### ReactDraw — Improvements Plan (2025-09-23)

This document outlines a thorough, prioritized set of improvements to the library and its documentation. The primary goals are: great first-run experience, accurate and up-to-date docs, interactive examples, API clarity, and a reliable publishing pipeline.

---

### Objectives

- Improve onboarding so devs can be productive in minutes.
- Keep documentation accurate and auto-synced with the code.
- Provide interactive examples, recipes, and deep-dive guides.
- Clarify API semantics, defaults, and supported patterns.
- Establish a stable release and documentation publishing workflow.

---

### Priorities

- P0: Fix outdated/mismatched documentation and add a live playground.
- P1: Autogenerate API docs from types, expand guides/recipes, and tidy examples.
- P2: Strengthen DX (packaging, CI, versioning, changelog), compatibility docs, and a11y.

---

### P0 — Immediate Documentation Fixes and Playground

1) Unify docs with source-of-truth types
- Auto-generate API reference from `src/types.ts` (Typedoc + Storybook Autodocs or TS Docgen). Ensure every public type is documented in code comments.
- Replace hand-written, drift-prone type snippets in stories with generated references or import live types.

2) Fix mismatches in Storybook MDX pages
- Update Type Descriptions to match current code:
  - `OnResizeContext` should use `shouldPreserveAspectRatio` (remove `mode`).
  - `DrawingData` fields: use `containerDiv` (not `container`), include `id`, `customData`, `style: ToolPropertiesMap` (string values), and `element`.
  - Ensure `ToolPropertiesMap` values are strings, not numbers, in examples.
- Correct any stale snippets that show old shapes or fields.

3) Storybook Playground
- Create a “Playground” story that exposes Controls for all `ReactDraw` props:
  - `layout` (default | fit | absolute object), `isResponsive`, `shouldCornerResizePreserveRatio`, `hideTopBar`, `hideBottomBar`, `shouldSelectAfterCreate`, `shouldKeepHistory`, `styleComponents`, `menuComponents`.
- Include toggles for common tool sets and demonstrate tool placement (top vs bottom) via `postition.view` and `postition.order`.

4) README revamp for npm users
- Add badges (npm version, downloads, bundle size), succinct value prop, feature bullets, compatibility matrix, and links to Storybook and CodeSandbox templates.
- Provide two examples: a 5-line minimal quickstart and a complete “all tools + styles + menu” example.
- Link to: API Reference, Guides (Custom Tool, Action Tool, Save/Load, External Control), and Playground.

5) Fix broken/duplicated code in stories
- In `stories/ReactDraw.stories.tsx`, clean up duplicated lines and truncated code in the “ExternalControls” docs source (e.g., duplicate Delete button, incomplete JSX). Ensure every example compiles if pasted into a project.

---

### P1 — API Clarity, Guides, and Example Coverage

1) API Reference (autogenerated)
- Generate and host API docs for:
  - `ReactDrawProps` (with default values), `DrawingTools`, `ActionTools`, `ReactDrawContext`, `ToolPropertiesMap`, `StylesObject`, `ClassNamesObject`, `Serializers`/`Deserializers`, and public utilities.
- Each prop should include: description, type, default, and usage example.

2) Prop semantics and defaults (document clearly)
- `id` defaults to "main".
- `actionTools` defaults to `[]`.
- `isResponsive` and `shouldCornerResizePreserveRatio` behaviors (what gets resized/scaled, when, and caveats).
- `styleComponents` order rules and how unioned styles are computed when multiple objects are selected.
- Style updates behavior when no selection: updates `globalStyles` (default styles for future objects).
- How bottom toolbar visibility is driven by `ActionTool.getDisplayMode`.

3) Tool positioning and ordering
- Document `BaseTool.postition.view` (top/bottom) and `postition.order` (render order). Include examples that mix drawing/action tools across top/bottom bars.
- Note: `postition` is misspelled; see P2 for deprecation plan.

4) Serialization Guide (Save/Load)
- Show `serializeObjects` and `deserializeData` end-to-end for all built-in tools with `Serializers`/`Deserializers` maps.
- Recommend embedding a `version` in the serialized format and describe migration strategy.
- Document the `shouldAddToCanvas` optional behavior.

5) Custom Tool Guide
- Step-through building a `DrawingTools` implementation with `onDrawStart`, `onDrawing`, `onDrawEnd`, `onResize`.
- Explain `styleHandlers`, `undoHandlers`/`redoHandlers`, and where to save extra state in `customData`.
- Provide a template and a runnable story.

6) Action Tool Guide
- How to implement `ActionTools` with `getDisplayMode` and `handleContext`.
- Examples: Undo, Redo, Duplicate, Bring Forward/Back, Clear.

7) External Control + Subscriptions
- Document `contextGetter` with examples to call: `getViewCenterPoint`, `createCircle`, `createImage` (with loading content), `createText`, `selectAll`, `duplicateSelectedObjects`, `bringSelectedBack`, `moveSelectedForward`, `deletedSelected`.
- Show how to subscribe to `selectTool` events (e.g., update UI with number of selected items).

8) Theming and Styling Guide
- Enumerate `styles` and `classNames` keys (tie them to constants in `src/constants.ts`).
- Demonstrate CSS-in-JS and plain CSS usage; show hover/active/disabled states for toolbar buttons and icons.
- Provide an advanced theming example with custom tokens and CSS variables.

9) Accessibility (a11y)
- Document keyboard interactions, focus management, ARIA labels, and tooltips.
- Provide accessible defaults and show how to extend/override.

10) Mobile/Touch Behavior
- Explain touch listener behavior, `passive` flags, and how to integrate gestures (pinch/zoom) if needed.
- Document known touch limitations and suggested UX patterns (bigger hit targets, tooltips on long press, etc.).

11) SSR / Next.js Guide
- Document using `dynamic()` with `ssr: false` when needed.
- Provide a Next.js App Router example (pages and app directories). Include caveats for client-only behaviors and style injection.

12) Recipes and Examples to Add
- “Preserve aspect ratio” resizing (show toggling `shouldCornerResizePreserveRatio`).
- Responsive mode example and caveats (what resizes/scales and when).
- Export to image (PNG/SVG) recipe.
- Drawing images with async loading indicators.
- Text editing modes (editable vs static text, default styles).
- Multi-select operations: select all, duplicate, align, move forward/back.

---

### P2 — Developer Experience, Packaging, and Release Process

1) Naming fixes (typed and runtime)
- `BaseTool.postition` → `position` (introduce new property, keep old as deprecated alias for a major version; document and warn in dev mode).
- `TOP_BAR_CONTAINER_CLASSES` string is currently `"topBarBontainer"` (typo). Either fix and alias, or document as-is and plan a breaking change with codemod guidance.

2) Package metadata and exports
- Add `repository`, `bugs`, and `homepage` to `package.json`.
- Consider `exports` map with ESM/CJS, and `sideEffects: false` if safe to improve tree-shaking.
- Confirm `types` path and ensure all public types are re-exported from `src/index.ts`.

3) Compatibility matrix
- Declare/test against React 17/18/19 and common bundlers (Vite, Webpack, Next.js). Keep `peerDependencies` up to date.
- Document SSR constraints and client-only behaviors.

4) Changelog and versioning
- Adopt Conventional Commits and generate `CHANGELOG.md` on release.
- Document breaking changes and migrations (e.g., `postition` → `position`, constants rename).

5) CI/CD
- GitHub Actions: type-check, lint, test, build, build Storybook, and deploy docs to GitHub Pages on release.
- Automate Storybook publish and link from README.

6) Testing and quality gates
- Expand unit tests for utilities (serialization, selection utils, style updates) and any logic in `ReactDraw` sensitive to regressions.
- Add visual regression tests for Storybook (Chromatic or Loki) for toolbar and canvas states.

7) Error messages and guardrails
- Improve development-time warnings: missing handlers on tools, serialization functions not provided, or unknown style keys.
- Add docs section for common errors and how to resolve them.

8) Security considerations
- Sanitize text content for `textAreaTool` to prevent XSS when deserializing.
- Document safe image loading patterns (CORS, fallbacks).

---

### Content Structure (Documentation IA)

- Get Started: Install, quickstart, minimal example.
- Core Concepts: Drawing vs Action tools, selection, styles, menus, layout, responsive behavior.
- API Reference: `ReactDraw` props with defaults, tool types, context, constants, and utilities.
- Guides: Custom Drawing Tool, Action Tool, Save/Load, External Control & Subscriptions, Theming/Styling, SSR/Next.js, Accessibility.
- Examples: Interactive Storybook playground and linked CodeSandboxes.
- Migration & Changelog: Versioned notes, breaking changes, deprecations.
- Contributing: Local dev, writing stories, tests, and release steps.

---

### Known Inconsistencies to Resolve

- Type Descriptions MDX out-of-date vs `src/types.ts` (e.g., `OnResizeContext`, `DrawingData`, style types).
- `stories/ReactDraw.stories.tsx` has duplicated/truncated demo code in docs source; clean up to valid, copy-pastable examples.
- `README` references props but omits newer props (`isResponsive`, `shouldCornerResizePreserveRatio`, `onLoad`, `contextGetter`, `styles`, `classNames`); update.
- Constant `TOP_BAR_CONTAINER_CLASSES` string value typo (`topBarBontainer`); decide alias vs breaking change timing.
- `BaseTool.postition` typo in types; provide deprecation path and migration note.

---

### High-ROI Quick Wins (1–2 days)

- Update README (badges, quickstart, live links, feature bullets, compatibility).
- Add Storybook Playground with Controls for all props.
- Fix Type Descriptions MDX to reflect `src/types.ts` exactly.
- Add MDX Guides: Custom Tool, Action Tool, Save/Load, External Control.
- Publish CodeSandbox templates and link from docs and README.

---

### Future Feature Ideas (optional, not immediate)

- Zoom/pan and mini-map; lasso selection; snap-to-grid/guides; rulers.
- Export and import themes; CSS variables for theming.
- Additional built-in tools (polygon, star, bezier path editor) as separate packages to keep core slim.
- Collaboration hooks (presence cursors, multi-user conflict strategies) as an advanced guide.

---

### Acceptance Criteria for This Initiative

- Storybook and README reflect the current API and behavior.
- An interactive Playground exists, covering all major props.
- Typed, auto-generated API docs are published and linked.
- Examples compile when copy-pasted; no broken snippets.
- A clear migration note exists for `postition` → `position` and constant typos.
- CodeSandbox templates enable instant trying without local setup.


