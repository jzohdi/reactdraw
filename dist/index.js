"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),e=require("styled-components");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=n(t),o=n(e);function i(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}const l={boxShadow:"#000000 0px 1px 3px 0px",borderRadius:4,overflow:"hidden",display:"flex",flexDirection:"column"};function c({children:t,layout:e}){const n=function(t){return"default"===t?{width:500,height:500,maxWidth:"100%"}:"fit"===t?{maxWidth:"100%"}:void 0}(e);return r.default.createElement("div",{style:Object.assign(Object.assign({},l),n)},t)}const a={light:"#bddefb",main:"#228be6"},d={light:"#ececec"},s=o.default.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  &:hover {
    background-color: ${d.light};
  }
  ${t=>t.selected&&e.css`
      background-color: ${a.main} !important;
      > svg path {
        fill: white;
      }
    `}
`;function u({children:t,selected:e,onSelect:n}){return r.default.createElement(s,{selected:e,onClick:n},t)}const h=o.default.div`
  display: flex;
  background-color: ${a.light};
`;function f({tools:t,onSelectTool:e,currentTool:n}){return r.default.createElement(h,null,t.map((t=>r.default.createElement(u,{key:t.id,selected:t.id===n,onSelect:()=>e(t.id)},t.icon))))}function p(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=n.length,o=0;o<t;o++)e+=n.charAt(Math.floor(Math.random()*r));return e}function g(t){let e=t.touches[0];return e||(e=t.targetTouches[0]),e||(e=t.changedTouches[0]),[e.clientX,e.clientY]}function m(t,e){if(!e)throw new Error("Container not set.");const n=e.getBoundingClientRect();return[t[0]-n.left,t[1]-n.top]}function w(){return void 0!==typeof window}function v(t,e){if(!w())throw new Error("new bounding div called on the server.");const[n,r]=t,{id:o,div:i,top:l,left:c,right:a,bottom:d}=function(t,e,n){const r=p(6),o=document.createElement("div"),i=t-n,l=e-n;return o.id=r,o.style.width=2*n+"px",o.style.height=2*n+"px",o.style.position="absolute",o.style.left=i+"px",o.style.top=l+"px",{div:o,id:r,top:l,left:i,right:i+n+n,bottom:l+n+n}}(n,r,e);return{coords:[t],element:null,container:{id:o,div:i,bounds:{top:l,left:c,right:a,bottom:d}},style:{lineWidth:e}}}function b(t,e){if(!w())throw new Error("createSVG called on server");const n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("viewbox",`0 0 ${t} ${e}`),n.style.width="100%",n.style.height="100%",n}function x(t,e,n){const r=e.div.getBoundingClientRect(),o=n.getBoundingClientRect(),i=r.top-o.top,l=t[1]-i,c=r.left-o.left;return[t[0]-c,l]}function y(t){return function(e){const{size:n,width:o,height:i,color:l}=e,c=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}(e,["size","width","height","color"]);return r.default.createElement(t,Object.assign({},c,{width:o||n||20,height:i||n||20,color:l||"#111827"}))}}var M=y((function(t){return r.default.createElement("svg",Object.assign({},t,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),r.default.createElement("path",{d:"M10.5858 0.585786C11.3668 -0.195262 12.6332 -0.195262 13.4142 0.585786C14.1953 1.36683 14.1953 2.63316 13.4142 3.41421L12.6213 4.20711L9.79289 1.37868L10.5858 0.585786Z",fill:t.color}),r.default.createElement("path",{d:"M8.37868 2.79289L0 11.1716V14H2.82842L11.2071 5.62132L8.37868 2.79289Z",fill:t.color}))})),E=y((function(t){return r.default.createElement("svg",Object.assign({},t,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),r.default.createElement("path",{d:"M5.67175 0.911473C5.52881 0.378007 4.98047 0.0614245 4.44701 0.204366C3.91354 0.347308 3.59696 0.895645 3.7399 1.42911L3.99872 2.39504C4.14166 2.9285 4.69 3.24509 5.22346 3.10214C5.75693 2.9592 6.07351 2.41086 5.93057 1.8774L5.67175 0.911473Z",fill:"#111827"}),r.default.createElement("path",{d:"M1.42911 3.7399C0.895645 3.59696 0.347308 3.91354 0.204366 4.44701C0.0614245 4.98047 0.378007 5.52881 0.911473 5.67175L1.8774 5.93057C2.41086 6.07351 2.9592 5.75693 3.10214 5.22346C3.24509 4.69 2.9285 4.14166 2.39504 3.99872L1.42911 3.7399Z",fill:"#111827"}),r.default.createElement("path",{d:"M10.2426 3.17149C10.6331 2.78097 10.6331 2.1478 10.2426 1.75728C9.85204 1.36676 9.21887 1.36676 8.82835 1.75728L8.12124 2.46439C7.73072 2.85491 7.73072 3.48808 8.12124 3.8786C8.51177 4.26912 9.14493 4.26912 9.53545 3.8786L10.2426 3.17149Z",fill:"#111827"}),r.default.createElement("path",{d:"M3.17149 10.2426L3.8786 9.53546C4.26912 9.14493 4.26912 8.51177 3.8786 8.12124C3.48808 7.73072 2.85491 7.73072 2.46439 8.12124L1.75728 8.82835C1.36676 9.21887 1.36676 9.85204 1.75728 10.2426C2.1478 10.6331 2.78097 10.6331 3.17149 10.2426Z",fill:"#111827"}),r.default.createElement("path",{d:"M6.37142 5.07152C6 4.92295 5.57578 5.01002 5.29292 5.29289C5.01006 5.57575 4.92298 5.99997 5.07155 6.37138L9.07155 16.3714C9.2178 16.737 9.56502 16.9828 9.95847 16.9991C10.3519 17.0155 10.7183 16.7994 10.8945 16.4472L12.274 13.6882L15.2929 16.7071C15.6834 17.0976 16.3166 17.0976 16.7071 16.7071C17.0977 16.3166 17.0977 15.6834 16.7071 15.2929L13.6882 12.2739L16.4472 10.8944C16.7995 10.7183 17.0155 10.3519 16.9992 9.95843C16.9828 9.56498 16.737 9.21777 16.3714 9.07152L6.37142 5.07152Z",fill:"#111827"}))}));const C={icon:r.default.createElement(E,{style:{transform:"translate(-2px, -1px)"}}),id:"react-draw-cursor",onDrawStart:t=>{t.container.div.style.border=`1px solid ${a.main}`,t.container.div.style.backgroundColor=a.light+"4d"},onDrawing:t=>{!function(t){if(t.coords.length<2)throw new Error("data coords must be at least length 2");const[e,n]=t.coords[0],[r,o]=t.coords[t.coords.length-1],i=Math.min(e,r),l=Math.min(n,o),c=Math.max(e,r),a=Math.max(n,o),{bounds:d,div:s}=t.container;d.left=i,d.right=c,d.top=l,d.bottom=a,s.style.top=l+"px",s.style.left=i+"px",s.style.width=c-i+"px",s.style.height=a-l+"px",t.coords}(t),t.coords.splice(1)},onDrawEnd:t=>{var e;const n=t.container.div;n.style.border="none",n.style.backgroundColor="transparent",null===(e=n.parentElement)||void 0===e||e.removeChild(n)}};const L={icon:r.default.createElement(M,null),onDrawStart:t=>{const e=t.style.lineWidth,n=b(e,e),r=function(t){if(!w())throw new Error("createPath called on server");const e=document.createElementNS("http://www.w3.org/2000/svg","circle");return e.setAttribute("fill","black"),e.setAttribute("cx",`${Math.ceil(t/2)}`),e.setAttribute("cy",`${Math.ceil(t/2)}`),e.setAttribute("r",`${t}`),e}(e/2);n.appendChild(r),t.container.div.appendChild(n),t.element=n},onDrawing:(t,e)=>{!function(t){let e=!1;const[n,r]=t.coords[t.coords.length-1],o=t.container,i=o.bounds,l=t.style.lineWidth;n-l<=i.left?(i.left=n-l,o.div.style.left=n-l+"px",o.div.style.width=i.right+2*l-n+"px",e=!0):n+l>=i.right&&(i.right=n+l,o.div.style.width=n+2*l-i.left+"px",e=!0),r+l>=i.bottom?(i.bottom=r+l,o.div.style.height=r+2*l-i.top+"px",e=!0):r-l<=i.top&&(i.top=r-l,o.div.style.top=r-l+"px",o.div.style.height=i.bottom+2*l-r+"px",e=!0)}(t);const n=function(t){const e=t.container.bounds;return{width:e.right-e.left,height:e.bottom-e.top}}(t),r=b(n.width,n.height),o=function(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("fill","transparent"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","4px"),n.setAttribute("stroke-linejoin","round"),n.setAttribute("stroke-linecap","round"),n.setAttribute("d",function(t,e){let n="";for(let r=0;r<t.coords.length;r++){const o=x(t.coords[r],t.container,e);n+=0===r?`M ${o[0]} ${o[1]}`:`L ${o[0]} ${o[1]}`,r!==t.coords.length-1&&(n+="")}return n}(t,e)),n}(t,e);o.style.width="100%",o.style.height="100%",r.appendChild(o),t.container.div.innerHTML="",t.container.div.appendChild(r),t.element=r},onDrawEnd:t=>{console.log(t)},cursor:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjU4NTggMC41ODU3ODZDMTEuMzY2OCAtMC4xOTUyNjIgMTIuNjMzMiAtMC4xOTUyNjIgMTMuNDE0MiAwLjU4NTc4NkMxNC4xOTUzIDEuMzY2ODMgMTQuMTk1MyAyLjYzMzE2IDEzLjQxNDIgMy40MTQyMUwxMi42MjEzIDQuMjA3MTFMOS43OTI4OSAxLjM3ODY4TDEwLjU4NTggMC41ODU3ODZaIiBmaWxsPSIjMTExODI3Ii8+CjxwYXRoIGQ9Ik04LjM3ODY4IDIuNzkyODlMMCAxMS4xNzE2VjE0SDIuODI4NDJMMTEuMjA3MSA1LjYyMTMyTDguMzc4NjggMi43OTI4OVoiIGZpbGw9IiMxMTE4MjciLz4KPC9zdmc+') 0 16, pointer"};exports.ReactDraw=function(e){var{children:n,topBarTools:o}=e,l=i(e,["children","topBarTools"]);const a=t.useRef(null),d=t.useMemo((()=>function(t){return[C].concat(t.map((t=>{var{id:e}=t,n=i(t,["id"]);if("react-draw-cursor"===e)throw new Error("Cannot give tool with reserved cursor id");return e?Object.assign({id:e},n):Object.assign(Object.assign({},n),{id:p(6)})})))}(o)),[o]),[s,u]=t.useState(d[0]),{layout:h}=function(e,n){const r=t.Children.count(e);if(r>1)throw new Error("ReactDraw expects either 0 or 1 children, detected more.");void 0===n&&(n="default");return{numChildren:r,layout:n}}(n,l.layout),w=t.useRef({}),b=t.useRef(null),[x,y]=t.useState(4),M=t.useRef(`drawing-area-container-${p(6)}`);return t.useEffect((()=>{const t=a.current;if(t)return t.addEventListener("mousedown",e),t.addEventListener("mouseup",r),t.addEventListener("mousemove",n),t.addEventListener("touchstart",o,{passive:!1}),t.addEventListener("touchmove",l,{passive:!1}),t.addEventListener("touchcancel",i),t.addEventListener("touchend",i),()=>{t.removeEventListener("mousedown",e),t.removeEventListener("mouseup",r),t.removeEventListener("mousemove",n),t.removeEventListener("touchstart",o),t.removeEventListener("touchmove",l),t.removeEventListener("touchcancel",i),t.removeEventListener("touchend",i)};function e(e){if(!t)return;const n=v(m([e.clientX,e.clientY],t),x);b.current=n,null==t||t.append(n.container.div),s.onDrawStart(n,t)}function n(e){const n=b.current;if(!n||!t)return;const r=m([e.clientX,e.clientY],t);n.coords.push(r),s.onDrawing(n,t)}function r(){const e=b.current;e&&t&&(b.current=null,w.current[e.container.id]=e,s.onDrawEnd(e,t))}function o(e){m(g(e),t)}function i(){}function l(e){m(g(e),t)}}),[s]),r.default.createElement(c,{layout:h},r.default.createElement(f,{tools:d,onSelectTool:t=>{if(s.id!==t){const e=d.find((e=>e.id===t));e&&u(e)}},currentTool:s.id}),r.default.createElement("div",{id:M.current,style:{position:"relative",width:"100%",flex:1,boxSizing:"border-box"},ref:a},n),r.default.createElement("div",null),r.default.createElement("style",null,`\n\t\t#${M.current} {\n\t\t\tcursor: ${s.cursor||"defautl"};\n\t\t}\n\t  `))},exports.freeDrawTool=L;
