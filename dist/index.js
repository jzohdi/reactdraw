"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),e=require("styled-components");function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=o(t),r=o(e);const i={boxShadow:"#000000 0px 1px 3px 0px",borderRadius:4,overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",fontFamily:"sans-serif"};function l({children:t,layout:e}){const o=function(t){return"default"===t?{width:500,height:500,maxWidth:"100%"}:"fit"===t?{maxWidth:"100%"}:void 0}(e);return n.default.createElement("div",{style:Object.assign(Object.assign({},i),o)},t)}const c="react-draw-erase-tool",a="react-draw-cursor",s={light:"#bddefb",main:"#228be6"},d={light:"#ececec"},u=r.default.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  &:hover {
    background-color: ${d.light};
  }
  ${t=>t.selected&&e.css`
      background-color: ${s.main} !important;
      > svg path {
        fill: white;
      }
    `}
`;function f({children:t,selected:e,onSelect:o}){return n.default.createElement(u,{selected:e,onClick:o},t)}const p=r.default.span`
  position: relative;
  display: inline-block;
`,h=r.default.span`
  visibility: hidden;
  /* min-width: 120px; */
  white-space: nowrap;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 10px;
  position: absolute;
  z-index: 1000;
  ${t=>t.open&&!t.disabled?e.css`
        visibility: visible;
        top: ${t.top};
        left: ${t.left};
      `:e.css`
      visibility: hidden;
      top: ${t.top};
      left: ${t.left};
    `}
`;function w({children:e,text:o,top:r,left:i,disabled:l}){const[c,a]=t.useState(!1),s=t.useRef(null);return t.useEffect((()=>{const t=s.current;if(t)return t.addEventListener("mouseover",e),t.addEventListener("mouseleave",o),()=>{t.removeEventListener("mouseover",e),t.removeEventListener("mouseleave",o)};function e(){a(!0),("ontouchstart"in window||navigator.maxTouchPoints>0)&&setTimeout((()=>{a(!1)}),1e3)}function o(){a(!1)}}),[]),o?n.default.createElement(p,{ref:s},n.default.createElement(h,{open:c,left:i,top:r,disabled:l},o),e):n.default.createElement(n.default.Fragment,null,e)}const g=r.default.div`
  display: flex;
  background-color: ${s.light};
  z-index: 1000;
`;function b({tools:t,onSelectTool:e,currentTool:o}){return n.default.createElement(g,null,t.map(((r,i)=>{const l=r.tooltip;return n.default.createElement(w,Object.assign({text:l},((e,o)=>e.tooltip?o<=t.length/2?{top:"50px",left:"0"}:{top:"50px",left:`-${3*e.tooltip.length}px`}:{top:"",left:""})(r,i),{key:r.id}),n.default.createElement(f,{selected:r.id===o,onSelect:()=>e(r.id)},r.icon))})))}function m(t){for(var e="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=o.length,r=0;r<t;r++)e+=o.charAt(Math.floor(Math.random()*n));return e}function y(){return void 0!==typeof window}function v(t,e,o){if(!y())throw new Error("new bounding div called on the server.");const n=parseInt(e.lineWidth),[r,i]=t,{id:l,div:c,top:a,left:s,right:d,bottom:u}=function(t,e,o,n){const r=m(6),i=document.createElement("div"),l=t-o,c=e-o;return i.id=`${n}-${r}`,i.style.width=2*o+"px",i.style.height=2*o+"px",i.style.position="absolute",i.style.left=l+"px",i.style.top=c+"px",i.style.pointerEvents="none",i.style.zIndex="1",i.style.boxSizing="border-box",{div:i,id:r,top:c,left:l,right:l+o+o,bottom:c+o+o}}(r,i,n,o);return{coords:[t],element:null,toolId:o,container:{id:l,div:c,bounds:{top:a,left:s,right:d,bottom:u}},style:e,customData:new Map}}function x(t,e){const{width:o,height:n}=function(t){const e=t.getAttribute("viewbox");if(!e)throw new Error("no viewbox found on ele");const o=e.split(" ");return{width:parseFloat(o[2]),height:parseFloat(o[3])}}(t),r=(e.right-e.left)/o,i=(e.bottom-e.top)/n;t.lastElementChild.style.transform=`scale(${r}, ${i})`}function E(t,e,o){const n=e.div.getBoundingClientRect(),r=o.getBoundingClientRect(),i=n.top-r.top,l=t[1]-i,c=n.left-r.left;return[t[0]-c,l]}function M(t){let e=!1;const[o,n]=t.coords[t.coords.length-1],r=t.container,i=r.bounds,l=parseInt(t.style.lineWidth);return o-l<=i.left?(i.left=o-l,r.div.style.left=o-l+"px",r.div.style.width=i.right+2*l-o+"px",e=!0):o+l>=i.right&&(i.right=o+l,r.div.style.width=o+2*l-i.left+"px",e=!0),n+l>=i.bottom?(i.bottom=n+l,r.div.style.height=n+2*l-i.top+"px",e=!0):n-l<=i.top&&(i.top=n-l,r.div.style.top=n-l+"px",r.div.style.height=i.bottom+2*l-n+"px",e=!0),e}function C(t){if(t.coords.length<2)throw new Error("data coords must be at least length 2");const[e,o]=t.coords[0],[n,r]=t.coords[t.coords.length-1],i=parseInt(t.style.lineWidth),l=Math.min(e,n),c=Math.min(o,r),a=Math.max(e,n),s=Math.max(o,r),{bounds:d,div:u}=t.container;return d.left=l,d.right=a,d.top=c,d.bottom=s,u.style.top=c+"px",u.style.left=l+"px",u.style.width=`${a-l+i}px`,u.style.height=`${s-c+i}px`,t.coords}function j(t,e){return t.top<=e.top&&t.bottom>=e.bottom&&t.left<=e.left&&t.right>=e.right}function I(t){const[e,o]=t;return{top:o,right:e,bottom:o,left:e}}function L(t){const e=t.container.bounds;return{width:e.right-e.left,height:e.bottom-e.top}}function S(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o}function T(t){const{size:e,width:o,height:n,color:r}=t,i=S(t,["size","width","height","color"]);return Object.assign({width:o||e||20,height:n||e||20,color:r||"#111827"},i)}function D(t){const e=T(t),{color:o}=e,r=S(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 5C3 4.44772 3.44772 4 4 4H16C16.5523 4 17 4.44772 17 5C17 5.55228 16.5523 6 16 6H4C3.44772 6 3 5.55228 3 5Z",fill:o}),n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 10C3 9.44772 3.44772 9 4 9H16C16.5523 9 17 9.44772 17 10C17 10.5523 16.5523 11 16 11H4C3.44772 11 3 10.5523 3 10Z",fill:o}),n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 15C3 14.4477 3.44772 14 4 14H16C16.5523 14 17 14.4477 17 15C17 15.5523 16.5523 16 16 16H4C3.44772 16 3 15.5523 3 15Z",fill:o}))}const k=r.default.div`
  display: flex;
  background-color: ${s.light};
  z-index: 1000;
`,O=r.default.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  ${t=>"hide"===t.mode?e.css`
        display: none;
      `:t.disabled?e.css`
        cursor: not-allowed;
        background-color: white;
        > svg path {
          fill: lightgrey;
          stroke: lightgrey;
        }
      `:e.css`
      &:hover {
        background-color: ${d.light};
      }
      display: inline-block;
    `}
`,A=r.default.button`
  position: relative;
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  &:hover {
    background-color: ${d.light};
  }
  ${t=>t.open?e.css`
        background-color: ${s.main} !important;
        > svg path {
          fill: white;
          stroke: white;
        }
      `:e.css``}
`,N=r.default.div`
  position: absolute;
  left: 0;
  padding: 15px;
  border: 1px solid ${s.main};
  z-index: 1000;
  background-color: white;
  border-radius: 0px 5px 0px 0px;
  @media only screen and (min-width: ${450}px) {
    bottom: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    bottom: 30px;
  }
`;function z({tools:e,displayMap:o,dispatch:r,hasMenu:i,children:l}){const[c,a]=t.useState(!1);return n.default.createElement(n.default.Fragment,null,c&&n.default.createElement(N,null,l),n.default.createElement(k,null,i&&n.default.createElement(w,{text:"Menu",top:"-40px",left:"10px"},n.default.createElement(A,{onClick:()=>a(!c),open:c},n.default.createElement(D,{size:30}))),e.map(((t,i)=>{const l=t.id,c=o.get(l)||"hide";return n.default.createElement(w,Object.assign({key:t.id,text:t.tooltip},((t,o)=>t.tooltip?o<=e.length/2?{top:"-35px",left:"0"}:{top:"-35px",left:`-${3*t.tooltip.length}px`}:{top:"",left:""})(t,i),{disabled:"disabled"===c}),n.default.createElement(O,{disabled:"disabled"===c,mode:c,onClick:()=>r(t.handleContext)},t.icon))}))))}function U(t,e){const o=t.container.id,{div:n}=t.container,r=e.fullState[a],i=r.handlers[o];if(i)for(const t of i)t.ele.removeEventListener(t.eventName,t.fn);const l=n.querySelector('[id^="select-frame"');r.handlers[o]=[],null!==l&&n.removeChild(l);const c=r.selectedIds.indexOf(o);c>=0&&r.selectedIds.splice(c,1)}function $(t,e){for(const o in e)t.style[o]=e[o];return t}function R(t,e){const o=t.find((t=>t.id===e));if(!o)throw new Error("could not find the used tool");return o}function W(t,e){const{objectsMap:o,viewContainer:n}=e,r=P(e.objectsMap,t);U(r,e);const{div:i,id:l}=r.container;n.removeChild(i),o.delete(l);const c=R(e.drawingTools,r.toolId);c.onDeleteObject&&c.onDeleteObject(r,e)}function P(t,e){const o=t.get(e);if(!o)throw new Error("could not get object from map");return o}function H(t,e){if(!e)throw new Error("Container not set.");const o=e.getBoundingClientRect();return[t[0]-o.left,t[1]-o.top]}function Z(t){let e=t.touches[0];return e||(e=t.targetTouches[0]),e||(e=t.changedTouches[0]),[e.clientX,e.clientY]}function B(t,e){const o=e.querySelectorAll(t);o.length>0&&o.forEach((t=>{e.removeChild(t)}))}function Y(t){return void 0!==t}function V(t,e){const[o,n]=e,r=t.container,i=r.bounds,l=r.div;i.left+5>=i.right+o||i.bottom-5<=i.top+n||(i.top+=n,i.right+=o,l.style.top=i.top+"px",l.style.width=i.right-i.left+"px",l.style.height=i.bottom-i.top+"px")}function K(t,e){const[o,n]=e,r=t.container,i=r.bounds,l=r.div;i.left+o>=i.right-5||i.bottom-5<=i.top+n||(i.top+=n,i.left+=o,l.style.top=i.top+"px",l.style.left=i.left+"px",l.style.width=i.right-i.left+"px",l.style.height=i.bottom-i.top+"px")}function q(t,e){const[o,n]=e,r=t.container,i=r.bounds,l=r.div;i.left+5>=i.right+o||i.bottom+n<=i.top+5||(i.right+=o,i.bottom+=n,l.style.width=i.right-i.left+"px",l.style.height=i.bottom-i.top+"px")}function Q(t,e){const[o,n]=e,r=t.container,i=r.bounds,l=r.div;i.left+o>=i.right-5||i.bottom+n<=i.top+5||(i.bottom+=n,i.left+=o,l.style.left=i.left+"px",l.style.width=i.right-i.left+"px",l.style.height=i.bottom-i.top+"px")}const F={top:"-45px",cursor:"grab",left:"calc(50% - 8px)"},X={width:"calc(100% + 16px)",height:"calc(100% + 16px)",position:"absolute",border:`2px dotted ${s.main}`,top:"-6px",left:"-6px",cursor:"all-scroll",pointerEvents:"all",boxSizing:"border-box"},G={width:"0px",height:"35px",borderLeft:"2px dotted black",position:"absolute",left:"5px",pointerEvents:"none"},J={position:"absolute",borderRadius:"50%",width:"16px",height:"16px"};function _(t,e){return t.map((t=>{const o=e.get(t);if(!o)throw new Error("object not found in map");return o}))}function tt(t,e){const o=t.toolId,n=e.drawingTools.find((t=>t.id===o));n&&n.onAfterUpdate&&n.onAfterUpdate(t,e)}function et(t,e,o){return{objectId:t.container.id,toolId:t.toolId,toolType:"top-bar-tool",action:e,data:o}}function ot(t){const e=t.element;if(!e)throw new Error;let o=e.querySelector("path");if(o||(o=e.querySelector("line")),!o)throw new Error;return o}const nt=/^(#([0-9A-F]{3}){1,2}|transparent)$/i;function rt(t,e,o,n){if(!n.match(nt))return;const r=ot(t),i=t.style[e];return r.style[o]=n,t.style[e]=n,et(t,e,i)}function it(t,e){return rt(t,"color","stroke",e)}function lt(t,e){const{ele:o,action:n}=ct(t,e,"background");return n?(o.style.backgroundColor=e,n):n}function ct(t,e,o){const n=t.element;if(!n)throw new Error;if(!e.match(nt))return{ele:n,action:void 0};const r=t.style[o];t.style[o]=e;return{ele:n,action:et(t,o,r)}}function at(t,e){const{ele:o,action:n}=ct(t,e,"color");return n?(o.style.border=st(t.style),n):n}function st(t){return`${t.lineWidth}px solid ${t.color}`}function dt(t,e,o,n){if(!n.match(nt))return;const r=t.style[e];return t.style[e]=n,t.container.div.style[o]=n,et(t,e,r)}function ut(t,e){if(!e.shouldKeepHistory)return;ht({toolId:t.toolId,toolType:"top-bar-tool",objectId:t.container.id,action:"create",data:null},e)}function ft(t,e){const o=P(e.objectsMap,t.objectId);return W(t.objectId,e),t.data=o,t.action="delete",t}function pt(t,e){const o=t.data;if(!o)throw new Error("redo delete but no data exists");return e.objectsMap.set(o.container.id,o),e.viewContainer.appendChild(o.container.div),t.data=null,t.action="create",t}function ht(t,e){e.shouldKeepHistory&&(e.undoStack.push(t),e.redoStack.splice(0))}function wt(t,e){const o=t.data;if(!o||"object"!=typeof o)throw new Error("malformed data");for(const[t,n]of o.entries())e.viewContainer.appendChild(n.container.div),e.objectsMap.set(t,n);return t.action="create",t.data=Array.from(o.keys()),t}function gt(t,e){const o=t.data;if(!o||!Array.isArray(o))throw console.error(t),new Error("malformed data");t.data=new Map;for(const n of o)t.data.set(n,P(e.objectsMap,n)),W(n,e);return t.action="delete",t}function bt(t,e){const o=P(e.objectsMap,t.objectId),n=o.style.opacity,r=t.data,i=o.element;if(!r||!i)throw new Error;return o.style.opacity=r,i.style.opacity=o.style.opacity,t.data=n,t}function mt(t,e){const o=P(e.objectsMap,t.objectId),n=o.style.lineWidth,r=t.data,i=o.element;if(!r||!i)throw new Error;return o.style.lineWidth=r,i.style.border=st(o.style),t.data=n,t}function yt(t,e){const o=P(e.objectsMap,t.objectId),n=o.style.background,r=t.data,i=o.element;if(!r||!i)throw new Error;return o.style.background=r,i.style.backgroundColor=r,t.data=n,t}function vt(t,e){const o=P(e.objectsMap,t.objectId),n=o.style.color,r=t.data,i=o.element;if(!r||!i)throw new Error;return o.style.color=r,i.style.border=st(o.style),t.data=n,t}function xt(t,e){return Mt(t,e,"color","stroke")}function Et(t,e){return Mt(t,e,"background","fill")}function Mt(t,e,o,n){const r=P(e.objectsMap,t.objectId),i=r.style[o],l=t.data,c=r.element;if(!c)throw new Error;let a=c.querySelector("path");if(a||(a=c.querySelector("line")),!a)throw new Error;return r.style[o]=l,a.style[n]=l,t.data=i,t}function Ct(t,e){const o=P(e.objectsMap,t.objectId),n=o.style.lineWidth,r=t.data,i=ot(o);return o.style.lineWidth=r,i.style.strokeWidth=r+"px",t.data=n,t}function jt(t,e){const o=t.fullState[a],n=o.prevPoint;if(!n)return;const r=_(o.selectedIds,t.objectsMap);!function(t,e,o){const[n,r]=o,[i,l]=e,c=n-i,a=r-l;for(const e of t){const{bounds:t,div:o}=e.container,{left:n,top:r,right:i,bottom:l}=t;t.left=n+c,t.top=r+a,t.right=t.left+(i-n),t.bottom=t.top+(l-r),o.style.top=t.top+"px",o.style.left=t.left+"px"}}(r,n,e),o.prevPoint=e,1===r.length&&tt(r[0],t)}function It(t,e){t.fullState[a].prevPoint=e,function(t){const e=_(t.fullState[a].selectedIds,t.objectsMap),o={objectId:"",toolId:a,toolType:"top-bar-tool",action:"drag",data:e.map((t=>({objectId:t.container.id,top:t.container.bounds.top,left:t.container.bounds.left})))};ht(o,t)}(t)}function Lt(t){t.fullState[a].prevPoint=null}function St(t,e,o){const n=function(t){t.stopPropagation();const e=H([t.clientX,t.clientY],o.viewContainer);It(o,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)},r=function(t){t.stopPropagation();const e=H([t.clientX,t.clientY],o.viewContainer);jt(o,e)},i=function(t){t.stopPropagation(),Lt(o),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)},l=function(t){t.stopPropagation();const e=H(Z(t),o.viewContainer);It(o,e),window.addEventListener("touchmove",c),window.addEventListener("touchend",s),window.addEventListener("touchcancel",s)},c=function(t){t.stopPropagation();const e=H(Z(t),o.viewContainer);jt(o,e)},s=function(t){t.stopPropagation(),Lt(o),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s)},d=o.fullState[a],u=d.handlers[e]||[];d.handlers[e]=u,u.push({ele:t,eventName:"mousedown",fn:n}),u.push({ele:t,eventName:"touchstart",fn:l}),t.addEventListener("mousedown",n),t.addEventListener("touchstart",l)}function Tt(t,e,o){const n=t.fullState[a],r=n.prevPoint;if(!r)return;const i=_(n.selectedIds,t.objectsMap);if(1!==i.length)throw new Error("start rotating got incorrect number of objects to handle");const l=i[0],c=(d=r,[(s=e)[0]-d[0],s[1]-d[1]]);var s,d;const u=R(t.drawingTools,l.toolId),f={viewContainer:t.viewContainer,newPoint:e,previousPoint:r};u.doResize?u.doResize(l,f):o(l,c),u.onResize(l,f),n.prevPoint=e}function Dt(t,e){t.fullState[a].prevPoint=e,function(t){const e=_(t.fullState[a].selectedIds,t.objectsMap);if(1!==e.length)throw new Error("resize push to stack expects 1 object selected");const{id:o,bounds:n}=e[0].container;ht({objectId:o,toolId:a,toolType:"top-bar-tool",action:"resize",data:{bounds:{top:n.top,left:n.left,right:n.right,bottom:n.bottom}}},t)}(t)}function kt(t){t.fullState[a].prevPoint=null}function Ot(t,e,o,n){const r=function(t){t.stopPropagation();const e=H([t.clientX,t.clientY],o.viewContainer);Dt(o,e),window.addEventListener("mousemove",i),window.addEventListener("mouseup",l)},i=function(t){t.stopPropagation();const e=H([t.clientX,t.clientY],o.viewContainer);Tt(o,e,n)},l=function(t){t.stopPropagation(),kt(o),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",l)},c=function(t){t.stopPropagation();const e=H(Z(t),o.viewContainer);Dt(o,e),window.addEventListener("touchmove",s),window.addEventListener("touchend",d),window.addEventListener("touchcancel",d)},s=function(t){t.stopPropagation();const e=H(Z(t),o.viewContainer);Tt(o,e,n)},d=function(t){t.stopPropagation(),kt(o),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",d),window.removeEventListener("touchcancel",d)},u=o.fullState[a],f=u.handlers[e]||[];u.handlers[e]=f,f.push({ele:t,eventName:"mousedown",fn:r}),f.push({ele:t,eventName:"touchstart",fn:c}),t.addEventListener("mousedown",r),t.addEventListener("touchstart",c)}const At=/-{0,1}\d+\.*\d*/g;function Nt(t){const e=t.style.transform;if(!e)return 0;const o=e.match(At);return o?parseFloat(o[0]):0}function zt(t,e){const o=t.fullState[a];if(!o.prevPoint)return;const n=_(o.selectedIds,t.objectsMap);if(1!==n.length)throw new Error("start rotating got incorrect number of objects to handle");const r=n[0];!function(t,e,o){const n=t.container.div,r=e[0]-o[0],i=e[1]-o[1],l=180*Math.atan2(i,r)/Math.PI+90;n.style.transform=`rotate(${l}deg)`}(r,e,function(t){const e=t.bottom-t.top,o=t.top+e/2,n=t.right-t.left;return[t.left+n/2,o]}(r.container.bounds)),o.prevPoint=e,tt(r,t)}function Ut(t,e){t.fullState[a].prevPoint=e,function(t){const e=_(t.fullState[a].selectedIds,t.objectsMap),o={objectId:"",toolId:a,toolType:"top-bar-tool",action:"rotate",data:e.map((t=>({objectId:t.container.id,rotate:Nt(t.container.div)})))};ht(o,t)}(t)}function $t(t){t.fullState[a].prevPoint=null}function Rt(t,e){for(const o of t){const t=Wt(o);t&&(St(t,o.container.id,e),o.container.div.appendChild(t))}}function Wt(t){const e=t.container.div,o=t.container.id;if(function(t){return null!==t.querySelector('[id^="select-frame"')}(e))return null;const n=document.createElement("div");return n.setAttribute("id",`select-frame-${o}`),$(n,X),n}function Pt(t,e){for(const o of t)U(o,e)}function Ht(t,e){const o=Wt(t);o&&(St(o,t.container.id,e),function(t,e,o){const n=e.container.id,r=Zt(n,!0,!1,!1,!0);Ot(r,n,o,K);const i=Zt(n,!0,!0);Ot(i,n,o,V);const l=Zt(n,!1,!0,!0);Ot(l,n,o,q);const c=Zt(n,!1,!1,!0,!0);Ot(c,n,o,Q),t.appendChild(r),t.appendChild(i),t.appendChild(l),t.appendChild(c);const s=Zt(n);s.id=`button-rotate-${n}`,$(s,F),function(t,e,o){const n=function(t){t.stopPropagation();const e=H([t.clientX,t.clientY],o.viewContainer);Ut(o,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)},r=function(t){t.stopPropagation();const e=H([t.clientX,t.clientY],o.viewContainer);zt(o,e)},i=function(t){t.stopPropagation(),$t(o),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)},l=function(t){t.stopPropagation();const e=H(Z(t),o.viewContainer);Ut(o,e),window.addEventListener("touchmove",c),window.addEventListener("touchend",s),window.addEventListener("touchcancel",s)},c=function(t){t.stopPropagation();const e=H(Z(t),o.viewContainer);zt(o,e)},s=function(t){t.stopPropagation(),$t(o),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s)},d=o.fullState[a],u=d.handlers[e]||[];d.handlers[e]=u,u.push({ele:t,eventName:"mousedown",fn:n}),u.push({ele:t,eventName:"touchstart",fn:l}),t.addEventListener("mousedown",n),t.addEventListener("touchstart",l)}(s,n,o);const d=document.createElement("div");$(d,G),d.id=`line-div-${n}`,s.appendChild(d),t.appendChild(s)}(o,t,e),t.container.div.appendChild(o))}function Zt(t,e,o,n,r){const i=document.createElement("button");$(i,J);let l="";return e?(i.style.top="-12px",l+="n"):n&&(i.style.bottom="-12px",l+="s"),o?(i.style.right="-12px",l+="e"):r&&(i.style.left="-12px",l+="w"),i.id=`corner-button-${l}-${t}`,i.style.cursor=`${l}-resize`,i}function Bt(t){const e=t.fullState[a];if(!e)throw new Error("no select state present");return[...e.selectedIds]}function Yt({getEditProps:e,styleComponents:o={},onUpdateStyle:r}){const[i,l]=t.useState(e()),c=Object.keys(i).filter((t=>!!o[t]));t.useEffect((()=>{function t(){const t=e();l(t)}return window.addEventListener("click",t),()=>{window.removeEventListener("click",t)}}),[i]);const a=(t,e)=>{l(Object.assign(Object.assign({},i),{[t]:e})),r(t,e)};return 0===c.length?n.default.createElement(n.default.Fragment,null):(c.sort(((t,e)=>{const n=o[t].order;return o[e].order-n})),n.default.createElement("div",{style:{display:"flex",flexDirection:"column",gap:10}},c.map((t=>{const e=o[t].component;return n.default.createElement(e,{key:t,onUpdate:a,styleKey:t,styleValue:i[t]})}))))}function Vt(t,e){const o=t.find((t=>t.id===e));if(!o)throw new Error("could not find the used tool");return o}function Kt(t){const e=t.fullState[a].selectedIds;if(e.length>0){Pt(_(e,t.objectsMap),t)}}const qt={lineWidth:"4",zIndex:"1",color:"#000000",fontSize:"14",background:"transparent",opacity:"1"};function Qt(t){const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("fill","transparent"),e.setAttribute("stroke",t.color),e.style.strokeWidth=`${t.lineWidth}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}function Ft(t,e,o){if(!y())throw new Error("createSVG called on server");const n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("viewbox",`0 0 ${t} ${e}`),n.style.overflow="visible",n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.opacity=o,n.style.width="100%",n.style.height="100%",n}function Xt(t,e){if(!y())throw new Error("createPath called on server");const o=document.createElementNS("http://www.w3.org/2000/svg","circle");return o.setAttribute("fill","black"),o.setAttribute("cx",`${Math.ceil(t/2)}`),o.setAttribute("cy",`${Math.ceil(t/2)}`),o.setAttribute("r",`${t}`),o}const Gt=/^[0-9]+$/g;function Jt(t,e){const o=t.element;if(!o)throw new Error;if(!e.match(Gt))return;const n=t.style.lineWidth;t.style.lineWidth=e,o.style.border=st(t.style);return et(t,"lineWidth",n)}function _t(t,e){const o=e.includes("px")?e:e+"px",n=ot(t),r="lineWidth",i=t.style[r];return n.style.strokeWidth=o,t.style[r]=e,et(t,r,i)}const te=/^(0(\.\d+)?|1(\.0+)?)$/;function ee(t,e){if(!e.match(te))return;const o=t.element;if(!o)throw new Error;const n=t.style.opacity;return t.style.opacity=e,o.style.opacity=e,et(t,"opacity",n)}const oe={id:"free-draw-tool",tooltip:"Free draw tool",icon:n.default.createElement((function(t){const e=T(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M10.5858 0.585786C11.3668 -0.195262 12.6332 -0.195262 13.4142 0.585786C14.1953 1.36683 14.1953 2.63316 13.4142 3.41421L12.6213 4.20711L9.79289 1.37868L10.5858 0.585786Z",fill:e.color}),n.default.createElement("path",{d:"M8.37868 2.79289L0 11.1716V14H2.82842L11.2071 5.62132L8.37868 2.79289Z",fill:e.color}))}),null),getEditableStyles:()=>["color","lineWidth","opacity"],onDrawStart:t=>{const e=parseInt(t.style.lineWidth),o=Ft(e,e,t.style.opacity);o.style.overflow="visible";const n=Xt(e/2,t.style.color);o.appendChild(n),t.container.div.appendChild(o),t.element=o},onDrawing:(t,{viewContainer:e})=>{M(t);const o=L(t),n=Ft(o.width,o.height,t.style.opacity);n.style.overflow="visible";const r=function(t,e){const o=Qt(t.style);return o.setAttribute("d",function(t,e){let o="";for(let n=0;n<t.coords.length;n++){o+=ne(E(t.coords[n],t.container,e),n),n!==t.coords.length-1&&(o+=" ")}return o}(t,e)),o}(t,e);n.appendChild(r),t.container.div.innerHTML="",t.container.div.appendChild(n),t.element=n},onDrawEnd:(t,e)=>{ut(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize:(t,e)=>{t.element&&x(t.element,t.container.bounds)},onUndo(t,e){if("create"===t.action)return ft(t,e);if("color"===t.action)return xt(t,e);if("lineWidth"===t.action)return Ct(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return pt(t,e);if("color"===t.action)return xt(t,e);if("lineWidth"===t.action)return Ct(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("unsupported action:",t),new Error},onUpdateStyle(t,e,o,n){if("color"===o)return it(t,n);if("lineWidth"===o)return _t(t,n);if("opacity"===o)return ee(t,n);throw console.log(o,n,t),new Error("unknown update style action")},cursor:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjU4NTggMC41ODU3ODZDMTEuMzY2OCAtMC4xOTUyNjIgMTIuNjMzMiAtMC4xOTUyNjIgMTMuNDE0MiAwLjU4NTc4NkMxNC4xOTUzIDEuMzY2ODMgMTQuMTk1MyAyLjYzMzE2IDEzLjQxNDIgMy40MTQyMUwxMi42MjEzIDQuMjA3MTFMOS43OTI4OSAxLjM3ODY4TDEwLjU4NTggMC41ODU3ODZaIiBmaWxsPSIjMTExODI3Ii8+CjxwYXRoIGQ9Ik04LjM3ODY4IDIuNzkyODlMMCAxMS4xNzE2VjE0SDIuODI4NDJMMTEuMjA3MSA1LjYyMTMyTDguMzc4NjggMi43OTI4OVoiIGZpbGw9IiMxMTE4MjciLz4KPC9zdmc+') 0 16, pointer"};function ne(t,e){return 0===e?`M ${t[0]} ${t[1]}`:`L ${t[0]} ${t[1]}`}function re(t,e){const o=t.data,n=[];for(const t of o){const o=P(e.objectsMap,t.objectId),{bounds:r,div:i}=o.container,{left:l,top:c}=t;n.push({objectId:t.objectId,top:r.top,left:r.left}),r.top=c,r.left=l,i.style.left=l+"px",i.style.top=c+"px",tt(o,e)}return t.data=n,t}function ie(t,e){const o=t.data,n=[];for(const t of o){const o=P(e.objectsMap,t.objectId),{div:r}=o.container,i=Nt(r);n.push({objectId:t.objectId,rotate:i}),r.style.transform=`rotate(${t.rotate}deg)`,tt(o,e)}return t.data=n,t}function le(t,e){const o=P(e.objectsMap,t.objectId),n=t.data,r=o.container.bounds,i=Object.assign({},r);var l,c;l=o.container.div,c=n.bounds,l.style.left=c.left+"px",l.style.top=c.top+"px",l.style.width=c.right-c.left+"px",l.style.height=c.bottom-c.top+"px",o.container.bounds=n.bounds;return R(e.drawingTools,o.toolId).onResize(o,Object.assign(Object.assign({},e),{previousPoint:[r.left,r.top],newPoint:[n.bounds.left,n.bounds.top]})),t.data.bounds=i,t}const ce={tooltip:"Select tool",icon:n.default.createElement((function(t){const e=T(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M5.67175 0.911473C5.52881 0.378007 4.98047 0.0614245 4.44701 0.204366C3.91354 0.347308 3.59696 0.895645 3.7399 1.42911L3.99872 2.39504C4.14166 2.9285 4.69 3.24509 5.22346 3.10214C5.75693 2.9592 6.07351 2.41086 5.93057 1.8774L5.67175 0.911473Z",fill:e.color}),n.default.createElement("path",{d:"M1.42911 3.7399C0.895645 3.59696 0.347308 3.91354 0.204366 4.44701C0.0614245 4.98047 0.378007 5.52881 0.911473 5.67175L1.8774 5.93057C2.41086 6.07351 2.9592 5.75693 3.10214 5.22346C3.24509 4.69 2.9285 4.14166 2.39504 3.99872L1.42911 3.7399Z",fill:e.color}),n.default.createElement("path",{d:"M10.2426 3.17149C10.6331 2.78097 10.6331 2.1478 10.2426 1.75728C9.85204 1.36676 9.21887 1.36676 8.82835 1.75728L8.12124 2.46439C7.73072 2.85491 7.73072 3.48808 8.12124 3.8786C8.51177 4.26912 9.14493 4.26912 9.53545 3.8786L10.2426 3.17149Z",fill:e.color}),n.default.createElement("path",{d:"M3.17149 10.2426L3.8786 9.53546C4.26912 9.14493 4.26912 8.51177 3.8786 8.12124C3.48808 7.73072 2.85491 7.73072 2.46439 8.12124L1.75728 8.82835C1.36676 9.21887 1.36676 9.85204 1.75728 10.2426C2.1478 10.6331 2.78097 10.6331 3.17149 10.2426Z",fill:e.color}),n.default.createElement("path",{d:"M6.37142 5.07152C6 4.92295 5.57578 5.01002 5.29292 5.29289C5.01006 5.57575 4.92298 5.99997 5.07155 6.37138L9.07155 16.3714C9.2178 16.737 9.56502 16.9828 9.95847 16.9991C10.3519 17.0155 10.7183 16.7994 10.8945 16.4472L12.274 13.6882L15.2929 16.7071C15.6834 17.0976 16.3166 17.0976 16.7071 16.7071C17.0977 16.3166 17.0977 15.6834 16.7071 15.2929L13.6882 12.2739L16.4472 10.8944C16.7995 10.7183 17.0155 10.3519 16.9992 9.95843C16.9828 9.56498 16.737 9.21777 16.3714 9.07152L6.37142 5.07152Z",fill:e.color}))}),{style:{transform:"translate(-2px, -1px)"}}),id:a,onDrawStart:t=>{t.container.div.style.border=`1px solid ${s.main}`,t.container.div.style.backgroundColor=s.light+"4d"},onDrawing:(t,e)=>{C(t),t.coords.splice(1),function(t,e){var o,n;const r=null!==(n=null===(o=e.lastEvent)||void 0===o?void 0:o.shiftKey)&&void 0!==n&&n,i=[...e.fullState[a].selectedIds];let l=function(t,e,o){const n=[];for(const[r,i]of t.entries())U(i,o),j(e,i.container.bounds)&&n.push(r);return n}(e.objectsMap,t.container.bounds,e);r&&(l=new Array(...new Set([...l,...i])));de(e,l)}(t,e)},onDrawEnd:(t,e)=>{const{objectsMap:o,viewContainer:n}=e;n.removeChild(t.container.div),o.delete(t.container.id),B('[id^="react-draw-cursor"',e.viewContainer),ae(t,e)},onResize:t=>{},onUnMount(t){for(const e of Object.values(t.objectsMap))U(e,t)},onUnPickTool(t){const e=t.fullState[a],o=e.selectedIds;if(0===o.length)return;Pt(_(o,t.objectsMap),t),e.selectedIds=[]},onKeyPress(t,e){if(!("Delete"===t.key))return;const o=e.fullState[a].selectedIds;if(o.length<1)return;ht(gt({toolId:a,toolType:"top-bar-tool",objectId:"",data:[...o],action:"delete"},e),e)},onUndo(t,e){const o=t.action;if("delete"===o)return wt(t,e);if("create"===o)return gt(t,e);if("drag"===o)return re(t,e);if("rotate"===o)return ie(t,e);if("resize"===o)return le(t,e);throw console.log("unsupported action",t),new Error},onRedo(t,e){const o=t.action;if("delete"===o)return wt(t,e);if("create"===o)return gt(t,e);if("drag"===o)return re(t,e);if("rotate"===o)return ie(t,e);if("resize"===o)return le(t,e);throw console.log("unsupported action",t),new Error}},ae=(t,e)=>{var o,n;const r=null!==(n=null===(o=e.lastEvent)||void 0===o?void 0:o.shiftKey)&&void 0!==n&&n,i=t.coords[0],l=t.coords[t.coords.length-1];if(c=l,a=i,Math.sqrt(Math.pow(Math.abs(c[0]-a[0]),2)+Math.pow(Math.abs(c[1]-a[1]),2))<75){const t=function(t,e){let{top:o,right:n,bottom:r,left:i}=t;const[l,c]=e;return c>r?r=c:c<o&&(o=c),l<i?i=l:l>n&&(n=l),{top:o,right:n,bottom:r,left:i}}(I(i),l);se(e,t,r)}var c,a},se=(t,e,o)=>{const n=function(t,e){var o;let n=null;for(const[r,i]of t.entries()){const t=parseInt(i.style.zIndex);j(i.container.bounds,e)&&(null!==(o=null==n?void 0:n.style.zIndex)&&void 0!==o?o:0<t)&&(n=i)}return n}(t.objectsMap,e);let{ids:r}=function(t){const e=[...t.fullState[a].selectedIds],{objectsMap:o,prevMousePosition:n}=t,r=_(e,o);if(Pt(r,t),1===r.length){const e=R(t.drawingTools,r[0].toolId);e&&t&&e.onUnSelect&&e.onUnSelect(r[0],t)}return n.current=null,{ids:e.splice(0,e.length),objects:r}}(t);return o||(r=[]),null!==n&&(r=r.concat([n.container.id])),de(t,r),r};function de(t,e){t.fullState[a].selectedIds=e;const o=_(e,t.objectsMap);return 1===o.length?(function(t,e,o){const n=R(t,e.toolId);n&&o&&n.onSelect&&n.onSelect(e,o)}(t.drawingTools,o[0],t),Ht(o[0],t)):o.length>1?Rt(o,t):void 0}const ue={id:"react-draw-square-tool",tooltip:"Square Tool",icon:n.default.createElement((function(t){const e=T(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("rect",{width:"16",height:"16",rx:"1",fill:e.color}))}),null),getEditableStyles:()=>["color","background","lineWidth","opacity"],onDrawStart:t=>{const e=function(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=`${t.lineWidth}px solid ${t.color}`,e.style.borderRadius="2px",e.style.boxSizing="border-box",e.style.backgroundColor=t.background,e.style.opacity=t.opacity,e}(t.style);t.container.div.appendChild(e),t.element=e},onDrawing:t=>{C(t),t.coords.splice(1)},onDrawEnd(t,e){ut(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onUndo(t,e){if("create"===t.action)return ft(t,e);if("color"===t.action)return vt(t,e);if("background"===t.action)return yt(t,e);if("lineWidth"===t.action)return mt(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return pt(t,e);if("color"===t.action)return vt(t,e);if("background"===t.action)return yt(t,e);if("lineWidth"===t.action)return mt(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("unsupported action:",t),new Error},onResize(t,e){},onUpdateStyle(t,e,o,n){if("color"===o)return at(t,n);if("background"===o)return lt(t,n);if("lineWidth"===o)return Jt(t,n);if("opacity"===o)return ee(t,n);throw console.log(o,n,t),new Error("unknown update style action")}};const fe={id:"react-draw-circle-tool",tooltip:"Circle tool",icon:n.default.createElement((function(t){const e=T(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("circle",{cx:"8",cy:"8",r:"8",fill:e.color}))}),null),getEditableStyles:()=>["color","background","lineWidth","opacity"],onDrawStart:t=>{const e=function(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=st(t),e.style.backgroundColor=t.background,e.style.borderRadius="50%",e.style.boxSizing="border-box",e.style.opacity=t.opacity,e}(t.style);t.container.div.appendChild(e),t.element=e},onDrawing:t=>{C(t),t.coords.splice(1)},onDrawEnd(t,e){ut(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){},onUndo(t,e){if("create"===t.action)return ft(t,e);if("color"===t.action)return vt(t,e);if("background"===t.action)return yt(t,e);if("lineWidth"===t.action)return mt(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return pt(t,e);if("color"===t.action)return vt(t,e);if("background"===t.action)return yt(t,e);if("lineWidth"===t.action)return mt(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("unsupported action:",t),new Error},onUpdateStyle(t,e,o,n){if("color"===o)return at(t,n);if("background"===o)return lt(t,n);if("lineWidth"===o)return Jt(t,n);if("opacity"===o)return ee(t,n);throw console.log(o,n,t),new Error("unknown update style action")}};const pe={id:"react-draw-diamond-tool",tooltip:"Diamond tool",icon:n.default.createElement((function(t){const e=T(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("rect",{x:"11",y:"-0.313721",width:"16",height:"16",rx:"1",transform:"rotate(45 11 -0.313721)",fill:e.color}))}),null),getEditableStyles:()=>["color","background","lineWidth","opacity"],onDrawStart:t=>{const e=t.container.div,o=he(t);e.appendChild(o)},onDrawing:t=>{C(t);const e=t.container.div,o=he(t);e.innerHTML="",e.appendChild(o),t.element=o,t.coords.splice(1)},onDrawEnd(t,e){ut(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){x(t.element,t.container.bounds)},onUndo(t,e){if("create"===t.action)return ft(t,e);if("color"===t.action)return xt(t,e);if("background"===t.action)return Et(t,e);if("lineWidth"===t.action)return Ct(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return pt(t,e);if("color"===t.action)return xt(t,e);if("background"===t.action)return Et(t,e);if("lineWidth"===t.action)return Ct(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("Unsupported action: ",t),new Error},onUpdateStyle(t,e,o,n){if("color"===o)return it(t,n);if("background"===o)return function(t,e){return rt(t,"background","fill",e)}(t,n);if("lineWidth"===o)return _t(t,n);if("opacity"===o)return ee(t,n);throw console.log(o,n,t),new Error("unknown update style action")}};function he(t){const e=parseInt(t.style.lineWidth),{bounds:o}=t.container,n=Ft(o.right-o.left+e,o.bottom-o.top+e,t.style.opacity),r=function(t,e){const o=Qt(e),n=parseInt(e.lineWidth);return o.setAttribute("d",function(t,e){const o=t.bottom-t.top,n=t.right-t.left,r=`${e/2} ${o/2}`;return`M ${r} L ${n/2} ${e/2} L ${n-e/2} ${o/2} L ${n/2} ${o-e/2} L ${r}`}(t,n)),o}(o,t.style);return n.appendChild(r),n}function we(t,e){const[o,n]=t,[r,i]=e;return r===o?i>n?"down":"up":i===n?r>o?"right":"left":r<o&&i<n?"nw":r>o&&i<n?"ne":r>o&&i>n?"se":"sw"}function ge(t,e,o){return"right"===o?[[0,0],[t,0]]:"left"===o?[[t,0],[0,0]]:"down"===o?[[0,0],[0,e]]:"up"===o?[[0,e],[0,0]]:"nw"===o?[[t,e],[0,0]]:"ne"===o?[[0,e],[t,0]]:"se"===o?[[0,0],[t,e]]:[[t,0],[0,e]]}const be={id:"react-draw-line-tool",tooltip:"Straight Line Tool",icon:n.default.createElement((function(t){const e=T(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 24 3",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("line",{y1:"1.5",x2:"24",y2:"1.5",stroke:"black",strokeWidth:"3"}))}),null),getEditableStyles:()=>["color","lineWidth","opacity"],onDrawStart:t=>{const e=t.container.div,o=parseInt(t.style.lineWidth),n=Ft(o,o,t.style.opacity),r=Xt(o/2,t.style.color);n.appendChild(r),e.append(n),t.element=n},onDrawing:(t,e)=>{C(t);const o=we(t.coords[0],t.coords[t.coords.length-1]);t.customData.set("orientation",o);const n=me(t,o),r=t.container.div;r.innerHTML="",r.appendChild(n),t.element=n,t.coords.splice(1)},onDrawEnd(t,e){ut(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){const o=t.customData.get("orientation");if(!o)throw new Error("orientation not set");const n=me(t,o),r=t.container.div;r.removeChild(t.element),r.appendChild(n),t.element=n,t.coords.splice(1)},onUndo(t,e){if("create"===t.action)return ft(t,e);if("color"===t.action)return xt(t,e);if("lineWidth"===t.action)return Ct(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return pt(t,e);if("color"===t.action)return xt(t,e);if("lineWidth"===t.action)return Ct(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("unsupported action:",t),new Error},onUpdateStyle(t,e,o,n){if("color"===o)return it(t,n);if("lineWidth"===o)return _t(t,n);if("opacity"===o)return ee(t,n);throw console.log(o,n,t),new Error("unknown update style action")}};function me(t,e){const{bounds:o}=t.container,n=o.right-o.left,r=o.bottom-o.top,i=Ft(n,r,t.style.opacity);i.style.overflow="visible";const[l,c]=ge(n,r,e),a=function(t){const e=document.createElementNS("http://www.w3.org/2000/svg","line");return e.setAttribute("fill","transparent"),e.setAttribute("stroke",t.color),e.style.strokeWidth=`${t.lineWidth}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}(t.style);return a.setAttribute("x1",l[0].toString()),a.setAttribute("y1",l[1].toString()),a.setAttribute("x2",c[0].toString()),a.setAttribute("y2",c[1].toString()),i.appendChild(a),i}const ye={icon:n.default.createElement("span",{style:{display:"inline-block",fontWeight:"bold",fontSize:"20px"}},"A"),id:"react-draw-textarea-tool",tooltip:"Textarea Tool",cursor:"text",getEditableStyles:()=>["color","background","fontSize","opacity"],onDrawStart:(t,e)=>{!function(t,e){const o=12,n=5,{div:r,bounds:i}=t.container;i.bottom=i.top+o+n,r.style.height="",r.style.minHeight=i.bottom-i.top+"px",r.style.minWidth=r.style.width,r.style.width="",r.style.border="1px solid black",r.style.backgroundColor=t.style.background,r.style.padding=n+"px",r.style.borderRadius="2px",r.style.boxSizing="border-box",r.style.color=t.style.color,r.style.fontSize=`${t.style.fontSize}px`;const l=document.createElement("style");l.innerHTML="\n\t.react-draw-cursor {\n\t\toutline: none;\t\t\n\t\theight: 100%;\n\t}",r.appendChild(l);const c=function(){const t=document.createElement("div");return t.setAttribute("contenteditable","true"),t.style.minWidth="1px",t.style.height="100%",t.className="react-draw-cursor",t}();function a(){const t=r.getBoundingClientRect(),{width:e,height:o}=t;i.bottom=i.top+o,i.right=i.left+e}c.style.opacity=t.style.opacity,t.element=c,t.customData.set("handler",a),c.addEventListener("keypress",a),r.appendChild(c),je(r,i),c.setAttribute("tabindex","1"),function(t,e){const o=t.element,n=t.customData;function r(o){const r=(new Date).getTime(),i=n.get("lastCapture");if(i){if(r-i>5e3){const n=o.target;ht({toolId:t.toolId,action:"input",data:n.innerHTML,toolType:"top-bar-tool",objectId:t.container.id},e)}}else{ht({toolId:t.toolId,action:"input",data:"",toolType:"top-bar-tool",objectId:t.container.id},e)}n.set("lastCapture",r)}o.addEventListener("input",r),n.set("capture",r)}(t,e),setTimeout((function(){c.focus()}),0)}(t,e)},onDrawing(t,e){},onDrawEnd(t,e){ut(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){Ce(t,!1),Ie(t.element)},onSelect(t,e){Ce(t,!1),Ie(t.element)},onUnSelect(t){Ce(t,!1),je(t.container.div,t.container.bounds)},onAfterUpdate(t,e){Ce(t,!1),Ie(t.element)},onUndo(t,e){if("create"===t.action)return ft(t,e);if("input"===t.action)return ve(t,e);if("color"===t.action)return xe(t,e);if("background"===t.action)return Ee(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return pt(t,e);if("input"===t.action)return ve(t,e);if("color"===t.action)return xe(t,e);if("background"===t.action)return Ee(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("unsupported action:",t),new Error},onDeleteObject(t,e){Ce(t,!0)},onUpdateStyle(t,e,o,n){if("color"===o)return function(t,e){return dt(t,"color","color",e)}(t,n);if("background"===o)return function(t,e){return dt(t,"background","backgroundColor",e)}(t,n);if("opacity"===o)return ee(t,n);throw console.log(o,n,t),new Error("unknown update style action")}};function ve(t,e){const o=P(e.objectsMap,t.objectId).element;if(!o)throw new Error("tried to undo text but no ele found");const n=o.innerHTML,r=t.data;return o.innerHTML=r,t.data=n,t}function xe(t,e){return Me(t,e,"color","color")}function Ee(t,e){return Me(t,e,"background","backgroundColor")}function Me(t,e,o,n){const r=P(e.objectsMap,t.objectId),i=r.style[o],l=t.data;return r.style[o]=l,r.container.div.style[n]=l,t.data=i,t}function Ce(t,e){const o=t.element;if(!o)return;const n=t.customData.get("handler");n&&(o.removeEventListener("keypress",n),t.customData.delete("handler"));const r=t.customData.get("capture");e&&r&&(o.removeEventListener("input",r),t.customData.delete("capture"))}function je(t,e){const o=t.getBoundingClientRect(),{width:n,height:r}=o;e.bottom=e.top+r,e.right=e.left+n}function Ie(t){if(t.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);const o=window.getSelection();if(o)return o.removeAllRanges(),o.addRange(e),!0}return console.error("cannot place caret at end"),!1}const Le={icon:n.default.createElement((function(t){const e=T(t),{color:o}=e,r=S(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M10.0616 0.586573L5.31159 5.33657L0.581585 10.1766C0.209084 10.5513 0 11.0582 0 11.5866C0 12.1149 0.209084 12.6218 0.581585 12.9966L4.88159 17.2966C5.06785 17.4813 5.31925 17.5855 5.58159 17.5866H17.5816V15.5866H10.5816L17.8016 8.36657C17.9875 8.18083 18.1351 7.96025 18.2357 7.71745C18.3364 7.47466 18.3882 7.2144 18.3882 6.95157C18.3882 6.68874 18.3364 6.42849 18.2357 6.18569C18.1351 5.9429 17.9875 5.72232 17.8016 5.53657L12.8916 0.586573C12.7058 0.40062 12.4853 0.253102 12.2425 0.152454C11.9997 0.0518053 11.7394 0 11.4766 0C11.2138 0 10.9535 0.0518053 10.7107 0.152454C10.4679 0.253102 10.2473 0.40062 10.0616 0.586573V0.586573ZM5.99159 15.5866L1.99159 11.5866L6.74159 6.74657L7.48159 5.99657L12.4316 10.9466L7.87159 15.5066L7.80159 15.5866H5.99159Z",fill:o}))}),null),tooltip:"Eraser tool",id:c,cursor:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOSAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjA2MTYgMC41ODY1NzNMNS4zMTE1OSA1LjMzNjU3TDAuNTgxNTg1IDEwLjE3NjZDMC4yMDkwODQgMTAuNTUxMyAwIDExLjA1ODIgMCAxMS41ODY2QzAgMTIuMTE0OSAwLjIwOTA4NCAxMi42MjE4IDAuNTgxNTg1IDEyLjk5NjZMNC44ODE1OSAxNy4yOTY2QzUuMDY3ODUgMTcuNDgxMyA1LjMxOTI1IDE3LjU4NTUgNS41ODE1OSAxNy41ODY2SDE3LjU4MTZWMTUuNTg2NkgxMC41ODE2TDE3LjgwMTYgOC4zNjY1N0MxNy45ODc1IDguMTgwODMgMTguMTM1MSA3Ljk2MDI1IDE4LjIzNTcgNy43MTc0NUMxOC4zMzY0IDcuNDc0NjYgMTguMzg4MiA3LjIxNDQgMTguMzg4MiA2Ljk1MTU3QzE4LjM4ODIgNi42ODg3NCAxOC4zMzY0IDYuNDI4NDkgMTguMjM1NyA2LjE4NTY5QzE4LjEzNTEgNS45NDI5IDE3Ljk4NzUgNS43MjIzMiAxNy44MDE2IDUuNTM2NTdMMTIuODkxNiAwLjU4NjU3M0MxMi43MDU4IDAuNDAwNjIgMTIuNDg1MyAwLjI1MzEwMiAxMi4yNDI1IDAuMTUyNDU0QzExLjk5OTcgMC4wNTE4MDUzIDExLjczOTQgMCAxMS40NzY2IDBDMTEuMjEzOCAwIDEwLjk1MzUgMC4wNTE4MDUzIDEwLjcxMDcgMC4xNTI0NTRDMTAuNDY3OSAwLjI1MzEwMiAxMC4yNDczIDAuNDAwNjIgMTAuMDYxNiAwLjU4NjU3M1YwLjU4NjU3M1pNNS45OTE1OSAxNS41ODY2TDEuOTkxNTkgMTEuNTg2Nkw2Ljc0MTU5IDYuNzQ2NTdMNy40ODE1OSA1Ljk5NjU3TDEyLjQzMTYgMTAuOTQ2Nkw3Ljg3MTU5IDE1LjUwNjZMNy44MDE1OSAxNS41ODY2SDUuOTkxNTlaIiBmaWxsPSJibGFjayI+PC9wYXRoPgo8L3N2Zz4=') 0 16, pointer",onDrawStart(t,e){},onDrawing(t,e){const o=e.viewContainer;M(t);const n=L(t),r=Ft(n.width,n.height,"1"),i=function(t,e){const o=Qt(t.style);return o.style.strokeWidth="10px",o.setAttribute("d",function(t,e){let o="",n=t.coords[0];for(let r=0;r<t.coords.length;r++){const i=E(t.coords[r],t.container,e);o+=Te(i,n,r),n=i,r!==t.coords.length-1&&(o+=" ")}return o}(t,e)),o.setAttribute("stroke","rgba(232, 16, 84, 0.142)"),o}(t,o);r.appendChild(i),t.container.div.innerHTML="",t.container.div.appendChild(r),t.element=r;const l=I(t.coords[t.coords.length-1]),c=e.objectsMap.keys();for(const t of c){const o=e.objectsMap.get(t);o&&(j(o.container.bounds,l)&&(W(t,e),Se(e,o)))}},onDrawEnd(t,e){const{objectsMap:o,viewContainer:n}=e;n.removeChild(t.container.div),o.delete(t.container.id),B('[id^="react-draw-erase-tool"',e.viewContainer);if(e.fullState[c].deletedObjects.size>0){const o={toolId:t.toolId,toolType:"top-bar-tool",objectId:"",action:"delete",data:e.fullState[c].deletedObjects};e.fullState[c].deletedObjects=new Map,ht(o,e)}},onUndo(t,e){if("delete"===t.action)return wt(t,e);throw console.error("unrecognized action",t),new Error},onRedo(t,e){if("create"===t.action)return gt(t,e);throw console.error("unrecognized action",t),new Error},onResize(t,e){}};function Se(t,e){t.fullState[c].deletedObjects.set(e.container.id,e)}function Te(t,e,o){return 0===o?`M ${t[0]} ${t[1]}`:`l ${t[0]-e[0]} ${t[1]-e[1]}`}const De={id:"react-draw-undo-tool",tooltip:"Undo",icon:n.default.createElement((function(t){const e=T(t),{color:o}=e,r=S(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M8.4345 1.3088e-05C6.17654 0.00387579 4.12643 0.851527 2.61286 2.2295L1.39599 1.07024C0.88081 0.57945 0 0.927028 0 1.62108V5.97259C0 6.40284 0.36611 6.75162 0.817742 6.75162H5.38548C6.11402 6.75162 6.47887 5.91251 5.96372 5.42172L4.54119 4.06653C5.59281 3.12847 6.95357 2.60886 8.39923 2.59698C11.5475 2.57108 14.2012 4.99825 14.174 8.09701C14.1482 11.0366 11.6466 13.5032 8.45 13.5032C7.0487 13.5032 5.7243 13.0268 4.68055 12.1543C4.51894 12.0193 4.27488 12.0275 4.12285 12.1723L2.77146 13.4597C2.60546 13.6178 2.61367 13.8757 2.78789 14.0256C4.28626 15.3149 6.27188 16.1 8.45 16.1C13.1168 16.1 16.9 12.4959 16.9 8.05007C16.9 3.6093 13.0959 -0.00793953 8.4345 1.3088e-05Z",fill:o}))}),null),getDisplayMode:t=>t.undoStack.length>0?"show":"disabled",handleContext(t){const e=t.undoStack.pop();if(e){if("top-bar-tool"===e.toolType){const o=R(t.drawingTools,e.toolId);if(o.onUndo){const n=o.onUndo(e,t);t.shouldKeepHistory&&t.redoStack.push(n)}}if("batch"===e.toolType){const o=e.data,n=[];for(const e of o){const o=R(t.drawingTools,e.toolId);o.onUndo&&n.push(o.onUndo(e,t))}e.data=n,t.shouldKeepHistory&&t.redoStack.push(e)}}}},ke={id:"react-draw-redo-tool",tooltip:"Redo",icon:n.default.createElement((function(t){const e=T(t),{color:o}=e,r=S(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M8.28183 1.34403e-05C10.4908 0.0039801 12.4964 0.874446 13.9771 2.28951L15.1676 1.09901C15.6716 0.595046 16.5333 0.951979 16.5333 1.66471V6.13334C16.5333 6.57517 16.1752 6.93334 15.7333 6.93334H11.2647C10.552 6.93334 10.195 6.07164 10.699 5.56764L12.0907 4.17598C11.0619 3.21268 9.73063 2.67908 8.31633 2.66688C5.2364 2.64028 2.64023 5.13278 2.66687 8.31494C2.69213 11.3336 5.13947 13.8667 8.26667 13.8667C9.63757 13.8667 10.9332 13.3774 11.9543 12.4815C12.1124 12.3428 12.3512 12.3512 12.4999 12.4999L13.822 13.822C13.9844 13.9844 13.9763 14.2491 13.8059 14.4031C12.3401 15.7271 10.3975 16.5333 8.26667 16.5333C3.70113 16.5333 3.33336e-05 12.8322 2.23918e-10 8.26674C-3.33331e-05 3.70644 3.72153 -0.00815322 8.28183 1.34403e-05Z",fill:o}))}),null),getDisplayMode:t=>t.redoStack.length>0?"show":"disabled",handleContext(t){const e=t.redoStack.pop();if(e)if("top-bar-tool"===e.toolType){const o=R(t.drawingTools,e.toolId);if(o.onRedo){const n=o.onRedo(e,t);t.shouldKeepHistory&&t.undoStack.push(n)}}else if("batch"===e.toolType){const o=e.data,n=[];for(const e of o){const o=R(t.drawingTools,e.toolId);o.onRedo&&n.push(o.onRedo(e,t))}e.data=n,t.shouldKeepHistory&&t.undoStack.push(e)}}},Oe={id:"react-draw-trash-tool",icon:n.default.createElement((function(t){const e=T(t),{color:o}=e,r=S(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 14 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0C5.62123 0 5.27497 0.214002 5.10557 0.552786L4.38197 2H1C0.447715 2 0 2.44772 0 3C0 3.55228 0.447716 4 1 4L1 14C1 15.1046 1.89543 16 3 16H11C12.1046 16 13 15.1046 13 14V4C13.5523 4 14 3.55228 14 3C14 2.44772 13.5523 2 13 2H9.61804L8.89443 0.552786C8.72504 0.214002 8.37877 0 8 0H6ZM4 6C4 5.44772 4.44772 5 5 5C5.55228 5 6 5.44772 6 6V12C6 12.5523 5.55228 13 5 13C4.44772 13 4 12.5523 4 12V6ZM9 5C8.44771 5 8 5.44772 8 6V12C8 12.5523 8.44771 13 9 13C9.55229 13 10 12.5523 10 12V6C10 5.44772 9.55229 5 9 5Z",fill:o}))}),null),tooltip:"Delete selected objects",getDisplayMode:t=>Bt(t).length>0?"show":"disabled",handleContext(t){const e=Bt(t);if(e.length<1)return;ht(gt({toolId:a,toolType:"top-bar-tool",objectId:"",data:[...e],action:"delete"},t),t)}},Ae={id:"react-draw-duplicate-tool",tooltip:"Duplicate objects",icon:n.default.createElement((function(t){const e=T(t),{color:o}=e,r=S(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M4 6C4 4.89543 4.89543 4 6 4H12C13.1046 4 14 4.89543 14 6V12C14 13.1046 13.1046 14 12 14H6C4.89543 14 4 13.1046 4 12V6Z",fill:o}),n.default.createElement("path",{d:"M2 0C0.895431 0 0 0.89543 0 2V8C0 9.10457 0.89543 10 2 10L2 2H10C10 0.895431 9.10457 0 8 0H2Z",fill:o}))}),null),getDisplayMode:t=>Bt(t).length>0?"show":"disabled",handleContext(t){const e=Bt(t);if(e.length<1)return;const o=e.map((e=>P(t.objectsMap,e)));Pt(o,t);const n=o.map((e=>function(t,e){const{div:o,id:n,bounds:r}=t.container,i=o.cloneNode(!0),{newId:l,divId:c}=function(t){const e=m(6),o=t.split("-");return o[o.length-1]=m(6),{divId:o.join("-"),newId:e}}(o.id);i.id=c;const a={coords:t.coords.slice(0),toolId:t.toolId,element:i.lastElementChild,style:Object.assign({},t.style),customData:new Map(t.customData),container:{bounds:{top:r.top+10,left:r.left+10,bottom:r.bottom+10,right:r.right+10},div:i,id:l}};i.style.top=a.container.bounds.top+"px",i.style.left=a.container.bounds.left+"px";const s=R(e.drawingTools,t.toolId);if(s.onDuplicate)return s.onDuplicate(a,e);return a}(e,t))),r=new Map;ht(wt({toolId:a,objectId:"",toolType:"top-bar-tool",action:"delete",data:n.reduce(((t,e)=>(t.set(e.container.id,e),t)),r)},t),t),1===e.length?Ht(n[0],t):Rt(n,t);t.fullState[a].selectedIds=n.map((t=>t.container.id))}};const Ne={id:"react-draw-back-tool",icon:n.default.createElement((function(t){const e=T(t),{color:o}=e,r=S(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M15 17L5 9L15 1V17Z",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),n.default.createElement("path",{d:"M1 16V2",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}),null),tooltip:"Move object back",getDisplayMode:t=>Bt(t).length>0?"show":"disabled",handleContext(t){const e=Bt(t);if(e.length<1)return;const o=e.map((e=>P(t.objectsMap,e)));let n=1/0;for(const e of t.objectsMap.values()){const t=ze(e);t<n&&(n=t)}o.forEach((t=>{t.container.div.style.zIndex=n.toString(),t.style.zIndex=n.toString()}))}};function ze(t){const e=parseInt(t.style.zIndex);return t.container.div.style.zIndex=(e+1).toString(),t.style.zIndex=(e+1).toString(),e}const Ue={id:"react-draw-forward-tool",tooltip:"Move object forward",icon:n.default.createElement((function(t){const e=T(t),{color:o}=e,r=S(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M1 1L11 9L1 17V1Z",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),n.default.createElement("path",{d:"M15 2V16",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}),null),getDisplayMode:t=>Bt(t).length>0?"show":"disabled",handleContext(t){const e=Bt(t);if(e.length<1)return;const o=e.map((e=>P(t.objectsMap,e)));let n=-1/0;for(const e of t.objectsMap.values()){const t=$e(e);t>n&&(n=t)}o.forEach((t=>{t.container.div.style.zIndex=n.toString(),t.style.zIndex=n.toString()}))}};function $e(t){const e=parseInt(t.style.zIndex);return t.container.div.style.zIndex=(e-1).toString(),t.style.zIndex=(e-1).toString(),e}function Re({onUpdate:e,styleKey:o,label:r,styleValue:i}){const l=t.useRef(m(5));return n.default.createElement("div",null,n.default.createElement("div",{style:{textAlign:"left",marginBottom:5}},n.default.createElement("label",{style:{fontWeight:"bold"},htmlFor:l.current},r)),n.default.createElement("div",{style:{display:"flex"}},n.default.createElement("span",{style:{display:"inline-block",borderRadius:5,width:30,height:30,backgroundColor:i}}),n.default.createElement("div",{style:{marginLeft:10,display:"flex"}},n.default.createElement("span",{style:{borderRadius:"5px 0px 0px 5px",width:30,padding:5,fontWeight:"bold",fontSize:18,textAlign:"center",color:"grey",backgroundColor:"lightgray"}},"#"),n.default.createElement("input",{id:l.current,value:i.replace("#",""),onChange:t=>{const n=t.target.value;e(o,"transparent"===n?n:"#"+n)},style:{width:80,borderRadius:"0px 5px 5px 0px"}}))))}const We={icon:n.default.createElement((function(t){const e=T(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 16 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.2929 0.292893C10.6834 -0.0976311 11.3166 -0.0976311 11.7071 0.292893L15.7071 4.29289C16.0976 4.68342 16.0976 5.31658 15.7071 5.70711L11.7071 9.70711C11.3166 10.0976 10.6834 10.0976 10.2929 9.70711C9.90237 9.31658 9.90237 8.68342 10.2929 8.29289L12.5858 6H1C0.447716 6 -2.41411e-08 5.55228 0 5C2.41411e-08 4.44772 0.447716 4 1 4H12.5858L10.2929 1.70711C9.90237 1.31658 9.90237 0.683418 10.2929 0.292893Z",fill:e.color}))}),null),id:"react-draw-arrow-tool",getEditableStyles:()=>["color","lineWidth","opacity"],onDrawStart:t=>{const e=t.container.div,o=parseInt(t.style.lineWidth),n=Ft(o,o,t.style.opacity),r=Xt(o/2,t.style.color);n.appendChild(r),e.append(n),t.element=n},onDrawing:(t,{viewContainer:e})=>{C(t);const o=we(t.coords[0],t.coords[t.coords.length-1]);t.customData.set("orientation",o);const n=Pe(t,o),r=t.container.div;r.innerHTML="",r.appendChild(n),t.element=n,t.coords.splice(1)},onDrawEnd:(t,e)=>{ut(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){const o=t.customData.get("orientation");if(!o)throw new Error("orientation not set");const n=Pe(t,o),r=t.container.div;r.removeChild(t.element),r.appendChild(n),t.element=n,t.coords.splice(1)},onUndo(t,e){if("create"===t.action)return ft(t,e);if("color"===t.action)return xt(t,e);if("lineWidth"===t.action)return Ct(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return pt(t,e);if("color"===t.action)return xt(t,e);if("lineWidth"===t.action)return Ct(t,e);if("opacity"===t.action)return bt(t,e);throw console.error("unsupported action:",t),new Error},onUpdateStyle(t,e,o,n){if("color"===o)return it(t,n);if("lineWidth"===o)return _t(t,n);if("opacity"===o)return ee(t,n);throw console.log(o,n,t),new Error("unknown update style action")}};function Pe(t,e){const o=parseInt(t.style.lineWidth),{bounds:n}=t.container,r=n.right-n.left,i=n.bottom-n.top,[l,c]=ge(r,i,e),a=Ft(r+o,i+o,t.style.opacity);a.style.overflow="visible";const s=function(t,e,o){const[n,r]=e,[i,l]=o,c=Qt(t.style),a=[n-i,r-l],[s,d]=a,u=Math.sqrt(s*s+d*d),f=[s/u,d/u],[p,h]=f,w=p*(Math.sqrt(3)/2)-.5*h,g=1*p/2+h*(Math.sqrt(3)/2),b=p*(Math.sqrt(3)/2)+.5*h,m=.5*-p+h*(Math.sqrt(3)/2),y=20,[v,x,E,M]=[-w*y,-g*y,-b*y,-m*y];return c.setAttribute("d",`M ${n} ${r} L ${i} ${l} L ${i-v} ${l-x} L ${i} ${l} L ${i-E} ${l-M}`),c}(t,l,c);return a.appendChild(s),a}exports.BackgroundStyle=t=>n.default.createElement(Re,Object.assign({},t,{label:"background"})),exports.ColorStyle=t=>n.default.createElement(Re,Object.assign({},t,{label:"color"})),exports.LineWidthStyle=function({onUpdate:e,styleKey:o,styleValue:r}){const i=t.useRef(m(5));return n.default.createElement("div",null,n.default.createElement("div",{style:{textAlign:"left",marginBottom:5}},n.default.createElement("label",{style:{fontWeight:"bold"},htmlFor:i.current},"line width")),n.default.createElement("div",{style:{width:"100%"}},n.default.createElement("input",{id:i.current,value:r,onChange:t=>{const n=t.target.value;e(o,n)},type:"number",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",step:"1"})))},exports.OpacityStyle=function({onUpdate:e,styleKey:o,styleValue:r}){const i=t.useRef(m(5));return n.default.createElement("div",null,n.default.createElement("div",{style:{textAlign:"left",marginBottom:5}},n.default.createElement("label",{style:{fontWeight:"bold"},htmlFor:i.current},"opacity")),n.default.createElement("div",{style:{width:"100%"}},n.default.createElement("input",{id:i.current,value:r,onChange:t=>{const n=t.target.value;e(o,n)},type:"number",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",max:"1",step:"0.1"})))},exports.ReactDraw=function(e){var{children:o,id:r="main",topBarTools:i,hideTopBar:s,bottomBarTools:d,hideBottomBar:u,shouldKeepHistory:f=!0,shouldSelectAfterCreate:p=!0,styleComponents:h}=e,w=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o}(e,["children","id","topBarTools","hideTopBar","bottomBarTools","hideBottomBar","shouldKeepHistory","shouldSelectAfterCreate","styleComponents"]);const g=t.useRef(null),[m,y]=t.useState(i[0]),{layout:x}=function(e,o){const n=t.Children.count(e);if(n>1)throw new Error("ReactDraw expects either 0 or 1 children, detected more.");void 0===o&&(o="default");return{numChildren:n,layout:o}}(o,w.layout),E=t.useRef(new Map),M=t.useRef(null),C=t.useRef(`drawing-area-container-${r}`),j=t.useRef(null),I=t.useRef(null),L=t.useRef(function(t){const e={[a]:{selectedIds:[],handlers:{},prevPoint:null},[c]:{deletedObjects:new Map}};return t.reduce(((t,o)=>(void 0===t[o.id]&&(t[o.id]={}),o.setupCustomState&&(t[o.id]=Object.assign(t[o.id],o.setupCustomState(e))),t)),e)}(i)),S=t.useRef([]),T=t.useRef([]),D=t.useRef(null),k=t.useRef(Object.assign({},qt)),[O,A]=t.useState(new Map),N=()=>{const t=(()=>{const t=new Map;return d.reduce(((t,e)=>(t.set(e.id,e.getDisplayMode($())),t)),t)})();if(t.size!==O.size)return A(t);const e=t.keys();for(const o of e)if(t.get(o)!==O.get(o))return A(t)};t.useEffect((()=>{N()}),[]),t.useEffect((()=>{if(m.id===a){const t=D.current;if(t){const e=$();Kt(e),e.fullState[a].selectedIds=[t.container.id],Ht(t,e)}}N()}),[m]);const U=t=>{if(m.id!==a)return D.current=t,y(Vt(i,a));const e=$();Kt(e),Ht(t,e),N()},$=t=>{const e=t||W(),o=L.current;return{viewContainer:e,objectsMap:E.current,lastEvent:I.current,prevMousePosition:j,drawingTools:i,fullState:o,undoStack:S.current,redoStack:T.current,shouldKeepHistory:f,selectDrawingTool:q,selectObject:U,shouldSelectAfterCreate:p}};function R(t){m.onKeyPress&&(m.onKeyPress(t,$()),N())}const W=()=>{const t=g.current;if(!t)throw new Error("no view container while resizing");return t};function B(t){const e=$(),o=v(t,Object.assign({},k.current),m.id);M.current=o,e.viewContainer.append(o.container.div),m.onDrawStart(o,e)}function V(t){const e=M.current;if(!e)return;const o=$();e.coords.push(t),m.onDrawing(e,o)}function K(t){const e=M.current;j.current=null,M.current=null,e&&(e.coords.push(t),E.current.set(e.container.id,e),m.onDrawEnd(e,$()),N())}t.useEffect((()=>{const t=g.current;if(t)return t.addEventListener("mousedown",e),t.addEventListener("mouseup",n),t.addEventListener("mousemove",o),t.addEventListener("touchstart",r,{passive:!1}),t.addEventListener("touchmove",l,{passive:!1}),t.addEventListener("touchcancel",c),t.addEventListener("touchend",c),t.addEventListener("mouseleave",n),window.addEventListener("keydown",R),()=>{t.removeEventListener("mousedown",e),t.removeEventListener("mouseup",n),t.removeEventListener("mousemove",o),t.removeEventListener("touchstart",r),t.removeEventListener("touchmove",l),t.removeEventListener("touchcancel",c),t.removeEventListener("touchend",c),t.removeEventListener("mouseleave",n),window.removeEventListener("keydown",R);const a=$(t);for(const t of i)t.onUnMount&&t.onUnMount(a)};function e(e){I.current=e;B(H([e.clientX,e.clientY],t))}function o(e){I.current=e;V(H([e.clientX,e.clientY],t))}function n(e){I.current=e;K(H([e.clientX,e.clientY],t))}function r(e){I.current=e,e.preventDefault();B(H(Z(e),t))}function l(e){I.current=e,e.preventDefault();V(H(Z(e),t))}function c(e){I.current=e,e.preventDefault();K(H(Z(e),t))}}),[m]);const q=t=>{if(m.id!==t){const e=Vt(i,t);if(e){const t=m,o=$();t.onUnPickTool&&t.onUnPickTool(o),e.onPickTool&&e.onPickTool(o),y(e),N()}}},Q=(t,e)=>{const o=t.filter(Y);if(0===o.length)return;ht({data:o,objectId:"",toolId:"",toolType:"batch",action:"batch"},e)},F=!!h&&!function(t){for(var e in t)return!1;return!0}(h);return n.default.createElement(l,{layout:x},!s&&n.default.createElement(b,{tools:i,onSelectTool:q,currentTool:m.id}),n.default.createElement("div",{id:C.current,style:{position:"relative",width:"100%",flex:1,boxSizing:"border-box"},ref:g},o),!u&&n.default.createElement(z,{displayMap:O,tools:d,dispatch:t=>{t($()),N()},hasMenu:F},n.default.createElement(Yt,{getEditProps:()=>{const t=$(),e=Bt(t);if(0===e.length){return k.current}const o=function(t,e){const o={},n=t.map((t=>P(e.objectsMap,t))),r={};for(const t of n){const n=Vt(e.drawingTools,t.toolId);if(n.getEditableStyles){const e=n.getEditableStyles();for(const n of e){const e=t.style[n];e?(o[n]=e,r[n]=(r[n]||0)+1):console.error("could not get style value for key:",n,"from object",t)}}}for(const t in r)r[t]!==n.length&&delete o[t];return o}(e,t);return o},styleComponents:h,onUpdateStyle:(t,e)=>{const o=$(),n=Bt(o);if(0===n.length)return k.current[t]=e,[];const r=n.map((t=>P(o.objectsMap,t))),i=r.map((n=>{const r=Vt(o.drawingTools,n.toolId);if(r.onUpdateStyle)return r.onUpdateStyle(n,o,t,e)}));return Q(i,o),i}})),n.default.createElement("style",null,`\n\t\t#${C.current} {\n\t\t\tcursor: ${m.cursor||"default"};\n\t\t}\n\t  `))},exports.arrowTool=We,exports.bringBackTool=Ne,exports.bringForwardTool=Ue,exports.circleTool=fe,exports.diamondTool=pe,exports.duplicateTool=Ae,exports.eraseTool=Le,exports.freeDrawTool=oe,exports.redoTool=ke,exports.selectTool=ce,exports.squareTool=ue,exports.straightLineTool=be,exports.textAreaTool=ye,exports.trashTool=Oe,exports.undoTool=De;
