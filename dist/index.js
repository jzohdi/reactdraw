"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),e=require("styled-components");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=n(t),r=n(e);const i={boxShadow:"#000000 0px 1px 3px 0px",borderRadius:4,overflow:"hidden",display:"flex",flexDirection:"column"};function c({children:t,layout:e}){const n=function(t){return"default"===t?{width:500,height:500,maxWidth:"100%"}:"fit"===t?{maxWidth:"100%"}:void 0}(e);return o.default.createElement("div",{style:Object.assign(Object.assign({},i),n)},t)}const l={light:"#bddefb",main:"#228be6"},u={light:"#ececec"},s={width:"calc(100% + 12px)",height:"calc(100% + 12px)",position:"absolute",border:`2px dotted ${l.main}`,top:"-6px",left:"-6px",cursor:"all-scroll",pointerEvents:"all"},d={top:"-45px",cursor:"grab",left:"calc(50% - 8px)"},a={width:"0px",height:"35px",borderLeft:"2px dotted black",position:"absolute",left:"5px"},f={position:"absolute",borderRadius:"50%",width:"16px",height:"16px"},h=r.default.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  &:hover {
    background-color: ${u.light};
  }
  ${t=>t.selected&&e.css`
      background-color: ${l.main} !important;
      > svg path {
        fill: white;
      }
    `}
`;function p({children:t,selected:e,onSelect:n}){return o.default.createElement(h,{selected:e,onClick:n},t)}const m=r.default.div`
  display: flex;
  background-color: ${l.light};
  z-index: 1;
`;function v({tools:t,onSelectTool:e,currentTool:n}){return o.default.createElement(m,null,t.map((t=>o.default.createElement(p,{key:t.id,selected:t.id===n,onSelect:()=>e(t.id)},t.icon))))}function w(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*o));return e}function g(t){let e=t.touches[0];return e||(e=t.targetTouches[0]),e||(e=t.changedTouches[0]),[e.clientX,e.clientY]}function b(t,e){if(!e)throw new Error("Container not set.");const n=e.getBoundingClientRect();return[t[0]-n.left,t[1]-n.top]}function x(){return void 0!==typeof window}function y(t,e){if(!x())throw new Error("new bounding div called on the server.");const[n,o]=t,{id:r,div:i,top:c,left:l,right:u,bottom:s}=function(t,e,n){const o=w(6),r=document.createElement("div"),i=t-n,c=e-n;return r.id=o,r.style.width=2*n+"px",r.style.height=2*n+"px",r.style.position="absolute",r.style.left=i+"px",r.style.top=c+"px",r.style.pointerEvents="none",r.style.zIndex="1",{div:r,id:o,top:c,left:i,right:i+n+n,bottom:c+n+n}}(n,o,e);return{coords:[t],element:null,container:{id:r,div:i,bounds:{top:c,left:l,right:u,bottom:s}},style:{zIndex:1,lineWidth:e}}}function E(t,e){if(!x())throw new Error("createSVG called on server");const n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("viewbox",`0 0 ${t} ${e}`),n.style.width="100%",n.style.height="100%",n}function M(t,e,n){const o=e.div.getBoundingClientRect(),r=n.getBoundingClientRect(),i=o.top-r.top,c=t[1]-i,l=o.left-r.left;return[t[0]-l,c]}function L(t,e){return t.top<=e.top&&t.bottom>=e.bottom&&t.left<=e.left&&t.right>=e.right}function j(t){const e=t.container.div,n=t.container.id;if(I(e))return null;const o=document.createElement("div");return o.setAttribute("id",`select-frame-${n}`),T(o,s),o}function O(t){const e=j(t);e&&(!function(t,e){const n=C(e,!0,!1,!1,!0),o=C(e,!0,!0),r=C(e,!1,!0,!0),i=C(e,!1,!1,!0,!0);t.appendChild(n),t.appendChild(o),t.appendChild(r),t.appendChild(i);const c=C(e);c.id=`button-rotate-${e}`,T(c,d);const l=document.createElement("div");T(l,a),c.appendChild(l),t.appendChild(c)}(e,t.container.id),t.container.div.appendChild(e))}function C(t,e,n,o,r){const i=document.createElement("button");T(i,f);let c="";return e?(i.style.top="-12px",c+="n"):o&&(i.style.bottom="-12px",c+="s"),n?(i.style.right="-12px",c+="e"):r&&(i.style.left="-12px",c+="w"),i.id=`corner-button-${c}-${t}`,i.style.cursor=`${c}-resize`,i}function D(t){const{div:e,id:n}=t.container;I(e)&&e.lastElementChild&&e.removeChild(e.lastElementChild)}function I(t){var e;return null===(e=t.lastElementChild)||void 0===e?void 0:e.id.includes("select-frame")}function T(t,e){for(const n in e)t.style[n]=e[n];return t}var A=function(t){return function(e){const{size:n,width:r,height:i,color:c}=e,l=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}(e,["size","width","height","color"]);return o.default.createElement(t,Object.assign({},l,{width:r||n||20,height:i||n||20,color:c||"#111827"}))}}((function(t){return o.default.createElement("svg",Object.assign({},t,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{d:"M10.5858 0.585786C11.3668 -0.195262 12.6332 -0.195262 13.4142 0.585786C14.1953 1.36683 14.1953 2.63316 13.4142 3.41421L12.6213 4.20711L9.79289 1.37868L10.5858 0.585786Z",fill:t.color}),o.default.createElement("path",{d:"M8.37868 2.79289L0 11.1716V14H2.82842L11.2071 5.62132L8.37868 2.79289Z",fill:t.color}))}));const S={id:"free-draw-tool",icon:o.default.createElement(A,null),onDrawStart:t=>{const e=t.style.lineWidth,n=E(e,e),o=function(t){if(!x())throw new Error("createPath called on server");const e=document.createElementNS("http://www.w3.org/2000/svg","circle");return e.setAttribute("fill","black"),e.setAttribute("cx",`${Math.ceil(t/2)}`),e.setAttribute("cy",`${Math.ceil(t/2)}`),e.setAttribute("r",`${t}`),e}(e/2);n.appendChild(o),t.container.div.appendChild(n),t.element=n},onDrawing:(t,e)=>{!function(t){let e=!1;const[n,o]=t.coords[t.coords.length-1],r=t.container,i=r.bounds,c=t.style.lineWidth;n-c<=i.left?(i.left=n-c,r.div.style.left=n-c+"px",r.div.style.width=i.right+2*c-n+"px",e=!0):n+c>=i.right&&(i.right=n+c,r.div.style.width=n+2*c-i.left+"px",e=!0),o+c>=i.bottom?(i.bottom=o+c,r.div.style.height=o+2*c-i.top+"px",e=!0):o-c<=i.top&&(i.top=o-c,r.div.style.top=o-c+"px",r.div.style.height=i.bottom+2*c-o+"px",e=!0)}(t);const n=function(t){const e=t.container.bounds;return{width:e.right-e.left,height:e.bottom-e.top}}(t),o=E(n.width,n.height),r=function(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("fill","transparent"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","4px"),n.setAttribute("stroke-linejoin","round"),n.setAttribute("stroke-linecap","round"),n.setAttribute("d",function(t,e){let n="";for(let o=0;o<t.coords.length;o++){const r=M(t.coords[o],t.container,e);n+=0===o?`M ${r[0]} ${r[1]}`:`L ${r[0]} ${r[1]}`,o!==t.coords.length-1&&(n+="")}return n}(t,e)),n}(t,e);r.style.width="100%",r.style.height="100%",o.appendChild(r),t.container.div.innerHTML="",t.container.div.appendChild(o),t.element=o},onDrawEnd:t=>{console.log("free draw end")},onUpdate:()=>{},cursor:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjU4NTggMC41ODU3ODZDMTEuMzY2OCAtMC4xOTUyNjIgMTIuNjMzMiAtMC4xOTUyNjIgMTMuNDE0MiAwLjU4NTc4NkMxNC4xOTUzIDEuMzY2ODMgMTQuMTk1MyAyLjYzMzE2IDEzLjQxNDIgMy40MTQyMUwxMi42MjEzIDQuMjA3MTFMOS43OTI4OSAxLjM3ODY4TDEwLjU4NTggMC41ODU3ODZaIiBmaWxsPSIjMTExODI3Ii8+CjxwYXRoIGQ9Ik04LjM3ODY4IDIuNzkyODlMMCAxMS4xNzE2VjE0SDIuODI4NDJMMTEuMjA3MSA1LjYyMTMyTDguMzc4NjggMi43OTI4OVoiIGZpbGw9IiMxMTE4MjciLz4KPC9zdmc+') 0 16, pointer"};exports.ReactDraw=function(e){var{children:n,topBarTools:r}=e,i=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}(e,["children","topBarTools"]);const l=t.useRef(null),[u,s]=t.useState(r[0]),{layout:d}=function(e,n){const o=t.Children.count(e);if(o>1)throw new Error("ReactDraw expects either 0 or 1 children, detected more.");void 0===n&&(n="default");return{numChildren:o,layout:n}}(n,i.layout),a=t.useRef({}),f=t.useRef(null),[h,p]=t.useState(4),m=t.useRef(`drawing-area-container-${w(6)}`),x=t.useRef([]),E=t.useRef(null),M=t.useRef(null),C=t=>{const e=E.current;if(!e)return;const{objects:n}=B();if("drag"===M.current)!function(t,e,n){const[o,r]=n,[i,c]=e,l=o-i,u=r-c;for(const e of t){const{bounds:t,div:n}=e.container,{left:o,top:r,right:i,bottom:c}=t;t.left=o+l,t.top=r+u,t.right=t.left+(i-o),t.bottom=t.top+(c-r),n.style.top=t.top+"px",n.style.left=t.left+"px"}}(n,e,t);else if("rotate"===M.current){if(n.length>1)throw new Error("should not be able to preform this action on more than object");const e=function(t){const e=t.bottom-t.top,n=t.top+e/2,o=t.right-t.left;return[t.left+o/2,n]}(n[0].container.bounds);!function(t,e,n){const o=t.container.div,r=e[0]-n[0],i=e[1]-n[1],c=180*Math.atan2(i,r)/Math.PI+90;o.style.transform=`rotate(${c}deg)`}(n[0],t,e)}};function I(t,e,n){const o=l.current;if(!o)return;if(N(t,e))return;z()&&n||U();const r=y(e,h);f.current=r,null==o||o.append(r.container.div),u.onDrawStart(r,o)}function T(t){if($())return;const e=l.current,n=f.current;n&&e&&(n.coords.push(t),u.onDrawing(n,e),"react-draw-cursor"===u.id&&R(n,a.current))}function A(t,e){const n=f.current,o=l.current;n&&o&&(M.current=null,E.current=null,f.current=null,u.onDrawEnd(n,o),z()?S(n,t,e):a.current[n.container.id]=n)}const S=(t,e,n)=>{const o=t.coords[0];if(r=e,i=o,Math.sqrt(Math.pow(Math.abs(r[0]-i[0]),2)+Math.pow(Math.abs(r[1]-i[1]),2))<75){const t=function(t,e){let{top:n,right:o,bottom:r,left:i}=t;const[c,l]=e;return l>r?r=l:l<n&&(n=l),c<i?i=c:c>o&&(o=c),{top:n,right:o,bottom:r,left:i}}(function(t){const[e,n]=t;return{top:n,right:e,bottom:n,left:e}}(o),e);P(a.current,t,n)}var r,i},z=()=>"react-draw-cursor"===u.id,$=()=>null!==E.current&&null!==M.current,N=(t,e)=>{if(!t)throw new Error("Did start select action recieved null as target");return t.id.includes("select-frame")?(E.current=e,M.current="drag",!0):!!t.id.includes("button-rotate")&&(E.current=e,M.current="rotate",!0)};function k(t){$()&&(C(t),E.current=t)}t.useEffect((()=>{const t=l.current;if(t)return t.addEventListener("mousedown",r),t.addEventListener("mouseup",c),t.addEventListener("mousemove",i),t.addEventListener("touchstart",u,{passive:!1}),t.addEventListener("touchmove",s,{passive:!1}),t.addEventListener("touchcancel",d),t.addEventListener("touchend",d),t.addEventListener("mouseleave",c),window.addEventListener("mousemove",e),window.addEventListener("mouseup",o),window.addEventListener("touchmove",n,{passive:!1}),window.addEventListener("touchend",o),()=>{t.removeEventListener("mousedown",r),t.removeEventListener("mouseup",c),t.removeEventListener("mousemove",i),t.removeEventListener("touchstart",u),t.removeEventListener("touchmove",s),t.removeEventListener("touchcancel",d),t.removeEventListener("touchend",d),t.removeEventListener("mouseleave",c),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",o),window.removeEventListener("touchmove",n),window.removeEventListener("touchend",o)};function e(e){k(b([e.clientX,e.clientY],t))}function n(e){k(b(g(e),t))}function o(){M.current=null,E.current=null}function r(e){const n=b([e.clientX,e.clientY],t);I(e.target,n,e.shiftKey)}function i(e){T(b([e.clientX,e.clientY],t))}function c(e){A(b([e.clientX,e.clientY],t),e.shiftKey)}function u(e){const n=b(g(e),t);I(e.target,n,e.shiftKey)}function s(e){T(b(g(e),t))}function d(e){A(b(g(e),t),e.shiftKey)}}),[u]);const R=(t,e)=>{let n=[];for(const o in e){const r=e[o];D(r),L(t.container.bounds,r.container.bounds)&&n.push(o)}Y(n)},P=(t,e,n)=>{var o;let r=null;for(const n in t){const i=t[n];if(L(i.container.bounds,e)){(null!==(o=null==r?void 0:r.style.zIndex)&&void 0!==o?o:0<i.style.zIndex)&&(r=i)}}let{ids:i}=U();n||(i=[]),null!==r&&(i=i.concat([r.container.id])),Y(i)},Y=t=>{x.current=t;const e=Z(t);return 1===e.length?O(e[0]):e.length>1?function(t){for(const e of t){const t=j(e);t&&e.container.div.appendChild(t)}}(e):void 0},Z=t=>t.map((t=>a.current[t])),U=()=>{const{objects:t,ids:e}=B();return function(t){for(const e of t)D(e)}(t),M.current=null,E.current=null,x.current=[],{ids:e,objects:t}},B=()=>{const t=x.current;return{objects:Z(t),ids:t}};return o.default.createElement(c,{layout:d},o.default.createElement(v,{tools:r,onSelectTool:t=>{if(u.id!==t){const e=r.find((e=>e.id===t));e&&s(e)}"react-draw-cursor"!==t&&U()},currentTool:u.id}),o.default.createElement("div",{id:m.current,style:{position:"relative",width:"100%",flex:1,boxSizing:"border-box"},ref:l},n),o.default.createElement("div",null),o.default.createElement("style",null,`\n\t\t#${m.current} {\n\t\t\tcursor: ${u.cursor||"defautl"};\n\t\t}\n\t  `))},exports.freeDrawTool=S;
