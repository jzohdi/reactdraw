"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react");function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=e(t);function n(t,e,o,n){return new(o||(o=Promise))((function(r,i){function l(t){try{a(n.next(t))}catch(t){i(t)}}function s(t){try{a(n.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(l,s)}a((n=n.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const r={boxShadow:"#000000 0px 1px 3px 0px",borderRadius:4,display:"flex",flexDirection:"column",position:"relative",fontFamily:"sans-serif"};var i=t.forwardRef((function({children:t,layout:e,style:n},i){const l=function(t){return"default"===t?{width:500,height:500,maxWidth:"100%"}:"fit"===t?{maxWidth:"100%"}:{width:t.width,height:t.width}}(e);let s=Object.assign(Object.assign({},r),l);return void 0!==n&&(s=Object.assign(Object.assign({},s),n)),o.default.createElement("div",{style:s,ref:i},t)}));const l={color:null,message:null,position:"top"},s=t.createContext([l,()=>{}]);function a({children:e}){const[n,r]=t.useState(l);return o.default.createElement(s.Provider,{value:[n,t=>{r(t)}]},e)}function c(){const[e,o]=t.useContext(s);return[e,o]}const d="react-draw-erase-tool",u="react-draw-cursor",p="bottomBarContainer",f="toolIconWrapper",h="clearAllButton",g="alertMessageDialog",y="bottomToolButton",m="menuButton",b="menuContainer",w="topBarBontainer",v="originalBounds",x="orientation",C=450,E={primary:{light:"#bddefb",main:"#228be6"},grey:{light:"#ececec"}};function M(t,e){const o=t.startsWith(".")?t:`.${t}`;let n="",r=`${o} {`;const i=Object.entries(e);for(const[t,e]of i)if("string"==typeof e||"number"==typeof e)r+=" "+S(t,e);else if("object"==typeof e&&t.startsWith("@media"))n+=D(t,o,e);else if("object"==typeof e&&t.startsWith("@keyframes"))n+=(l=e,`${t} { ${Object.entries(l).map((([t,e])=>M(t,e).replace(".",""))).join("")} }`);else if("object"==typeof e&&t.trim().startsWith("*"))n+=M(o+" "+t.replace(/&/g,o),e);else{if("object"!=typeof e)throw console.error("Unrecognized value:",e),new Error;n+=M(t.replace(/&/g,o),e)}var l;return n+=`${r} }`,n}function D(t,e,o){let n=`${t} { `;return n+=M(e,o),n+" }"}const j=new Set(["opacity","zIndex","fontWeight","lineHeight","flex"]);function S(t,e){return"string"==typeof e||j.has(t)?`${I(t)}: ${e};`:`${I(t)}: ${e}px;`}function I(t){return t.replace(/([a-z])([A-Z])/g,(t=>t[0]+"-"+t[1].toLowerCase()))}const k=t=>`@media only screen and (min-width: ${t}px)`,L=t=>`@media only screen and (max-width: ${t}px)`,T={display:"flex",cursor:"pointer",justifyContent:"center",alignItems:"center",border:"none",backgroundColor:"transparent",borderRadius:2,transition:"background-color 150ms ease-in-out",[k(C)]:{width:40,height:40},[L(C)]:{width:30,height:30},"&:hover":{backgroundColor:E.grey.light},'&[data-selected="true"]':{backgroundColor:`${E.primary.main} !important`},'&[data-selected="true"] > svg path':{fill:"white"}};var O={key:f,styles:T};const z={width:180,fontSize:16,display:"flex",justifyContent:"flex-start",alignItems:"center",borderRadius:5,cursor:"pointer",border:"none",padding:"7px 10px",backgroundColor:E.primary.light,"&:hover":{backgroundColor:E.primary.main}};var A={key:h,styles:z};var N={key:g,styles:{position:"absolute",whiteSpace:"nowrap",textAlign:"center",borderRadius:6,padding:"5px 10px",zIndex:1001,color:"white"}};const H={display:"flex",backgroundColor:E.primary.light,zIndex:1e3,width:"100%",overflowX:"auto","*":{scrollbarWidth:"none",scrollbarColor:`${E.primary.main} #e2ecf5`},"&::-webkit-scrollbar":{height:10},"&::-webkit-scrollbar-track":{background:"#e2ecf5"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#035195",borderRadius:10,border:"3px none #ffffff"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:" #00294d"}};var R={key:p,styles:H};const $={display:"flex",cursor:"pointer",justifyContent:"center",alignItems:"center",border:"none",backgroundColor:"transparent",borderRadius:2,transition:"background-color 150ms ease-in-out",[k(C)]:{width:40,height:40},[L(C)]:{width:30,height:30},'&[data-mode="hide"]':{display:"none"},'&[data-disabled="true"]':{cursor:"not-allowed",backgroundColor:"white"},'&[data-disabled="true"] > svg path':{fill:"lightgrey",stroke:"lightgrey"},'&[data-disabled="false"]:hover':{backgroundColor:E.grey.light},'&[data-disabled="false"]':{display:"inline-block"}};var P={key:y,styles:$};const W={position:"relative",display:"flex",cursor:"pointer",justifyContent:"center",alignItems:"center",border:"none",backgroundColor:"transparent",borderRadius:2,transition:"background-color 150ms ease-in-out",[k(C)]:{width:40,height:40},[L(C)]:{width:30,height:30},"&:hover":{backgroundColor:E.grey.light},'&[data-open="true"]':{backgroundColor:`${E.primary.main} !important`},'&[data-open="true"] > svg path':{fill:"white",stroke:"white"}};var B={key:m,styles:W};const U={position:"absolute",left:0,padding:15,border:`1px solid ${E.primary.main}`,zIndex:1e3,backgroundColor:"white",borderRadius:"0px 5px 0px 0px",maxHeight:"calc(100% - 80px)",maxWidth:"100%",overflow:"auto",boxSizing:"border-box",[k(C)]:{bottom:40},[L(C)]:{bottom:30},"*":{scrollbarWidth:"none",scrollbarColor:`${E.primary.main} #e2ecf5`},"&::-webkit-scrollbar":{width:8},"&::-webkit-scrollbar-track":{background:"#e2ecf5"},"&::-webkit-scrollbar-thumb":{backgroundColor:E.primary.main,borderRadius:8,border:"3px none #ffffff"}};var Z={key:b,styles:U};const Y={display:"flex",backgroundColor:E.primary.light,zIndex:1e3,width:"100%",overflowX:"auto","*":{scrollbarWidth:"none",scrollbarColor:`${E.primary.main} #e2ecf5`},"&::-webkit-scrollbar":{height:10},"&::-webkit-scrollbar-track":{background:"#e2ecf5"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#035195",borderRadius:10,border:"3px none #ffffff"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:"#00294d"}};var V={key:w,styles:Y},K=Object.freeze({__proto__:null,toolIconWrapperStyles:O,clearAllButtonStyles:A,alertMessageStles:N,bottomBarContainerStyles:R,bottomToolButtonStyles:P,menuButtonStyles:B,menuContainerStyles:Z,topBarContainerStyles:V});const F=t.createContext((()=>""));function q(t){const e=new Map;if(!t)return e;for(const o in t){const n=t[o];void 0!==n&&e.set(o,n)}return e}function Q(t,e){for(const o in e){const n=e[o];void 0!==typeof n&&("string"==typeof n||"number"==typeof n||"object"==typeof n&&void 0===t[o]?t[o]=n:"object"==typeof n&&Q(t[o],n))}}function X(t,e,o){if(!e)return t;for(const n in e){if(void 0===n)continue;const r=e[n];void 0!==r&&(void 0===t[n]?(t[n]=r,o.set(n,n)):Q(t[n],r))}return t}function G(t){return Object.values(K).reduce(((e,o)=>{if(e[o.key])throw new Error("duplicate key while creating css styles");e[o.key]=o.styles;const n=t.get(o.key);return void 0!==n&&t.set(o.key,n+" "+o.key),t.set(o.key,o.key),e}),{})}function J({children:e,styles:n,classNames:r}){const i=t.useRef(q(r)),l=t.useRef(X(G(i.current),n,i.current)),s=t.useRef(null);t.useEffect((()=>{const t=s.current;t&&(i.current=q(r),l.current=X(G(i.current),n,i.current),t.innerHTML=function(t){let e="";const o=Object.entries(t);for(const[t,n]of o)e+=M(t,n);return e}(l.current))}),[n]);return o.default.createElement(F.Provider,{value:t=>{const e=i.current.get(t);if(void 0===e)throw new Error("Could not find key in classNames map");return e}},o.default.createElement("style",{id:"react-draw-styles",ref:s}),e)}function _(e){return t.useContext(F)(e)}function tt(){const[t]=c(),e=_(g);return o.default.createElement("dialog",{className:e,style:{backgroundColor:t.color||"black",[t.position]:10},open:null!==t.message},t.message)}function et({children:t,selected:e,onSelect:n}){const r=_(f);return o.default.createElement("button",{"data-selected":e,className:r,onClick:n},t)}function ot({children:t,text:e,position:n,disabled:r}){const[i,l]=c();if(!t)return o.default.createElement(o.default.Fragment,null);if(!e)return o.default.createElement(o.default.Fragment,null,t);return o.default.createElement("span",{onMouseOver:()=>{r||"ontouchstart"in window||navigator.maxTouchPoints>0||l(Object.assign(Object.assign({},i),{message:e,position:n}))},onMouseLeave:()=>{null!==i.message&&l(Object.assign(Object.assign({},i),{message:null}))},"aria-label":`label mouse listener ${e}`},t)}function nt({tools:t,onSelectTool:e,currentTool:n}){const r=_(w);return o.default.createElement("div",{className:r},t.filter((t=>!!t.icon)).map(((t,r)=>{const i=t.tooltip;return o.default.createElement(ot,{text:i,position:"top",key:t.id},o.default.createElement(et,{selected:t.id===n,onSelect:()=>e(t.id)},t.icon))})))}function rt(t){for(var e="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)e+=o.charAt(Math.floor(62*Math.random()));return e}function it(){return void 0!==typeof window}function lt(t,e,o){if(!it())throw new Error("new bounding div called on the server.");const n=parseInt(e.lineWidth),[r,i]=t,{id:l,div:s}=st(r,i,n,o);return{coords:[t],element:null,toolId:o,containerDiv:s,id:l,style:e,customData:new Map}}function st(t,e,o,n){const r=rt(6),i=document.createElement("div"),l=t-o,s=e-o;return i.id=`${n}-${r}`,i.style.width=2*o+"px",i.style.height=2*o+"px",i.style.position="absolute",i.style.left=l+"px",i.style.top=s+"px",i.style.pointerEvents="none",i.style.zIndex="1",i.style.boxSizing="border-box",{div:i,id:r,top:s,left:l,right:l+o+o,bottom:s+o+o}}function at(t,e){const{width:o,height:n}=function(t){const e=t.getAttribute("viewbox");if(!e)throw new Error("no viewbox found on ele");const o=e.split(" ");return{width:parseFloat(o[2]),height:parseFloat(o[3])}}(t),r=(e.right-e.left)/o,i=(e.bottom-e.top)/n;t.lastElementChild.style.transform=`scale(${r}, ${i})`}function ct(t,e,o){const n=e.getBoundingClientRect(),r=o.getBoundingClientRect(),i=n.top-r.top,l=t[1]-i,s=n.left-r.left;return[t[0]-s,l]}function dt(t){let e=!1;const[o,n]=t.coords[t.coords.length-1],r=t.containerDiv,i=gt(t),l=parseInt(t.style.lineWidth);if(o-l<=i.left){const t=o-l,n=i.left-t;r.style.left=t+"px",r.style.width=i.width+n+"px",e=!0}else o+l>=i.right&&(r.style.width=o+2*l-i.left+"px",e=!0);if(n+l>=i.bottom)r.style.height=n+2*l-i.top+"px",e=!0;else if(n-l<=i.top){const t=n-l,o=i.top-t;r.style.top=t+"px",r.style.height=i.height+o+"px",e=!0}return e}function ut(t){if(t.coords.length<2)throw new Error("data coords must be at least length 2");const[e,o]=t.coords[0],[n,r]=t.coords[t.coords.length-1];parseInt(t.style.lineWidth);const i=Math.min(e,n),l=Math.min(o,r),s=Math.max(e,n),a=Math.max(o,r),c=t.containerDiv;return c.style.top=l+"px",c.style.left=i+"px",c.style.width=`${Math.max(s-i,1)}px`,c.style.height=`${Math.max(a-l,1)}px`,t.coords}function pt(t,e){return t.top<=e.top&&t.bottom>=e.bottom&&t.left<=e.left&&t.right>=e.right}function ft(t,e){return Math.sqrt(Math.pow(Math.abs(t[0]-e[0]),2)+Math.pow(Math.abs(t[1]-e[1]),2))}function ht(t){const[e,o]=t;return{top:o,right:e,bottom:o,left:e}}function gt(t){const e=t.containerDiv,o=e.getBoundingClientRect(),n=mt(e.style.left),r=mt(e.style.top),i=mt(e.style.height),l=mt(e.style.width),s=0===i?o.height:i,a=0===l?o.width:l;return{left:n,top:r,height:s,width:a,right:n+a,bottom:r+s}}const yt=/-?\d+\.*\d*/;function mt(t){const e=t.match(yt);return e?parseFloat(e[0]):0}function bt(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o}function wt(t){const{size:e,width:o,height:n,color:r}=t,i=bt(t,["size","width","height","color"]);return Object.assign({width:o||e||20,height:n||e||20,color:r||"#111827"},i)}function vt(t){const e=wt(t),{color:n}=e,r=bt(e,["color"]);return o.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 5C3 4.44772 3.44772 4 4 4H16C16.5523 4 17 4.44772 17 5C17 5.55228 16.5523 6 16 6H4C3.44772 6 3 5.55228 3 5Z",fill:n}),o.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 10C3 9.44772 3.44772 9 4 9H16C16.5523 9 17 9.44772 17 10C17 10.5523 16.5523 11 16 11H4C3.44772 11 3 10.5523 3 10Z",fill:n}),o.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 15C3 14.4477 3.44772 14 4 14H16C16.5523 14 17 14.4477 17 15C17 15.5523 16.5523 16 16 16H4C3.44772 16 3 15.5523 3 15Z",fill:n}))}function xt(t){const e=wt(t),{color:n}=e,r=bt(e,["color"]);return o.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 18 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{d:"M16 5L15.1327 17.1425C15.0579 18.1891 14.187 19 13.1378 19H4.86224C3.81296 19 2.94208 18.1891 2.86732 17.1425L2 5M7 9V15M11 9V15M12 5V2C12 1.44772 11.5523 1 11 1H7C6.44772 1 6 1.44772 6 2V5M1 5H17",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}function Ct(t){const e=wt(t),{color:n}=e,r=bt(e,["color"]);return o.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{d:"M19.312 11.75C20.4373 11.75 21.312 10.8936 21.312 9.79167C21.312 8.68978 20.4373 7.83333 19.312 7.83333C18.1867 7.83333 17.312 8.68978 17.312 9.79167C17.312 10.8936 18.1867 11.75 19.312 11.75ZM15.312 6.54867C16.4373 6.54867 17.312 5.69222 17.312 4.59033C17.312 3.48844 16.4373 2.632 15.312 2.632C14.1867 2.632 13.312 3.48844 13.312 4.59033C13.312 5.69222 14.1867 6.54867 15.312 6.54867ZM8.688 6.54867C9.81333 6.54867 10.688 5.69222 10.688 4.59033C10.688 3.48844 9.81333 2.632 8.688 2.632C7.56267 2.632 6.688 3.48844 6.688 4.59033C6.688 5.69222 7.56267 6.54867 8.688 6.54867ZM4.688 11.75C5.81333 11.75 6.688 10.8936 6.688 9.79167C6.688 8.68978 5.81333 7.83333 4.688 7.83333C3.56267 7.83333 2.688 8.68978 2.688 9.79167C2.688 10.8936 3.56267 11.75 4.688 11.75ZM12 0C18.6253 0 24 4.71175 24 10.4653C24 14.0765 21 16.9526 17.312 16.9526H15C13.8747 16.9526 13 17.8091 13 18.911C13 19.4006 13.188 19.8288 13.5 20.1956C13.812 20.5625 14 21.0521 14 21.5417C14 22.6436 13.1253 23.5 12 23.5C5.37467 23.5 0 18.2373 0 11.75C0 5.26269 5.37467 0 12 0Z",fill:n}))}function Et({getEditProps:e,styleComponents:n={},onUpdateStyle:r}){const[i,l]=t.useState(e()),s=Object.keys(i).filter((t=>!!n[t]));t.useEffect((()=>{function t(){const t=e();l(t)}return window.addEventListener("click",t),()=>{window.removeEventListener("click",t)}}),[i]);const a=(t,e)=>{l(Object.assign(Object.assign({},i),{[t]:e})),r(t,e)};return 0===s.length?o.default.createElement(o.default.Fragment,null):(s.sort(((t,e)=>{const o=n[t].order;return n[e].order-o})),o.default.createElement("div",{style:{display:"flex",flexDirection:"column",gap:10}},s.map((t=>{const e=n[t].component;return o.default.createElement(e,{key:t,onUpdate:a,styleKey:t,styleValue:i[t]})}))))}function Mt({tools:e,displayMap:n,dispatch:r,stylesMenu:i,children:l}){const s=_(p),a=_(y),c=_(m),d=_(b),[u,f]=t.useState(null),h=t=>f(t===u?null:t),g=!!i.styleComponents&&!function(t){for(var e in t)return!1;return!0}(i.styleComponents),w=!!l&&o.default.Children.count(l)>0;return o.default.createElement(o.default.Fragment,null,"styles"===u&&o.default.createElement("div",{className:d},o.default.createElement(Et,Object.assign({},i))),"menu"===u&&o.default.createElement("div",{className:d},l),o.default.createElement("div",{className:s},w&&o.default.createElement(ot,{text:"Menu",position:"bottom"},o.default.createElement("button",{className:c,onClick:()=>h("menu"),"data-open":"menu"===u},o.default.createElement(vt,{size:20}))),g&&o.default.createElement(ot,{text:"Styles",position:"bottom"},o.default.createElement("button",{className:c,onClick:()=>h("styles"),"data-open":"styles"===u},o.default.createElement(Ct,{size:20}))),e.map(((t,e)=>{const i=t.id,l=n.get(i)||"hide",s="disabled"===l;return o.default.createElement(ot,{key:t.id,text:t.tooltip,position:"bottom",disabled:s},o.default.createElement("button",{className:a,"aria-disabled":s,"data-disabled":s,"data-mode":l,disabled:s,onClick:()=>r(t.handleContext)},t.icon))}))))}function Dt(t,e){const o=t.id,n=t.containerDiv,r=e.fullState[u],i=r.handlers[o];if(i)for(const t of i)t.ele.removeEventListener(t.eventName,t.fn);const l=n.querySelector('[id^="select-frame"');r.handlers[o]=[],null!==l&&n.removeChild(l);const s=r.selectedIds.indexOf(o);s>=0&&r.selectedIds.splice(s,1)}function jt(t,e){e.shouldKeepHistory&&(e.undoStack.push(t),e.redoStack.splice(0))}function St(t,e){for(const o in e)t.style[o]=e[o];return t}function It(t,e){const o=t.find((t=>t.id===e));if(!o)throw new Error("could not find the used tool");return o}function kt(t,e){const{objectsMap:o,viewContainer:n}=e,r=Lt(e.objectsMap,t);Dt(r,e);const{containerDiv:i,id:l}=r;n.removeChild(i),o.delete(l);const s=It(e.drawingTools,r.toolId);s.onDeleteObject&&s.onDeleteObject(r,e)}function Lt(t,e){const o=t.get(e);if(!o)throw new Error("could not get object from map");return o}function Tt(t,e){if(!e)throw new Error("Container not set.");const o=e.getBoundingClientRect();return[t[0]-o.left,t[1]-o.top]}function Ot(t){let e=t.touches[0];return e||(e=t.targetTouches[0]),e||(e=t.changedTouches[0]),[e.clientX,e.clientY]}function zt(t){const{width:e,height:o,top:n,left:r}=t;return[r+e/2,n+o/2]}function At(t){const e=t.viewContainer.getBoundingClientRect();return[e.width/2,e.height/2]}function Nt(t,e){const o=e.querySelectorAll(t);o.length>0&&o.forEach((t=>{e.removeChild(t)}))}function Ht(t){return void 0!==t}function Rt(t,e){var o;const n={action:"batch",toolType:"batch",toolId:"",objectId:"",data:[]},r=new Set;for(const i of t){const t=Lt(e.objectsMap,i),l=t.toolId,s=It(e.drawingTools,l);if(e.shouldKeepHistory&&(null===(o=null==s?void 0:s.undoHandlers)||void 0===o?void 0:o.delete)){const e={action:"delete",toolType:"top-bar-tool",toolId:l,objectId:i,data:t};n.data.push(e)}else r.add(l);kt(i,e)}if(e.shouldKeepHistory){if(jt(n,e),r.size>0){console.log("removing items from undo stack since they do not implement undoDelete",r);for(let t=e.undoStack.length-1;t>=0;t--)r.has(e.undoStack[t].toolId)&&(e.undoStack.splice(t,1),t++)}}else e.undoStack.splice(0)}function $t(t,e,o){return lt(e,Object.assign({},t.globalStyles),o)}function Pt(t,e){const{containerDiv:o,id:n}=e;t.viewContainer.appendChild(o),t.objectsMap.set(n,e)}const Wt=/-{0,1}\d+\.*\d*/g;function Bt(t){const e=t.style.transform;if(!e)return 0;const o=e.match(Wt);return o?parseFloat(o[0]):0}function Ut(t,e){const o=zt(gt(t)),n=Bt(t.containerDiv);if(0===n)return[e.newPoint[0]-e.previousPoint[0],e.newPoint[1]-e.previousPoint[1]];const[r,i]=Yt(e.previousPoint,o),[l,s]=Yt(e.newPoint,o),a=Kt(r,i,-n);return Yt(Kt(l,s,-n),a)}function Zt(t,e,o,n,r){const[i,l]=zt(e),[s,a]=Yt([e.left,e.top],[i,l]),[c,d]=Kt(s,a,o),[u,p]=Kt(n/2,r,o),[f,h]=function(t,e,o,n,r){const i=r*(Math.PI/180),l=t-o,s=e-n,a=l*Math.cos(i)-s*Math.sin(i),c=l*Math.sin(i)+s*Math.cos(i),d=c+n;return[Ft(a+o,Vt),Ft(d,Vt)]}(c,d,u,p,o);return{top:l-h,left:f+i}}function Yt(t,e){const[o,n]=e,[r,i]=t;return[r-o,n-i]}const Vt=5;function Kt(t,e,o){const n=o*(Math.PI/180),r=t*Math.cos(n)+e*Math.sin(n),i=-t*Math.sin(n)+e*Math.cos(n);return[Ft(r,Vt),Ft(i,Vt)]}function Ft(t,e){const o=Math.pow(10,e);return Math.round(t*o)/o}function qt(t,e){let[o,n]=Ut(t,e);o=0;const r=gt(t),i=t.containerDiv,l=Bt(i),[s,a]=zt(r),[c,d]=Kt(o,-n/2,l),u=a-(d+(r.height-n)/2),p=c-r.width/2+s;i.style.top=u+"px",i.style.left=p+"px",i.style.width=r.width+o+"px",i.style.height=r.height-n+"px"}function Qt(t,e){let[o,n]=Ut(t,e);n=0;const r=gt(t),i=t.containerDiv,l=Bt(i),[s,a]=zt(r),[c,d]=Kt(o/2,n,l),u=r.width-o,p=a-(d+r.height/2),f=c-u/2+s;i.style.top=p+"px",i.style.left=f+"px",i.style.width=r.width-o+"px",i.style.height=r.height+n+"px"}function Xt(t,e){let[o,n]=Ut(t,e);o=0;const r=gt(t),i=t.containerDiv,l=Bt(i),[s,a]=zt(r),[c,d]=Kt(o,-n/2,l),u=r.height+n,p=a-(d+u/2),f=c-r.width/2+s;i.style.top=p+"px",i.style.left=f+"px",i.style.height=u+"px"}function Gt(t,e){Xt(t,e),Qt(t,e)}function Jt(t,e){let[o,n]=Ut(t,e);n=0;const r=gt(t),i=t.containerDiv,l=Bt(i),{top:s,left:a}=Zt(0,r,l,o,n);i.style.top=s+"px",i.style.left=a+"px",i.style.width=r.width+o+"px",i.style.height=r.height+n+"px"}function _t(t,e){Jt(t,e),Xt(t,e)}function te(t,e){qt(t,e),Qt(t,e)}function ee(t,e){qt(t,e),Jt(t,e)}const oe="button-rotate",ne="select-frame",re="corner-button",ie={top:"-45px",cursor:"grab",left:"calc(50% - 8px)"},le={width:"calc(100% + 16px)",height:"calc(100% + 16px)",position:"absolute",border:`2px dotted ${E.primary.main}`,top:"-6px",left:"-6px",cursor:"all-scroll",pointerEvents:"all",boxSizing:"border-box"},se={width:"0px",height:"35px",borderLeft:"2px dotted black",position:"absolute",left:"5px",pointerEvents:"none"},ae=16,ce=16,de={position:"absolute",borderRadius:"50%",width:`${ae}px`,height:`${ce}px`};function ue(t,e){return t.map((t=>{const o=e.get(t);if(!o)throw new Error("object not found in map");return o}))}function pe(t,e){const o=t.toolId,n=e.drawingTools.find((t=>t.id===o));n&&n.onAfterUpdate&&n.onAfterUpdate(t,e)}function fe(t,e){const o=t.fullState[u],n=o.prevPoint;if(!n)return void console.error("handleDrag prev point not set");const r=ue(o.selectedIds,t.objectsMap);!function(t,e,o){const[n,r]=o,[i,l]=e,s=n-i,a=r-l;for(const e of t){const t=e.containerDiv,o=gt(e),{left:n,top:r}=o;t.style.top=r+a+"px",t.style.left=n+s+"px"}}(r,n,e),o.prevPoint=e,1===r.length&&pe(r[0],t)}function he(t,e){t.fullState[u].prevPoint=e,function(t){const e=t.fullState[u],o=ue(e.selectedIds,t.objectsMap),n={objectId:"",toolId:u,toolType:"top-bar-tool",action:"drag",data:o.map((t=>{const e=gt(t);return{objectId:t.id,top:e.top,left:e.left}}))};jt(n,t)}(t)}function ge(t){t.fullState[u].prevPoint=null}function ye(t,e,o){const n=function(t){t.stopPropagation();const e=Tt([t.clientX,t.clientY],o.viewContainer);he(o,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)},r=function(t){t.stopPropagation();const e=Tt([t.clientX,t.clientY],o.viewContainer);fe(o,e)},i=function(t){t.stopPropagation(),ge(o),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)},l=function(t){t.stopPropagation();const e=Tt(Ot(t),o.viewContainer);he(o,e),window.addEventListener("touchmove",s,{passive:!0}),window.addEventListener("touchend",a,{passive:!0}),window.addEventListener("touchcancel",a,{passive:!0})},s=function(t){t.stopPropagation();const e=Tt(Ot(t),o.viewContainer);fe(o,e)},a=function(t){t.stopPropagation(),ge(o),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)},c=o.fullState[u],d=c.handlers[e]||[];c.handlers[e]=d,d.push({ele:t,eventName:"mousedown",fn:n}),d.push({ele:t,eventName:"touchstart",fn:l}),t.addEventListener("mousedown",n),t.addEventListener("touchstart",l,{passive:!0})}function me(t,e,o){const n=t.fullState[u],r=n.prevPoint;if(!r)return;const i=ue(n.selectedIds,t.objectsMap);if(1!==i.length)throw new Error("start rotating got incorrect number of objects to handle");const l=i[0],s=It(t.drawingTools,l.toolId),a={viewContainer:t.viewContainer,newPoint:e,previousPoint:r,shouldPreserveAspectRatio:t.shouldPreserveAspectRatio};s.doResize?s.doResize(l,a):o(l,a),s.onResize(l,a),n.prevPoint=e}function be(t,e){t.fullState[u].prevPoint=e,function(t){const e=t.fullState[u],o=ue(e.selectedIds,t.objectsMap);if(1!==o.length)throw new Error("resize push to stack expects 1 object selected");const n=o[0],r=gt(n);jt({objectId:n.id,toolId:u,toolType:"top-bar-tool",action:"resize",data:{bounds:{top:r.top,left:r.left,right:r.right,bottom:r.bottom}}},t)}(t)}function we(t){t.fullState[u].prevPoint=null}function ve(t,e,o,n){const r=function(t){t.stopPropagation();const e=Tt([t.clientX,t.clientY],o.viewContainer);be(o,e),window.addEventListener("mousemove",i),window.addEventListener("mouseup",l)},i=function(t){t.stopPropagation();const e=Tt([t.clientX,t.clientY],o.viewContainer);me(o,e,n)},l=function(t){t.stopPropagation(),we(o),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",l)},s=function(t){t.stopPropagation();const e=Tt(Ot(t),o.viewContainer);be(o,e),window.addEventListener("touchmove",a,{passive:!0}),window.addEventListener("touchend",c,{passive:!0}),window.addEventListener("touchcancel",c,{passive:!0})},a=function(t){t.stopPropagation();const e=Tt(Ot(t),o.viewContainer);me(o,e,n)},c=function(t){t.stopPropagation(),we(o),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",c),window.removeEventListener("touchcancel",c)},d=o.fullState[u],p=d.handlers[e]||[];d.handlers[e]=p,p.push({ele:t,eventName:"mousedown",fn:r}),p.push({ele:t,eventName:"touchstart",fn:s}),t.addEventListener("mousedown",r),t.addEventListener("touchstart",s,{passive:!0})}function xe(t,e){const o=t.fullState[u];if(!o.prevPoint)return;const n=ue(o.selectedIds,t.objectsMap);if(1!==n.length)throw new Error("start rotating got incorrect number of objects to handle");const r=n[0];!function(t,e,o){const n=t.containerDiv,r=e[0]-o[0],i=e[1]-o[1],l=180*Math.atan2(i,r)/Math.PI+90;n.style.transform=`rotate(${Ft(l,5)}deg)`}(r,e,zt(gt(r))),o.prevPoint=e,pe(r,t)}function Ce(t,e){t.fullState[u].prevPoint=e,function(t){const e=t.fullState[u],o=ue(e.selectedIds,t.objectsMap),n={objectId:"",toolId:u,toolType:"top-bar-tool",action:"rotate",data:o.map((t=>({objectId:t.id,rotate:Bt(t.containerDiv)})))};jt(n,t)}(t)}function Ee(t){t.fullState[u].prevPoint=null}function Me(t,e){for(const o of t){const t=De(o);t&&(ye(t,o.id,e),o.containerDiv.appendChild(t))}}function De(t){const e=t.containerDiv,o=t.id;if(function(t){return null!==t.querySelector('[id^="select-frame"')}(e))return null;const n=document.createElement("div");return n.setAttribute("id",`${ne}-${o}`),St(n,le),n}function je(t,e,o){const n=It(t,e.toolId);n&&o&&n.onSelect&&n.onSelect(e,o)}function Se(t,e){for(const o of t)Dt(o,e)}function Ie(t,e){const o=De(t);o&&(ye(o,t.id,e),function(t,e,o){const n=e.id,r=Le(n,2,0,0,2);ve(r,n,o,te);const i=Le(n,2,1);ve(i,n,o,qt);const l=Le(n,2,2);ve(l,n,o,ee);const s=Le(n,0,2,1);ve(s,n,o,Jt);const a=Le(n,0,2,2);ve(a,n,o,_t);const c=Le(n,0,1,2);ve(c,n,o,Xt);const d=Le(n,0,0,2,2);ve(d,n,o,Gt);const p=Le(n,0,0,1,2);ve(p,n,o,Qt),t.appendChild(r),t.appendChild(i),t.appendChild(l),t.appendChild(s),t.appendChild(a),t.appendChild(c),t.appendChild(d),t.appendChild(p);const f=Le(n);f.id=`${oe}-${n}`,St(f,ie),function(t,e,o){const n=function(t){t.stopPropagation();const e=Tt([t.clientX,t.clientY],o.viewContainer);Ce(o,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)},r=function(t){t.stopPropagation();const e=Tt([t.clientX,t.clientY],o.viewContainer);xe(o,e)},i=function(t){t.stopPropagation(),Ee(o),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)},l=function(t){t.stopPropagation();const e=Tt(Ot(t),o.viewContainer);Ce(o,e),window.addEventListener("touchmove",s,{passive:!0}),window.addEventListener("touchend",a,{passive:!0}),window.addEventListener("touchcancel",a,{passive:!0})},s=function(t){t.stopPropagation();const e=Tt(Ot(t),o.viewContainer);xe(o,e)},a=function(t){t.stopPropagation(),Ee(o),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)},c=o.fullState[u],d=c.handlers[e]||[];c.handlers[e]=d,d.push({ele:t,eventName:"mousedown",fn:n}),d.push({ele:t,eventName:"touchstart",fn:l}),t.addEventListener("mousedown",n),t.addEventListener("touchstart",l,{passive:!0})}(f,n,o);const h=document.createElement("div");St(h,se),h.id=`line-div-${n}`,f.appendChild(h),t.appendChild(f)}(o,t,e),t.containerDiv.appendChild(o))}const ke=-12;function Le(t,e=0,o=0,n=0,r=0){const i=document.createElement("button");St(i,de);let l="";return 2===e&&(i.style.top=`${ke}px`,l+="n"),2===n?(i.style.bottom=`${ke}px`,l+="s"):1===n&&(i.style.bottom=`calc(50% - ${ce/2}px)`),2===o?(i.style.right=`${ke}px`,l+="e"):1===o&&(i.style.right=`calc(50% - ${ae/2}px)`),2===r&&(i.style.left=`${ke}px`,l+="w"),i.id=`${re}-${l}-${t}`,i.style.cursor=`${l}-resize`,i}function Te(t){const e=t.fullState[u];if(!e)throw new Error("no select state present");return[...e.selectedIds]}function Oe({children:e,id:n="main",topBarTools:r,hideTopBar:i,bottomBarTools:l=[],hideBottomBar:s,shouldKeepHistory:a=!0,shouldSelectAfterCreate:c=!0,shouldPreserveAspectRatio:p=!1,isResponsive:f=!1,styleComponents:h,menuComponents:g=[],onLoad:y,contextGetter:m}){const b=t.useRef(null),[w,v]=t.useState(r[0]),x=t.useRef(new Map),C=t.useRef(null),E=t.useRef(`drawing-area-container-${n}`),M=t.useRef(null),D=t.useRef(null),j=t.useRef(function(t){const e={[u]:{selectedIds:[],handlers:{},prevPoint:null},[d]:{deletedObjects:new Map}};return t.reduce(((t,o)=>(void 0===t[o.id]&&(t[o.id]={}),o.setupCustomState&&(t[o.id]=Object.assign(t[o.id],o.setupCustomState(e))),t)),e)}(r)),S=t.useRef([]),I=t.useRef([]),k=t.useRef(null),L=t.useRef(function(t){const e=Object.assign({},Ne);return e}()),[T,O]=t.useState(new Map),z=()=>{const t=(()=>{const t=new Map;return l.reduce(((t,e)=>(t.set(e.id,e.getDisplayMode(N())),t)),t)})();if(t.size!==T.size)return O(t);const e=t.keys();for(const o of e)if(t.get(o)!==T.get(o))return O(t)};t.useEffect((()=>{z(),y&&y(N())}),[]),t.useEffect((()=>{if(w.id===u){const t=k.current;if(t){const e=N();Ae(e),e.fullState[u].selectedIds=[t.id],Ie(t,e),k.current=null}}z()}),[w]);const A=t=>{if(w.id!==u)return k.current=t,v(ze(r,u));const e=N();Ae(e),e.fullState[u].selectedIds=[t.id],Ie(t,e),z()},N=t=>{const e=t||R(),o=j.current;return{viewContainer:e,objectsMap:x.current,lastEvent:D.current,prevMousePosition:M,drawingTools:r,fullState:o,undoStack:S.current,redoStack:I.current,shouldKeepHistory:a,shouldPreserveAspectRatio:p,selectDrawingTool:U,selectObject:A,shouldSelectAfterCreate:c,globalStyles:L.current}};function H(t){w.onKeyPress&&(w.onKeyPress(t,N()),z())}const R=()=>{const t=b.current;if(!t)throw new Error("no view container while resizing");return t};function $(t){const e=N(),o=lt(t,Object.assign({},L.current),w.id);C.current=o,e.viewContainer.append(o.containerDiv),w.onDrawStart(o,e)}function P(t){const e=C.current;if(!e)return;const o=N();e.coords.push(t),w.onDrawing(e,o)}function W(t){const e=C.current;M.current=null,C.current=null,e&&(e.coords.push(t),x.current.set(e.id,e),w.onDrawEnd(e,N()),z())}t.useEffect((()=>{const t=b.current;if(t)return t.addEventListener("mousedown",e),t.addEventListener("mouseup",n),t.addEventListener("mousemove",o),t.addEventListener("touchstart",i,{passive:!1}),t.addEventListener("touchmove",l,{passive:!1}),t.addEventListener("touchcancel",s,{passive:!0}),t.addEventListener("touchend",s,{passive:!0}),t.addEventListener("mouseleave",n),window.addEventListener("keydown",H),()=>{t.removeEventListener("mousedown",e),t.removeEventListener("mouseup",n),t.removeEventListener("mousemove",o),t.removeEventListener("touchstart",i),t.removeEventListener("touchmove",l),t.removeEventListener("touchcancel",s),t.removeEventListener("touchend",s),t.removeEventListener("mouseleave",n),window.removeEventListener("keydown",H);const a=N(t);for(const t of r)t.onUnMount&&t.onUnMount(a)};function e(e){D.current=e;$(Tt([e.clientX,e.clientY],t))}function o(e){D.current=e;P(Tt([e.clientX,e.clientY],t))}function n(e){D.current=e;W(Tt([e.clientX,e.clientY],t))}function i(e){D.current=e,e.preventDefault();$(Tt(Ot(e),t))}function l(e){D.current=e,e.preventDefault();P(Tt(Ot(e),t))}function s(e){D.current=e,e.preventDefault();W(Tt(Ot(e),t))}}),[w]);const B=t.useRef({width:0,height:0});t.useEffect((()=>{const{viewContainer:t}=N();if(!t)return;B.current.width=t.offsetWidth,B.current.height=t.offsetHeight;let e=null;return f&&(e=new ResizeObserver((function(){const t=N(),{viewContainer:e}=t,o=e.offsetWidth,n=e.offsetHeight,r=n/B.current.height,i=o/B.current.width;t.objectsMap.forEach((e=>{e.containerDiv.style.height=e.containerDiv.offsetHeight*r+"px",e.containerDiv.style.width=e.containerDiv.offsetWidth*i+"px";const o=mt(e.containerDiv.style.left),n=mt(e.containerDiv.style.top),l=o*i,s=n*r;e.containerDiv.style.left=l+"px",e.containerDiv.style.top=s+"px",ze(t.drawingTools,e.toolId).onResize(e,Object.assign(Object.assign({},t),{shouldPreserveAspectRatio:t.shouldPreserveAspectRatio,previousPoint:[o,n],newPoint:[l,s]}))})),B.current={width:o,height:n}})),e.observe(t)),()=>{null==e||e.disconnect()}}),[]);const U=t=>{if(w.id!==t){const e=ze(r,t);if(e){const t=w,o=N();t.onUnPickTool&&t.onUnPickTool(o),e.onPickTool&&e.onPickTool(o),v(e),z()}}},Z=(t,e)=>{const o=t.filter(Ht);if(0===o.length)return;jt({data:o,objectId:"",toolId:"",toolType:"batch",action:"batch"},e)};return t.useEffect((()=>{m&&m(N)}),[]),o.default.createElement(o.default.Fragment,null,!i&&o.default.createElement(nt,{tools:r,onSelectTool:U,currentTool:w.id}),o.default.createElement("div",{id:E.current,style:{position:"relative",width:"100%",flex:1,overflow:"hidden",boxSizing:"border-box"},ref:b},o.default.createElement(tt,null),e),!s&&o.default.createElement(Mt,{displayMap:T,tools:l,dispatch:t=>{t(N()),z()},stylesMenu:{getEditProps:()=>{const t=N(),e=Te(t);if(0===e.length){return L.current}const o=function(t,e){const o={},n=t.map((t=>Lt(e.objectsMap,t))),r={};for(const t of n){const n=ze(e.drawingTools,t.toolId);if(n.styleHandlers){const e=Object.keys(n.styleHandlers);for(const n of e){const e=t.style[n];e?(o[n]=e,r[n]=(r[n]||0)+1):console.error("could not get style value for key:",n,"from object",t)}}}for(const t in r)r[t]!==n.length&&delete o[t];return o}(e,t);return o},styleComponents:h,onUpdateStyle:(t,e)=>{const o=N(),n=Te(o);if(0===n.length)return L.current[t]=e,[];const r=n.map((t=>Lt(o.objectsMap,t))),i=r.map((n=>{const r=ze(o.drawingTools,n.toolId).styleHandlers;if(r&&r[t])return r[t](n,e,o)}));return Z(i,o),i}}},g.map(((t,e)=>o.default.createElement(t,{key:e,getContext:N})))),o.default.createElement("style",null,`\n\t\t#${E.current} {\n\t\t\tcursor: ${w.cursor||"default"};\n\t\t}\n\t  `))}function ze(t,e){const o=t.find((t=>t.id===e));if(!o)throw new Error("could not find the used tool");return o}function Ae(t){const e=t.fullState[u].selectedIds;if(e.length>0){Se(ue(e,t.objectsMap),t)}}const Ne={lineWidth:"4",zIndex:"1",color:"#000000",fontSize:"14",background:"transparent",opacity:"1"};var He=t.forwardRef((function(e,n){var{children:r,styles:l,style:s,classNames:c}=e,d=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o}(e,["children","styles","style","classNames"]);const{layout:u}=function(e,o){const n=t.Children.count(e);if(n>1)throw new Error("ReactDraw expects either 0 or 1 children, detected more.");void 0===o&&(o="default");return{numChildren:n,layout:o}}(r,d.layout);return o.default.createElement(J,{styles:l,classNames:c},o.default.createElement(a,null,o.default.createElement(i,{layout:u,ref:n,style:s},o.default.createElement(Oe,Object.assign({},d),r))))}));function Re(t){const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("fill","transparent"),e.setAttribute("stroke",t.color),e.style.strokeWidth=`${t.lineWidth}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}function $e(t,e,o){if(!it())throw new Error("createSVG called on server");const n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("viewbox",`0 0 ${t} ${e}`),n.style.overflow="visible",n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.opacity=o,n.style.width="100%",n.style.height="100%",n}function Pe(t,e){if(!it())throw new Error("createPath called on server");const o=document.createElementNS("http://www.w3.org/2000/svg","circle");return o.setAttribute("fill","black"),o.setAttribute("cx",`${Math.ceil(t/2)}`),o.setAttribute("cy",`${Math.ceil(t/2)}`),o.setAttribute("r",`${t}`),o}function We(t,e,o){return{objectId:t.id,toolId:t.toolId,toolType:"top-bar-tool",action:e,data:o}}function Be(t){const e=t.containerDiv;return e.style.backgroundColor=t.style.background,e.style.borderRadius="2px",e.style.boxSizing="border-box",e.style.color=t.style.color,e.style.opacity=t.style.opacity,e.style.fontSize=`${t.style.fontSize}px`,t}function Ue(t){const e=t.element;if(!e)throw new Error;let o=e.querySelector("path");if(o||(o=e.querySelector("line")),!o)throw new Error;return o}const Ze=/^(#([0-9A-F]{3}){1,2}|transparent)$/i;function Ye(t,e,o,n){if(!n.match(Ze))return;const r=Ue(t),i=t.style[e];return r.style[o]=n,t.style[e]=n,We(t,e,i)}function Ve(t,e){return Ye(t,"color","stroke",e)}function Ke(t,e){const{ele:o,action:n}=Fe(t,e,"background");return n?(o.style.backgroundColor=e,n):n}function Fe(t,e,o){const n=t.element;if(!n)throw new Error;if(!e.match(Ze))return{ele:n,action:void 0};const r=t.style[o];t.style[o]=e;return{ele:n,action:We(t,o,r)}}function qe(t,e){const{ele:o,action:n}=Fe(t,e,"color");return n?(o.style.border=Qe(t.style),n):n}function Qe(t){return`${t.lineWidth}px solid ${t.color}`}function Xe(t,e,o,n){if(!n.match(Ze))return;const r=t.style[e];return t.style[e]=n,t.containerDiv.style[o]=n,We(t,e,r)}function Ge(t,e){if(!e.shouldKeepHistory)return;jt({toolId:t.toolId,toolType:"top-bar-tool",objectId:t.id,action:"create",data:null},e)}function Je(t,e){const o=Lt(e.objectsMap,t.objectId);return kt(t.objectId,e),t.data=o,t.action="delete",t}function _e(t,e){const o=t.data;if(!o)throw new Error("redo delete but no data exists");return e.objectsMap.set(o.id,o),e.viewContainer.appendChild(o.containerDiv),t.data=null,t.action="create",t}function to(t,e){const o=t.data;if(!o||"object"!=typeof o)throw new Error("malformed data");for(const[t,n]of o.entries())e.viewContainer.appendChild(n.containerDiv),e.objectsMap.set(t,n);return t.action="create",t.data=Array.from(o.keys()),t}function eo(t,e){const o=t.data;if(!o||!Array.isArray(o))throw console.error(t),new Error("malformed data");t.data=new Map;for(const n of o)t.data.set(n,Lt(e.objectsMap,n)),kt(n,e);return t.action="delete",t}function oo(t,e){const o=Lt(e.objectsMap,t.objectId),n=o.style.opacity,r=t.data,i=o.element;if(!r||!i)throw new Error;return o.style.opacity=r,i.style.opacity=o.style.opacity,t.data=n,t}function no(t,e){const o=Lt(e.objectsMap,t.objectId),n=o.style.lineWidth,r=t.data,i=o.element;if(!r||!i)throw new Error;return o.style.lineWidth=r,i.style.border=Qe(o.style),t.data=n,t}function ro(t,e){const o=Lt(e.objectsMap,t.objectId),n=o.style.background,r=t.data,i=o.element;if(!r||!i)throw new Error;return o.style.background=r,i.style.backgroundColor=r,t.data=n,t}function io(t,e){const o=Lt(e.objectsMap,t.objectId),n=o.style.color,r=t.data,i=o.element;if(!r||!i)throw new Error;return o.style.color=r,i.style.border=Qe(o.style),t.data=n,t}function lo(t,e){return ao(t,e,"color","stroke")}function so(t,e){return ao(t,e,"background","fill")}function ao(t,e,o,n){const r=Lt(e.objectsMap,t.objectId),i=r.style[o],l=t.data,s=r.element;if(!s)throw new Error;let a=s.querySelector("path");if(a||(a=s.querySelector("line")),!a)throw new Error;return r.style[o]=l,a.style[n]=l,t.data=i,t}function co(t,e){const o=Lt(e.objectsMap,t.objectId),n=o.style.lineWidth,r=t.data,i=Ue(o);return o.style.lineWidth=r,i.style.strokeWidth=r+"px",t.data=n,t}const uo=/^[0-9]+$/g;function po(t,e){const o=t.element;if(!o)throw new Error;if(!e.match(uo))return;const n=t.style.lineWidth;t.style.lineWidth=e,o.style.border=Qe(t.style);return We(t,"lineWidth",n)}function fo(t,e){const o=e.includes("px")?e:e+"px",n=Ue(t),r="lineWidth",i=t.style[r];return n.style.strokeWidth=o,t.style[r]=e,We(t,r,i)}const ho=/^(0(\.\d+)?|1(\.0+)?)$/;function go(t,e){if(!e.match(ho))return;const o=t.element;if(!o)throw new Error;const n=t.style.opacity;return t.style.opacity=e,o.style.opacity=e,We(t,"opacity",n)}const yo={id:"free-draw-tool",tooltip:"Free draw tool",icon:o.default.createElement((function(t){const e=wt(t);return o.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{d:"M10.5858 0.585786C11.3668 -0.195262 12.6332 -0.195262 13.4142 0.585786C14.1953 1.36683 14.1953 2.63316 13.4142 3.41421L12.6213 4.20711L9.79289 1.37868L10.5858 0.585786Z",fill:e.color}),o.default.createElement("path",{d:"M8.37868 2.79289L0 11.1716V14H2.82842L11.2071 5.62132L8.37868 2.79289Z",fill:e.color}))}),null),onDrawStart:t=>{const e=parseInt(t.style.lineWidth),o=$e(e,e,t.style.opacity);o.style.overflow="visible";const n=Pe(e/2,t.style.color);o.appendChild(n),t.containerDiv.appendChild(o),t.element=o},onDrawing:(t,e)=>{!function(t){const e=t.length;if(e<3)return;const o=t[e-3],n=t[e-1];ft(o,n)<10&&t.splice(e-2,1);ft(o,n)<20&&(t[e-2]=function(t,e){const[o,n]=t,[r,i]=e;return[Math.min(o,r)+Math.abs(o-r)/2,Math.min(n,i)+Math.abs(n-i)/2]}(o,n))}(t.coords),dt(t);const o=gt(t),n=$e(o.width,o.height,t.style.opacity);n.style.overflow="visible";const r=mo(t,e.viewContainer);n.appendChild(r),t.containerDiv.innerHTML="",t.containerDiv.appendChild(n),t.element=n},onDrawEnd:(t,e)=>{Ge(t,e),function(t){t.customData.set(v,gt(t))}(t),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize:(t,e)=>{t.element&&at(t.element,gt(t))},undoHandlers:{create:Je,delete:_e,color:lo,lineWidth:co,opacity:oo},redoHandlers:{create:Je,delete:_e,color:lo,lineWidth:co,opacity:oo},styleHandlers:{color:(t,e,o)=>Ve(t,e),lineWidth:(t,e,o)=>fo(t,e),opacity:(t,e,o)=>go(t,e)},cursor:"url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjU4NTggMC41ODU3ODZDMTEuMzY2OCAtMC4xOTUyNjIgMTIuNjMzMiAtMC4xOTUyNjIgMTMuNDE0MiAwLjU4NTc4NkMxNC4xOTUzIDEuMzY2ODMgMTQuMTk1MyAyLjYzMzE2IDEzLjQxNDIgMy40MTQyMUwxMi42MjEzIDQuMjA3MTFMOS43OTI4OSAxLjM3ODY4TDEwLjU4NTggMC41ODU3ODZaIiBmaWxsPSIjMTExODI3Ii8+CjxwYXRoIGQ9Ik04LjM3ODY4IDIuNzkyODlMMCAxMS4xNzE2VjE0SDIuODI4NDJMMTEuMjA3MSA1LjYyMTMyTDguMzc4NjggMi43OTI4OVoiIGZpbGw9IiMxMTE4MjciLz4KPC9zdmc+) 0 16, pointer"};function mo(t,e){const o=Re(t.style);return o.setAttribute("d",function(t,e){let o="";for(let n=0;n<t.coords.length;n++){o+=bo(ct(t.coords[n],t.containerDiv,e),n),n!==t.coords.length-1&&(o+=" ")}return o}(t,e)),o}function bo(t,e){return 0===e?`M ${t[0]} ${t[1]}`:`L ${t[0]} ${t[1]}`}function wo(t,e){const o=t.data,n=[];for(const t of o){const o=Lt(e.objectsMap,t.objectId),r=o.containerDiv,i=gt(o),{left:l,top:s}=t;n.push({objectId:t.objectId,top:i.top,left:i.left}),r.style.left=l+"px",r.style.top=s+"px",pe(o,e)}return t.data=n,t}function vo(t,e){const o=t.data,n=[];for(const t of o){const o=Lt(e.objectsMap,t.objectId),r=o.containerDiv,i=Bt(r);n.push({objectId:t.objectId,rotate:i}),r.style.transform=`rotate(${t.rotate}deg)`,pe(o,e)}return t.data=n,t}function xo(t,e){const o=Lt(e.objectsMap,t.objectId),n=t.data,r=gt(o),i=Object.assign({},r);Co(o.containerDiv,n.bounds);return It(e.drawingTools,o.toolId).onResize(o,Object.assign(Object.assign({},e),{previousPoint:[r.left,r.top],newPoint:[n.bounds.left,n.bounds.top],shouldPreserveAspectRatio:e.shouldPreserveAspectRatio})),t.data.bounds=i,t}function Co(t,e){t.style.left=e.left+"px",t.style.top=e.top+"px",t.style.width=e.right-e.left+"px",t.style.height=e.bottom-e.top+"px"}function Eo(t,e){var o,n;const r=null!==(n=null===(o=t.localState)||void 0===o?void 0:o.subs)&&void 0!==n?n:[];Te(e).length>0?r.forEach((t=>t("selected"))):r.forEach((t=>t("none-selected")))}const Mo={tooltip:"Select tool",icon:o.default.createElement((function(t){const e=wt(t);return o.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{d:"M5.67175 0.911473C5.52881 0.378007 4.98047 0.0614245 4.44701 0.204366C3.91354 0.347308 3.59696 0.895645 3.7399 1.42911L3.99872 2.39504C4.14166 2.9285 4.69 3.24509 5.22346 3.10214C5.75693 2.9592 6.07351 2.41086 5.93057 1.8774L5.67175 0.911473Z",fill:e.color}),o.default.createElement("path",{d:"M1.42911 3.7399C0.895645 3.59696 0.347308 3.91354 0.204366 4.44701C0.0614245 4.98047 0.378007 5.52881 0.911473 5.67175L1.8774 5.93057C2.41086 6.07351 2.9592 5.75693 3.10214 5.22346C3.24509 4.69 2.9285 4.14166 2.39504 3.99872L1.42911 3.7399Z",fill:e.color}),o.default.createElement("path",{d:"M10.2426 3.17149C10.6331 2.78097 10.6331 2.1478 10.2426 1.75728C9.85204 1.36676 9.21887 1.36676 8.82835 1.75728L8.12124 2.46439C7.73072 2.85491 7.73072 3.48808 8.12124 3.8786C8.51177 4.26912 9.14493 4.26912 9.53545 3.8786L10.2426 3.17149Z",fill:e.color}),o.default.createElement("path",{d:"M3.17149 10.2426L3.8786 9.53546C4.26912 9.14493 4.26912 8.51177 3.8786 8.12124C3.48808 7.73072 2.85491 7.73072 2.46439 8.12124L1.75728 8.82835C1.36676 9.21887 1.36676 9.85204 1.75728 10.2426C2.1478 10.6331 2.78097 10.6331 3.17149 10.2426Z",fill:e.color}),o.default.createElement("path",{d:"M6.37142 5.07152C6 4.92295 5.57578 5.01002 5.29292 5.29289C5.01006 5.57575 4.92298 5.99997 5.07155 6.37138L9.07155 16.3714C9.2178 16.737 9.56502 16.9828 9.95847 16.9991C10.3519 17.0155 10.7183 16.7994 10.8945 16.4472L12.274 13.6882L15.2929 16.7071C15.6834 17.0976 16.3166 17.0976 16.7071 16.7071C17.0977 16.3166 17.0977 15.6834 16.7071 15.2929L13.6882 12.2739L16.4472 10.8944C16.7995 10.7183 17.0155 10.3519 16.9992 9.95843C16.9828 9.56498 16.737 9.21777 16.3714 9.07152L6.37142 5.07152Z",fill:e.color}))}),{style:{transform:"translate(-2px, -1px)"}}),id:u,onDrawStart:t=>{t.containerDiv.style.border=`1px solid ${E.primary.main}`,t.containerDiv.style.backgroundColor=E.primary.light+"4d"},onDrawing(t,e){ut(t),t.coords.splice(1),function(t,e){var o,n;const r=null!==(n=null===(o=e.lastEvent)||void 0===o?void 0:o.shiftKey)&&void 0!==n&&n,i=e.fullState[u].selectedIds,l=[...i];let s=function(t,e,o){const n=[];for(const[r,i]of t.entries())Dt(i,o),pt(e,gt(i))&&n.push(r);return n}(e.objectsMap,gt(t),e);r&&(s=new Array(...new Set([...s,...l])));Io(e,s)}(t,e),Eo(Mo,e)},onDrawEnd(t,e){const{objectsMap:o,viewContainer:n}=e;n.removeChild(t.containerDiv),o.delete(t.id),Nt('[id^="react-draw-cursor"',e.viewContainer),jo(t,e),Eo(Mo,e)},onResize:t=>{},onUnMount(t){var e;for(const e of Object.values(t.objectsMap))Dt(e,t);(null===(e=Mo.localState)||void 0===e?void 0:e.subs)&&(Mo.localState.subs=[])},onUnPickTool(t){const e=t.fullState[u],o=e.selectedIds;if(0===o.length)return;Se(ue(o,t.objectsMap),t),e.selectedIds=[],Eo(Mo,t)},onKeyPress(t,e){"Delete"===t.key&&(Do(e),Eo(Mo,e))},undoHandlers:{delete:to,create:eo,drag:wo,rotate:vo,resize:xo},redoHandlers:{delete:to,create:eo,drag:wo,rotate:vo,resize:xo},subscribe(t){var e;Mo.localState||(Mo.localState={}),(null===(e=Mo.localState)||void 0===e?void 0:e.subs)||(Mo.localState.subs=[]),Mo.localState.subs.push(t)}};function Do(t){const e=t.fullState[u].selectedIds;if(e.length<1)return;const o={toolId:"",toolType:"top-bar-tool",objectId:"",data:[],action:"delete"};o.toolId=u,o.data=[...e];const n=eo(o,t);t.shouldKeepHistory&&jt(n,t)}const jo=(t,e)=>{var o,n;const r=null!==(n=null===(o=e.lastEvent)||void 0===o?void 0:o.shiftKey)&&void 0!==n&&n,i=t.coords[0],l=t.coords[t.coords.length-1];if(ft(l,i)<75){const t=function(t,e){let{top:o,right:n,bottom:r,left:i}=t;const[l,s]=e;return s>r?r=s:s<o&&(o=s),l<i?i=l:l>n&&(n=l),{top:o,right:n,bottom:r,left:i}}(ht(i),l);So(e,t,r)}},So=(t,e,o)=>{const n=function(t,e){let o=null;for(const[n,r]of t.entries()){const t=parseInt(r.style.zIndex);if(pt(gt(r),e)){if(null===o){o=r;continue}t>parseInt(o.style.zIndex)&&(o=r)}}return o}(t.objectsMap,e);let{ids:r}=function(t){const e=[...t.fullState[u].selectedIds],{objectsMap:o,prevMousePosition:n}=t,r=ue(e,o);if(Se(r,t),1===r.length){const e=It(t.drawingTools,r[0].toolId);e&&t&&e.onUnSelect&&e.onUnSelect(r[0],t)}return n.current=null,{ids:e.splice(0,e.length),objects:r}}(t);return o||(r=[]),null!==n&&(r=r.concat([n.id])),Io(t,r),r};function Io(t,e){t.fullState[u].selectedIds=e;const o=ue(e,t.objectsMap);return 1===o.length?(je(t.drawingTools,o[0],t),Ie(o[0],t)):o.length>1?Me(o,t):void 0}const ko={id:"react-draw-square-tool",tooltip:"Square Tool",icon:o.default.createElement((function(t){const e=wt(t);return o.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("rect",{width:"16",height:"16",rx:"1",fill:e.color}))}),null),onDrawStart:t=>{const e=Lo(t.style);t.containerDiv.appendChild(e),t.element=e},onDrawing:t=>{ut(t),t.coords.splice(1)},onDrawEnd(t,e){Ge(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},undoHandlers:{create:Je,delete:_e,color:io,background:ro,lineWidth:no,opacity:oo},redoHandlers:{create:Je,delete:_e,color:io,background:ro,lineWidth:no,opacity:oo},onResize(t,e){},styleHandlers:{color:qe,background:Ke,lineWidth:po,opacity:go}};function Lo(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=`${t.lineWidth}px solid ${t.color}`,e.style.borderRadius="2px",e.style.boxSizing="border-box",e.style.backgroundColor=t.background,e.style.opacity=t.opacity,e}const To={id:"react-draw-circle-tool",tooltip:"Circle tool",icon:o.default.createElement((function(t){const e=wt(t);return o.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("circle",{cx:"8",cy:"8",r:"8",fill:e.color}))}),null),onDrawStart:t=>{const e=Oo(t.style);t.containerDiv.appendChild(e),t.element=e},onDrawing:t=>{ut(t),t.coords.splice(1)},onDrawEnd(t,e){Ge(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){},undoHandlers:{create:Je,delete:_e,color:io,background:ro,lineWidth:no,opacity:oo},redoHandlers:{delete:_e,create:Je,color:io,background:ro,lineWidth:no,opacity:oo},styleHandlers:{color:(t,e,o)=>qe(t,e),background:(t,e,o)=>Ke(t,e),lineWidth:(t,e,o)=>po(t,e),opacity:(t,e,o)=>go(t,e)}};function Oo(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=Qe(t),e.style.backgroundColor=t.background,e.style.borderRadius="50%",e.style.boxSizing="border-box",e.style.opacity=t.opacity,e}const zo={id:"react-draw-diamond-tool",tooltip:"Diamond tool",icon:o.default.createElement((function(t){const e=wt(t);return o.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("rect",{x:"11",y:"-0.313721",width:"16",height:"16",rx:"1",transform:"rotate(45 11 -0.313721)",fill:e.color}))}),null),onDrawStart:t=>{const e=t.containerDiv,o=Ao(t);e.appendChild(o)},onDrawing:t=>{ut(t);const e=t.containerDiv,o=Ao(t);e.innerHTML="",e.appendChild(o),t.element=o,t.coords.splice(1)},onDrawEnd(t,e){Ge(t,e),t.customData.set(v,gt(t)),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){at(t.element,gt(t))},undoHandlers:{create:Je,delete:_e,color:lo,background:so,lineWidth:co,opacity:oo},redoHandlers:{create:Je,delete:_e,color:lo,background:so,lineWidth:co,opacity:oo},styleHandlers:{color:Ve,background:function(t,e){return Ye(t,"background","fill",e)},lineWidth:fo,opacity:go}};function Ao(t){const e=parseInt(t.style.lineWidth),o=gt(t),{width:n,height:r}=o,i=$e(n+e,r+e,t.style.opacity),l=function(t,e){const o=Re(e);o.setAttribute("fill",e.background);const n=parseInt(e.lineWidth);return o.setAttribute("d",function(t,e){const o=t.bottom-t.top,n=t.right-t.left,r=`${e/2} ${o/2}`,i=`L ${n/2} ${e/2}`,l=`L ${n-e/2} ${o/2}`,s=`L ${n/2} ${o-e/2}`;return`M ${r} ${i} ${l} ${s} L ${r}`}(t,n)),o}(o,t.style);return i.appendChild(l),i}function No(t,e){const[o,n]=t,[r,i]=e;return r===o?i>n?"down":"up":i===n?r>o?"right":"left":r<o&&i<n?"nw":r>o&&i<n?"ne":r>o&&i>n?"se":"sw"}function Ho(t,e,o){return"right"===o?[[0,e/2],[t,e/2]]:"left"===o?[[t,e/2],[0,e/2]]:"down"===o?[[t/2,0],[t/2,e]]:"up"===o?[[t/2,e],[t/2,0]]:"nw"===o?[[t,e],[0,0]]:"ne"===o?[[0,e],[t,0]]:"se"===o?[[0,0],[t,e]]:[[t,0],[0,e]]}const Ro={id:"react-draw-line-tool",tooltip:"Straight Line Tool",icon:o.default.createElement((function(t){const e=wt(t);return o.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 24 3",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("line",{y1:"1.5",x2:"24",y2:"1.5",stroke:"black",strokeWidth:"3"}))}),null),onDrawStart:t=>{const e=t.containerDiv,o=parseInt(t.style.lineWidth),n=$e(o,o,t.style.opacity),r=Pe(o/2,t.style.color);n.appendChild(r),e.append(n),t.element=n},onDrawing:(t,e)=>{ut(t);const o=No(t.coords[0],t.coords[t.coords.length-1]);t.customData.set(x,o);const n=$o(t,o),r=t.containerDiv;r.innerHTML="",r.appendChild(n),t.element=n,t.coords.splice(1)},onDrawEnd(t,e){Ge(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){const o=t.customData.get(x);if(!o)throw new Error("orientation not set");const n=$o(t,o),r=t.containerDiv;r.removeChild(t.element),r.appendChild(n),t.element=n,t.coords.splice(1)},undoHandlers:{create:Je,delete:_e,color:lo,lineWidth:co,opacity:oo},redoHandlers:{create:Je,delete:_e,color:lo,lineWidth:co,opacity:oo},styleHandlers:{color:Ve,lineWidth:fo,opacity:go}};function $o(t,e){const o=gt(t),n=o.right-o.left,r=o.bottom-o.top,i=$e(n,r,t.style.opacity);i.style.overflow="visible";const[l,s]=Ho(n,r,e),a=function(t){const e=document.createElementNS("http://www.w3.org/2000/svg","line");return e.setAttribute("fill","transparent"),e.setAttribute("stroke",t.color),e.style.strokeWidth=`${t.lineWidth}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}(t.style);return a.setAttribute("x1",l[0].toString()),a.setAttribute("y1",l[1].toString()),a.setAttribute("x2",s[0].toString()),a.setAttribute("y2",s[1].toString()),i.appendChild(a),i}const Po={icon:o.default.createElement("span",{style:{display:"inline-block",fontWeight:"bold",fontSize:"20px"}},"A"),id:"react-draw-textarea-tool",tooltip:"Textarea Tool",cursor:"text",onDrawStart:(t,e)=>{qo(t,e)},onDrawing(t,e){},onDrawEnd(t,e){Ge(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){Vo(t,!1),Fo(t.element)},onSelect(t,e){Vo(t,!1),Fo(t.element)},onUnSelect(t){Vo(t,!1),Ko(t.containerDiv,gt(t))},onAfterUpdate(t,e){Vo(t,!1),Fo(t.element)},undoHandlers:{create:Je,delete:_e,input:Bo,color:Uo,background:Zo,opacity:oo,fontSize:Wo},redoHandlers:{create:Je,delete:_e,input:Bo,color:Uo,background:Zo,opacity:oo,fontSize:Wo},onDeleteObject(t,e){Vo(t,!0)},styleHandlers:{color:function(t,e){return Xe(t,"color","color",e)},background:function(t,e){return Xe(t,"background","backgroundColor",e)},opacity:go,fontSize:function(t,e){const o=t.style.fontSize;return t.style.fontSize=e,t.containerDiv.style.fontSize=e+"px",Ko(t.containerDiv,gt(t)),We(t,"fontSize",o)}}};function Wo(t,e){const o=Lt(e.objectsMap,t.objectId),n=o.style.fontSize,r=t.data;return o.style.fontSize=r,o.containerDiv.style.fontSize=r+"px",t.data=n,t}function Bo(t,e){const o=Lt(e.objectsMap,t.objectId).element;if(!o)throw new Error("tried to undo text but no ele found");const n=o.innerHTML,r=t.data;return o.innerHTML=r,t.data=n,t}function Uo(t,e){return Yo(t,e,"color","color")}function Zo(t,e){return Yo(t,e,"background","backgroundColor")}function Yo(t,e,o,n){const r=Lt(e.objectsMap,t.objectId),i=r.style[o],l=t.data;return r.style[o]=l,r.containerDiv.style[n]=l,t.data=i,t}function Vo(t,e){const o=t.element;if(!o)return;const n=t.customData.get("handler");n&&(o.removeEventListener("keypress",n),t.customData.delete("handler"));const r=t.customData.get("capture");e&&r&&(o.removeEventListener("input",r),t.customData.delete("capture"))}function Ko(t,e){const o=t.getBoundingClientRect(),{width:n,height:r}=o;e.bottom=e.top+r,e.right=e.left+n}function Fo(t){if(t.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);const o=window.getSelection();if(o)return o.removeAllRanges(),o.addRange(e),!0}return console.error("cannot place caret at end"),!1}function qo(t,e){const o=t.containerDiv,n=gt(t);Be(t),function(t){const e=parseInt(t.style.fontSize),o=t.containerDiv,n=gt(t),r=n.top+e+5;o.style.height="",o.style.minHeight=r-n.top+"px",o.style.minWidth=o.style.width,o.style.width="",o.style.border="1px solid black"}(t),function(t){const e=t.containerDiv;e.style.padding="5px",e.style.borderRadius="2px",e.style.boxSizing="border-box";const o=document.createElement("style");o.innerHTML="\n\t.react-draw-cursor {\n\t\toutline: none;\t\t\n\t\theight: 100%;\n\t}",e.appendChild(o)}(t);const r=function(){const t=document.createElement("div");return t.setAttribute("contenteditable","true"),t.style.minWidth="1px",t.style.height="100%",t.className="react-draw-cursor",t}();return r.style.opacity=t.style.opacity,t.element=r,o.appendChild(r),Ko(o,n),r.setAttribute("tabindex","1"),Qo(t,e),setTimeout((function(){r.focus()}),0),r}function Qo(t,e){const o=t.element,n=t.customData;function r(o){const r=(new Date).getTime(),i=n.get("lastCapture");if(i){if(r-i>5e3){const n=o.target;jt({toolId:t.toolId,action:"input",data:n.innerHTML,toolType:"top-bar-tool",objectId:t.id},e)}}else{jt({toolId:t.toolId,action:"input",data:"",toolType:"top-bar-tool",objectId:t.id},e)}n.set("lastCapture",r)}o.addEventListener("input",r),n.set("capture",r)}const Xo={icon:o.default.createElement((function(t){const e=wt(t);return o.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 16 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.2929 0.292893C10.6834 -0.0976311 11.3166 -0.0976311 11.7071 0.292893L15.7071 4.29289C16.0976 4.68342 16.0976 5.31658 15.7071 5.70711L11.7071 9.70711C11.3166 10.0976 10.6834 10.0976 10.2929 9.70711C9.90237 9.31658 9.90237 8.68342 10.2929 8.29289L12.5858 6H1C0.447716 6 -2.41411e-08 5.55228 0 5C2.41411e-08 4.44772 0.447716 4 1 4H12.5858L10.2929 1.70711C9.90237 1.31658 9.90237 0.683418 10.2929 0.292893Z",fill:e.color}))}),null),id:"react-draw-arrow-tool",tooltip:"Arrow Tool",onDrawStart:t=>{const e=t.containerDiv,o=parseInt(t.style.lineWidth),n=$e(o,o,t.style.opacity),r=Pe(o/2,t.style.color);n.appendChild(r),e.append(n),t.element=n},onDrawing:(t,{viewContainer:e})=>{ut(t);const o=No(t.coords[0],t.coords[t.coords.length-1]);t.customData.set(x,o);const n=Go(t,o),r=t.containerDiv;r.innerHTML="",r.appendChild(n),t.element=n,t.coords.splice(1)},onDrawEnd:(t,e)=>{e.shouldKeepHistory&&Ge(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){const o=t.customData.get(x);if(!o)throw new Error("orientation not set");const n=Go(t,o),r=t.containerDiv;r.removeChild(t.element),r.appendChild(n),t.element=n,t.coords.splice(1)},undoHandlers:{create:Je,delete:_e,color:lo,lineWidth:co,opacity:oo},redoHandlers:{create:Je,delete:_e,color:lo,lineWidth:co,opacity:oo},styleHandlers:{color:(t,e,o)=>Ve(t,e),lineWidth:(t,e,o)=>fo(t,e),opacity:(t,e,o)=>go(t,e)}};function Go(t,e){const o=parseInt(t.style.lineWidth),{width:n,height:r}=gt(t),[i,l]=Ho(n,r,e),s=$e(n+o,r+o,t.style.opacity);s.style.overflow="visible";const a=function(t,e,o){const[n,r]=e,[i,l]=o,s=Re(t.style),a=[n-i,r-l],[c,d]=a,u=Math.sqrt(c*c+d*d),p=[c/u,d/u],[f,h]=p,g=f*(Math.sqrt(3)/2)-.5*h,y=1*f/2+h*(Math.sqrt(3)/2),m=f*(Math.sqrt(3)/2)+.5*h,b=.5*-f+h*(Math.sqrt(3)/2),w=20,[v,x,C,E]=[-g*w,-y*w,-m*w,-b*w];return s.setAttribute("d",`M ${n} ${r} L ${i} ${l} L ${i-v} ${l-x} L ${i} ${l} L ${i-C} ${l-E}`),s}(t,i,l);return s.appendChild(a),s}const Jo={icon:o.default.createElement((function(t){const e=wt(t),{color:n}=e,r=bt(e,["color"]);return o.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{d:"M10.0616 0.586573L5.31159 5.33657L0.581585 10.1766C0.209084 10.5513 0 11.0582 0 11.5866C0 12.1149 0.209084 12.6218 0.581585 12.9966L4.88159 17.2966C5.06785 17.4813 5.31925 17.5855 5.58159 17.5866H17.5816V15.5866H10.5816L17.8016 8.36657C17.9875 8.18083 18.1351 7.96025 18.2357 7.71745C18.3364 7.47466 18.3882 7.2144 18.3882 6.95157C18.3882 6.68874 18.3364 6.42849 18.2357 6.18569C18.1351 5.9429 17.9875 5.72232 17.8016 5.53657L12.8916 0.586573C12.7058 0.40062 12.4853 0.253102 12.2425 0.152454C11.9997 0.0518053 11.7394 0 11.4766 0C11.2138 0 10.9535 0.0518053 10.7107 0.152454C10.4679 0.253102 10.2473 0.40062 10.0616 0.586573V0.586573ZM5.99159 15.5866L1.99159 11.5866L6.74159 6.74657L7.48159 5.99657L12.4316 10.9466L7.87159 15.5066L7.80159 15.5866H5.99159Z",fill:n}))}),null),tooltip:"Eraser tool",id:d,cursor:"url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOSAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjA2MTYgMC41ODY1NzNMNS4zMTE1OSA1LjMzNjU3TDAuNTgxNTg1IDEwLjE3NjZDMC4yMDkwODQgMTAuNTUxMyAwIDExLjA1ODIgMCAxMS41ODY2QzAgMTIuMTE0OSAwLjIwOTA4NCAxMi42MjE4IDAuNTgxNTg1IDEyLjk5NjZMNC44ODE1OSAxNy4yOTY2QzUuMDY3ODUgMTcuNDgxMyA1LjMxOTI1IDE3LjU4NTUgNS41ODE1OSAxNy41ODY2SDE3LjU4MTZWMTUuNTg2NkgxMC41ODE2TDE3LjgwMTYgOC4zNjY1N0MxNy45ODc1IDguMTgwODMgMTguMTM1MSA3Ljk2MDI1IDE4LjIzNTcgNy43MTc0NUMxOC4zMzY0IDcuNDc0NjYgMTguMzg4MiA3LjIxNDQgMTguMzg4MiA2Ljk1MTU3QzE4LjM4ODIgNi42ODg3NCAxOC4zMzY0IDYuNDI4NDkgMTguMjM1NyA2LjE4NTY5QzE4LjEzNTEgNS45NDI5IDE3Ljk4NzUgNS43MjIzMiAxNy44MDE2IDUuNTM2NTdMMTIuODkxNiAwLjU4NjU3M0MxMi43MDU4IDAuNDAwNjIgMTIuNDg1MyAwLjI1MzEwMiAxMi4yNDI1IDAuMTUyNDU0QzExLjk5OTcgMC4wNTE4MDUzIDExLjczOTQgMCAxMS40NzY2IDBDMTEuMjEzOCAwIDEwLjk1MzUgMC4wNTE4MDUzIDEwLjcxMDcgMC4xNTI0NTRDMTAuNDY3OSAwLjI1MzEwMiAxMC4yNDczIDAuNDAwNjIgMTAuMDYxNiAwLjU4NjU3M1YwLjU4NjU3M1pNNS45OTE1OSAxNS41ODY2TDEuOTkxNTkgMTEuNTg2Nkw2Ljc0MTU5IDYuNzQ2NTdMNy40ODE1OSA1Ljk5NjU3TDEyLjQzMTYgMTAuOTQ2Nkw3Ljg3MTU5IDE1LjUwNjZMNy44MDE1OSAxNS41ODY2SDUuOTkxNTlaIiBmaWxsPSJibGFjayI+PC9wYXRoPgo8L3N2Zz4=) 0 16, pointer",onDrawStart(t,e){},onDrawing(t,e){const o=e.viewContainer;dt(t);const n=gt(t),r=$e(n.width,n.height,"1"),i=function(t,e){const o=Re(t.style);return o.style.strokeWidth="10px",o.setAttribute("d",function(t,e){let o="",n=t.coords[0];for(let r=0;r<t.coords.length;r++){const i=ct(t.coords[r],t.containerDiv,e);o+=tn(i,n,r),n=i,r!==t.coords.length-1&&(o+=" ")}return o}(t,e)),o.setAttribute("stroke","rgba(232, 16, 84, 0.142)"),o}(t,o);r.appendChild(i);const l=t.containerDiv;l.innerHTML="",l.appendChild(r),t.element=r;const s=ht(t.coords[t.coords.length-1]),a=e.objectsMap.keys();for(const t of a){const o=e.objectsMap.get(t);if(!o)continue;pt(gt(o),s)&&(kt(t,e),_o(e,o))}},onDrawEnd(t,e){const{objectsMap:o,viewContainer:n}=e;n.removeChild(t.containerDiv),o.delete(t.id),Nt('[id^="react-draw-erase-tool"',e.viewContainer);if(e.fullState[d].deletedObjects.size>0&&e.shouldKeepHistory){const o={toolId:t.toolId,toolType:"top-bar-tool",objectId:"",action:"delete",data:e.fullState[d].deletedObjects};e.fullState[d].deletedObjects=new Map,jt(o,e)}},undoHandlers:{delete:to},redoHandlers:{create:eo},onResize(t,e){}};function _o(t,e){t.fullState[d].deletedObjects.set(e.id,e)}function tn(t,e,o){return 0===o?`M ${t[0]} ${t[1]}`:`l ${t[0]-e[0]} ${t[1]-e[1]}`}const en={id:"react-draw-undo-tool",tooltip:"Undo",icon:o.default.createElement((function(t){const e=wt(t),{color:n}=e,r=bt(e,["color"]);return o.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{d:"M8.4345 1.3088e-05C6.17654 0.00387579 4.12643 0.851527 2.61286 2.2295L1.39599 1.07024C0.88081 0.57945 0 0.927028 0 1.62108V5.97259C0 6.40284 0.36611 6.75162 0.817742 6.75162H5.38548C6.11402 6.75162 6.47887 5.91251 5.96372 5.42172L4.54119 4.06653C5.59281 3.12847 6.95357 2.60886 8.39923 2.59698C11.5475 2.57108 14.2012 4.99825 14.174 8.09701C14.1482 11.0366 11.6466 13.5032 8.45 13.5032C7.0487 13.5032 5.7243 13.0268 4.68055 12.1543C4.51894 12.0193 4.27488 12.0275 4.12285 12.1723L2.77146 13.4597C2.60546 13.6178 2.61367 13.8757 2.78789 14.0256C4.28626 15.3149 6.27188 16.1 8.45 16.1C13.1168 16.1 16.9 12.4959 16.9 8.05007C16.9 3.6093 13.0959 -0.00793953 8.4345 1.3088e-05Z",fill:n}))}),null),getDisplayMode:t=>t.undoStack.length>0?"show":"disabled",handleContext(t){const e=t.undoStack.pop();if(e)return"top-bar-tool"===e.toolType?function(t,e){const o=e.toolId,n=It(t.drawingTools,o),r=n.undoHandlers,i=e.action;if(!r)return void console.error("tool:",n,"does not implement undo functionality");const l=r[i];l||console.error("tool:",n,"does not implement undo action:",i);const s=l(e,t);t.shouldKeepHistory&&t.redoStack.push(s)}(t,e):"batch"===e.toolType?function(t,e){const o=e.data,n=[];for(const e of o){const o=e.toolId,r=It(t.drawingTools,o),i=r.undoHandlers,l=e.action;if(!i)return void console.error("tool:",r,"does not implement undo functionality");const s=i[l];if(!s)return void console.error("tool:",r,"does not implement action:",l);n.push(s(e,t))}e.data=n,t.shouldKeepHistory&&t.redoStack.push(e)}(t,e):void 0}};const on={id:"react-draw-redo-tool",tooltip:"Redo",icon:o.default.createElement((function(t){const e=wt(t),{color:n}=e,r=bt(e,["color"]);return o.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{d:"M8.28183 1.34403e-05C10.4908 0.0039801 12.4964 0.874446 13.9771 2.28951L15.1676 1.09901C15.6716 0.595046 16.5333 0.951979 16.5333 1.66471V6.13334C16.5333 6.57517 16.1752 6.93334 15.7333 6.93334H11.2647C10.552 6.93334 10.195 6.07164 10.699 5.56764L12.0907 4.17598C11.0619 3.21268 9.73063 2.67908 8.31633 2.66688C5.2364 2.64028 2.64023 5.13278 2.66687 8.31494C2.69213 11.3336 5.13947 13.8667 8.26667 13.8667C9.63757 13.8667 10.9332 13.3774 11.9543 12.4815C12.1124 12.3428 12.3512 12.3512 12.4999 12.4999L13.822 13.822C13.9844 13.9844 13.9763 14.2491 13.8059 14.4031C12.3401 15.7271 10.3975 16.5333 8.26667 16.5333C3.70113 16.5333 3.33336e-05 12.8322 2.23918e-10 8.26674C-3.33331e-05 3.70644 3.72153 -0.00815322 8.28183 1.34403e-05Z",fill:n}))}),null),getDisplayMode:t=>t.redoStack.length>0?"show":"disabled",handleContext(t){const e=t.redoStack.pop();if(e)return"top-bar-tool"===e.toolType?function(t,e){const o=e.toolId,n=It(t.drawingTools,o),r=n.redoHandlers,i=e.action;if(!r)return void console.error("tool:",n,"does not implement undo functionality");const l=r[i];l||console.error("tool:",n,"does not implement undo action:",i);const s=l(e,t);t.shouldKeepHistory&&t.undoStack.push(s)}(t,e):"batch"===e.toolType?function(t,e){const o=e.data,n=[];for(const e of o){const o=e.toolId,r=It(t.drawingTools,o),i=r.redoHandlers,l=e.action;if(!i)return void console.error("tool:",r,"does not implement undo functionality");const s=i[l];if(!s)return void console.error("tool:",r,"does not implement action:",l);n.push(s(e,t))}e.data=n,t.shouldKeepHistory&&t.undoStack.push(e)}(t,e):void 0}};const nn={id:"react-draw-trash-tool",icon:o.default.createElement((function(t){const e=wt(t),{color:n}=e,r=bt(e,["color"]);return o.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 14 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0C5.62123 0 5.27497 0.214002 5.10557 0.552786L4.38197 2H1C0.447715 2 0 2.44772 0 3C0 3.55228 0.447716 4 1 4L1 14C1 15.1046 1.89543 16 3 16H11C12.1046 16 13 15.1046 13 14V4C13.5523 4 14 3.55228 14 3C14 2.44772 13.5523 2 13 2H9.61804L8.89443 0.552786C8.72504 0.214002 8.37877 0 8 0H6ZM4 6C4 5.44772 4.44772 5 5 5C5.55228 5 6 5.44772 6 6V12C6 12.5523 5.55228 13 5 13C4.44772 13 4 12.5523 4 12V6ZM9 5C8.44771 5 8 5.44772 8 6V12C8 12.5523 8.44771 13 9 13C9.55229 13 10 12.5523 10 12V6C10 5.44772 9.55229 5 9 5Z",fill:n}))}),null),tooltip:"Delete selected objects",getDisplayMode:t=>Te(t).length>0?"show":"disabled",handleContext(t){const e=Te(t);e.length<1||Rt(e,t)}},rn={id:"react-draw-duplicate-tool",tooltip:"Duplicate objects",icon:o.default.createElement((function(t){const e=wt(t),{color:n}=e,r=bt(e,["color"]);return o.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{d:"M4 6C4 4.89543 4.89543 4 6 4H12C13.1046 4 14 4.89543 14 6V12C14 13.1046 13.1046 14 12 14H6C4.89543 14 4 13.1046 4 12V6Z",fill:n}),o.default.createElement("path",{d:"M2 0C0.895431 0 0 0.89543 0 2V8C0 9.10457 0.89543 10 2 10L2 2H10C10 0.895431 9.10457 0 8 0H2Z",fill:n}))}),null),getDisplayMode:t=>Te(t).length>0?"show":"disabled",handleContext(t){ln(t)}};function ln(t){const e=Te(t);if(e.length<1)return;const o=e.map((e=>Lt(t.objectsMap,e)));Se(o,t);const n=o.map((e=>function(t,e){const o=t.containerDiv,n=o.cloneNode(!0),{newId:r,divId:i}=function(t){const e=rt(6),o=t.split("-");return o[o.length-1]=rt(6),{divId:o.join("-"),newId:e}}(o.id);n.id=i;const l={coords:t.coords.slice(0),toolId:t.toolId,element:n.lastElementChild,style:Object.assign({},t.style),customData:new Map(t.customData),containerDiv:n,id:r},s=gt(t);n.style.top=s.top+5+"px",n.style.left=s.left+10+"px";const a=It(e.drawingTools,t.toolId);if(a.onDuplicate)return a.onDuplicate(l,e);return l}(e,t))),r=n.map((e=>{const{toolId:o,id:n}=e;t.objectsMap.set(n,e),t.viewContainer.appendChild(e.containerDiv);return{action:"create",toolType:"top-bar-tool",toolId:o,objectId:n,data:e}}));if(t.shouldKeepHistory){jt({toolId:"",objectId:"",toolType:"batch",action:"batch",data:r},t)}1===e.length?Ie(n[0],t):Me(n,t);t.fullState[u].selectedIds=n.map((t=>t.id))}const sn={id:"react-draw-back-tool",icon:o.default.createElement((function(t){const e=wt(t),{color:n}=e,r=bt(e,["color"]);return o.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{d:"M15 17L5 9L15 1V17Z",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.default.createElement("path",{d:"M1 16V2",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}),null),tooltip:"Move object back",getDisplayMode:t=>Te(t).length>0?"show":"disabled",handleContext(t){an(t)}};function an(t){var e,o;const n=Te(t);if(n.length<1)return;let r=[],i=new Set;n.forEach((e=>{r.push(Lt(t.objectsMap,e)),i.add(e)}));for(const t of r)t.style.zIndex="0",t.containerDiv.style.zIndex="0";let l=1/0;for(const o of t.objectsMap.values()){if(i.has(o.id))continue;const t=parseInt(null!==(e=o.containerDiv.style.zIndex)&&void 0!==e?e:"0");t<l&&(l=t)}let s=1;l<0&&(s=1-l);for(const e of t.objectsMap.values()){if(i.has(e.id))continue;const t=parseInt(null!==(o=e.containerDiv.style.zIndex)&&void 0!==o?o:"0")+s;e.style.zIndex=t.toString(),e.containerDiv.style.zIndex=t.toString()}}const cn={id:"react-draw-forward-tool",tooltip:"Move object forward",icon:o.default.createElement((function(t){const e=wt(t),{color:n}=e,r=bt(e,["color"]);return o.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),o.default.createElement("path",{d:"M1 1L11 9L1 17V1Z",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),o.default.createElement("path",{d:"M15 2V16",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}),null),getDisplayMode:t=>Te(t).length>0?"show":"disabled",handleContext(t){dn(t)}};function dn(t){const e=Te(t);if(e.length<1)return;const o=e.map((e=>Lt(t.objectsMap,e)));o.sort(((t,e)=>un(t)-un(e)));const n=[];for(const o of t.objectsMap.values())e.includes(o.id)||n.push(o);let r=n.length+1;for(const t of o)t.style.zIndex=r.toString(),t.containerDiv.style.zIndex=r.toString(),r+=1;n.sort(((t,e)=>{const o=un(t);return un(e)-o}));let i=n.length;n.forEach((t=>{t.style.zIndex=i.toString(),t.containerDiv.style.zIndex=i.toString(),i-=1}))}const un=t=>t.containerDiv.style.zIndex?parseInt(t.containerDiv.style.zIndex):t.style.zIndex?parseInt(t.style.zIndex):0;function pn({onUpdate:e,styleKey:n,label:r,styleValue:i}){const l=t.useRef(rt(5));return o.default.createElement("div",null,o.default.createElement("div",{style:{textAlign:"left",marginBottom:5}},o.default.createElement("label",{style:{fontWeight:"bold"},htmlFor:l.current},r)),o.default.createElement("div",{style:{display:"flex"}},o.default.createElement("span",{style:{display:"inline-block",borderRadius:5,width:30,height:30,backgroundColor:i}}),o.default.createElement("div",{style:{marginLeft:10,display:"flex"}},o.default.createElement("span",{style:{borderRadius:"5px 0px 0px 5px",width:30,padding:5,fontWeight:"bold",fontSize:18,textAlign:"center",color:"grey",backgroundColor:"lightgray"}},"#"),o.default.createElement("input",{id:l.current,value:i.replace("#",""),onChange:t=>{const o=t.target.value;e(n,"transparent"===o?o:"#"+o)},style:{width:80,borderRadius:"0px 5px 5px 0px"}}))))}const fn=/\d+\.*\d*/g;function hn(t){return{rotation:Bt(t.containerDiv),bbox:gt(t),scale:null,other:{}}}function gn(t){var e;const o=hn(t);o.scale=function(t){const e=Ue(t).style.transform.match(fn);return e?{x:e[0],y:e[1]}:{x:"1",y:"1"}}(t),o.other.viewbox=null===(e=t.element)||void 0===e?void 0:e.getAttribute("viewbox");return{containerState:o,customData:mn(t)}}function yn(t){return{containerState:hn(t),customData:mn(t)}}const mn=t=>{const e={};for(const o of t.customData.keys())e[o]=t.customData.get(o);return e};function bn(t,e){throw new Error("toolid not function in serializers. id: "+t.toolId+" .options: "+Object.keys(e)+" . object: "+JSON.stringify(t))}function wn(t){const e=t,o=e.containerDiv,n=e.customData,r=e.coords[0],i=parseInt(e.style.lineWidth),{id:l,div:s}=st(r[0],r[1],i,e.toolId);return{drawingData:{toolId:e.toolId,id:l,style:e.style,customData:Cn(n),containerDiv:s,element:null,coords:e.coords},div:s,containerState:o}}function vn(t,e){t.containerDiv.innerHTML="",t.containerDiv.appendChild(e),t.element=e}function xn(t,e){t.style.transform=`rotate(${e.rotation}deg)`}function Cn(t){const e=new Map;for(const o in t){const n=t[o];e.set(o,n)}return e}exports.BackgroundStyle=t=>o.default.createElement(pn,Object.assign({},t,{label:"background"})),exports.COLORS=E,exports.ClearAllButton=({getContext:t})=>{const e=_(h),n=o.default.useRef(rt(6));return o.default.createElement("button",{className:e,id:n.current,onClick:()=>{const e=t();if(0===e.objectsMap.size)return;const o=e.objectsMap.keys();Rt(Array.from(o),e)}},o.default.createElement("div",{style:{padding:"0px 5px",height:20}},o.default.createElement(xt,{width:15,height:20})),o.default.createElement("label",{htmlFor:n.current,style:{padding:"0px 10px",pointerEvents:"none"}},"Clear All"))},exports.ColorStyle=t=>o.default.createElement(pn,Object.assign({},t,{label:"color"})),exports.FontSizeStyle=function({onUpdate:e,styleKey:n,styleValue:r}){const i=t.useRef(rt(5));return o.default.createElement("div",null,o.default.createElement("div",{style:{textAlign:"left",marginBottom:5}},o.default.createElement("label",{style:{fontWeight:"bold"},htmlFor:i.current},"font size")),o.default.createElement("div",{style:{width:"100%"}},o.default.createElement("input",{id:i.current,value:r,onChange:t=>{const o=t.target.value;e(n,o)},type:"number",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",step:"1"})))},exports.LineWidthStyle=function({onUpdate:e,styleKey:n,styleValue:r}){const i=t.useRef(rt(5));return o.default.createElement("div",null,o.default.createElement("div",{style:{textAlign:"left",marginBottom:5}},o.default.createElement("label",{style:{fontWeight:"bold"},htmlFor:i.current},"line width")),o.default.createElement("div",{style:{width:"100%"}},o.default.createElement("input",{id:i.current,value:r,onChange:t=>{const o=t.target.value;e(n,o)},type:"number",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",step:"1"})))},exports.OpacityStyle=function({onUpdate:e,styleKey:n,styleValue:r}){const i=t.useRef(rt(5));return o.default.createElement("div",null,o.default.createElement("div",{style:{textAlign:"left",marginBottom:5}},o.default.createElement("label",{style:{fontWeight:"bold"},htmlFor:i.current},"opacity (",r,")")),o.default.createElement("div",{style:{width:"100%"}},o.default.createElement("input",{id:i.current,value:r,onChange:t=>{const o=t.target.value;e(n,o)},type:"range",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",max:"1",step:"0.1"})))},exports.ReactDraw=He,exports.addObject=Pt,exports.arrowTool=Xo,exports.bringBackTool=sn,exports.bringForwardTool=cn,exports.bringSelectedBack=an,exports.centerObject=function(t,e,o,n){const r=t.viewContainer.getBoundingClientRect(),i=e.containerDiv;if(!o||!n){const{width:t,height:e}=i.getBoundingClientRect();o=o||t,n=n||e}const l=r.height/2-n/2,s=r.width/2-o/2;i.style.top=l+"px",i.style.left=s+"px",i.style.height=n+"px",i.style.width=o+"px"},exports.circleTool=To,exports.createCircle=function(t,e){const o=$t(t,e.pointA,e.toolId),n=Oo(t.globalStyles);return o.containerDiv.appendChild(n),o.element=n,o.coords.push(e.pointB),ut(o),Pt(t,o),t.selectObject(o),o},exports.createImage=function(t,e){return n(this,void 0,void 0,(function*(){const o=$t(t,e.pointA,e.toolId);Pt(t,o),o.coords.push(e.pointB),ut(o);const n=e.url;return new Promise(((r,i)=>{var l;const s=e=>{o.element=e,o.containerDiv.innerHTML="",o.containerDiv.appendChild(e),t.shouldSelectAfterCreate&&t.selectObject(o),r(o)};if(n){if(e.showLoading){const t=null!==(l=e.loadingElement)&&void 0!==l?l:function(){const t=document.createElement("style");t.innerHTML=".skeleton-loader {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\tborder-radius: 10px;\n\t\t\t\t\tbackground: linear-gradient(\n\t\t\t\t\t\t\tto right,\n\t\t\t\t\t\t\trgba(255, 255, 255, 0),\n\t\t\t\t\t\t\trgba(255, 255, 255, 0.5) 50%,\n\t\t\t\t\t\t\trgba(255, 255, 255, 0) 80%\n\t\t\t\t\t\t),\n\t\t\t\t\t\tlightgray;\n\t\t\t\t\tbackground-repeat: repeat-y;\n\t\t\t\t\tbackground-size: 50px 500px;\n\t\t\t\t\tbackground-position: 0 0;\n\t\t\t\t\tanimation: shine 1s infinite;\n\t\t\t\t}\n\t\t\t\t@keyframes shine {\n\t\t\t\t\tto {\n\t\t\t\t\t\tbackground-position: 100% 0, /* move highlight to right */ 0 0;\n\t\t\t\t\t}\n\t\t\t\t}";const e=document.createElement("div");e.appendChild(t),e.style.width="100%",e.style.height="100%";const o=document.createElement("span");return o.className="skeleton-loader",e.appendChild(o),e}();o.containerDiv.appendChild(t)}const t=new Image;return t.style.width="100%",t.style.height="100%",t.crossOrigin="anonymous",t.onload=function(){s(t)},t.onerror=()=>{i(null)},t.src=n,o}const a=e.image;if(!a)throw new Error("createImage must be given either url (string) or image (HTMLImageElement) options. Neither provided.");s(a)}))}))},exports.createNewObject=$t,exports.createText=function(t,e){const{toolId:o,text:n,viewLocation:r,editable:i,useTextToolDefaults:l}=e,s=$t(t,null!=r?r:At(t),o);if(l){const e=qo(s,t);return e.innerHTML=n,Pt(t,s),Fo(e),s}const a=document.createElement("div");a.style.width="fit-content",a.innerText=n;const c=s.containerDiv;c.appendChild(a),s.element=a,Pt(t,s);const d=a.getBoundingClientRect();return c.style.width=d.width+"px",c.style.height=d.height+"px",c.style.display="flex",c.style.justifyContent="center",c.style.alignItems="center",Be(s),i?(a.setAttribute("tabindex","1"),a.contentEditable="true",o===Po.id&&Qo(s,t),s):(a.contentEditable="false",s)},exports.deletedSelected=Do,exports.deserializationSetup=wn,exports.deserializeArrow=(t,e,o)=>{const{drawingData:n,div:r,containerState:i}=wn(t),l=n.customData.get(x);Co(r,i.bbox),o&&Pt(e,n);const s=Go(n,l);return s.setAttribute("viewbox",i.other.viewbox),s.style.overflow="visible",vn(n,s),xn(s,i),n},exports.deserializeCircle=(t,e,o)=>{const{drawingData:n,containerState:r,div:i}=wn(t);Co(i,r.bbox);return vn(n,Oo(n.style)),xn(i,r),o&&Pt(e,n),n},exports.deserializeData=function(t,e,o,n=!0){const r=JSON.parse(t),i=[];for(const t of r){const r=e[t.toolId];if(void 0===r)return bn(t,e);const l=r(t,o,n);i.push(l)}return i},exports.deserializeDiamond=(t,e,o)=>{var n,r;const{drawingData:i,div:l,containerState:s}=wn(t),a=i.customData.get(v),c=s.bbox;Co(l,a),o&&Pt(e,i);const d=Ao(i);d.setAttribute("viewbox",s.other.viewbox),d.style.overflow="visible";const u=d.getElementsByTagName("path")[0];return u&&(u.style.transform=`scale(${null===(n=s.scale)||void 0===n?void 0:n.x}, ${null===(r=s.scale)||void 0===r?void 0:r.y})`),vn(i,d),xn(d,s),Co(l,c),i},exports.deserializeFreeDraw=(t,e,o=!0)=>{var n,r;const{drawingData:i,div:l,containerState:s}=wn(t),a=i.customData.get(v),c=s.bbox;Co(l,a),o&&Pt(e,i);const d=$e(a.width,a.height,i.style.opacity);d.setAttribute("viewbox",s.other.viewbox),d.style.overflow="visible";const u=mo(i,e.viewContainer);return u.style.transform=`scale(${null===(n=s.scale)||void 0===n?void 0:n.x}, ${null===(r=s.scale)||void 0===r?void 0:r.y})`,d.appendChild(u),vn(i,d),xn(d,s),Co(l,c),i},exports.deserializeLine=(t,e,o)=>{const{drawingData:n,div:r,containerState:i}=wn(t),l=n.customData.get(x);Co(r,i.bbox),o&&Pt(e,n);const s=$o(n,l);return s.setAttribute("viewbox",i.other.viewbox),s.style.overflow="visible",vn(n,s),xn(s,i),n},exports.deserializeSquare=(t,e,o)=>{const{drawingData:n,containerState:r,div:i}=wn(t);return vn(n,Lo(t.style)),xn(i,r),Co(i,r.bbox),o&&Pt(e,n),n},exports.deserializeTextArea=(t,e,o)=>{const{drawingData:n,containerState:r,div:i}=wn(t);return qo(n,e),i.innerHTML=r.other.text,Co(i,r.bbox),xn(i,r),o&&Pt(e,n),n},exports.diamondTool=zo,exports.duplicateSelectedObjects=ln,exports.duplicateTool=rn,exports.eraseTool=Jo,exports.freeDrawTool=yo,exports.getSelectedObjects=function(t){return ue(Te(t),t.objectsMap)},exports.getViewCenterPoint=At,exports.makeArrowSvg=Go,exports.makeCircleDiv=Oo,exports.makeDiamondSvg=Ao,exports.makeLineInOrientation=$o,exports.makeNewDiv=st,exports.makeSquareDiv=Lo,exports.moveSelectedForward=dn,exports.notifyTool=je,exports.redoTool=on,exports.selectAll=function(t){const e=ue(Te(t),t.objectsMap);e.length>0&&Se(e,t);const o=Array.from(t.objectsMap.keys());t.fullState[u].selectedIds=o;const n=Array.from(t.objectsMap.values());return 1===n.length?(je(t.drawingTools,n[0],t),Ie(n[0],t)):n.length>1?Me(n,t):void 0},exports.selectElement=Ie,exports.selectManyElements=Me,exports.selectTool=Mo,exports.serializeArrow=t=>{const{containerState:e,customData:o}=gn(t);return Object.assign(Object.assign({},t),{containerDiv:e,customData:o})},exports.serializeCircle=t=>{const e=hn(t),o=mn(t);return Object.assign(Object.assign({},t),{containerDiv:e,customData:o})},exports.serializeDiamond=t=>{const{containerState:e,customData:o}=gn(t);return Object.assign(Object.assign({},t),{containerDiv:e,customData:o})},exports.serializeFreeDraw=t=>{const{containerState:e,customData:o}=gn(t);return Object.assign(Object.assign({},t),{containerDiv:e,customData:o})},exports.serializeLine=t=>{const{containerState:e,customData:o}=gn(t);return Object.assign(Object.assign({},t),{containerDiv:e,customData:o})},exports.serializeObjects=function(t,e){const o=[];for(const n of e.objectsMap.values()){const e=t[n.toolId];if(void 0===e)return bn(n,t);o.push(e(n))}return JSON.stringify(o)},exports.serializeSquare=t=>{const{containerState:e,customData:o}=yn(t);return Object.assign(Object.assign({},t),{containerDiv:e,customData:o})},exports.serializeText=t=>{const{containerState:e,customData:o}=yn(t);e.other.text=t.containerDiv.innerText;return Object.assign(Object.assign({},t),{containerDiv:e,customData:o})},exports.setContainerRect=ut,exports.setupTextAreaDiv=qo,exports.squareTool=ko,exports.straightLineTool=Ro,exports.textAreaTool=Po,exports.trashTool=nn,exports.undoTool=en,exports.unselectAll=Se,exports.unselectElement=Dt,exports.useStyles=_;
