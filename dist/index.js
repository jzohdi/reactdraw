"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),e=require("styled-components");function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=o(t),r=o(e);const l={boxShadow:"#000000 0px 1px 3px 0px",borderRadius:4,display:"flex",flexDirection:"column",position:"relative",fontFamily:"sans-serif"};var i=t.forwardRef((function({children:t,layout:e},o){const r=function(t){return"default"===t?{width:500,height:500,maxWidth:"100%"}:"fit"===t?{maxWidth:"100%"}:void 0}(e);return n.default.createElement("div",{style:Object.assign(Object.assign({},l),r),ref:o},t)}));const c="react-draw-erase-tool",s="react-draw-cursor",a={light:"#bddefb",main:"#228be6"},d={light:"#ececec"},u=r.default.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  &:hover {
    background-color: ${d.light};
  }
  ${t=>t.selected&&e.css`
      background-color: ${a.main} !important;
      > svg path {
        fill: white;
      }
    `}
`;function f({children:t,selected:e,onSelect:o}){return n.default.createElement(u,{selected:e,onClick:o},t)}const p={color:null,message:null,position:"top"},h=t.createContext([p,()=>{}]);function g({children:e}){const[o,r]=t.useState(p);return n.default.createElement(h.Provider,{value:[o,t=>{r(t)}]},e)}function m(){const[e,o]=t.useContext(h);return[e,o]}function b({children:t,text:e,position:o,disabled:r}){const[l,i]=m();if(!t)return n.default.createElement(n.default.Fragment,null);if(!e)return n.default.createElement(n.default.Fragment,null,t);return n.default.createElement("span",{onMouseOver:()=>{r||"ontouchstart"in window||navigator.maxTouchPoints>0||i(Object.assign(Object.assign({},l),{message:e,position:o}))},onMouseLeave:()=>{null!==l.message&&i(Object.assign(Object.assign({},l),{message:null}))},"aria-label":`label mouse listener ${e}`},t)}const w=r.default.div`
  display: flex;
  background-color: ${a.light};
  z-index: 1000;
  width: 100%;
  overflow-x: auto;
  /* Firefox */
  * {
    scrollbar-width: none;
    scrollbar-color: ${a.main} #e2ecf5;
  }

  /* Chrome, Edge, and Safari */
  &::-webkit-scrollbar {
    height: 10px;
  }

  &::-webkit-scrollbar-track {
    background: #e2ecf5;
  }

  &::-webkit-scrollbar-thumb {
    background-color: #035195;
    border-radius: 10px;
    border: 3px none #ffffff;
  }
  &::-webkit-scrollbar-thumb:hover {
    background-color: #00294d;
  }
`;function y({tools:t,onSelectTool:e,currentTool:o}){return n.default.createElement(w,null,t.map(((t,r)=>{const l=t.tooltip;return n.default.createElement(b,{text:l,position:"top",key:t.id},n.default.createElement(f,{selected:t.id===o,onSelect:()=>e(t.id)},t.icon))})))}function v(t){for(var e="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=o.length,r=0;r<t;r++)e+=o.charAt(Math.floor(Math.random()*n));return e}function x(){return void 0!==typeof window}function E(t,e,o){if(!x())throw new Error("new bounding div called on the server.");const n=parseInt(e.lineWidth),[r,l]=t,{id:i,div:c,top:s,left:a,right:d,bottom:u}=function(t,e,o,n){const r=v(6),l=document.createElement("div"),i=t-o,c=e-o;return l.id=`${n}-${r}`,l.style.width=2*o+"px",l.style.height=2*o+"px",l.style.position="absolute",l.style.left=i+"px",l.style.top=c+"px",l.style.pointerEvents="none",l.style.zIndex="1",l.style.boxSizing="border-box",{div:l,id:r,top:c,left:i,right:i+o+o,bottom:c+o+o}}(r,l,n,o);return{coords:[t],element:null,toolId:o,container:{id:i,div:c,bounds:{top:s,left:a,right:d,bottom:u}},style:e,customData:new Map}}function C(t,e){const{width:o,height:n}=function(t){const e=t.getAttribute("viewbox");if(!e)throw new Error("no viewbox found on ele");const o=e.split(" ");return{width:parseFloat(o[2]),height:parseFloat(o[3])}}(t),r=(e.right-e.left)/o,l=(e.bottom-e.top)/n;t.lastElementChild.style.transform=`scale(${r}, ${l})`}function M(t,e,o){const n=e.div.getBoundingClientRect(),r=o.getBoundingClientRect(),l=n.top-r.top,i=t[1]-l,c=n.left-r.left;return[t[0]-c,i]}function j(t){let e=!1;const[o,n]=t.coords[t.coords.length-1],r=t.container,l=r.bounds,i=parseInt(t.style.lineWidth);return o-i<=l.left?(l.left=o-i,r.div.style.left=o-i+"px",r.div.style.width=l.right+2*i-o+"px",e=!0):o+i>=l.right&&(l.right=o+i,r.div.style.width=o+2*i-l.left+"px",e=!0),n+i>=l.bottom?(l.bottom=n+i,r.div.style.height=n+2*i-l.top+"px",e=!0):n-i<=l.top&&(l.top=n-i,r.div.style.top=n-i+"px",r.div.style.height=l.bottom+2*i-n+"px",e=!0),e}function I(t){if(t.coords.length<2)throw new Error("data coords must be at least length 2");const[e,o]=t.coords[0],[n,r]=t.coords[t.coords.length-1],l=parseInt(t.style.lineWidth),i=Math.min(e,n),c=Math.min(o,r),s=Math.max(e,n),a=Math.max(o,r),{bounds:d,div:u}=t.container;return d.left=i,d.right=s,d.top=c,d.bottom=a,u.style.top=c+"px",u.style.left=i+"px",u.style.width=`${s-i+l}px`,u.style.height=`${a-c+l}px`,t.coords}function L(t,e){return t.top<=e.top&&t.bottom>=e.bottom&&t.left<=e.left&&t.right>=e.right}function k(t,e){return Math.sqrt(Math.pow(Math.abs(t[0]-e[0]),2)+Math.pow(Math.abs(t[1]-e[1]),2))}function S(t){const[e,o]=t;return{top:o,right:e,bottom:o,left:e}}function T(t){const e=t.container.bounds;return{width:e.right-e.left,height:e.bottom-e.top}}function D(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o}function O(t){const{size:e,width:o,height:n,color:r}=t,l=D(t,["size","width","height","color"]);return Object.assign({width:o||e||20,height:n||e||20,color:r||"#111827"},l)}function z(t){const e=O(t),{color:o}=e,r=D(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 5C3 4.44772 3.44772 4 4 4H16C16.5523 4 17 4.44772 17 5C17 5.55228 16.5523 6 16 6H4C3.44772 6 3 5.55228 3 5Z",fill:o}),n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 10C3 9.44772 3.44772 9 4 9H16C16.5523 9 17 9.44772 17 10C17 10.5523 16.5523 11 16 11H4C3.44772 11 3 10.5523 3 10Z",fill:o}),n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 15C3 14.4477 3.44772 14 4 14H16C16.5523 14 17 14.4477 17 15C17 15.5523 16.5523 16 16 16H4C3.44772 16 3 15.5523 3 15Z",fill:o}))}function A(t){const e=O(t),{color:o}=e,r=D(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 18 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M16 5L15.1327 17.1425C15.0579 18.1891 14.187 19 13.1378 19H4.86224C3.81296 19 2.94208 18.1891 2.86732 17.1425L2 5M7 9V15M11 9V15M12 5V2C12 1.44772 11.5523 1 11 1H7C6.44772 1 6 1.44772 6 2V5M1 5H17",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}function N(t){const e=O(t),{color:o}=e,r=D(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M19.312 11.75C20.4373 11.75 21.312 10.8936 21.312 9.79167C21.312 8.68978 20.4373 7.83333 19.312 7.83333C18.1867 7.83333 17.312 8.68978 17.312 9.79167C17.312 10.8936 18.1867 11.75 19.312 11.75ZM15.312 6.54867C16.4373 6.54867 17.312 5.69222 17.312 4.59033C17.312 3.48844 16.4373 2.632 15.312 2.632C14.1867 2.632 13.312 3.48844 13.312 4.59033C13.312 5.69222 14.1867 6.54867 15.312 6.54867ZM8.688 6.54867C9.81333 6.54867 10.688 5.69222 10.688 4.59033C10.688 3.48844 9.81333 2.632 8.688 2.632C7.56267 2.632 6.688 3.48844 6.688 4.59033C6.688 5.69222 7.56267 6.54867 8.688 6.54867ZM4.688 11.75C5.81333 11.75 6.688 10.8936 6.688 9.79167C6.688 8.68978 5.81333 7.83333 4.688 7.83333C3.56267 7.83333 2.688 8.68978 2.688 9.79167C2.688 10.8936 3.56267 11.75 4.688 11.75ZM12 0C18.6253 0 24 4.71175 24 10.4653C24 14.0765 21 16.9526 17.312 16.9526H15C13.8747 16.9526 13 17.8091 13 18.911C13 19.4006 13.188 19.8288 13.5 20.1956C13.812 20.5625 14 21.0521 14 21.5417C14 22.6436 13.1253 23.5 12 23.5C5.37467 23.5 0 18.2373 0 11.75C0 5.26269 5.37467 0 12 0Z",fill:o}))}function H({getEditProps:e,styleComponents:o={},onUpdateStyle:r}){const[l,i]=t.useState(e()),c=Object.keys(l).filter((t=>!!o[t]));t.useEffect((()=>{function t(){const t=e();i(t)}return window.addEventListener("click",t),()=>{window.removeEventListener("click",t)}}),[l]);const s=(t,e)=>{i(Object.assign(Object.assign({},l),{[t]:e})),r(t,e)};return 0===c.length?n.default.createElement(n.default.Fragment,null):(c.sort(((t,e)=>{const n=o[t].order;return o[e].order-n})),n.default.createElement("div",{style:{display:"flex",flexDirection:"column",gap:10}},c.map((t=>{const e=o[t].component;return n.default.createElement(e,{key:t,onUpdate:s,styleKey:t,styleValue:l[t]})}))))}const $=r.default.div`
  display: flex;
  background-color: ${a.light};
  z-index: 1000;
  width: 100%;
  overflow-x: auto;
  /* Firefox */
  * {
    scrollbar-width: none;
    scrollbar-color: ${a.main} #e2ecf5;
  }

  /* Chrome, Edge, and Safari */
  &::-webkit-scrollbar {
    height: 10px;
  }

  &::-webkit-scrollbar-track {
    background: #e2ecf5;
  }

  &::-webkit-scrollbar-thumb {
    background-color: #035195;
    border-radius: 10px;
    border: 3px none #ffffff;
  }
  &::-webkit-scrollbar-thumb:hover {
    background-color: #00294d;
  }
`,P=r.default.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  ${t=>"hide"===t.mode?e.css`
        display: none;
      `:t.disabled?e.css`
        cursor: not-allowed;
        background-color: white;
        > svg path {
          fill: lightgrey;
          stroke: lightgrey;
        }
      `:e.css`
      &:hover {
        background-color: ${d.light};
      }
      display: inline-block;
    `}
`,R=r.default.button`
  position: relative;
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  &:hover {
    background-color: ${d.light};
  }
  ${t=>t.open?e.css`
        background-color: ${a.main} !important;
        > svg path {
          fill: white;
          stroke: white;
        }
      `:e.css``}
`,W=r.default.div`
  position: absolute;
  left: 0;
  padding: 15px;
  border: 1px solid ${a.main};
  z-index: 1000;
  background-color: white;
  border-radius: 0px 5px 0px 0px;
  max-height: calc(100% - 80px);
  max-width: 100%;
  overflow: auto;
  box-sizing: border-box;

  @media only screen and (min-width: ${450}px) {
    bottom: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    bottom: 30px;
  }
  /* Firefox */
  * {
    scrollbar-width: none;
    scrollbar-color: ${a.main} #e2ecf5;
  }

  /* Chrome, Edge, and Safari */
  &::-webkit-scrollbar {
    width: 8px;
  }

  &::-webkit-scrollbar-track {
    background: #e2ecf5;
  }

  &::-webkit-scrollbar-thumb {
    background-color: ${a.main};
    border-radius: 8px;
    border: 3px none #ffffff;
  }
`;function U({tools:e,displayMap:o,dispatch:r,stylesMenu:l,children:i}){const[c,s]=t.useState(null),a=t=>s(t===c?null:t),d=!!l.styleComponents&&!function(t){for(var e in t)return!1;return!0}(l.styleComponents),u=!!i&&n.default.Children.count(i)>0;return n.default.createElement(n.default.Fragment,null,"styles"===c&&n.default.createElement(W,null,n.default.createElement(H,Object.assign({},l))),"menu"===c&&n.default.createElement(W,null,i),n.default.createElement($,null,u&&n.default.createElement(b,{text:"Menu",position:"bottom"},n.default.createElement(R,{onClick:()=>a("menu"),open:"menu"===c},n.default.createElement(z,{size:20}))),d&&n.default.createElement(b,{text:"Styles",position:"bottom"},n.default.createElement(R,{onClick:()=>a("styles"),open:"styles"===c},n.default.createElement(N,{size:20}))),e.map(((t,e)=>{const l=t.id,i=o.get(l)||"hide";return n.default.createElement(b,{key:t.id,text:t.tooltip,position:"bottom",disabled:"disabled"===i},n.default.createElement(P,{disabled:"disabled"===i,mode:i,onClick:()=>r(t.handleContext)},t.icon))}))))}function Z(t,e){const o=t.container.id,{div:n}=t.container,r=e.fullState[s],l=r.handlers[o];if(l)for(const t of l)t.ele.removeEventListener(t.eventName,t.fn);const i=n.querySelector('[id^="select-frame"');r.handlers[o]=[],null!==i&&n.removeChild(i);const c=r.selectedIds.indexOf(o);c>=0&&r.selectedIds.splice(c,1)}function B(t,e){e.shouldKeepHistory&&(e.undoStack.push(t),e.redoStack.splice(0))}function Y(t,e){for(const o in e)t.style[o]=e[o];return t}function V(t,e){const o=t.find((t=>t.id===e));if(!o)throw new Error("could not find the used tool");return o}function K(t,e){const{objectsMap:o,viewContainer:n}=e,r=F(e.objectsMap,t);Z(r,e);const{div:l,id:i}=r.container;n.removeChild(l),o.delete(i);const c=V(e.drawingTools,r.toolId);c.onDeleteObject&&c.onDeleteObject(r,e)}function F(t,e){const o=t.get(e);if(!o)throw new Error("could not get object from map");return o}function q(t,e){if(!e)throw new Error("Container not set.");const o=e.getBoundingClientRect();return[t[0]-o.left,t[1]-o.top]}function Q(t){let e=t.touches[0];return e||(e=t.targetTouches[0]),e||(e=t.changedTouches[0]),[e.clientX,e.clientY]}function X(t){const e=t.bottom-t.top,o=t.top+e/2,n=t.right-t.left;return[t.left+n/2,o]}function G(t,e){const o=e.querySelectorAll(t);o.length>0&&o.forEach((t=>{e.removeChild(t)}))}function J(t){return void 0!==t}function _(t,e){var o;const n={action:"batch",toolType:"batch",toolId:"",objectId:"",data:[]},r=new Set;for(const l of t){const t=F(e.objectsMap,l),i=t.toolId,c=V(e.drawingTools,i);if(e.shouldKeepHistory&&(null===(o=null==c?void 0:c.undoHandlers)||void 0===o?void 0:o.delete)){const e={action:"delete",toolType:"top-bar-tool",toolId:i,objectId:l,data:t};n.data.push(e)}else r.add(i);K(l,e)}if(e.shouldKeepHistory){if(B(n,e),r.size>0){console.log("removing items from undo stack since they do not implement undoDelete",r);for(let t=e.undoStack.length-1;t>=0;t--)r.has(e.undoStack[t].toolId)&&(e.undoStack.splice(t,1),t++)}}else e.undoStack.splice(0)}const tt=/-{0,1}\d+\.*\d*/g;function et(t){const e=t.style.transform;if(!e)return 0;const o=e.match(tt);return o?parseFloat(o[0]):0}function ot(t,e){const[o,n]=X(t.container.bounds),r=et(t.container.div);if(0===r)return[e.newPoint[0]-e.previousPoint[0],e.newPoint[1]-e.previousPoint[1]];const l=nt(o,n,-(r+10)*Math.PI/180,e.previousPoint),i=nt(o,n,-(r+10)*Math.PI/180,e.newPoint);return[i[0]-l[0],i[1]-l[1]]}function nt(t,e,o,n){const r=Math.sin(o),l=Math.cos(o),[i,c]=[n[0]-t,n[1]-e];return[i*l-c*r+t,i*r+c*l+e]}function rt(t,e){const[o,n]=ot(t,e),r=t.container,l=r.bounds,i=r.div;l.left+5>=l.right+o||l.bottom-5<=l.top+n||(l.top+=n,l.right+=o,i.style.top=l.top+"px",i.style.width=l.right-l.left+"px",i.style.height=l.bottom-l.top+"px")}function lt(t,e){const[o,n]=ot(t,e),r=t.container,l=r.bounds,i=r.div;l.left+o>=l.right-5||l.bottom-5<=l.top+n||(l.top+=n,l.left+=o,i.style.top=l.top+"px",i.style.left=l.left+"px",i.style.width=l.right-l.left+"px",i.style.height=l.bottom-l.top+"px")}function it(t,e){const[o,n]=ot(t,e),r=t.container,l=r.bounds,i=r.div;l.left+5>=l.right+o||l.bottom+n<=l.top+5||(l.right+=o,l.bottom+=n,i.style.width=l.right-l.left+"px",i.style.height=l.bottom-l.top+"px")}function ct(t,e){const[o,n]=ot(t,e),r=t.container,l=r.bounds,i=r.div;l.left+o>=l.right-5||l.bottom+n<=l.top+5||(l.bottom+=n,l.left+=o,i.style.left=l.left+"px",i.style.width=l.right-l.left+"px",i.style.height=l.bottom-l.top+"px")}const st={top:"-45px",cursor:"grab",left:"calc(50% - 8px)"},at={width:"calc(100% + 16px)",height:"calc(100% + 16px)",position:"absolute",border:`2px dotted ${a.main}`,top:"-6px",left:"-6px",cursor:"all-scroll",pointerEvents:"all",boxSizing:"border-box"},dt={width:"0px",height:"35px",borderLeft:"2px dotted black",position:"absolute",left:"5px",pointerEvents:"none"},ut={position:"absolute",borderRadius:"50%",width:"16px",height:"16px"};function ft(t,e){return t.map((t=>{const o=e.get(t);if(!o)throw new Error("object not found in map");return o}))}function pt(t,e){const o=t.toolId,n=e.drawingTools.find((t=>t.id===o));n&&n.onAfterUpdate&&n.onAfterUpdate(t,e)}function ht(t,e){const o=t.fullState[s],n=o.prevPoint;if(!n)return;const r=ft(o.selectedIds,t.objectsMap);!function(t,e,o){const[n,r]=o,[l,i]=e,c=n-l,s=r-i;for(const e of t){const{bounds:t,div:o}=e.container,{left:n,top:r,right:l,bottom:i}=t;t.left=n+c,t.top=r+s,t.right=t.left+(l-n),t.bottom=t.top+(i-r),o.style.top=t.top+"px",o.style.left=t.left+"px"}}(r,n,e),o.prevPoint=e,1===r.length&&pt(r[0],t)}function gt(t,e){t.fullState[s].prevPoint=e,function(t){const e=ft(t.fullState[s].selectedIds,t.objectsMap),o={objectId:"",toolId:s,toolType:"top-bar-tool",action:"drag",data:e.map((t=>({objectId:t.container.id,top:t.container.bounds.top,left:t.container.bounds.left})))};B(o,t)}(t)}function mt(t){t.fullState[s].prevPoint=null}function bt(t,e,o){const n=function(t){t.stopPropagation();const e=q([t.clientX,t.clientY],o.viewContainer);gt(o,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",l)},r=function(t){t.stopPropagation();const e=q([t.clientX,t.clientY],o.viewContainer);ht(o,e)},l=function(t){t.stopPropagation(),mt(o),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",l)},i=function(t){t.stopPropagation();const e=q(Q(t),o.viewContainer);gt(o,e),window.addEventListener("touchmove",c),window.addEventListener("touchend",a),window.addEventListener("touchcancel",a)},c=function(t){t.stopPropagation();const e=q(Q(t),o.viewContainer);ht(o,e)},a=function(t){t.stopPropagation(),mt(o),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)},d=o.fullState[s],u=d.handlers[e]||[];d.handlers[e]=u,u.push({ele:t,eventName:"mousedown",fn:n}),u.push({ele:t,eventName:"touchstart",fn:i}),t.addEventListener("mousedown",n),t.addEventListener("touchstart",i)}function wt(t,e,o){const n=t.fullState[s],r=n.prevPoint;if(!r)return;const l=ft(n.selectedIds,t.objectsMap);if(1!==l.length)throw new Error("start rotating got incorrect number of objects to handle");const i=l[0],c=V(t.drawingTools,i.toolId),a={viewContainer:t.viewContainer,newPoint:e,previousPoint:r};c.doResize?c.doResize(i,a):o(i,a),c.onResize(i,a),n.prevPoint=e}function yt(t,e){t.fullState[s].prevPoint=e,function(t){const e=ft(t.fullState[s].selectedIds,t.objectsMap);if(1!==e.length)throw new Error("resize push to stack expects 1 object selected");const{id:o,bounds:n}=e[0].container;B({objectId:o,toolId:s,toolType:"top-bar-tool",action:"resize",data:{bounds:{top:n.top,left:n.left,right:n.right,bottom:n.bottom}}},t)}(t)}function vt(t){t.fullState[s].prevPoint=null}function xt(t,e,o,n){const r=function(t){t.stopPropagation();const e=q([t.clientX,t.clientY],o.viewContainer);yt(o,e),window.addEventListener("mousemove",l),window.addEventListener("mouseup",i)},l=function(t){t.stopPropagation();const e=q([t.clientX,t.clientY],o.viewContainer);wt(o,e,n)},i=function(t){t.stopPropagation(),vt(o),window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",i)},c=function(t){t.stopPropagation();const e=q(Q(t),o.viewContainer);yt(o,e),window.addEventListener("touchmove",a),window.addEventListener("touchend",d),window.addEventListener("touchcancel",d)},a=function(t){t.stopPropagation();const e=q(Q(t),o.viewContainer);wt(o,e,n)},d=function(t){t.stopPropagation(),vt(o),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",d),window.removeEventListener("touchcancel",d)},u=o.fullState[s],f=u.handlers[e]||[];u.handlers[e]=f,f.push({ele:t,eventName:"mousedown",fn:r}),f.push({ele:t,eventName:"touchstart",fn:c}),t.addEventListener("mousedown",r),t.addEventListener("touchstart",c)}function Et(t,e){const o=t.fullState[s];if(!o.prevPoint)return;const n=ft(o.selectedIds,t.objectsMap);if(1!==n.length)throw new Error("start rotating got incorrect number of objects to handle");const r=n[0];!function(t,e,o){const n=t.container.div,r=e[0]-o[0],l=e[1]-o[1],i=180*Math.atan2(l,r)/Math.PI+90;n.style.transform=`rotate(${i}deg)`}(r,e,X(r.container.bounds)),o.prevPoint=e,pt(r,t)}function Ct(t,e){t.fullState[s].prevPoint=e,function(t){const e=ft(t.fullState[s].selectedIds,t.objectsMap),o={objectId:"",toolId:s,toolType:"top-bar-tool",action:"rotate",data:e.map((t=>({objectId:t.container.id,rotate:et(t.container.div)})))};B(o,t)}(t)}function Mt(t){t.fullState[s].prevPoint=null}function jt(t,e){for(const o of t){const t=It(o);t&&(bt(t,o.container.id,e),o.container.div.appendChild(t))}}function It(t){const e=t.container.div,o=t.container.id;if(function(t){return null!==t.querySelector('[id^="select-frame"')}(e))return null;const n=document.createElement("div");return n.setAttribute("id",`select-frame-${o}`),Y(n,at),n}function Lt(t,e){for(const o of t)Z(o,e)}function kt(t,e){const o=It(t);o&&(bt(o,t.container.id,e),function(t,e,o){const n=e.container.id,r=St(n,!0,!1,!1,!0);xt(r,n,o,lt);const l=St(n,!0,!0);xt(l,n,o,rt);const i=St(n,!1,!0,!0);xt(i,n,o,it);const c=St(n,!1,!1,!0,!0);xt(c,n,o,ct),t.appendChild(r),t.appendChild(l),t.appendChild(i),t.appendChild(c);const a=St(n);a.id=`button-rotate-${n}`,Y(a,st),function(t,e,o){const n=function(t){t.stopPropagation();const e=q([t.clientX,t.clientY],o.viewContainer);Ct(o,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",l)},r=function(t){t.stopPropagation();const e=q([t.clientX,t.clientY],o.viewContainer);Et(o,e)},l=function(t){t.stopPropagation(),Mt(o),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",l)},i=function(t){t.stopPropagation();const e=q(Q(t),o.viewContainer);Ct(o,e),window.addEventListener("touchmove",c),window.addEventListener("touchend",a),window.addEventListener("touchcancel",a)},c=function(t){t.stopPropagation();const e=q(Q(t),o.viewContainer);Et(o,e)},a=function(t){t.stopPropagation(),Mt(o),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)},d=o.fullState[s],u=d.handlers[e]||[];d.handlers[e]=u,u.push({ele:t,eventName:"mousedown",fn:n}),u.push({ele:t,eventName:"touchstart",fn:i}),t.addEventListener("mousedown",n),t.addEventListener("touchstart",i)}(a,n,o);const d=document.createElement("div");Y(d,dt),d.id=`line-div-${n}`,a.appendChild(d),t.appendChild(a)}(o,t,e),t.container.div.appendChild(o))}function St(t,e,o,n,r){const l=document.createElement("button");Y(l,ut);let i="";return e?(l.style.top="-12px",i+="n"):n&&(l.style.bottom="-12px",i+="s"),o?(l.style.right="-12px",i+="e"):r&&(l.style.left="-12px",i+="w"),l.id=`corner-button-${i}-${t}`,l.style.cursor=`${i}-resize`,l}function Tt(t){const e=t.fullState[s];if(!e)throw new Error("no select state present");return[...e.selectedIds]}const Dt=r.default.dialog`
  position: absolute;
  /* top: 10px; */
  white-space: nowrap;
  text-align: center;
  border-radius: 6px;
  padding: 5px 10px;
  ${t=>e.css`
      ${t.position}: 10px
    `}
`;function Ot(){const[t]=m();return n.default.createElement(Dt,{style:{backgroundColor:t.color||"black",color:"white"},position:t.position,open:null!==t.message},t.message)}var zt=t.forwardRef((function(e,o){var{children:r,id:l="main",topBarTools:a,hideTopBar:d,bottomBarTools:u,hideBottomBar:f,shouldKeepHistory:p=!0,shouldSelectAfterCreate:h=!0,styleComponents:m,menuComponents:b=[]}=e,w=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o}(e,["children","id","topBarTools","hideTopBar","bottomBarTools","hideBottomBar","shouldKeepHistory","shouldSelectAfterCreate","styleComponents","menuComponents"]);const v=t.useRef(null),[x,C]=t.useState(a[0]),{layout:M}=function(e,o){const n=t.Children.count(e);if(n>1)throw new Error("ReactDraw expects either 0 or 1 children, detected more.");void 0===o&&(o="default");return{numChildren:n,layout:o}}(r,w.layout),j=t.useRef(new Map),I=t.useRef(null),L=t.useRef(`drawing-area-container-${l}`),k=t.useRef(null),S=t.useRef(null),T=t.useRef(function(t){const e={[s]:{selectedIds:[],handlers:{},prevPoint:null},[c]:{deletedObjects:new Map}};return t.reduce(((t,o)=>(void 0===t[o.id]&&(t[o.id]={}),o.setupCustomState&&(t[o.id]=Object.assign(t[o.id],o.setupCustomState(e))),t)),e)}(a)),D=t.useRef([]),O=t.useRef([]),z=t.useRef(null),A=t.useRef(Object.assign({},Ht)),[N,H]=t.useState(new Map),$=()=>{const t=(()=>{const t=new Map;return u.reduce(((t,e)=>(t.set(e.id,e.getDisplayMode(R())),t)),t)})();if(t.size!==N.size)return H(t);const e=t.keys();for(const o of e)if(t.get(o)!==N.get(o))return H(t)};t.useEffect((()=>{$()}),[]),t.useEffect((()=>{if(x.id===s){const t=z.current;if(t){const e=R();Nt(e),e.fullState[s].selectedIds=[t.container.id],kt(t,e)}}$()}),[x]);const P=t=>{if(x.id!==s)return z.current=t,C(At(a,s));const e=R();Nt(e),kt(t,e),$()},R=t=>{const e=t||Z(),o=T.current;return{viewContainer:e,objectsMap:j.current,lastEvent:S.current,prevMousePosition:k,drawingTools:a,fullState:o,undoStack:D.current,redoStack:O.current,shouldKeepHistory:p,selectDrawingTool:X,selectObject:P,shouldSelectAfterCreate:h}};function W(t){x.onKeyPress&&(x.onKeyPress(t,R()),$())}const Z=()=>{const t=v.current;if(!t)throw new Error("no view container while resizing");return t};function Y(t){const e=R(),o=E(t,Object.assign({},A.current),x.id);I.current=o,e.viewContainer.append(o.container.div),x.onDrawStart(o,e)}function V(t){const e=I.current;if(!e)return;const o=R();e.coords.push(t),x.onDrawing(e,o)}function K(t){const e=I.current;k.current=null,I.current=null,e&&(e.coords.push(t),j.current.set(e.container.id,e),x.onDrawEnd(e,R()),$())}t.useEffect((()=>{const t=v.current;if(t)return t.addEventListener("mousedown",e),t.addEventListener("mouseup",n),t.addEventListener("mousemove",o),t.addEventListener("touchstart",r,{passive:!1}),t.addEventListener("touchmove",l,{passive:!1}),t.addEventListener("touchcancel",i),t.addEventListener("touchend",i),t.addEventListener("mouseleave",n),window.addEventListener("keydown",W),()=>{t.removeEventListener("mousedown",e),t.removeEventListener("mouseup",n),t.removeEventListener("mousemove",o),t.removeEventListener("touchstart",r),t.removeEventListener("touchmove",l),t.removeEventListener("touchcancel",i),t.removeEventListener("touchend",i),t.removeEventListener("mouseleave",n),window.removeEventListener("keydown",W);const c=R(t);for(const t of a)t.onUnMount&&t.onUnMount(c)};function e(e){S.current=e;Y(q([e.clientX,e.clientY],t))}function o(e){S.current=e;V(q([e.clientX,e.clientY],t))}function n(e){S.current=e;K(q([e.clientX,e.clientY],t))}function r(e){S.current=e,e.preventDefault();Y(q(Q(e),t))}function l(e){S.current=e,e.preventDefault();V(q(Q(e),t))}function i(e){S.current=e,e.preventDefault();K(q(Q(e),t))}}),[x]);const X=t=>{if(x.id!==t){const e=At(a,t);if(e){const t=x,o=R();t.onUnPickTool&&t.onUnPickTool(o),e.onPickTool&&e.onPickTool(o),C(e),$()}}},G=(t,e)=>{const o=t.filter(J);if(0===o.length)return;B({data:o,objectId:"",toolId:"",toolType:"batch",action:"batch"},e)};return n.default.createElement(g,null,n.default.createElement(i,{layout:M,ref:o},!d&&n.default.createElement(y,{tools:a,onSelectTool:X,currentTool:x.id}),n.default.createElement("div",{id:L.current,style:{position:"relative",width:"100%",flex:1,overflow:"hidden",boxSizing:"border-box"},ref:v},n.default.createElement(Ot,null),r),!f&&n.default.createElement(U,{displayMap:N,tools:u,dispatch:t=>{t(R()),$()},stylesMenu:{getEditProps:()=>{const t=R(),e=Tt(t);if(0===e.length){return A.current}const o=function(t,e){const o={},n=t.map((t=>F(e.objectsMap,t))),r={};for(const t of n){const n=At(e.drawingTools,t.toolId);if(n.styleHandlers){const e=Object.keys(n.styleHandlers);for(const n of e){const e=t.style[n];e?(o[n]=e,r[n]=(r[n]||0)+1):console.error("could not get style value for key:",n,"from object",t)}}}for(const t in r)r[t]!==n.length&&delete o[t];return o}(e,t);return o},styleComponents:m,onUpdateStyle:(t,e)=>{const o=R(),n=Tt(o);if(0===n.length)return A.current[t]=e,[];const r=n.map((t=>F(o.objectsMap,t))),l=r.map((n=>{const r=At(o.drawingTools,n.toolId).styleHandlers;if(r&&r[t])return r[t](n,e,o)}));return G(l,o),l}}},b.map(((t,e)=>n.default.createElement(t,{key:e,getContext:R})))),n.default.createElement("style",null,`\n\t\t#${L.current} {\n\t\t\tcursor: ${x.cursor||"default"};\n\t\t}\n\t  `)))}));function At(t,e){const o=t.find((t=>t.id===e));if(!o)throw new Error("could not find the used tool");return o}function Nt(t){const e=t.fullState[s].selectedIds;if(e.length>0){Lt(ft(e,t.objectsMap),t)}}const Ht={lineWidth:"4",zIndex:"1",color:"#000000",fontSize:"14",background:"transparent",opacity:"1"};function $t(t){const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("fill","transparent"),e.setAttribute("stroke",t.color),e.style.strokeWidth=`${t.lineWidth}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}function Pt(t,e,o){if(!x())throw new Error("createSVG called on server");const n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("viewbox",`0 0 ${t} ${e}`),n.style.overflow="visible",n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.opacity=o,n.style.width="100%",n.style.height="100%",n}function Rt(t,e){if(!x())throw new Error("createPath called on server");const o=document.createElementNS("http://www.w3.org/2000/svg","circle");return o.setAttribute("fill","black"),o.setAttribute("cx",`${Math.ceil(t/2)}`),o.setAttribute("cy",`${Math.ceil(t/2)}`),o.setAttribute("r",`${t}`),o}function Wt(t,e,o){return{objectId:t.container.id,toolId:t.toolId,toolType:"top-bar-tool",action:e,data:o}}function Ut(t){const e=t.element;if(!e)throw new Error;let o=e.querySelector("path");if(o||(o=e.querySelector("line")),!o)throw new Error;return o}const Zt=/^(#([0-9A-F]{3}){1,2}|transparent)$/i;function Bt(t,e,o,n){if(!n.match(Zt))return;const r=Ut(t),l=t.style[e];return r.style[o]=n,t.style[e]=n,Wt(t,e,l)}function Yt(t,e){return Bt(t,"color","stroke",e)}function Vt(t,e){const{ele:o,action:n}=Kt(t,e,"background");return n?(o.style.backgroundColor=e,n):n}function Kt(t,e,o){const n=t.element;if(!n)throw new Error;if(!e.match(Zt))return{ele:n,action:void 0};const r=t.style[o];t.style[o]=e;return{ele:n,action:Wt(t,o,r)}}function Ft(t,e){const{ele:o,action:n}=Kt(t,e,"color");return n?(o.style.border=qt(t.style),n):n}function qt(t){return`${t.lineWidth}px solid ${t.color}`}function Qt(t,e,o,n){if(!n.match(Zt))return;const r=t.style[e];return t.style[e]=n,t.container.div.style[o]=n,Wt(t,e,r)}function Xt(t,e){if(!e.shouldKeepHistory)return;B({toolId:t.toolId,toolType:"top-bar-tool",objectId:t.container.id,action:"create",data:null},e)}function Gt(t,e){const o=F(e.objectsMap,t.objectId);return K(t.objectId,e),t.data=o,t.action="delete",t}function Jt(t,e){const o=t.data;if(!o)throw new Error("redo delete but no data exists");return e.objectsMap.set(o.container.id,o),e.viewContainer.appendChild(o.container.div),t.data=null,t.action="create",t}function _t(t,e){const o=t.data;if(!o||"object"!=typeof o)throw new Error("malformed data");for(const[t,n]of o.entries())e.viewContainer.appendChild(n.container.div),e.objectsMap.set(t,n);return t.action="create",t.data=Array.from(o.keys()),t}function te(t,e){const o=t.data;if(!o||!Array.isArray(o))throw console.error(t),new Error("malformed data");t.data=new Map;for(const n of o)t.data.set(n,F(e.objectsMap,n)),K(n,e);return t.action="delete",t}function ee(t,e){const o=F(e.objectsMap,t.objectId),n=o.style.opacity,r=t.data,l=o.element;if(!r||!l)throw new Error;return o.style.opacity=r,l.style.opacity=o.style.opacity,t.data=n,t}function oe(t,e){const o=F(e.objectsMap,t.objectId),n=o.style.lineWidth,r=t.data,l=o.element;if(!r||!l)throw new Error;return o.style.lineWidth=r,l.style.border=qt(o.style),t.data=n,t}function ne(t,e){const o=F(e.objectsMap,t.objectId),n=o.style.background,r=t.data,l=o.element;if(!r||!l)throw new Error;return o.style.background=r,l.style.backgroundColor=r,t.data=n,t}function re(t,e){const o=F(e.objectsMap,t.objectId),n=o.style.color,r=t.data,l=o.element;if(!r||!l)throw new Error;return o.style.color=r,l.style.border=qt(o.style),t.data=n,t}function le(t,e){return ce(t,e,"color","stroke")}function ie(t,e){return ce(t,e,"background","fill")}function ce(t,e,o,n){const r=F(e.objectsMap,t.objectId),l=r.style[o],i=t.data,c=r.element;if(!c)throw new Error;let s=c.querySelector("path");if(s||(s=c.querySelector("line")),!s)throw new Error;return r.style[o]=i,s.style[n]=i,t.data=l,t}function se(t,e){const o=F(e.objectsMap,t.objectId),n=o.style.lineWidth,r=t.data,l=Ut(o);return o.style.lineWidth=r,l.style.strokeWidth=r+"px",t.data=n,t}const ae=/^[0-9]+$/g;function de(t,e){const o=t.element;if(!o)throw new Error;if(!e.match(ae))return;const n=t.style.lineWidth;t.style.lineWidth=e,o.style.border=qt(t.style);return Wt(t,"lineWidth",n)}function ue(t,e){const o=e.includes("px")?e:e+"px",n=Ut(t),r="lineWidth",l=t.style[r];return n.style.strokeWidth=o,t.style[r]=e,Wt(t,r,l)}const fe=/^(0(\.\d+)?|1(\.0+)?)$/;function pe(t,e){if(!e.match(fe))return;const o=t.element;if(!o)throw new Error;const n=t.style.opacity;return t.style.opacity=e,o.style.opacity=e,Wt(t,"opacity",n)}const he={id:"free-draw-tool",tooltip:"Free draw tool",icon:n.default.createElement((function(t){const e=O(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M10.5858 0.585786C11.3668 -0.195262 12.6332 -0.195262 13.4142 0.585786C14.1953 1.36683 14.1953 2.63316 13.4142 3.41421L12.6213 4.20711L9.79289 1.37868L10.5858 0.585786Z",fill:e.color}),n.default.createElement("path",{d:"M8.37868 2.79289L0 11.1716V14H2.82842L11.2071 5.62132L8.37868 2.79289Z",fill:e.color}))}),null),onDrawStart:t=>{const e=parseInt(t.style.lineWidth),o=Pt(e,e,t.style.opacity);o.style.overflow="visible";const n=Rt(e/2,t.style.color);o.appendChild(n),t.container.div.appendChild(o),t.element=o},onDrawing:(t,{viewContainer:e})=>{!function(t){const e=t.length;if(e<3)return;const o=t[e-3],n=t[e-1];k(o,n)<10&&t.splice(e-2,1);k(o,n)<20&&(t[e-2]=function(t,e){const[o,n]=t,[r,l]=e;return[Math.min(o,r)+Math.abs(o-r)/2,Math.min(n,l)+Math.abs(n-l)/2]}(o,n))}(t.coords),j(t);const o=T(t),n=Pt(o.width,o.height,t.style.opacity);n.style.overflow="visible";const r=function(t,e){const o=$t(t.style);return o.setAttribute("d",function(t,e){let o="";for(let n=0;n<t.coords.length;n++){o+=ge(M(t.coords[n],t.container,e),n),n!==t.coords.length-1&&(o+=" ")}return o}(t,e)),o}(t,e);n.appendChild(r),t.container.div.innerHTML="",t.container.div.appendChild(n),t.element=n},onDrawEnd:(t,e)=>{Xt(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize:(t,e)=>{t.element&&C(t.element,t.container.bounds)},undoHandlers:{create:Gt,delete:Jt,color:le,lineWidth:se,opacity:ee},redoHandlers:{create:Gt,delete:Jt,color:le,lineWidth:se,opacity:ee},styleHandlers:{color:(t,e,o)=>Yt(t,e),lineWidth:(t,e,o)=>ue(t,e),opacity:(t,e,o)=>pe(t,e)},cursor:"url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjU4NTggMC41ODU3ODZDMTEuMzY2OCAtMC4xOTUyNjIgMTIuNjMzMiAtMC4xOTUyNjIgMTMuNDE0MiAwLjU4NTc4NkMxNC4xOTUzIDEuMzY2ODMgMTQuMTk1MyAyLjYzMzE2IDEzLjQxNDIgMy40MTQyMUwxMi42MjEzIDQuMjA3MTFMOS43OTI4OSAxLjM3ODY4TDEwLjU4NTggMC41ODU3ODZaIiBmaWxsPSIjMTExODI3Ii8+CjxwYXRoIGQ9Ik04LjM3ODY4IDIuNzkyODlMMCAxMS4xNzE2VjE0SDIuODI4NDJMMTEuMjA3MSA1LjYyMTMyTDguMzc4NjggMi43OTI4OVoiIGZpbGw9IiMxMTE4MjciLz4KPC9zdmc+) 0 16, pointer"};function ge(t,e){return 0===e?`M ${t[0]} ${t[1]}`:`L ${t[0]} ${t[1]}`}function me(t,e){const o=t.data,n=[];for(const t of o){const o=F(e.objectsMap,t.objectId),{bounds:r,div:l}=o.container,{left:i,top:c}=t;n.push({objectId:t.objectId,top:r.top,left:r.left}),r.top=c,r.left=i,l.style.left=i+"px",l.style.top=c+"px",pt(o,e)}return t.data=n,t}function be(t,e){const o=t.data,n=[];for(const t of o){const o=F(e.objectsMap,t.objectId),{div:r}=o.container,l=et(r);n.push({objectId:t.objectId,rotate:l}),r.style.transform=`rotate(${t.rotate}deg)`,pt(o,e)}return t.data=n,t}function we(t,e){const o=F(e.objectsMap,t.objectId),n=t.data,r=o.container.bounds,l=Object.assign({},r);var i,c;i=o.container.div,c=n.bounds,i.style.left=c.left+"px",i.style.top=c.top+"px",i.style.width=c.right-c.left+"px",i.style.height=c.bottom-c.top+"px",o.container.bounds=n.bounds;return V(e.drawingTools,o.toolId).onResize(o,Object.assign(Object.assign({},e),{previousPoint:[r.left,r.top],newPoint:[n.bounds.left,n.bounds.top]})),t.data.bounds=l,t}const ye={tooltip:"Select tool",icon:n.default.createElement((function(t){const e=O(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M5.67175 0.911473C5.52881 0.378007 4.98047 0.0614245 4.44701 0.204366C3.91354 0.347308 3.59696 0.895645 3.7399 1.42911L3.99872 2.39504C4.14166 2.9285 4.69 3.24509 5.22346 3.10214C5.75693 2.9592 6.07351 2.41086 5.93057 1.8774L5.67175 0.911473Z",fill:e.color}),n.default.createElement("path",{d:"M1.42911 3.7399C0.895645 3.59696 0.347308 3.91354 0.204366 4.44701C0.0614245 4.98047 0.378007 5.52881 0.911473 5.67175L1.8774 5.93057C2.41086 6.07351 2.9592 5.75693 3.10214 5.22346C3.24509 4.69 2.9285 4.14166 2.39504 3.99872L1.42911 3.7399Z",fill:e.color}),n.default.createElement("path",{d:"M10.2426 3.17149C10.6331 2.78097 10.6331 2.1478 10.2426 1.75728C9.85204 1.36676 9.21887 1.36676 8.82835 1.75728L8.12124 2.46439C7.73072 2.85491 7.73072 3.48808 8.12124 3.8786C8.51177 4.26912 9.14493 4.26912 9.53545 3.8786L10.2426 3.17149Z",fill:e.color}),n.default.createElement("path",{d:"M3.17149 10.2426L3.8786 9.53546C4.26912 9.14493 4.26912 8.51177 3.8786 8.12124C3.48808 7.73072 2.85491 7.73072 2.46439 8.12124L1.75728 8.82835C1.36676 9.21887 1.36676 9.85204 1.75728 10.2426C2.1478 10.6331 2.78097 10.6331 3.17149 10.2426Z",fill:e.color}),n.default.createElement("path",{d:"M6.37142 5.07152C6 4.92295 5.57578 5.01002 5.29292 5.29289C5.01006 5.57575 4.92298 5.99997 5.07155 6.37138L9.07155 16.3714C9.2178 16.737 9.56502 16.9828 9.95847 16.9991C10.3519 17.0155 10.7183 16.7994 10.8945 16.4472L12.274 13.6882L15.2929 16.7071C15.6834 17.0976 16.3166 17.0976 16.7071 16.7071C17.0977 16.3166 17.0977 15.6834 16.7071 15.2929L13.6882 12.2739L16.4472 10.8944C16.7995 10.7183 17.0155 10.3519 16.9992 9.95843C16.9828 9.56498 16.737 9.21777 16.3714 9.07152L6.37142 5.07152Z",fill:e.color}))}),{style:{transform:"translate(-2px, -1px)"}}),id:s,onDrawStart:t=>{t.container.div.style.border=`1px solid ${a.main}`,t.container.div.style.backgroundColor=a.light+"4d"},onDrawing:(t,e)=>{I(t),t.coords.splice(1),function(t,e){var o,n;const r=null!==(n=null===(o=e.lastEvent)||void 0===o?void 0:o.shiftKey)&&void 0!==n&&n,l=[...e.fullState[s].selectedIds];let i=function(t,e,o){const n=[];for(const[r,l]of t.entries())Z(l,o),L(e,l.container.bounds)&&n.push(r);return n}(e.objectsMap,t.container.bounds,e);r&&(i=new Array(...new Set([...i,...l])));Ee(e,i)}(t,e)},onDrawEnd:(t,e)=>{const{objectsMap:o,viewContainer:n}=e;n.removeChild(t.container.div),o.delete(t.container.id),G('[id^="react-draw-cursor"',e.viewContainer),ve(t,e)},onResize:t=>{},onUnMount(t){for(const e of Object.values(t.objectsMap))Z(e,t)},onUnPickTool(t){const e=t.fullState[s],o=e.selectedIds;if(0===o.length)return;Lt(ft(o,t.objectsMap),t),e.selectedIds=[]},onKeyPress(t,e){if(!("Delete"===t.key))return;const o=e.fullState[s].selectedIds;if(o.length<1)return;B(te({toolId:s,toolType:"top-bar-tool",objectId:"",data:[...o],action:"delete"},e),e)},undoHandlers:{delete:_t,create:te,drag:me,rotate:be,resize:we},redoHandlers:{delete:_t,create:te,drag:me,rotate:be,resize:we}},ve=(t,e)=>{var o,n;const r=null!==(n=null===(o=e.lastEvent)||void 0===o?void 0:o.shiftKey)&&void 0!==n&&n,l=t.coords[0],i=t.coords[t.coords.length-1];if(k(i,l)<75){const t=function(t,e){let{top:o,right:n,bottom:r,left:l}=t;const[i,c]=e;return c>r?r=c:c<o&&(o=c),i<l?l=i:i>n&&(n=i),{top:o,right:n,bottom:r,left:l}}(S(l),i);xe(e,t,r)}},xe=(t,e,o)=>{const n=function(t,e){var o;let n=null;for(const[r,l]of t.entries()){const t=parseInt(l.style.zIndex);L(l.container.bounds,e)&&(null!==(o=null==n?void 0:n.style.zIndex)&&void 0!==o?o:0<t)&&(n=l)}return n}(t.objectsMap,e);let{ids:r}=function(t){const e=[...t.fullState[s].selectedIds],{objectsMap:o,prevMousePosition:n}=t,r=ft(e,o);if(Lt(r,t),1===r.length){const e=V(t.drawingTools,r[0].toolId);e&&t&&e.onUnSelect&&e.onUnSelect(r[0],t)}return n.current=null,{ids:e.splice(0,e.length),objects:r}}(t);return o||(r=[]),null!==n&&(r=r.concat([n.container.id])),Ee(t,r),r};function Ee(t,e){t.fullState[s].selectedIds=e;const o=ft(e,t.objectsMap);return 1===o.length?(function(t,e,o){const n=V(t,e.toolId);n&&o&&n.onSelect&&n.onSelect(e,o)}(t.drawingTools,o[0],t),kt(o[0],t)):o.length>1?jt(o,t):void 0}const Ce={id:"react-draw-square-tool",tooltip:"Square Tool",icon:n.default.createElement((function(t){const e=O(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("rect",{width:"16",height:"16",rx:"1",fill:e.color}))}),null),onDrawStart:t=>{const e=function(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=`${t.lineWidth}px solid ${t.color}`,e.style.borderRadius="2px",e.style.boxSizing="border-box",e.style.backgroundColor=t.background,e.style.opacity=t.opacity,e}(t.style);t.container.div.appendChild(e),t.element=e},onDrawing:t=>{I(t),t.coords.splice(1)},onDrawEnd(t,e){Xt(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},undoHandlers:{create:Gt,delete:Jt,color:re,background:ne,lineWidth:oe,opacity:ee},redoHandlers:{create:Gt,delete:Jt,color:re,background:ne,lineWidth:oe,opacity:ee},onResize(t,e){},styleHandlers:{color:Ft,background:Vt,lineWidth:de,opacity:pe}};const Me={id:"react-draw-circle-tool",tooltip:"Circle tool",icon:n.default.createElement((function(t){const e=O(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("circle",{cx:"8",cy:"8",r:"8",fill:e.color}))}),null),onDrawStart:t=>{const e=function(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=qt(t),e.style.backgroundColor=t.background,e.style.borderRadius="50%",e.style.boxSizing="border-box",e.style.opacity=t.opacity,e}(t.style);t.container.div.appendChild(e),t.element=e},onDrawing:t=>{I(t),t.coords.splice(1)},onDrawEnd(t,e){Xt(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){},undoHandlers:{create:Gt,delete:Jt,color:re,background:ne,lineWidth:oe,opacity:ee},redoHandlers:{delete:Jt,create:Gt,color:re,background:ne,lineWidth:oe,opacity:ee},styleHandlers:{color:(t,e,o)=>Ft(t,e),background:(t,e,o)=>Vt(t,e),lineWidth:(t,e,o)=>de(t,e),opacity:(t,e,o)=>pe(t,e)}};const je={id:"react-draw-diamond-tool",tooltip:"Diamond tool",icon:n.default.createElement((function(t){const e=O(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("rect",{x:"11",y:"-0.313721",width:"16",height:"16",rx:"1",transform:"rotate(45 11 -0.313721)",fill:e.color}))}),null),onDrawStart:t=>{const e=t.container.div,o=Ie(t);e.appendChild(o)},onDrawing:t=>{I(t);const e=t.container.div,o=Ie(t);e.innerHTML="",e.appendChild(o),t.element=o,t.coords.splice(1)},onDrawEnd(t,e){Xt(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){C(t.element,t.container.bounds)},undoHandlers:{create:Gt,delete:Jt,color:le,background:ie,lineWidth:se,opacity:ee},redoHandlers:{create:Gt,delete:Jt,color:le,background:ie,lineWidth:se,opacity:ee},styleHandlers:{color:Yt,background:function(t,e){return Bt(t,"background","fill",e)},lineWidth:ue,opacity:pe}};function Ie(t){const e=parseInt(t.style.lineWidth),{bounds:o}=t.container,n=Pt(o.right-o.left+e,o.bottom-o.top+e,t.style.opacity),r=function(t,e){const o=$t(e),n=parseInt(e.lineWidth);return o.setAttribute("d",function(t,e){const o=t.bottom-t.top,n=t.right-t.left,r=`${e/2} ${o/2}`;return`M ${r} L ${n/2} ${e/2} L ${n-e/2} ${o/2} L ${n/2} ${o-e/2} L ${r}`}(t,n)),o}(o,t.style);return n.appendChild(r),n}function Le(t,e){const[o,n]=t,[r,l]=e;return r===o?l>n?"down":"up":l===n?r>o?"right":"left":r<o&&l<n?"nw":r>o&&l<n?"ne":r>o&&l>n?"se":"sw"}function ke(t,e,o){return"right"===o?[[0,0],[t,0]]:"left"===o?[[t,0],[0,0]]:"down"===o?[[0,0],[0,e]]:"up"===o?[[0,e],[0,0]]:"nw"===o?[[t,e],[0,0]]:"ne"===o?[[0,e],[t,0]]:"se"===o?[[0,0],[t,e]]:[[t,0],[0,e]]}const Se={id:"react-draw-line-tool",tooltip:"Straight Line Tool",icon:n.default.createElement((function(t){const e=O(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 24 3",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("line",{y1:"1.5",x2:"24",y2:"1.5",stroke:"black",strokeWidth:"3"}))}),null),onDrawStart:t=>{const e=t.container.div,o=parseInt(t.style.lineWidth),n=Pt(o,o,t.style.opacity),r=Rt(o/2,t.style.color);n.appendChild(r),e.append(n),t.element=n},onDrawing:(t,e)=>{I(t);const o=Le(t.coords[0],t.coords[t.coords.length-1]);t.customData.set("orientation",o);const n=Te(t,o),r=t.container.div;r.innerHTML="",r.appendChild(n),t.element=n,t.coords.splice(1)},onDrawEnd(t,e){Xt(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){const o=t.customData.get("orientation");if(!o)throw new Error("orientation not set");const n=Te(t,o),r=t.container.div;r.removeChild(t.element),r.appendChild(n),t.element=n,t.coords.splice(1)},undoHandlers:{create:Gt,delete:Jt,color:le,lineWidth:se,opacity:ee},redoHandlers:{create:Gt,delete:Jt,color:le,lineWidth:se,opacity:ee},styleHandlers:{color:Yt,lineWidth:ue,opacity:pe}};function Te(t,e){const{bounds:o}=t.container,n=o.right-o.left,r=o.bottom-o.top,l=Pt(n,r,t.style.opacity);l.style.overflow="visible";const[i,c]=ke(n,r,e),s=function(t){const e=document.createElementNS("http://www.w3.org/2000/svg","line");return e.setAttribute("fill","transparent"),e.setAttribute("stroke",t.color),e.style.strokeWidth=`${t.lineWidth}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}(t.style);return s.setAttribute("x1",i[0].toString()),s.setAttribute("y1",i[1].toString()),s.setAttribute("x2",c[0].toString()),s.setAttribute("y2",c[1].toString()),l.appendChild(s),l}const De={icon:n.default.createElement("span",{style:{display:"inline-block",fontWeight:"bold",fontSize:"20px"}},"A"),id:"react-draw-textarea-tool",tooltip:"Textarea Tool",cursor:"text",onDrawStart:(t,e)=>{!function(t,e){const o=12,n=5,{div:r,bounds:l}=t.container;l.bottom=l.top+o+n,r.style.height="",r.style.minHeight=l.bottom-l.top+"px",r.style.minWidth=r.style.width,r.style.width="",r.style.border="1px solid black",r.style.backgroundColor=t.style.background,r.style.padding=n+"px",r.style.borderRadius="2px",r.style.boxSizing="border-box",r.style.color=t.style.color,r.style.fontSize=`${t.style.fontSize}px`;const i=document.createElement("style");i.innerHTML="\n\t.react-draw-cursor {\n\t\toutline: none;\t\t\n\t\theight: 100%;\n\t}",r.appendChild(i);const c=function(){const t=document.createElement("div");return t.setAttribute("contenteditable","true"),t.style.minWidth="1px",t.style.height="100%",t.className="react-draw-cursor",t}();function s(){const t=r.getBoundingClientRect(),{width:e,height:o}=t;l.bottom=l.top+o,l.right=l.left+e}c.style.opacity=t.style.opacity,t.element=c,t.customData.set("handler",s),c.addEventListener("keypress",s),r.appendChild(c),Pe(r,l),c.setAttribute("tabindex","1"),function(t,e){const o=t.element,n=t.customData;function r(o){const r=(new Date).getTime(),l=n.get("lastCapture");if(l){if(r-l>5e3){const n=o.target;B({toolId:t.toolId,action:"input",data:n.innerHTML,toolType:"top-bar-tool",objectId:t.container.id},e)}}else{B({toolId:t.toolId,action:"input",data:"",toolType:"top-bar-tool",objectId:t.container.id},e)}n.set("lastCapture",r)}o.addEventListener("input",r),n.set("capture",r)}(t,e),setTimeout((function(){c.focus()}),0)}(t,e)},onDrawing(t,e){},onDrawEnd(t,e){Xt(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){$e(t,!1),Re(t.element)},onSelect(t,e){$e(t,!1),Re(t.element)},onUnSelect(t){$e(t,!1),Pe(t.container.div,t.container.bounds)},onAfterUpdate(t,e){$e(t,!1),Re(t.element)},undoHandlers:{create:Gt,delete:Jt,input:ze,color:Ae,background:Ne,opacity:ee,fontSize:Oe},redoHandlers:{create:Gt,delete:Jt,input:ze,color:Ae,background:Ne,opacity:ee,fontSize:Oe},onDeleteObject(t,e){$e(t,!0)},styleHandlers:{color:function(t,e){return Qt(t,"color","color",e)},background:function(t,e){return Qt(t,"background","backgroundColor",e)},opacity:pe,fontSize:function(t,e){const o=t.style.fontSize;return t.style.fontSize=e,t.container.div.style.fontSize=e+"px",Pe(t.container.div,t.container.bounds),Wt(t,"fontSize",o)}}};function Oe(t,e){const o=F(e.objectsMap,t.objectId),n=o.style.fontSize,r=t.data;return o.style.fontSize=r,o.container.div.style.fontSize=r+"px",t.data=n,t}function ze(t,e){const o=F(e.objectsMap,t.objectId).element;if(!o)throw new Error("tried to undo text but no ele found");const n=o.innerHTML,r=t.data;return o.innerHTML=r,t.data=n,t}function Ae(t,e){return He(t,e,"color","color")}function Ne(t,e){return He(t,e,"background","backgroundColor")}function He(t,e,o,n){const r=F(e.objectsMap,t.objectId),l=r.style[o],i=t.data;return r.style[o]=i,r.container.div.style[n]=i,t.data=l,t}function $e(t,e){const o=t.element;if(!o)return;const n=t.customData.get("handler");n&&(o.removeEventListener("keypress",n),t.customData.delete("handler"));const r=t.customData.get("capture");e&&r&&(o.removeEventListener("input",r),t.customData.delete("capture"))}function Pe(t,e){const o=t.getBoundingClientRect(),{width:n,height:r}=o;e.bottom=e.top+r,e.right=e.left+n}function Re(t){if(t.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);const o=window.getSelection();if(o)return o.removeAllRanges(),o.addRange(e),!0}return console.error("cannot place caret at end"),!1}const We={icon:n.default.createElement((function(t){const e=O(t),{color:o}=e,r=D(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M10.0616 0.586573L5.31159 5.33657L0.581585 10.1766C0.209084 10.5513 0 11.0582 0 11.5866C0 12.1149 0.209084 12.6218 0.581585 12.9966L4.88159 17.2966C5.06785 17.4813 5.31925 17.5855 5.58159 17.5866H17.5816V15.5866H10.5816L17.8016 8.36657C17.9875 8.18083 18.1351 7.96025 18.2357 7.71745C18.3364 7.47466 18.3882 7.2144 18.3882 6.95157C18.3882 6.68874 18.3364 6.42849 18.2357 6.18569C18.1351 5.9429 17.9875 5.72232 17.8016 5.53657L12.8916 0.586573C12.7058 0.40062 12.4853 0.253102 12.2425 0.152454C11.9997 0.0518053 11.7394 0 11.4766 0C11.2138 0 10.9535 0.0518053 10.7107 0.152454C10.4679 0.253102 10.2473 0.40062 10.0616 0.586573V0.586573ZM5.99159 15.5866L1.99159 11.5866L6.74159 6.74657L7.48159 5.99657L12.4316 10.9466L7.87159 15.5066L7.80159 15.5866H5.99159Z",fill:o}))}),null),tooltip:"Eraser tool",id:c,cursor:"url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOSAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjA2MTYgMC41ODY1NzNMNS4zMTE1OSA1LjMzNjU3TDAuNTgxNTg1IDEwLjE3NjZDMC4yMDkwODQgMTAuNTUxMyAwIDExLjA1ODIgMCAxMS41ODY2QzAgMTIuMTE0OSAwLjIwOTA4NCAxMi42MjE4IDAuNTgxNTg1IDEyLjk5NjZMNC44ODE1OSAxNy4yOTY2QzUuMDY3ODUgMTcuNDgxMyA1LjMxOTI1IDE3LjU4NTUgNS41ODE1OSAxNy41ODY2SDE3LjU4MTZWMTUuNTg2NkgxMC41ODE2TDE3LjgwMTYgOC4zNjY1N0MxNy45ODc1IDguMTgwODMgMTguMTM1MSA3Ljk2MDI1IDE4LjIzNTcgNy43MTc0NUMxOC4zMzY0IDcuNDc0NjYgMTguMzg4MiA3LjIxNDQgMTguMzg4MiA2Ljk1MTU3QzE4LjM4ODIgNi42ODg3NCAxOC4zMzY0IDYuNDI4NDkgMTguMjM1NyA2LjE4NTY5QzE4LjEzNTEgNS45NDI5IDE3Ljk4NzUgNS43MjIzMiAxNy44MDE2IDUuNTM2NTdMMTIuODkxNiAwLjU4NjU3M0MxMi43MDU4IDAuNDAwNjIgMTIuNDg1MyAwLjI1MzEwMiAxMi4yNDI1IDAuMTUyNDU0QzExLjk5OTcgMC4wNTE4MDUzIDExLjczOTQgMCAxMS40NzY2IDBDMTEuMjEzOCAwIDEwLjk1MzUgMC4wNTE4MDUzIDEwLjcxMDcgMC4xNTI0NTRDMTAuNDY3OSAwLjI1MzEwMiAxMC4yNDczIDAuNDAwNjIgMTAuMDYxNiAwLjU4NjU3M1YwLjU4NjU3M1pNNS45OTE1OSAxNS41ODY2TDEuOTkxNTkgMTEuNTg2Nkw2Ljc0MTU5IDYuNzQ2NTdMNy40ODE1OSA1Ljk5NjU3TDEyLjQzMTYgMTAuOTQ2Nkw3Ljg3MTU5IDE1LjUwNjZMNy44MDE1OSAxNS41ODY2SDUuOTkxNTlaIiBmaWxsPSJibGFjayI+PC9wYXRoPgo8L3N2Zz4=) 0 16, pointer",onDrawStart(t,e){},onDrawing(t,e){const o=e.viewContainer;j(t);const n=T(t),r=Pt(n.width,n.height,"1"),l=function(t,e){const o=$t(t.style);return o.style.strokeWidth="10px",o.setAttribute("d",function(t,e){let o="",n=t.coords[0];for(let r=0;r<t.coords.length;r++){const l=M(t.coords[r],t.container,e);o+=Ze(l,n,r),n=l,r!==t.coords.length-1&&(o+=" ")}return o}(t,e)),o.setAttribute("stroke","rgba(232, 16, 84, 0.142)"),o}(t,o);r.appendChild(l),t.container.div.innerHTML="",t.container.div.appendChild(r),t.element=r;const i=S(t.coords[t.coords.length-1]),c=e.objectsMap.keys();for(const t of c){const o=e.objectsMap.get(t);o&&(L(o.container.bounds,i)&&(K(t,e),Ue(e,o)))}},onDrawEnd(t,e){const{objectsMap:o,viewContainer:n}=e;n.removeChild(t.container.div),o.delete(t.container.id),G('[id^="react-draw-erase-tool"',e.viewContainer);if(e.fullState[c].deletedObjects.size>0){const o={toolId:t.toolId,toolType:"top-bar-tool",objectId:"",action:"delete",data:e.fullState[c].deletedObjects};e.fullState[c].deletedObjects=new Map,B(o,e)}},undoHandlers:{delete:_t},redoHandlers:{create:te},onResize(t,e){}};function Ue(t,e){t.fullState[c].deletedObjects.set(e.container.id,e)}function Ze(t,e,o){return 0===o?`M ${t[0]} ${t[1]}`:`l ${t[0]-e[0]} ${t[1]-e[1]}`}const Be={id:"react-draw-undo-tool",tooltip:"Undo",icon:n.default.createElement((function(t){const e=O(t),{color:o}=e,r=D(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M8.4345 1.3088e-05C6.17654 0.00387579 4.12643 0.851527 2.61286 2.2295L1.39599 1.07024C0.88081 0.57945 0 0.927028 0 1.62108V5.97259C0 6.40284 0.36611 6.75162 0.817742 6.75162H5.38548C6.11402 6.75162 6.47887 5.91251 5.96372 5.42172L4.54119 4.06653C5.59281 3.12847 6.95357 2.60886 8.39923 2.59698C11.5475 2.57108 14.2012 4.99825 14.174 8.09701C14.1482 11.0366 11.6466 13.5032 8.45 13.5032C7.0487 13.5032 5.7243 13.0268 4.68055 12.1543C4.51894 12.0193 4.27488 12.0275 4.12285 12.1723L2.77146 13.4597C2.60546 13.6178 2.61367 13.8757 2.78789 14.0256C4.28626 15.3149 6.27188 16.1 8.45 16.1C13.1168 16.1 16.9 12.4959 16.9 8.05007C16.9 3.6093 13.0959 -0.00793953 8.4345 1.3088e-05Z",fill:o}))}),null),getDisplayMode:t=>t.undoStack.length>0?"show":"disabled",handleContext(t){const e=t.undoStack.pop();if(e)return"top-bar-tool"===e.toolType?function(t,e){const o=e.toolId,n=V(t.drawingTools,o),r=n.undoHandlers,l=e.action;if(!r)return void console.error("tool:",n,"does not implement undo functionality");const i=r[l];i||console.error("tool:",n,"does not implement undo action:",l);const c=i(e,t);t.shouldKeepHistory&&t.redoStack.push(c)}(t,e):"batch"===e.toolType?function(t,e){const o=e.data,n=[];for(const e of o){const o=e.toolId,r=V(t.drawingTools,o),l=r.undoHandlers,i=e.action;if(!l)return void console.error("tool:",r,"does not implement undo functionality");const c=l[i];if(!c)return void console.error("tool:",r,"does not implement action:",i);n.push(c(e,t))}e.data=n,t.shouldKeepHistory&&t.redoStack.push(e)}(t,e):void 0}};const Ye={id:"react-draw-redo-tool",tooltip:"Redo",icon:n.default.createElement((function(t){const e=O(t),{color:o}=e,r=D(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M8.28183 1.34403e-05C10.4908 0.0039801 12.4964 0.874446 13.9771 2.28951L15.1676 1.09901C15.6716 0.595046 16.5333 0.951979 16.5333 1.66471V6.13334C16.5333 6.57517 16.1752 6.93334 15.7333 6.93334H11.2647C10.552 6.93334 10.195 6.07164 10.699 5.56764L12.0907 4.17598C11.0619 3.21268 9.73063 2.67908 8.31633 2.66688C5.2364 2.64028 2.64023 5.13278 2.66687 8.31494C2.69213 11.3336 5.13947 13.8667 8.26667 13.8667C9.63757 13.8667 10.9332 13.3774 11.9543 12.4815C12.1124 12.3428 12.3512 12.3512 12.4999 12.4999L13.822 13.822C13.9844 13.9844 13.9763 14.2491 13.8059 14.4031C12.3401 15.7271 10.3975 16.5333 8.26667 16.5333C3.70113 16.5333 3.33336e-05 12.8322 2.23918e-10 8.26674C-3.33331e-05 3.70644 3.72153 -0.00815322 8.28183 1.34403e-05Z",fill:o}))}),null),getDisplayMode:t=>t.redoStack.length>0?"show":"disabled",handleContext(t){const e=t.redoStack.pop();if(e)return"top-bar-tool"===e.toolType?function(t,e){const o=e.toolId,n=V(t.drawingTools,o),r=n.redoHandlers,l=e.action;if(!r)return void console.error("tool:",n,"does not implement undo functionality");const i=r[l];i||console.error("tool:",n,"does not implement undo action:",l);const c=i(e,t);t.shouldKeepHistory&&t.undoStack.push(c)}(t,e):"batch"===e.toolType?function(t,e){const o=e.data,n=[];for(const e of o){const o=e.toolId,r=V(t.drawingTools,o),l=r.redoHandlers,i=e.action;if(!l)return void console.error("tool:",r,"does not implement undo functionality");const c=l[i];if(!c)return void console.error("tool:",r,"does not implement action:",i);n.push(c(e,t))}e.data=n,t.shouldKeepHistory&&t.undoStack.push(e)}(t,e):void 0}};const Ve={id:"react-draw-trash-tool",icon:n.default.createElement((function(t){const e=O(t),{color:o}=e,r=D(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 14 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0C5.62123 0 5.27497 0.214002 5.10557 0.552786L4.38197 2H1C0.447715 2 0 2.44772 0 3C0 3.55228 0.447716 4 1 4L1 14C1 15.1046 1.89543 16 3 16H11C12.1046 16 13 15.1046 13 14V4C13.5523 4 14 3.55228 14 3C14 2.44772 13.5523 2 13 2H9.61804L8.89443 0.552786C8.72504 0.214002 8.37877 0 8 0H6ZM4 6C4 5.44772 4.44772 5 5 5C5.55228 5 6 5.44772 6 6V12C6 12.5523 5.55228 13 5 13C4.44772 13 4 12.5523 4 12V6ZM9 5C8.44771 5 8 5.44772 8 6V12C8 12.5523 8.44771 13 9 13C9.55229 13 10 12.5523 10 12V6C10 5.44772 9.55229 5 9 5Z",fill:o}))}),null),tooltip:"Delete selected objects",getDisplayMode:t=>Tt(t).length>0?"show":"disabled",handleContext(t){const e=Tt(t);e.length<1||_(e,t)}},Ke={id:"react-draw-duplicate-tool",tooltip:"Duplicate objects",icon:n.default.createElement((function(t){const e=O(t),{color:o}=e,r=D(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M4 6C4 4.89543 4.89543 4 6 4H12C13.1046 4 14 4.89543 14 6V12C14 13.1046 13.1046 14 12 14H6C4.89543 14 4 13.1046 4 12V6Z",fill:o}),n.default.createElement("path",{d:"M2 0C0.895431 0 0 0.89543 0 2V8C0 9.10457 0.89543 10 2 10L2 2H10C10 0.895431 9.10457 0 8 0H2Z",fill:o}))}),null),getDisplayMode:t=>Tt(t).length>0?"show":"disabled",handleContext(t){const e=Tt(t);if(e.length<1)return;const o=e.map((e=>F(t.objectsMap,e)));Lt(o,t);const n=o.map((e=>function(t,e){const{div:o,id:n,bounds:r}=t.container,l=o.cloneNode(!0),{newId:i,divId:c}=function(t){const e=v(6),o=t.split("-");return o[o.length-1]=v(6),{divId:o.join("-"),newId:e}}(o.id);l.id=c;const s={coords:t.coords.slice(0),toolId:t.toolId,element:l.lastElementChild,style:Object.assign({},t.style),customData:new Map(t.customData),container:{bounds:{top:r.top+10,left:r.left+10,bottom:r.bottom+10,right:r.right+10},div:l,id:i}};l.style.top=s.container.bounds.top+"px",l.style.left=s.container.bounds.left+"px";const a=V(e.drawingTools,t.toolId);if(a.onDuplicate)return a.onDuplicate(s,e);return s}(e,t))),r=new Map;B(_t({toolId:s,objectId:"",toolType:"top-bar-tool",action:"delete",data:n.reduce(((t,e)=>(t.set(e.container.id,e),t)),r)},t),t),1===e.length?kt(n[0],t):jt(n,t);t.fullState[s].selectedIds=n.map((t=>t.container.id))}};const Fe={id:"react-draw-back-tool",icon:n.default.createElement((function(t){const e=O(t),{color:o}=e,r=D(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M15 17L5 9L15 1V17Z",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),n.default.createElement("path",{d:"M1 16V2",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}),null),tooltip:"Move object back",getDisplayMode:t=>Tt(t).length>0?"show":"disabled",handleContext(t){const e=Tt(t);if(e.length<1)return;const o=e.map((e=>F(t.objectsMap,e)));let n=1/0;for(const e of t.objectsMap.values()){const t=qe(e);t<n&&(n=t)}o.forEach((t=>{t.container.div.style.zIndex=n.toString(),t.style.zIndex=n.toString()}))}};function qe(t){const e=parseInt(t.style.zIndex);return t.container.div.style.zIndex=(e+1).toString(),t.style.zIndex=(e+1).toString(),e}const Qe={id:"react-draw-forward-tool",tooltip:"Move object forward",icon:n.default.createElement((function(t){const e=O(t),{color:o}=e,r=D(e,["color"]);return n.default.createElement("svg",Object.assign({},r,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{d:"M1 1L11 9L1 17V1Z",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),n.default.createElement("path",{d:"M15 2V16",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}),null),getDisplayMode:t=>Tt(t).length>0?"show":"disabled",handleContext(t){const e=Tt(t);if(e.length<1)return;const o=e.map((e=>F(t.objectsMap,e)));let n=-1/0;for(const e of t.objectsMap.values()){const t=Xe(e);t>n&&(n=t)}o.forEach((t=>{t.container.div.style.zIndex=n.toString(),t.style.zIndex=n.toString()}))}};function Xe(t){const e=parseInt(t.style.zIndex);return t.container.div.style.zIndex=(e-1).toString(),t.style.zIndex=(e-1).toString(),e}function Ge({onUpdate:e,styleKey:o,label:r,styleValue:l}){const i=t.useRef(v(5));return n.default.createElement("div",null,n.default.createElement("div",{style:{textAlign:"left",marginBottom:5}},n.default.createElement("label",{style:{fontWeight:"bold"},htmlFor:i.current},r)),n.default.createElement("div",{style:{display:"flex"}},n.default.createElement("span",{style:{display:"inline-block",borderRadius:5,width:30,height:30,backgroundColor:l}}),n.default.createElement("div",{style:{marginLeft:10,display:"flex"}},n.default.createElement("span",{style:{borderRadius:"5px 0px 0px 5px",width:30,padding:5,fontWeight:"bold",fontSize:18,textAlign:"center",color:"grey",backgroundColor:"lightgray"}},"#"),n.default.createElement("input",{id:i.current,value:l.replace("#",""),onChange:t=>{const n=t.target.value;e(o,"transparent"===n?n:"#"+n)},style:{width:80,borderRadius:"0px 5px 5px 0px"}}))))}const Je={icon:n.default.createElement((function(t){const e=O(t);return n.default.createElement("svg",Object.assign({},e,{viewBox:"0 0 16 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.2929 0.292893C10.6834 -0.0976311 11.3166 -0.0976311 11.7071 0.292893L15.7071 4.29289C16.0976 4.68342 16.0976 5.31658 15.7071 5.70711L11.7071 9.70711C11.3166 10.0976 10.6834 10.0976 10.2929 9.70711C9.90237 9.31658 9.90237 8.68342 10.2929 8.29289L12.5858 6H1C0.447716 6 -2.41411e-08 5.55228 0 5C2.41411e-08 4.44772 0.447716 4 1 4H12.5858L10.2929 1.70711C9.90237 1.31658 9.90237 0.683418 10.2929 0.292893Z",fill:e.color}))}),null),id:"react-draw-arrow-tool",tooltip:"Arrow Tool",onDrawStart:t=>{const e=t.container.div,o=parseInt(t.style.lineWidth),n=Pt(o,o,t.style.opacity),r=Rt(o/2,t.style.color);n.appendChild(r),e.append(n),t.element=n},onDrawing:(t,{viewContainer:e})=>{I(t);const o=Le(t.coords[0],t.coords[t.coords.length-1]);t.customData.set("orientation",o);const n=_e(t,o),r=t.container.div;r.innerHTML="",r.appendChild(n),t.element=n,t.coords.splice(1)},onDrawEnd:(t,e)=>{Xt(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){const o=t.customData.get("orientation");if(!o)throw new Error("orientation not set");const n=_e(t,o),r=t.container.div;r.removeChild(t.element),r.appendChild(n),t.element=n,t.coords.splice(1)},undoHandlers:{create:Gt,delete:Jt,color:le,lineWidth:se,opacity:ee},redoHandlers:{create:Gt,delete:Jt,color:le,lineWidth:se,opacity:ee},styleHandlers:{color:(t,e,o)=>Yt(t,e),lineWidth:(t,e,o)=>ue(t,e),opacity:(t,e,o)=>pe(t,e)}};function _e(t,e){const o=parseInt(t.style.lineWidth),{bounds:n}=t.container,r=n.right-n.left,l=n.bottom-n.top,[i,c]=ke(r,l,e),s=Pt(r+o,l+o,t.style.opacity);s.style.overflow="visible";const a=function(t,e,o){const[n,r]=e,[l,i]=o,c=$t(t.style),s=[n-l,r-i],[a,d]=s,u=Math.sqrt(a*a+d*d),f=[a/u,d/u],[p,h]=f,g=p*(Math.sqrt(3)/2)-.5*h,m=1*p/2+h*(Math.sqrt(3)/2),b=p*(Math.sqrt(3)/2)+.5*h,w=.5*-p+h*(Math.sqrt(3)/2),y=20,[v,x,E,C]=[-g*y,-m*y,-b*y,-w*y];return c.setAttribute("d",`M ${n} ${r} L ${l} ${i} L ${l-v} ${i-x} L ${l} ${i} L ${l-E} ${i-C}`),c}(t,i,c);return s.appendChild(a),s}const to=r.default.button`
  width: 180px;
  font-size: 16px;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  border-radius: 5px;
  cursor: pointer;
  border: none;
  padding: 7px 10px;
  background-color: ${a.light};
`;exports.BackgroundStyle=t=>n.default.createElement(Ge,Object.assign({},t,{label:"background"})),exports.ClearAllButton=({getContext:t})=>{const e=n.default.useRef(v(6));return n.default.createElement(to,{id:e.current,onClick:()=>{const e=t();if(0===e.objectsMap.size)return;const o=e.objectsMap.keys();_(Array.from(o),e)}},n.default.createElement("div",{style:{padding:"0px 5px"}},n.default.createElement(A,{size:15})),n.default.createElement("label",{htmlFor:e.current,style:{padding:"0px 10px",pointerEvents:"none"}},"Clear All"))},exports.ColorStyle=t=>n.default.createElement(Ge,Object.assign({},t,{label:"color"})),exports.FontSizeStyle=function({onUpdate:e,styleKey:o,styleValue:r}){const l=t.useRef(v(5));return n.default.createElement("div",null,n.default.createElement("div",{style:{textAlign:"left",marginBottom:5}},n.default.createElement("label",{style:{fontWeight:"bold"},htmlFor:l.current},"font size")),n.default.createElement("div",{style:{width:"100%"}},n.default.createElement("input",{id:l.current,value:r,onChange:t=>{const n=t.target.value;e(o,n)},type:"number",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",step:"1"})))},exports.LineWidthStyle=function({onUpdate:e,styleKey:o,styleValue:r}){const l=t.useRef(v(5));return n.default.createElement("div",null,n.default.createElement("div",{style:{textAlign:"left",marginBottom:5}},n.default.createElement("label",{style:{fontWeight:"bold"},htmlFor:l.current},"line width")),n.default.createElement("div",{style:{width:"100%"}},n.default.createElement("input",{id:l.current,value:r,onChange:t=>{const n=t.target.value;e(o,n)},type:"number",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",step:"1"})))},exports.OpacityStyle=function({onUpdate:e,styleKey:o,styleValue:r}){const l=t.useRef(v(5));return n.default.createElement("div",null,n.default.createElement("div",{style:{textAlign:"left",marginBottom:5}},n.default.createElement("label",{style:{fontWeight:"bold"},htmlFor:l.current},"opacity (",r,")")),n.default.createElement("div",{style:{width:"100%"}},n.default.createElement("input",{id:l.current,value:r,onChange:t=>{const n=t.target.value;e(o,n)},type:"range",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",max:"1",step:"0.1"})))},exports.ReactDraw=zt,exports.arrowTool=Je,exports.bringBackTool=Fe,exports.bringForwardTool=Qe,exports.circleTool=Me,exports.diamondTool=je,exports.duplicateTool=Ke,exports.eraseTool=We,exports.freeDrawTool=he,exports.redoTool=Ye,exports.selectTool=ye,exports.squareTool=Ce,exports.straightLineTool=Se,exports.textAreaTool=De,exports.trashTool=Ve,exports.undoTool=Be;
