import t,{useState as e,useRef as n,useEffect as o,Children as r}from"react";import i,{css as c}from"styled-components";const l={boxShadow:"#000000 0px 1px 3px 0px",borderRadius:4,overflow:"hidden",display:"flex",flexDirection:"column"};function s({children:e,layout:n}){const o=function(t){return"default"===t?{width:500,height:500,maxWidth:"100%"}:"fit"===t?{maxWidth:"100%"}:void 0}(n);return t.createElement("div",{style:Object.assign(Object.assign({},l),o)},e)}const a="react-draw-erase-tool",d="react-draw-cursor",u={light:"#bddefb",main:"#228be6"},p={light:"#ececec"},f=i.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  &:hover {
    background-color: ${p.light};
  }
  ${t=>t.selected&&c`
      background-color: ${u.main} !important;
      > svg path {
        fill: white;
      }
    `}
`;function h({children:e,selected:n,onSelect:o}){return t.createElement(f,{selected:n,onClick:o},e)}const w=i.div`
  display: flex;
  background-color: ${u.light};
  z-index: 1000;
`;function g({tools:e,onSelectTool:n,currentTool:o}){return t.createElement(w,null,e.map((e=>t.createElement(h,{key:e.id,selected:e.id===o,onSelect:()=>n(e.id)},e.icon))))}function m(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*o));return e}function v(){return void 0!==typeof window}function b(t,e,n){if(!v())throw new Error("new bounding div called on the server.");const[o,r]=t,{id:i,div:c,top:l,left:s,right:a,bottom:d}=function(t,e,n,o){const r=m(6),i=document.createElement("div"),c=t-n,l=e-n;return i.id=`${o}-${r}`,i.style.width=2*n+"px",i.style.height=2*n+"px",i.style.position="absolute",i.style.left=c+"px",i.style.top=l+"px",i.style.pointerEvents="none",i.style.zIndex="1",i.style.boxSizing="border-box",{div:i,id:r,top:l,left:c,right:c+n+n,bottom:l+n+n}}(o,r,e,n);return{coords:[t],element:null,toolId:n,container:{id:i,div:c,bounds:{top:l,left:s,right:a,bottom:d}},style:{zIndex:1,lineWidth:e},customData:new Map}}function x(t,e){const{width:n,height:o}=function(t){const e=t.getAttribute("viewbox");if(!e)throw new Error("no viewbox found on ele");const n=e.split(" ");return{width:parseFloat(n[2]),height:parseFloat(n[3])}}(t),r=(e.right-e.left)/n,i=(e.bottom-e.top)/o;t.lastElementChild.style.transform=`scale(${r}, ${i})`}function y(t,e,n){const o=e.div.getBoundingClientRect(),r=n.getBoundingClientRect(),i=o.top-r.top,c=t[1]-i,l=o.left-r.left;return[t[0]-l,c]}function M(t){let e=!1;const[n,o]=t.coords[t.coords.length-1],r=t.container,i=r.bounds,c=t.style.lineWidth;return n-c<=i.left?(i.left=n-c,r.div.style.left=n-c+"px",r.div.style.width=i.right+2*c-n+"px",e=!0):n+c>=i.right&&(i.right=n+c,r.div.style.width=n+2*c-i.left+"px",e=!0),o+c>=i.bottom?(i.bottom=o+c,r.div.style.height=o+2*c-i.top+"px",e=!0):o-c<=i.top&&(i.top=o-c,r.div.style.top=o-c+"px",r.div.style.height=i.bottom+2*c-o+"px",e=!0),e}function E(t){if(t.coords.length<2)throw new Error("data coords must be at least length 2");const[e,n]=t.coords[0],[o,r]=t.coords[t.coords.length-1],i=t.style.lineWidth,c=Math.min(e,o),l=Math.min(n,r),s=Math.max(e,o),a=Math.max(n,r),{bounds:d,div:u}=t.container;return d.left=c,d.right=s,d.top=l,d.bottom=a,u.style.top=l+"px",u.style.left=c+"px",u.style.width=`${s-c+i}px`,u.style.height=`${a-l+i}px`,t.coords}function C(t,e){return t.top<=e.top&&t.bottom>=e.bottom&&t.left<=e.left&&t.right>=e.right}function j(t){const[e,n]=t;return{top:n,right:e,bottom:n,left:e}}function L(t){const e=t.container.bounds;return{width:e.right-e.left,height:e.bottom-e.top}}function I(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}function D(t){const{size:e,width:n,height:o,color:r}=t,i=I(t,["size","width","height","color"]);return Object.assign({width:n||e||20,height:o||e||20,color:r||"#111827"},i)}function T(e){const n=D(e),{color:o}=n,r=I(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 5C3 4.44772 3.44772 4 4 4H16C16.5523 4 17 4.44772 17 5C17 5.55228 16.5523 6 16 6H4C3.44772 6 3 5.55228 3 5Z",fill:o}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 10C3 9.44772 3.44772 9 4 9H16C16.5523 9 17 9.44772 17 10C17 10.5523 16.5523 11 16 11H4C3.44772 11 3 10.5523 3 10Z",fill:o}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 15C3 14.4477 3.44772 14 4 14H16C16.5523 14 17 14.4477 17 15C17 15.5523 16.5523 16 16 16H4C3.44772 16 3 15.5523 3 15Z",fill:o}))}const S=i.div`
  display: flex;
  background-color: ${u.light};
  z-index: 1000;
`,O=i.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  ${t=>"hide"===t.mode?c`
        display: none;
      `:t.disabled?c`
        cursor: not-allowed;
        background-color: white;
        > svg path {
          fill: lightgrey;
          stroke: lightgrey;
        }
      `:c`
      &:hover {
        background-color: ${p.light};
      }
      display: inline-block;
    `}
`,N=i.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  &:hover {
    background-color: ${p.light};
  }
  ${t=>t.open?c`
        background-color: ${u.main} !important;
        > svg path {
          fill: white;
        }
      `:c``}
`;function k({tools:n,displayMap:o,dispatch:r,children:i}){const[c,l]=e(!1);return t.createElement(S,null,t.createElement(N,{onClick:()=>l(!c),open:c},t.createElement(T,{size:30})),n.map((e=>{const n=e.id,i=o.get(n)||"hide";return t.createElement(O,{disabled:"disabled"===i,key:e.id,mode:i,onClick:()=>r(e.handleContext)},e.icon)})))}function A(t,e){const n=t.container.id,{div:o}=t.container,r=e.fullState[d],i=r.handlers[n];if(i)for(const t of i)t.ele.removeEventListener(t.eventName,t.fn);const c=o.querySelector('[id^="select-frame"');r.handlers[n]=[],null!==c&&o.removeChild(c);const l=r.selectedIds.indexOf(n);l>=0&&r.selectedIds.splice(l,1)}function z(t,e){for(const n in e)t.style[n]=e[n];return t}function U(t,e){const n=t.find((t=>t.id===e));if(!n)throw new Error("could not find the used tool");return n}function P(t,e){const{objectsMap:n,viewContainer:o}=e,r=$(e.objectsMap,t);A(r,e);const{div:i,id:c}=r.container;o.removeChild(i),n.delete(c);const l=U(e.drawingTools,r.toolId);l.onDeleteObject&&l.onDeleteObject(r,e)}function $(t,e){const n=t.get(e);if(!n)throw new Error("could not get object from map");return n}function R(t,e){if(!e)throw new Error("Container not set.");const n=e.getBoundingClientRect();return[t[0]-n.left,t[1]-n.top]}function H(t){let e=t.touches[0];return e||(e=t.targetTouches[0]),e||(e=t.changedTouches[0]),[e.clientX,e.clientY]}function Z(t,e){const n=e.querySelectorAll(t);n.length>0&&n.forEach((t=>{e.removeChild(t)}))}function Y(t,e){const[n,o]=e,r=t.container,i=r.bounds,c=r.div;i.left+5>=i.right+n||i.bottom-5<=i.top+o||(i.top+=o,i.right+=n,c.style.top=i.top+"px",c.style.width=i.right-i.left+"px",c.style.height=i.bottom-i.top+"px")}function B(t,e){const[n,o]=e,r=t.container,i=r.bounds,c=r.div;i.left+n>=i.right-5||i.bottom-5<=i.top+o||(i.top+=o,i.left+=n,c.style.top=i.top+"px",c.style.left=i.left+"px",c.style.width=i.right-i.left+"px",c.style.height=i.bottom-i.top+"px")}function W(t,e){const[n,o]=e,r=t.container,i=r.bounds,c=r.div;i.left+5>=i.right+n||i.bottom+o<=i.top+5||(i.right+=n,i.bottom+=o,c.style.width=i.right-i.left+"px",c.style.height=i.bottom-i.top+"px")}function V(t,e){const[n,o]=e,r=t.container,i=r.bounds,c=r.div;i.left+n>=i.right-5||i.bottom+o<=i.top+5||(i.bottom+=o,i.left+=n,c.style.left=i.left+"px",c.style.width=i.right-i.left+"px",c.style.height=i.bottom-i.top+"px")}const Q={top:"-45px",cursor:"grab",left:"calc(50% - 8px)"},K={width:"calc(100% + 16px)",height:"calc(100% + 16px)",position:"absolute",border:`2px dotted ${u.main}`,top:"-6px",left:"-6px",cursor:"all-scroll",pointerEvents:"all",boxSizing:"border-box"},X={width:"0px",height:"35px",borderLeft:"2px dotted black",position:"absolute",left:"5px",pointerEvents:"none"},G={position:"absolute",borderRadius:"50%",width:"16px",height:"16px"};function F(t,e){return t.map((t=>{const n=e.get(t);if(!n)throw new Error("object not found in map");return n}))}function q(t,e){const n=t.toolId,o=e.drawingTools.find((t=>t.id===n));o&&o.onAfterUpdate&&o.onAfterUpdate(t,e)}function J(t,e){if(!e.shouldKeepHistory)return;et({toolId:t.toolId,toolType:"top-bar-tool",objectId:t.container.id,action:"create",data:null},e)}function _(t,e){const n=$(e.objectsMap,t.objectId);return P(t.objectId,e),t.data=n,t.action="delete",t}function tt(t,e){const n=t.data;if(!n)throw new Error("redo delete but no data exists");return e.objectsMap.set(n.container.id,n),e.viewContainer.appendChild(n.container.div),t.data=null,t.action="create",t}function et(t,e){e.shouldKeepHistory&&(e.undoStack.push(t),e.redoStack.splice(0))}function nt(t,e){const n=t.data;if(!n||"object"!=typeof n)throw new Error("malformed data");const o=Object.keys(n);for(const t of o){const o=n[t];e.viewContainer.appendChild(o.container.div),e.objectsMap.set(t,o)}return t.action="create",t.data=o,t}function ot(t,e){const n=t.data;if(!n||!Array.isArray(n))throw new Error("malformed data");t.data={};for(const o of n)t.data[o]=$(e.objectsMap,o),P(o,e);return t.action="delete",t}function rt(t,e){const n=t.fullState[d],o=n.prevPoint;if(!o)return;const r=F(n.selectedIds,t.objectsMap);!function(t,e,n){const[o,r]=n,[i,c]=e,l=o-i,s=r-c;for(const e of t){const{bounds:t,div:n}=e.container,{left:o,top:r,right:i,bottom:c}=t;t.left=o+l,t.top=r+s,t.right=t.left+(i-o),t.bottom=t.top+(c-r),n.style.top=t.top+"px",n.style.left=t.left+"px"}}(r,o,e),n.prevPoint=e,1===r.length&&q(r[0],t)}function it(t,e){t.fullState[d].prevPoint=e,function(t){const e=F(t.fullState[d].selectedIds,t.objectsMap),n={objectId:"",toolId:d,toolType:"top-bar-tool",action:"drag",data:e.map((t=>({objectId:t.container.id,top:t.container.bounds.top,left:t.container.bounds.left})))};et(n,t)}(t)}function ct(t){t.fullState[d].prevPoint=null}function lt(t,e,n){const o=function(t){t.stopPropagation();const e=R([t.clientX,t.clientY],n.viewContainer);it(n,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)},r=function(t){t.stopPropagation();const e=R([t.clientX,t.clientY],n.viewContainer);rt(n,e)},i=function(t){t.stopPropagation(),ct(n),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)},c=function(t){t.stopPropagation();const e=R(H(t),n.viewContainer);it(n,e),window.addEventListener("touchmove",l),window.addEventListener("touchend",s),window.addEventListener("touchcancel",s)},l=function(t){t.stopPropagation();const e=R(H(t),n.viewContainer);rt(n,e)},s=function(t){t.stopPropagation(),ct(n),window.removeEventListener("touchmove",l),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s)},a=n.fullState[d],u=a.handlers[e]||[];a.handlers[e]=u,u.push({ele:t,eventName:"mousedown",fn:o}),u.push({ele:t,eventName:"touchstart",fn:c}),t.addEventListener("mousedown",o),t.addEventListener("touchstart",c)}function st(t,e,n){const o=t.fullState[d],r=o.prevPoint;if(!r)return;const i=F(o.selectedIds,t.objectsMap);if(1!==i.length)throw new Error("start rotating got incorrect number of objects to handle");const c=i[0],l=(a=r,[(s=e)[0]-a[0],s[1]-a[1]]);var s,a;const u=U(t.drawingTools,c.toolId),p={viewContainer:t.viewContainer,newPoint:e,previousPoint:r};u.doResize?u.doResize(c,p):n(c,l),u.onResize(c,p),o.prevPoint=e}function at(t,e){t.fullState[d].prevPoint=e,function(t){const e=F(t.fullState[d].selectedIds,t.objectsMap);if(1!==e.length)throw new Error("resize push to stack expects 1 object selected");const{id:n,bounds:o}=e[0].container;et({objectId:n,toolId:d,toolType:"top-bar-tool",action:"resize",data:{bounds:{top:o.top,left:o.left,right:o.right,bottom:o.bottom}}},t)}(t)}function dt(t){t.fullState[d].prevPoint=null}function ut(t,e,n,o){const r=function(t){t.stopPropagation();const e=R([t.clientX,t.clientY],n.viewContainer);at(n,e),window.addEventListener("mousemove",i),window.addEventListener("mouseup",c)},i=function(t){t.stopPropagation();const e=R([t.clientX,t.clientY],n.viewContainer);st(n,e,o)},c=function(t){t.stopPropagation(),dt(n),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",c)},l=function(t){t.stopPropagation();const e=R(H(t),n.viewContainer);at(n,e),window.addEventListener("touchmove",s),window.addEventListener("touchend",a),window.addEventListener("touchcancel",a)},s=function(t){t.stopPropagation();const e=R(H(t),n.viewContainer);st(n,e,o)},a=function(t){t.stopPropagation(),dt(n),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)},u=n.fullState[d],p=u.handlers[e]||[];u.handlers[e]=p,p.push({ele:t,eventName:"mousedown",fn:r}),p.push({ele:t,eventName:"touchstart",fn:l}),t.addEventListener("mousedown",r),t.addEventListener("touchstart",l)}const pt=/-{0,1}\d+\.*\d*/g;function ft(t){const e=t.style.transform;if(!e)return 0;const n=e.match(pt);return n?parseFloat(n[0]):0}function ht(t,e){const n=t.fullState[d];if(!n.prevPoint)return;const o=F(n.selectedIds,t.objectsMap);if(1!==o.length)throw new Error("start rotating got incorrect number of objects to handle");const r=o[0];!function(t,e,n){const o=t.container.div,r=e[0]-n[0],i=e[1]-n[1],c=180*Math.atan2(i,r)/Math.PI+90;o.style.transform=`rotate(${c}deg)`}(r,e,function(t){const e=t.bottom-t.top,n=t.top+e/2,o=t.right-t.left;return[t.left+o/2,n]}(r.container.bounds)),n.prevPoint=e,q(r,t)}function wt(t,e){t.fullState[d].prevPoint=e,function(t){const e=F(t.fullState[d].selectedIds,t.objectsMap),n={objectId:"",toolId:d,toolType:"top-bar-tool",action:"rotate",data:e.map((t=>({objectId:t.container.id,rotate:ft(t.container.div)})))};et(n,t)}(t)}function gt(t){t.fullState[d].prevPoint=null}function mt(t,e){for(const n of t){const t=vt(n);t&&(lt(t,n.container.id,e),n.container.div.appendChild(t))}}function vt(t){const e=t.container.div,n=t.container.id;if(function(t){return null!==t.querySelector('[id^="select-frame"')}(e))return null;const o=document.createElement("div");return o.setAttribute("id",`select-frame-${n}`),z(o,K),o}function bt(t,e){for(const n of t)A(n,e)}function xt(t,e){const n=vt(t);n&&(lt(n,t.container.id,e),function(t,e,n){const o=e.container.id,r=yt(o,!0,!1,!1,!0);ut(r,o,n,B);const i=yt(o,!0,!0);ut(i,o,n,Y);const c=yt(o,!1,!0,!0);ut(c,o,n,W);const l=yt(o,!1,!1,!0,!0);ut(l,o,n,V),t.appendChild(r),t.appendChild(i),t.appendChild(c),t.appendChild(l);const s=yt(o);s.id=`button-rotate-${o}`,z(s,Q),function(t,e,n){const o=function(t){t.stopPropagation();const e=R([t.clientX,t.clientY],n.viewContainer);wt(n,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)},r=function(t){t.stopPropagation();const e=R([t.clientX,t.clientY],n.viewContainer);ht(n,e)},i=function(t){t.stopPropagation(),gt(n),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)},c=function(t){t.stopPropagation();const e=R(H(t),n.viewContainer);wt(n,e),window.addEventListener("touchmove",l),window.addEventListener("touchend",s),window.addEventListener("touchcancel",s)},l=function(t){t.stopPropagation();const e=R(H(t),n.viewContainer);ht(n,e)},s=function(t){t.stopPropagation(),gt(n),window.removeEventListener("touchmove",l),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s)},a=n.fullState[d],u=a.handlers[e]||[];a.handlers[e]=u,u.push({ele:t,eventName:"mousedown",fn:o}),u.push({ele:t,eventName:"touchstart",fn:c}),t.addEventListener("mousedown",o),t.addEventListener("touchstart",c)}(s,o,n);const a=document.createElement("div");z(a,X),a.id=`line-div-${o}`,s.appendChild(a),t.appendChild(s)}(n,t,e),t.container.div.appendChild(n))}function yt(t,e,n,o,r){const i=document.createElement("button");z(i,G);let c="";return e?(i.style.top="-12px",c+="n"):o&&(i.style.bottom="-12px",c+="s"),n?(i.style.right="-12px",c+="e"):r&&(i.style.left="-12px",c+="w"),i.id=`corner-button-${c}-${t}`,i.style.cursor=`${c}-resize`,i}function Mt(t){const e=t.fullState[d];if(!e)throw new Error("no select state present");return[...e.selectedIds]}function Et(i){var{children:c,id:l="main",topBarTools:u,hideTopBar:p,bottomBarTools:f,hideBottomBar:h,shouldKeepHistory:w=!0,shouldSelectAfterCreate:m=!0}=i,v=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}(i,["children","id","topBarTools","hideTopBar","bottomBarTools","hideBottomBar","shouldKeepHistory","shouldSelectAfterCreate"]);const x=n(null),[y,M]=e(u[0]),{layout:E}=function(t,e){const n=r.count(t);if(n>1)throw new Error("ReactDraw expects either 0 or 1 children, detected more.");void 0===e&&(e="default");return{numChildren:n,layout:e}}(c,v.layout),C=n(new Map),j=n(null),[L,I]=e(4),D=n(`drawing-area-container-${l}`),T=n(null),S=n(null),O=n(function(t){const e={[d]:{selectedIds:[],handlers:{},prevPoint:null},[a]:{deletedObjects:new Map}};return t.reduce(((t,n)=>(void 0===t[n.id]&&(t[n.id]={}),n.setupCustomState&&(t[n.id]=Object.assign(t[n.id],n.setupCustomState(e))),t)),e)}(u)),N=n([]),A=n([]),z=n(null),[U,P]=e(new Map),$=()=>{const t=(()=>{const t=new Map;return f.reduce(((t,e)=>(t.set(e.id,e.getDisplayMode(Y())),t)),t)})();if(t.size!==U.size)return P(t);const e=t.keys();for(const n of e)if(t.get(n)!==U.get(n))return P(t)};o((()=>{$()}),[]),o((()=>{if(y.id===d){const t=z.current;if(t){const e=Y();jt(e),e.fullState[d].selectedIds=[t.container.id],xt(t,e)}}$()}),[y]);const Z=t=>{if(y.id!==d)return z.current=t,M(Ct(u,d));const e=Y();jt(e),xt(t,e),$()},Y=t=>{const e=t||W(),n=O.current;return{viewContainer:e,objectsMap:C.current,lastEvent:S.current,prevMousePosition:T,drawingTools:u,fullState:n,undoStack:N.current,redoStack:A.current,shouldKeepHistory:w,selectDrawingTool:X,selectObject:Z,shouldSelectAfterCreate:m}};function B(t){y.onKeyPress&&(y.onKeyPress(t,Y()),$())}const W=()=>{const t=x.current;if(!t)throw new Error("no view container while resizing");return t};function V(t){const e=Y(),n=b(t,L,y.id);j.current=n,e.viewContainer.append(n.container.div),y.onDrawStart(n,e)}function Q(t){const e=j.current;if(!e)return;const n=Y();e.coords.push(t),y.onDrawing(e,n)}function K(t){const e=j.current;T.current=null,j.current=null,e&&(e.coords.push(t),C.current.set(e.container.id,e),y.onDrawEnd(e,Y()),$())}o((()=>{const t=x.current;if(t)return t.addEventListener("mousedown",e),t.addEventListener("mouseup",o),t.addEventListener("mousemove",n),t.addEventListener("touchstart",r,{passive:!1}),t.addEventListener("touchmove",i,{passive:!1}),t.addEventListener("touchcancel",c),t.addEventListener("touchend",c),t.addEventListener("mouseleave",o),window.addEventListener("keydown",B),()=>{t.removeEventListener("mousedown",e),t.removeEventListener("mouseup",o),t.removeEventListener("mousemove",n),t.removeEventListener("touchstart",r),t.removeEventListener("touchmove",i),t.removeEventListener("touchcancel",c),t.removeEventListener("touchend",c),t.removeEventListener("mouseleave",o),window.removeEventListener("keydown",B);const l=Y(t);for(const t of u)t.onUnMount&&t.onUnMount(l)};function e(e){S.current=e;V(R([e.clientX,e.clientY],t))}function n(e){S.current=e;Q(R([e.clientX,e.clientY],t))}function o(e){S.current=e;K(R([e.clientX,e.clientY],t))}function r(e){S.current=e,e.preventDefault();V(R(H(e),t))}function i(e){S.current=e,e.preventDefault();Q(R(H(e),t))}function c(e){S.current=e,e.preventDefault();K(R(H(e),t))}}),[y]);const X=t=>{if(y.id!==t){const e=Ct(u,t);if(e){const t=y,n=Y();t.onUnPickTool&&t.onUnPickTool(n),e.onPickTool&&e.onPickTool(n),M(e),$()}}};return t.createElement(s,{layout:E},!p&&t.createElement(g,{tools:u,onSelectTool:X,currentTool:y.id}),t.createElement("div",{id:D.current,style:{position:"relative",width:"100%",flex:1,boxSizing:"border-box"},ref:x},c),!h&&t.createElement(k,{displayMap:U,tools:f,dispatch:t=>{t(Y()),$()}},t.createElement("div",null,"hello world")),t.createElement("style",null,`\n\t\t#${D.current} {\n\t\t\tcursor: ${y.cursor||"default"};\n\t\t}\n\t  `))}function Ct(t,e){const n=t.find((t=>t.id===e));if(!n)throw new Error("could not find the used tool");return n}function jt(t){const e=t.fullState[d].selectedIds;if(e.length>0){bt(F(e,t.objectsMap),t)}}function Lt(t){const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("fill","transparent"),e.setAttribute("stroke","black"),e.style.strokeWidth=`${t}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}function It(t,e){if(!v())throw new Error("createSVG called on server");const n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("viewbox",`0 0 ${t} ${e}`),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n}function Dt(t){if(!v())throw new Error("createPath called on server");const e=document.createElementNS("http://www.w3.org/2000/svg","circle");return e.setAttribute("fill","black"),e.setAttribute("cx",`${Math.ceil(t/2)}`),e.setAttribute("cy",`${Math.ceil(t/2)}`),e.setAttribute("r",`${t}`),e}const Tt={id:"free-draw-tool",icon:t.createElement((function(e){const n=D(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M10.5858 0.585786C11.3668 -0.195262 12.6332 -0.195262 13.4142 0.585786C14.1953 1.36683 14.1953 2.63316 13.4142 3.41421L12.6213 4.20711L9.79289 1.37868L10.5858 0.585786Z",fill:n.color}),t.createElement("path",{d:"M8.37868 2.79289L0 11.1716V14H2.82842L11.2071 5.62132L8.37868 2.79289Z",fill:n.color}))}),null),onDrawStart:t=>{const e=t.style.lineWidth,n=It(e,e);n.style.overflow="visible";const o=Dt(e/2);n.appendChild(o),t.container.div.appendChild(n),t.element=n},onDrawing:(t,{viewContainer:e})=>{M(t);const n=L(t),o=It(n.width,n.height);o.style.overflow="visible";const r=function(t,e){const n=Lt(t.style.lineWidth);return n.setAttribute("d",function(t,e){let n="",o=t.coords[0];for(let r=0;r<t.coords.length;r++){const i=y(t.coords[r],t.container,e);n+=St(i,o,r),o=i,r!==t.coords.length-1&&(n+=" ")}return n}(t,e)),n}(t,e);o.appendChild(r),t.container.div.innerHTML="",t.container.div.appendChild(o),t.element=o},onDrawEnd:(t,e)=>{J(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize:(t,e)=>{t.element&&x(t.element,t.container.bounds)},onUndo(t,e){if("create"===t.action)return _(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return tt(t,e);throw console.error("unsupported action:",t),new Error},cursor:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjU4NTggMC41ODU3ODZDMTEuMzY2OCAtMC4xOTUyNjIgMTIuNjMzMiAtMC4xOTUyNjIgMTMuNDE0MiAwLjU4NTc4NkMxNC4xOTUzIDEuMzY2ODMgMTQuMTk1MyAyLjYzMzE2IDEzLjQxNDIgMy40MTQyMUwxMi42MjEzIDQuMjA3MTFMOS43OTI4OSAxLjM3ODY4TDEwLjU4NTggMC41ODU3ODZaIiBmaWxsPSIjMTExODI3Ii8+CjxwYXRoIGQ9Ik04LjM3ODY4IDIuNzkyODlMMCAxMS4xNzE2VjE0SDIuODI4NDJMMTEuMjA3MSA1LjYyMTMyTDguMzc4NjggMi43OTI4OVoiIGZpbGw9IiMxMTE4MjciLz4KPC9zdmc+') 0 16, pointer"};function St(t,e,n){return 0===n?`M ${t[0]} ${t[1]}`:`l ${t[0]-e[0]} ${t[1]-e[1]}`}function Ot(t,e){const n=t.data,o=[];for(const t of n){const n=$(e.objectsMap,t.objectId),{bounds:r,div:i}=n.container,{left:c,top:l}=t;o.push({objectId:t.objectId,top:r.top,left:r.left}),r.top=l,r.left=c,i.style.left=c+"px",i.style.top=l+"px",q(n,e)}return t.data=o,t}function Nt(t,e){const n=t.data,o=[];for(const t of n){const n=$(e.objectsMap,t.objectId),{div:r}=n.container,i=ft(r);o.push({objectId:t.objectId,rotate:i}),r.style.transform=`rotate(${t.rotate}deg)`,q(n,e)}return t.data=o,t}function kt(t,e){const n=$(e.objectsMap,t.objectId),o=t.data,r=n.container.bounds,i=Object.assign({},r);var c,l;c=n.container.div,l=o.bounds,c.style.left=l.left+"px",c.style.top=l.top+"px",c.style.width=l.right-l.left+"px",c.style.height=l.bottom-l.top+"px",n.container.bounds=o.bounds;return U(e.drawingTools,n.toolId).onResize(n,Object.assign(Object.assign({},e),{previousPoint:[r.left,r.top],newPoint:[o.bounds.left,o.bounds.top]})),t.data.bounds=i,t}const At={icon:t.createElement((function(e){const n=D(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M5.67175 0.911473C5.52881 0.378007 4.98047 0.0614245 4.44701 0.204366C3.91354 0.347308 3.59696 0.895645 3.7399 1.42911L3.99872 2.39504C4.14166 2.9285 4.69 3.24509 5.22346 3.10214C5.75693 2.9592 6.07351 2.41086 5.93057 1.8774L5.67175 0.911473Z",fill:n.color}),t.createElement("path",{d:"M1.42911 3.7399C0.895645 3.59696 0.347308 3.91354 0.204366 4.44701C0.0614245 4.98047 0.378007 5.52881 0.911473 5.67175L1.8774 5.93057C2.41086 6.07351 2.9592 5.75693 3.10214 5.22346C3.24509 4.69 2.9285 4.14166 2.39504 3.99872L1.42911 3.7399Z",fill:n.color}),t.createElement("path",{d:"M10.2426 3.17149C10.6331 2.78097 10.6331 2.1478 10.2426 1.75728C9.85204 1.36676 9.21887 1.36676 8.82835 1.75728L8.12124 2.46439C7.73072 2.85491 7.73072 3.48808 8.12124 3.8786C8.51177 4.26912 9.14493 4.26912 9.53545 3.8786L10.2426 3.17149Z",fill:n.color}),t.createElement("path",{d:"M3.17149 10.2426L3.8786 9.53546C4.26912 9.14493 4.26912 8.51177 3.8786 8.12124C3.48808 7.73072 2.85491 7.73072 2.46439 8.12124L1.75728 8.82835C1.36676 9.21887 1.36676 9.85204 1.75728 10.2426C2.1478 10.6331 2.78097 10.6331 3.17149 10.2426Z",fill:n.color}),t.createElement("path",{d:"M6.37142 5.07152C6 4.92295 5.57578 5.01002 5.29292 5.29289C5.01006 5.57575 4.92298 5.99997 5.07155 6.37138L9.07155 16.3714C9.2178 16.737 9.56502 16.9828 9.95847 16.9991C10.3519 17.0155 10.7183 16.7994 10.8945 16.4472L12.274 13.6882L15.2929 16.7071C15.6834 17.0976 16.3166 17.0976 16.7071 16.7071C17.0977 16.3166 17.0977 15.6834 16.7071 15.2929L13.6882 12.2739L16.4472 10.8944C16.7995 10.7183 17.0155 10.3519 16.9992 9.95843C16.9828 9.56498 16.737 9.21777 16.3714 9.07152L6.37142 5.07152Z",fill:n.color}))}),{style:{transform:"translate(-2px, -1px)"}}),id:d,onDrawStart:t=>{t.container.div.style.border=`1px solid ${u.main}`,t.container.div.style.backgroundColor=u.light+"4d"},onDrawing:(t,e)=>{E(t),t.coords.splice(1),function(t,e){var n,o;const r=null!==(o=null===(n=e.lastEvent)||void 0===n?void 0:n.shiftKey)&&void 0!==o&&o,i=[...e.fullState[d].selectedIds];let c=function(t,e,n){const o=[];for(const[r,i]of t.entries())A(i,n),C(e,i.container.bounds)&&o.push(r);return o}(e.objectsMap,t.container.bounds,e);r&&(c=new Array(...new Set([...c,...i])));Pt(e,c)}(t,e)},onDrawEnd:(t,e)=>{const{objectsMap:n,viewContainer:o}=e;o.removeChild(t.container.div),n.delete(t.container.id),Z('[id^="react-draw-cursor"',e.viewContainer),zt(t,e)},onResize:t=>{},onUnMount(t){for(const e of Object.values(t.objectsMap))A(e,t)},onUnPickTool(t){const e=t.fullState[d],n=e.selectedIds;if(0===n.length)return;bt(F(n,t.objectsMap),t),e.selectedIds=[]},onKeyPress(t,e){if(!("Delete"===t.key))return;const n=e.fullState[d].selectedIds;if(n.length<1)return;et(ot({toolId:d,toolType:"top-bar-tool",objectId:"",data:[...n],action:"delete"},e),e)},onUndo(t,e){const n=t.action;if("delete"===n)return nt(t,e);if("create"===n)return ot(t,e);if("drag"===n)return Ot(t,e);if("rotate"===n)return Nt(t,e);if("resize"===n)return kt(t,e);throw console.log("unsupported action",t),new Error},onRedo(t,e){const n=t.action;if("delete"===n)return nt(t,e);if("create"===n)return ot(t,e);if("drag"===n)return Ot(t,e);if("rotate"===n)return Nt(t,e);if("resize"===n)return kt(t,e);throw console.log("unsupported action",t),new Error}},zt=(t,e)=>{var n,o;const r=null!==(o=null===(n=e.lastEvent)||void 0===n?void 0:n.shiftKey)&&void 0!==o&&o,i=t.coords[0],c=t.coords[t.coords.length-1];if(l=c,s=i,Math.sqrt(Math.pow(Math.abs(l[0]-s[0]),2)+Math.pow(Math.abs(l[1]-s[1]),2))<75){const t=function(t,e){let{top:n,right:o,bottom:r,left:i}=t;const[c,l]=e;return l>r?r=l:l<n&&(n=l),c<i?i=c:c>o&&(o=c),{top:n,right:o,bottom:r,left:i}}(j(i),c);Ut(e,t,r)}var l,s},Ut=(t,e,n)=>{const o=function(t,e){var n;let o=null;for(const[r,i]of t.entries())C(i.container.bounds,e)&&(null!==(n=null==o?void 0:o.style.zIndex)&&void 0!==n?n:0<i.style.zIndex)&&(o=i);return o}(t.objectsMap,e);let{ids:r}=function(t){const e=[...t.fullState[d].selectedIds],{objectsMap:n,prevMousePosition:o}=t,r=F(e,n);if(bt(r,t),1===r.length){const e=U(t.drawingTools,r[0].toolId);e&&t&&e.onUnSelect&&e.onUnSelect(r[0],t)}return o.current=null,{ids:e.splice(0,e.length),objects:r}}(t);return n||(r=[]),null!==o&&(r=r.concat([o.container.id])),Pt(t,r),r};function Pt(t,e){t.fullState[d].selectedIds=e;const n=F(e,t.objectsMap);return 1===n.length?(function(t,e,n){const o=U(t,e.toolId);o&&n&&o.onSelect&&o.onSelect(e,n)}(t.drawingTools,n[0],t),xt(n[0],t)):n.length>1?mt(n,t):void 0}const $t={id:"react-draw-square-tool",icon:t.createElement((function(e){const n=D(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("rect",{width:"16",height:"16",rx:"1",fill:n.color}))}),null),onDrawStart:t=>{const e=function(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=`${t}px solid black`,e.style.borderRadius="2px",e.style.boxSizing="border-box",e}(t.style.lineWidth);t.container.div.appendChild(e),t.element=e},onDrawing:t=>{E(t),t.coords.splice(1)},onDrawEnd(t,e){J(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onUndo(t,e){if("create"===t.action)return _(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return tt(t,e);throw console.error("unsupported action:",t),new Error},onResize(t,e){}};const Rt={id:"react-draw-circle-tool",icon:t.createElement((function(e){const n=D(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("circle",{cx:"8",cy:"8",r:"8",fill:n.color}))}),null),onDrawStart:t=>{const e=function(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=`${t}px solid black`,e.style.borderRadius="50%",e.style.boxSizing="border-box",e}(t.style.lineWidth);t.container.div.appendChild(e),t.element=e},onDrawing:t=>{E(t),t.coords.splice(1)},onDrawEnd(t,e){J(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){},onUndo(t,e){if("create"===t.action)return _(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return tt(t,e);throw console.error("unsupported action:",t),new Error}};const Ht={id:"react-draw-diamond-tool",icon:t.createElement((function(e){const n=D(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("rect",{x:"11",y:"-0.313721",width:"16",height:"16",rx:"1",transform:"rotate(45 11 -0.313721)",fill:n.color}))}),null),onDrawStart:t=>{const e=t.container.div,n=Zt(t);e.appendChild(n)},onDrawing:t=>{E(t);const e=t.container.div,n=Zt(t);e.innerHTML="",e.appendChild(n),t.element=n,t.coords.splice(1)},onDrawEnd(t,e){J(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){x(t.element,t.container.bounds)},onUndo(t,e){if("create"===t.action)return _(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return tt(t,e);throw console.error("Unsupported action: ",t),new Error}};function Zt(t){const e=t.style.lineWidth,{bounds:n}=t.container,o=It(n.right-n.left+e,n.bottom-n.top+e),r=function(t,e){const n=Lt(e);return n.setAttribute("d",function(t,e){const n=t.bottom-t.top,o=t.right-t.left,r=`${e/2} ${n/2}`;return`M ${r} L ${o/2} ${e/2} L ${o-e/2} ${n/2} L ${o/2} ${n-e/2} L ${r}`}(t,e)),n}(n,t.style.lineWidth);return o.appendChild(r),o}const Yt={id:"react-draw-line-tool",icon:t.createElement((function(e){const n=D(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 24 3",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("line",{y1:"1.5",x2:"24",y2:"1.5",stroke:"black",strokeWidth:"3"}))}),null),onDrawStart:t=>{const e=t.container.div,n=t.style.lineWidth,o=It(n,n),r=Dt(n/2);o.appendChild(r),e.append(o),t.element=o},onDrawing:(t,e)=>{E(t);const n=function(t,e){const[n,o]=t,[r,i]=e;if(r===n)return i>o?"down":"up";if(i===o)return r>n?"right":"left";if(r<n&&i<o)return"nw";if(r>n&&i<o)return"ne";if(r>n&&i>o)return"se";return"sw"}(t.coords[0],t.coords[t.coords.length-1]);t.customData.set("orientation",n);const o=Bt(t,n),r=t.container.div;r.innerHTML="",r.appendChild(o),t.element=o,t.coords.splice(1)},onDrawEnd(t,e){J(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){const n=t.customData.get("orientation");if(!n)throw new Error("orientation not set");const o=Bt(t,n),r=t.container.div;r.removeChild(t.element),r.appendChild(o),t.element=o,t.coords.splice(1)},onUndo(t,e){if("create"===t.action)return _(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return tt(t,e);throw console.error("unsupported action:",t),new Error}};function Bt(t,e){const{bounds:n}=t.container,o=n.right-n.left,r=n.bottom-n.top,i=It(o,r);i.style.overflow="visible";const[c,l]=function(t,e,n){if("right"===n)return[[0,0],[t,0]];if("left"===n)return[[t,0],[0,0]];if("down"===n)return[[0,0],[0,e]];if("up"===n)return[[0,e],[0,0]];if("nw"===n)return[[t,e],[0,0]];if("ne"===n)return[[0,e],[t,0]];if("se"===n)return[[0,0],[t,e]];return[[t,0],[0,e]]}(o,r,e),s=function(t){const e=document.createElementNS("http://www.w3.org/2000/svg","line");return e.setAttribute("fill","transparent"),e.setAttribute("stroke","black"),e.style.strokeWidth=`${t}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}(t.style.lineWidth);return s.setAttribute("x1",c[0].toString()),s.setAttribute("y1",c[1].toString()),s.setAttribute("x2",l[0].toString()),s.setAttribute("y2",l[1].toString()),i.appendChild(s),i}const Wt={icon:t.createElement("span",{style:{display:"inline-block",fontWeight:"bold",fontSize:"20px"}},"A"),id:"react-draw-textarea-tool",cursor:"text",onDrawStart:(t,e)=>{!function(t,e){const n=12,o=5,{div:r,bounds:i}=t.container;i.bottom=i.top+n+o,r.style.height="",r.style.minHeight=i.bottom-i.top+"px",r.style.minWidth=r.style.width,r.style.width="",r.style.border="1px solid black",r.style.padding=o+"px",r.style.borderRadius="2px",r.style.boxSizing="border-box";const c=document.createElement("style");c.innerHTML="\n\t.react-draw-cursor {\n\t\toutline: none;\t\t\n\t\theight: 100%;\n\t}",r.appendChild(c);const l=function(){const t=document.createElement("div");return t.style.fontSize="14px",t.setAttribute("contenteditable","true"),t.style.minWidth="1px",t.style.height="100%",t.className="react-draw-cursor",t}();function s(){const t=r.getBoundingClientRect(),{width:e,height:n}=t;i.bottom=i.top+n,i.right=i.left+e}t.element=l,t.customData.set("handler",s),l.addEventListener("keypress",s),r.appendChild(l),Kt(r,i),l.setAttribute("tabindex","1"),function(t,e){const n=t.element,o=t.customData;function r(n){const r=(new Date).getTime(),i=o.get("lastCapture");if(i){if(r-i>5e3){const o=n.target;et({toolId:t.toolId,action:"input",data:o.innerHTML,toolType:"top-bar-tool",objectId:t.container.id},e)}}else{et({toolId:t.toolId,action:"input",data:"",toolType:"top-bar-tool",objectId:t.container.id},e)}o.set("lastCapture",r)}n.addEventListener("input",r),o.set("capture",r)}(t,e),setTimeout((function(){l.focus()}),0)}(t,e)},onDrawing(t,e){},onDrawEnd(t,e){J(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){Qt(t,!1),Xt(t.element)},onSelect(t,e){Qt(t,!1),Xt(t.element)},onUnSelect(t){Qt(t,!1),Kt(t.container.div,t.container.bounds)},onAfterUpdate(t,e){Qt(t,!1),Xt(t.element)},onUndo(t,e){if("create"===t.action)return _(t,e);if("input"===t.action)return Vt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return tt(t,e);if("input"===t.action)return Vt(t,e);throw console.error("unsupported action:",t),new Error},onDeleteObject(t,e){Qt(t,!0)}};function Vt(t,e){const n=$(e.objectsMap,t.objectId).element;if(!n)throw new Error("tried to undo text but no ele found");const o=n.innerHTML,r=t.data;return n.innerHTML=r,t.data=o,t}function Qt(t,e){const n=t.element;if(!n)return;const o=t.customData.get("handler");o&&(n.removeEventListener("keypress",o),t.customData.delete("handler"));const r=t.customData.get("capture");e&&r&&(n.removeEventListener("input",r),t.customData.delete("capture"))}function Kt(t,e){const n=t.getBoundingClientRect(),{width:o,height:r}=n;e.bottom=e.top+r,e.right=e.left+o}function Xt(t){if(t.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);const n=window.getSelection();if(n)return n.removeAllRanges(),n.addRange(e),!0}return console.error("cannot place caret at end"),!1}const Gt={icon:t.createElement((function(e){const n=D(e),{color:o}=n,r=I(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M10.0616 0.586573L5.31159 5.33657L0.581585 10.1766C0.209084 10.5513 0 11.0582 0 11.5866C0 12.1149 0.209084 12.6218 0.581585 12.9966L4.88159 17.2966C5.06785 17.4813 5.31925 17.5855 5.58159 17.5866H17.5816V15.5866H10.5816L17.8016 8.36657C17.9875 8.18083 18.1351 7.96025 18.2357 7.71745C18.3364 7.47466 18.3882 7.2144 18.3882 6.95157C18.3882 6.68874 18.3364 6.42849 18.2357 6.18569C18.1351 5.9429 17.9875 5.72232 17.8016 5.53657L12.8916 0.586573C12.7058 0.40062 12.4853 0.253102 12.2425 0.152454C11.9997 0.0518053 11.7394 0 11.4766 0C11.2138 0 10.9535 0.0518053 10.7107 0.152454C10.4679 0.253102 10.2473 0.40062 10.0616 0.586573V0.586573ZM5.99159 15.5866L1.99159 11.5866L6.74159 6.74657L7.48159 5.99657L12.4316 10.9466L7.87159 15.5066L7.80159 15.5866H5.99159Z",fill:o}))}),null),id:a,cursor:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOSAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjA2MTYgMC41ODY1NzNMNS4zMTE1OSA1LjMzNjU3TDAuNTgxNTg1IDEwLjE3NjZDMC4yMDkwODQgMTAuNTUxMyAwIDExLjA1ODIgMCAxMS41ODY2QzAgMTIuMTE0OSAwLjIwOTA4NCAxMi42MjE4IDAuNTgxNTg1IDEyLjk5NjZMNC44ODE1OSAxNy4yOTY2QzUuMDY3ODUgMTcuNDgxMyA1LjMxOTI1IDE3LjU4NTUgNS41ODE1OSAxNy41ODY2SDE3LjU4MTZWMTUuNTg2NkgxMC41ODE2TDE3LjgwMTYgOC4zNjY1N0MxNy45ODc1IDguMTgwODMgMTguMTM1MSA3Ljk2MDI1IDE4LjIzNTcgNy43MTc0NUMxOC4zMzY0IDcuNDc0NjYgMTguMzg4MiA3LjIxNDQgMTguMzg4MiA2Ljk1MTU3QzE4LjM4ODIgNi42ODg3NCAxOC4zMzY0IDYuNDI4NDkgMTguMjM1NyA2LjE4NTY5QzE4LjEzNTEgNS45NDI5IDE3Ljk4NzUgNS43MjIzMiAxNy44MDE2IDUuNTM2NTdMMTIuODkxNiAwLjU4NjU3M0MxMi43MDU4IDAuNDAwNjIgMTIuNDg1MyAwLjI1MzEwMiAxMi4yNDI1IDAuMTUyNDU0QzExLjk5OTcgMC4wNTE4MDUzIDExLjczOTQgMCAxMS40NzY2IDBDMTEuMjEzOCAwIDEwLjk1MzUgMC4wNTE4MDUzIDEwLjcxMDcgMC4xNTI0NTRDMTAuNDY3OSAwLjI1MzEwMiAxMC4yNDczIDAuNDAwNjIgMTAuMDYxNiAwLjU4NjU3M1YwLjU4NjU3M1pNNS45OTE1OSAxNS41ODY2TDEuOTkxNTkgMTEuNTg2Nkw2Ljc0MTU5IDYuNzQ2NTdMNy40ODE1OSA1Ljk5NjU3TDEyLjQzMTYgMTAuOTQ2Nkw3Ljg3MTU5IDE1LjUwNjZMNy44MDE1OSAxNS41ODY2SDUuOTkxNTlaIiBmaWxsPSJibGFjayI+PC9wYXRoPgo8L3N2Zz4=') 0 16, pointer",onDrawStart(t,e){},onDrawing(t,e){const n=e.viewContainer;M(t);const o=L(t),r=It(o.width,o.height),i=function(t,e){const n=Lt(10);return n.setAttribute("d",function(t,e){let n="",o=t.coords[0];for(let r=0;r<t.coords.length;r++){const i=y(t.coords[r],t.container,e);n+=qt(i,o,r),o=i,r!==t.coords.length-1&&(n+=" ")}return n}(t,e)),n.setAttribute("stroke","rgba(232, 16, 84, 0.142)"),n}(t,n);r.appendChild(i),t.container.div.innerHTML="",t.container.div.appendChild(r),t.element=r;const c=j(t.coords[t.coords.length-1]),l=e.objectsMap.keys();for(const t of l){const n=e.objectsMap.get(t);n&&(C(n.container.bounds,c)&&(P(t,e),Ft(e,n)))}},onDrawEnd(t,e){const{objectsMap:n,viewContainer:o}=e;o.removeChild(t.container.div),n.delete(t.container.id),Z('[id^="react-draw-erase-tool"',e.viewContainer);if(e.fullState[a].deletedObjects.size>0){const n={toolId:t.toolId,toolType:"top-bar-tool",objectId:"",action:"delete",data:e.fullState[a].deletedObjects};e.fullState[a].deletedObjects=new Map,et(n,e)}},onUndo(t,e){if("delete"===t.action)return nt(t,e);throw console.error("unrecognized action",t),new Error},onRedo(t,e){if("create"===t.action)return ot(t,e);throw console.error("unrecognized action",t),new Error},onResize(t,e){}};function Ft(t,e){t.fullState[a].deletedObjects.set(e.container.id,e)}function qt(t,e,n){return 0===n?`M ${t[0]} ${t[1]}`:`l ${t[0]-e[0]} ${t[1]-e[1]}`}const Jt={id:"react-draw-undo-tool",icon:t.createElement((function(e){const n=D(e),{color:o}=n,r=I(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M8.4345 1.3088e-05C6.17654 0.00387579 4.12643 0.851527 2.61286 2.2295L1.39599 1.07024C0.88081 0.57945 0 0.927028 0 1.62108V5.97259C0 6.40284 0.36611 6.75162 0.817742 6.75162H5.38548C6.11402 6.75162 6.47887 5.91251 5.96372 5.42172L4.54119 4.06653C5.59281 3.12847 6.95357 2.60886 8.39923 2.59698C11.5475 2.57108 14.2012 4.99825 14.174 8.09701C14.1482 11.0366 11.6466 13.5032 8.45 13.5032C7.0487 13.5032 5.7243 13.0268 4.68055 12.1543C4.51894 12.0193 4.27488 12.0275 4.12285 12.1723L2.77146 13.4597C2.60546 13.6178 2.61367 13.8757 2.78789 14.0256C4.28626 15.3149 6.27188 16.1 8.45 16.1C13.1168 16.1 16.9 12.4959 16.9 8.05007C16.9 3.6093 13.0959 -0.00793953 8.4345 1.3088e-05Z",fill:o}))}),null),getDisplayMode:t=>t.undoStack.length>0?"show":"disabled",handleContext(t){const e=t.undoStack.pop();if(e&&"top-bar-tool"===e.toolType){const n=U(t.drawingTools,e.toolId);if(n.onUndo){const o=n.onUndo(e,t);t.shouldKeepHistory&&t.redoStack.push(o)}}}},_t={id:"react-draw-redo-tool",icon:t.createElement((function(e){const n=D(e),{color:o}=n,r=I(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M8.28183 1.34403e-05C10.4908 0.0039801 12.4964 0.874446 13.9771 2.28951L15.1676 1.09901C15.6716 0.595046 16.5333 0.951979 16.5333 1.66471V6.13334C16.5333 6.57517 16.1752 6.93334 15.7333 6.93334H11.2647C10.552 6.93334 10.195 6.07164 10.699 5.56764L12.0907 4.17598C11.0619 3.21268 9.73063 2.67908 8.31633 2.66688C5.2364 2.64028 2.64023 5.13278 2.66687 8.31494C2.69213 11.3336 5.13947 13.8667 8.26667 13.8667C9.63757 13.8667 10.9332 13.3774 11.9543 12.4815C12.1124 12.3428 12.3512 12.3512 12.4999 12.4999L13.822 13.822C13.9844 13.9844 13.9763 14.2491 13.8059 14.4031C12.3401 15.7271 10.3975 16.5333 8.26667 16.5333C3.70113 16.5333 3.33336e-05 12.8322 2.23918e-10 8.26674C-3.33331e-05 3.70644 3.72153 -0.00815322 8.28183 1.34403e-05Z",fill:o}))}),null),getDisplayMode:t=>t.redoStack.length>0?"show":"disabled",handleContext(t){const e=t.redoStack.pop();if(e&&"top-bar-tool"===e.toolType){const n=U(t.drawingTools,e.toolId);if(n.onRedo){const o=n.onRedo(e,t);t.shouldKeepHistory&&t.undoStack.push(o)}}}},te={id:"react-draw-trash-tool",icon:t.createElement((function(e){const n=D(e),{color:o}=n,r=I(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 14 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0C5.62123 0 5.27497 0.214002 5.10557 0.552786L4.38197 2H1C0.447715 2 0 2.44772 0 3C0 3.55228 0.447716 4 1 4L1 14C1 15.1046 1.89543 16 3 16H11C12.1046 16 13 15.1046 13 14V4C13.5523 4 14 3.55228 14 3C14 2.44772 13.5523 2 13 2H9.61804L8.89443 0.552786C8.72504 0.214002 8.37877 0 8 0H6ZM4 6C4 5.44772 4.44772 5 5 5C5.55228 5 6 5.44772 6 6V12C6 12.5523 5.55228 13 5 13C4.44772 13 4 12.5523 4 12V6ZM9 5C8.44771 5 8 5.44772 8 6V12C8 12.5523 8.44771 13 9 13C9.55229 13 10 12.5523 10 12V6C10 5.44772 9.55229 5 9 5Z",fill:o}))}),null),getDisplayMode:t=>Mt(t).length>0?"show":"disabled",handleContext(t){const e=Mt(t);if(e.length<1)return;et(ot({toolId:d,toolType:"top-bar-tool",objectId:"",data:[...e],action:"delete"},t),t)}},ee={id:"react-draw-duplicate-tool",icon:t.createElement((function(e){const n=D(e),{color:o}=n,r=I(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M4 6C4 4.89543 4.89543 4 6 4H12C13.1046 4 14 4.89543 14 6V12C14 13.1046 13.1046 14 12 14H6C4.89543 14 4 13.1046 4 12V6Z",fill:o}),t.createElement("path",{d:"M2 0C0.895431 0 0 0.89543 0 2V8C0 9.10457 0.89543 10 2 10L2 2H10C10 0.895431 9.10457 0 8 0H2Z",fill:o}))}),null),getDisplayMode:t=>Mt(t).length>0?"show":"disabled",handleContext(t){const e=Mt(t);if(e.length<1)return;const n=e.map((e=>$(t.objectsMap,e)));bt(n,t);const o=n.map((e=>function(t,e){const{div:n,id:o,bounds:r}=t.container,i=n.cloneNode(!0),{newId:c,divId:l}=function(t){const e=m(6),n=t.split("-");return n[n.length-1]=m(6),{divId:n.join("-"),newId:e}}(n.id);i.id=l;const s={coords:t.coords.slice(0),toolId:t.toolId,element:i.lastElementChild,style:Object.assign({},t.style),customData:new Map(t.customData),container:{bounds:{top:r.top+10,left:r.left+10,bottom:r.bottom+10,right:r.right+10},div:i,id:c}};i.style.top=s.container.bounds.top+"px",i.style.left=s.container.bounds.left+"px";const a=U(e.drawingTools,t.toolId);if(a.onDuplicate)return a.onDuplicate(s,e);return s}(e,t)));et(nt({toolId:d,objectId:"",toolType:"top-bar-tool",action:"delete",data:o.reduce(((t,e)=>(t[e.container.id]=e,t)),{})},t),t),1===e.length?xt(o[0],t):mt(o,t);t.fullState[d].selectedIds=o.map((t=>t.container.id))}};const ne={id:"react-draw-back-tool",icon:t.createElement((function(e){const n=D(e),{color:o}=n,r=I(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M15 17L5 9L15 1V17Z",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),t.createElement("path",{d:"M1 16V2",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}),null),getDisplayMode:t=>Mt(t).length>0?"show":"disabled",handleContext(t){const e=Mt(t);if(e.length<1)return;const n=e.map((e=>$(t.objectsMap,e)));let o=1/0;for(const e of t.objectsMap.values()){const t=oe(e);t<o&&(o=t)}n.forEach((t=>{t.container.div.style.zIndex=o.toString(),t.style.zIndex=o}))}};function oe(t){const e=t.style.zIndex;return t.container.div.style.zIndex=(e+1).toString(),t.style.zIndex=e+1,e}const re={id:"react-draw-forward-tool",icon:t.createElement((function(e){const n=D(e),{color:o}=n,r=I(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M1 1L11 9L1 17V1Z",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),t.createElement("path",{d:"M15 2V16",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}),null),getDisplayMode:t=>Mt(t).length>0?"show":"disabled",handleContext(t){const e=Mt(t);if(e.length<1)return;const n=e.map((e=>$(t.objectsMap,e)));let o=-1/0;for(const e of t.objectsMap.values()){const t=ie(e);t>o&&(o=t)}n.forEach((t=>{t.container.div.style.zIndex=o.toString(),t.style.zIndex=o}))}};function ie(t){const e=t.style.zIndex;return t.container.div.style.zIndex=(e-1).toString(),t.style.zIndex=e-1,e}export{Et as ReactDraw,ne as bringBackTool,re as bringForwardTool,Rt as circleTool,Ht as diamondTool,ee as duplicateTool,Gt as eraseTool,Tt as freeDrawTool,_t as redoTool,At as selectTool,$t as squareTool,Yt as straightLineTool,Wt as textAreaTool,te as trashTool,Jt as undoTool};
