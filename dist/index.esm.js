import t,{useRef as e,useState as n,useEffect as o,Children as i}from"react";import r,{css as c}from"styled-components";const s={boxShadow:"#000000 0px 1px 3px 0px",borderRadius:4,overflow:"hidden",display:"flex",flexDirection:"column"};function l({children:e,layout:n}){const o=function(t){return"default"===t?{width:500,height:500,maxWidth:"100%"}:"fit"===t?{maxWidth:"100%"}:void 0}(n);return t.createElement("div",{style:Object.assign(Object.assign({},s),o)},e)}const d={light:"#bddefb",main:"#228be6"},a={light:"#ececec"},u=r.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  &:hover {
    background-color: ${a.light};
  }
  ${t=>t.selected&&c`
      background-color: ${d.main} !important;
      > svg path {
        fill: white;
      }
    `}
`;function p({children:e,selected:n,onSelect:o}){return t.createElement(u,{selected:n,onClick:o},e)}const h=r.div`
  display: flex;
  background-color: ${d.light};
  z-index: 1000;
`;function f({tools:e,onSelectTool:n,currentTool:o}){return t.createElement(h,null,e.map((e=>t.createElement(p,{key:e.id,selected:e.id===o,onSelect:()=>n(e.id)},e.icon))))}function w(t){let e=t.touches[0];return e||(e=t.targetTouches[0]),e||(e=t.changedTouches[0]),[e.clientX,e.clientY]}function m(t,e){if(!e)throw new Error("Container not set.");const n=e.getBoundingClientRect();return[t[0]-n.left,t[1]-n.top]}function g(){return void 0!==typeof window}function v(t,e,n){if(!g())throw new Error("new bounding div called on the server.");const[o,i]=t,{id:r,div:c,top:s,left:l,right:d,bottom:a}=function(t,e,n,o){const i=function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,i=0;i<t;i++)e+=n.charAt(Math.floor(Math.random()*o));return e}(6),r=document.createElement("div"),c=t-n,s=e-n;return r.id=`${o}-${i}`,r.style.width=2*n+"px",r.style.height=2*n+"px",r.style.position="absolute",r.style.left=c+"px",r.style.top=s+"px",r.style.pointerEvents="none",r.style.zIndex="1",{div:r,id:i,top:s,left:c,right:c+n+n,bottom:s+n+n}}(o,i,e,n);return{coords:[t],element:null,toolId:n,container:{id:r,div:c,bounds:{top:s,left:l,right:d,bottom:a}},style:{zIndex:1,lineWidth:e},customData:{}}}function b(t,e){const{width:n,height:o}=function(t){const e=t.getAttribute("viewbox");if(!e)throw new Error("no viewbox found on ele");const n=e.split(" ");return{width:parseFloat(n[2]),height:parseFloat(n[3])}}(t),i=(e.right-e.left)/n,r=(e.bottom-e.top)/o;t.lastElementChild.style.transform=`scale(${i}, ${r})`}function M(t,e,n){const o=e.div.getBoundingClientRect(),i=n.getBoundingClientRect(),r=o.top-i.top,c=t[1]-r,s=o.left-i.left;return[t[0]-s,c]}function E(t){let e=!1;const[n,o]=t.coords[t.coords.length-1],i=t.container,r=i.bounds,c=t.style.lineWidth;return n-c<=r.left?(r.left=n-c,i.div.style.left=n-c+"px",i.div.style.width=r.right+2*c-n+"px",e=!0):n+c>=r.right&&(r.right=n+c,i.div.style.width=n+2*c-r.left+"px",e=!0),o+c>=r.bottom?(r.bottom=o+c,i.div.style.height=o+2*c-r.top+"px",e=!0):o-c<=r.top&&(r.top=o-c,i.div.style.top=o-c+"px",i.div.style.height=r.bottom+2*c-o+"px",e=!0),e}function x(t){if(t.coords.length<2)throw new Error("data coords must be at least length 2");const[e,n]=t.coords[0],[o,i]=t.coords[t.coords.length-1],r=t.style.lineWidth,c=Math.min(e,o),s=Math.min(n,i),l=Math.max(e,o),d=Math.max(n,i),{bounds:a,div:u}=t.container;return a.left=c,a.right=l,a.top=s,a.bottom=d,u.style.top=s+"px",u.style.left=c+"px",u.style.width=`${l-c+r}px`,u.style.height=`${d-s+r}px`,t.coords}function y(t,e){return t.top<=e.top&&t.bottom>=e.bottom&&t.left<=e.left&&t.right>=e.right}function D(t){const[e,n]=t;return{top:n,right:e,bottom:n,left:e}}function L(t){const e=t.container.bounds;return{width:e.right-e.left,height:e.bottom-e.top}}function C(t,e){for(const n in e)t.style[n]=e[n];return t}function j(t,e){const n=t.find((t=>t.id===e));if(!n)throw new Error("could not find the used tool");return n}function T(t,e){const n=t.toolId,o=e.drawingTools.find((t=>t.id===n));o&&o.onAfterUpdate&&o.onAfterUpdate(t,N(e,n))}function N(t,e){return Object.assign(Object.assign({},t),{customState:t.fullState[e]})}function I(r){var{children:c,topBarTools:s,hideTopBar:d,id:a}=r,u=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(t);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(t,o[i])&&(n[o[i]]=t[o[i]])}return n}(r,["children","topBarTools","hideTopBar","id"]);const p=e(null),[h,g]=n(s[0]),{layout:b}=function(t,e){const n=i.count(t);if(n>1)throw new Error("ReactDraw expects either 0 or 1 children, detected more.");void 0===e&&(e="default");return{numChildren:n,layout:e}}(c,u.layout),M=e({}),E=e(null),[x,y]=n(4),D=e(`drawing-area-container-${a}`),L=e(null),C=e(null),j=e(function(t){const e={};return t.reduce(((t,e)=>(t[e.id]={},e.setupCustomState&&(t[e.id]=e.setupCustomState(t[e.id])),t)),e)}(s)),T=()=>{const t=S(),e=j.current;return{viewContainer:t,objectsMap:M.current,lastEvent:C.current,prevMousePosition:L,drawingTools:s,customState:e[h.id],fullState:e}};function I(t){h.onKeyPress&&h.onKeyPress(t,T())}const S=()=>{const t=p.current;if(!t)throw new Error("no view container while resizing");return t};function O(t){const e=S(),n=v(t,x,h.id);E.current=n,e.append(n.container.div),h.onDrawStart(n,e)}function A(t){const e=E.current;if(!e)return;const n=T();e.coords.push(t),h.onDrawing(e,n)}function z(t){const e=E.current;L.current=null,E.current=null,e&&(e.coords.push(t),M.current[e.container.id]=e,h.onDrawEnd(e,T()))}o((()=>{const t=p.current;if(t)return t.addEventListener("mousedown",e),t.addEventListener("mouseup",o),t.addEventListener("mousemove",n),t.addEventListener("touchstart",i,{passive:!1}),t.addEventListener("touchmove",r,{passive:!1}),t.addEventListener("touchcancel",c),t.addEventListener("touchend",c),t.addEventListener("mouseleave",o),window.addEventListener("keydown",I),()=>{t.removeEventListener("mousedown",e),t.removeEventListener("mouseup",o),t.removeEventListener("mousemove",n),t.removeEventListener("touchstart",i),t.removeEventListener("touchmove",r),t.removeEventListener("touchcancel",c),t.removeEventListener("touchend",c),t.removeEventListener("mouseleave",o),window.removeEventListener("keydown",I)};function e(e){C.current=e;O(m([e.clientX,e.clientY],t))}function n(e){C.current=e;A(m([e.clientX,e.clientY],t))}function o(e){C.current=e;z(m([e.clientX,e.clientY],t))}function i(e){C.current=e,e.preventDefault();O(m(w(e),t))}function r(e){C.current=e,e.preventDefault();A(m(w(e),t))}function c(e){C.current=e,e.preventDefault();z(m(w(e),t))}}),[h]);return t.createElement(l,{layout:b},!d&&t.createElement(f,{tools:s,onSelectTool:t=>{if(h.id!==t){const e=function(t,e){const n=t.find((t=>t.id===e));if(!n)throw new Error("could not find the used tool");return n}(s,t);if(e){const t=h,n=T();t.onUnPickTool&&t.onUnPickTool(n),e.onPickTool&&e.onPickTool(N(n,e.id)),g(e)}}},currentTool:h.id}),t.createElement("div",{id:D.current,style:{position:"relative",width:"100%",flex:1,boxSizing:"border-box"},ref:p},c),t.createElement("div",null),t.createElement("style",null,`\n\t\t#${D.current} {\n\t\t\tcursor: ${h.cursor||"defautl"};\n\t\t}\n\t  `))}function S(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(t);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(t,o[i])&&(n[o[i]]=t[o[i]])}return n}function O(t){const{size:e,width:n,height:o,color:i}=t,r=S(t,["size","width","height","color"]);return Object.assign({width:n||e||20,height:o||e||20,color:i||"#111827"},r)}function A(t){const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("fill","transparent"),e.setAttribute("stroke","black"),e.style.strokeWidth=`${t}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}function z(t,e){if(!g())throw new Error("createSVG called on server");const n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("viewbox",`0 0 ${t} ${e}`),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n}function k(t){if(!g())throw new Error("createPath called on server");const e=document.createElementNS("http://www.w3.org/2000/svg","circle");return e.setAttribute("fill","black"),e.setAttribute("cx",`${Math.ceil(t/2)}`),e.setAttribute("cy",`${Math.ceil(t/2)}`),e.setAttribute("r",`${t}`),e}const P={id:"free-draw-tool",icon:t.createElement((function(e){const n=O(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M10.5858 0.585786C11.3668 -0.195262 12.6332 -0.195262 13.4142 0.585786C14.1953 1.36683 14.1953 2.63316 13.4142 3.41421L12.6213 4.20711L9.79289 1.37868L10.5858 0.585786Z",fill:n.color}),t.createElement("path",{d:"M8.37868 2.79289L0 11.1716V14H2.82842L11.2071 5.62132L8.37868 2.79289Z",fill:n.color}))}),null),onDrawStart:t=>{const e=t.style.lineWidth,n=z(e,e),o=k(e/2);n.appendChild(o),t.container.div.appendChild(n),t.element=n},onDrawing:(t,{viewContainer:e})=>{E(t);const n=L(t),o=z(n.width,n.height),i=function(t,e){const n=A(t.style.lineWidth);return n.setAttribute("d",function(t,e){let n="",o=t.coords[0];for(let i=0;i<t.coords.length;i++){const r=M(t.coords[i],t.container,e);n+=$(r,o,i),o=r,i!==t.coords.length-1&&(n+=" ")}return n}(t,e)),n}(t,e);o.appendChild(i),t.container.div.innerHTML="",t.container.div.appendChild(o),t.element=o},onDrawEnd:t=>{},onResize:(t,e)=>{t.element&&b(t.element,t.container.bounds)},cursor:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjU4NTggMC41ODU3ODZDMTEuMzY2OCAtMC4xOTUyNjIgMTIuNjMzMiAtMC4xOTUyNjIgMTMuNDE0MiAwLjU4NTc4NkMxNC4xOTUzIDEuMzY2ODMgMTQuMTk1MyAyLjYzMzE2IDEzLjQxNDIgMy40MTQyMUwxMi42MjEzIDQuMjA3MTFMOS43OTI4OSAxLjM3ODY4TDEwLjU4NTggMC41ODU3ODZaIiBmaWxsPSIjMTExODI3Ii8+CjxwYXRoIGQ9Ik04LjM3ODY4IDIuNzkyODlMMCAxMS4xNzE2VjE0SDIuODI4NDJMMTEuMjA3MSA1LjYyMTMyTDguMzc4NjggMi43OTI4OVoiIGZpbGw9IiMxMTE4MjciLz4KPC9zdmc+') 0 16, pointer"};function $(t,e,n){return 0===n?`M ${t[0]} ${t[1]}`:`l ${t[0]-e[0]} ${t[1]-e[1]}`}function U(t,e){const[n,o]=e,i=t.container,r=i.bounds,c=i.div;r.left+5>=r.right+n||r.bottom-5<=r.top+o||(r.top+=o,r.right+=n,c.style.top=r.top+"px",c.style.width=r.right-r.left+"px",c.style.height=r.bottom-r.top+"px")}function Y(t,e){const[n,o]=e,i=t.container,r=i.bounds,c=i.div;r.left+n>=r.right-5||r.bottom-5<=r.top+o||(r.top+=o,r.left+=n,c.style.top=r.top+"px",c.style.left=r.left+"px",c.style.width=r.right-r.left+"px",c.style.height=r.bottom-r.top+"px")}function R(t,e){const[n,o]=e,i=t.container,r=i.bounds,c=i.div;r.left+5>=r.right+n||r.bottom+o<=r.top+5||(r.right+=n,r.bottom+=o,c.style.width=r.right-r.left+"px",c.style.height=r.bottom-r.top+"px")}function Z(t,e){const[n,o]=e,i=t.container,r=i.bounds,c=i.div;r.left+n>=r.right-5||r.bottom+o<=r.top+5||(r.bottom+=o,r.left+=n,c.style.left=r.left+"px",c.style.width=r.right-r.left+"px",c.style.height=r.bottom-r.top+"px")}const W={top:"-45px",cursor:"grab",left:"calc(50% - 8px)"},B={width:"calc(100% + 16px)",height:"calc(100% + 16px)",position:"absolute",border:`2px dotted ${d.main}`,top:"-6px",left:"-6px",cursor:"all-scroll",pointerEvents:"all"},H={width:"0px",height:"35px",borderLeft:"2px dotted black",position:"absolute",left:"5px",pointerEvents:"none"},Q={position:"absolute",borderRadius:"50%",width:"16px",height:"16px"};function X(t,e){const n=t.customState,o=n.prevPoint;if(!o)return;const i=rt(n.selectedIds,t.objectsMap);!function(t,e,n){const[o,i]=n,[r,c]=e,s=o-r,l=i-c;for(const e of t){const{bounds:t,div:n}=e.container,{left:o,top:i,right:r,bottom:c}=t;t.left=o+s,t.top=i+l,t.right=t.left+(r-o),t.bottom=t.top+(c-i),n.style.top=t.top+"px",n.style.left=t.left+"px"}}(i,o,e),n.prevPoint=e,1===i.length&&T(i[0],t)}function G(t,e){t.customState.prevPoint=e}function K(t){t.customState.prevPoint=null}function V(t,e,n){const o=function(t){t.stopPropagation();const e=m([t.clientX,t.clientY],n.viewContainer);G(n,e),window.addEventListener("mousemove",i),window.addEventListener("mouseup",r)},i=function(t){t.stopPropagation();const e=m([t.clientX,t.clientY],n.viewContainer);X(n,e)},r=function(t){t.stopPropagation(),K(n),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",r)},c=function(t){t.stopPropagation();const e=m(w(t),n.viewContainer);G(n,e),window.addEventListener("touchmove",s),window.addEventListener("touchend",l),window.addEventListener("touchcancel",l)},s=function(t){t.stopPropagation();const e=m(w(t),n.viewContainer);X(n,e)},l=function(t){t.stopPropagation(),K(n),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",l),window.removeEventListener("touchcancel",l)},d=n.customState,a=d.handlers[e]||[];d.handlers[e]=a,a.push({ele:t,eventName:"mousedown",fn:o}),a.push({ele:t,eventName:"touchstart",fn:c}),t.addEventListener("mousedown",o),t.addEventListener("touchstart",c)}function q(t,e,n){const o=t.customState,i=o.prevPoint;if(!i)return;const r=rt(o.selectedIds,t.objectsMap);if(1!==r.length)throw new Error("start rotating got incorrect number of objects to handle");const c=r[0],s=(d=i,[(l=e)[0]-d[0],l[1]-d[1]]);var l,d;const a=j(t.drawingTools,c.toolId),u={viewContainer:t.viewContainer,newPoint:e,previousPoint:i};a.doResize?a.doResize(c,u):n(c,s),a.onResize(c,u),o.prevPoint=e}function F(t,e){t.customState.prevPoint=e}function J(t){t.customState.prevPoint=null}function _(t,e,n,o){const i=function(t){t.stopPropagation();const e=m([t.clientX,t.clientY],n.viewContainer);F(n,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",c)},r=function(t){t.stopPropagation();const e=m([t.clientX,t.clientY],n.viewContainer);q(n,e,o)},c=function(t){t.stopPropagation(),J(n),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",c)},s=function(t){t.stopPropagation();const e=m(w(t),n.viewContainer);F(n,e),window.addEventListener("touchmove",l),window.addEventListener("touchend",d),window.addEventListener("touchcancel",d)},l=function(t){t.stopPropagation();const e=m(w(t),n.viewContainer);q(n,e,o)},d=function(t){t.stopPropagation(),J(n),window.removeEventListener("touchmove",l),window.removeEventListener("touchend",d),window.removeEventListener("touchcancel",d)},a=n.customState,u=a.handlers[e]||[];a.handlers[e]=u,u.push({ele:t,eventName:"mousedown",fn:i}),u.push({ele:t,eventName:"touchstart",fn:s}),t.addEventListener("mousedown",i),t.addEventListener("touchstart",s)}function tt(t,e){const n=t.customState;if(!n.prevPoint)return;const o=rt(n.selectedIds,t.objectsMap);if(1!==o.length)throw new Error("start rotating got incorrect number of objects to handle");const i=o[0];!function(t,e,n){const o=t.container.div,i=e[0]-n[0],r=e[1]-n[1],c=180*Math.atan2(r,i)/Math.PI+90;o.style.transform=`rotate(${c}deg)`}(i,e,function(t){const e=t.bottom-t.top,n=t.top+e/2,o=t.right-t.left;return[t.left+o/2,n]}(i.container.bounds)),n.prevPoint=e,T(i,t)}function et(t,e){t.customState.prevPoint=e}function nt(t){t.customState.prevPoint=null}function ot(t){const e=t.container.div,n=t.container.id;if(function(t){return null!==t.querySelector('[id^="select-frame"')}(e))return null;const o=document.createElement("div");return o.setAttribute("id",`select-frame-${n}`),C(o,B),o}function it(t,e){return e.map((e=>t[e]))}function rt(t,e){return t.map((t=>e[t]))}function ct(t,e){for(const n of t)dt(n,e)}function st(t,e){const n=ot(t);n&&(V(n,t.container.id,e),function(t,e,n){const o=e.container.id,i=lt(o,!0,!1,!1,!0);_(i,o,n,Y);const r=lt(o,!0,!0);_(r,o,n,U);const c=lt(o,!1,!0,!0);_(c,o,n,R);const s=lt(o,!1,!1,!0,!0);_(s,o,n,Z),t.appendChild(i),t.appendChild(r),t.appendChild(c),t.appendChild(s);const l=lt(o);l.id=`button-rotate-${o}`,C(l,W),function(t,e,n){const o=function(t){t.stopPropagation();const e=m([t.clientX,t.clientY],n.viewContainer);et(n,e),window.addEventListener("mousemove",i),window.addEventListener("mouseup",r)},i=function(t){t.stopPropagation();const e=m([t.clientX,t.clientY],n.viewContainer);tt(n,e)},r=function(t){t.stopPropagation(),nt(n),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",r)},c=function(t){t.stopPropagation();const e=m(w(t),n.viewContainer);et(n,e),window.addEventListener("touchmove",s),window.addEventListener("touchend",l),window.addEventListener("touchcancel",l)},s=function(t){t.stopPropagation();const e=m(w(t),n.viewContainer);tt(n,e)},l=function(t){t.stopPropagation(),nt(n),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",l),window.removeEventListener("touchcancel",l)},d=n.customState,a=d.handlers[e]||[];d.handlers[e]=a,a.push({ele:t,eventName:"mousedown",fn:o}),a.push({ele:t,eventName:"touchstart",fn:c}),t.addEventListener("mousedown",o),t.addEventListener("touchstart",c)}(l,o,n);const d=document.createElement("div");C(d,H),d.id=`line-div-${o}`,l.appendChild(d),t.appendChild(l)}(n,t,e),t.container.div.appendChild(n))}function lt(t,e,n,o,i){const r=document.createElement("button");C(r,Q);let c="";return e?(r.style.top="-12px",c+="n"):o&&(r.style.bottom="-12px",c+="s"),n?(r.style.right="-12px",c+="e"):i&&(r.style.left="-12px",c+="w"),r.id=`corner-button-${c}-${t}`,r.style.cursor=`${c}-resize`,r}function dt(t,e){const{div:n}=t.container,o=n.querySelector('[id^="select-frame"'),i=e.customState,r=i.handlers[t.container.id];if(r)for(const t of r)t.ele.removeEventListener(t.eventName,t.fn);i.handlers[t.container.id]=[],null!==o&&n.removeChild(o)}const at={icon:t.createElement((function(e){const n=O(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M5.67175 0.911473C5.52881 0.378007 4.98047 0.0614245 4.44701 0.204366C3.91354 0.347308 3.59696 0.895645 3.7399 1.42911L3.99872 2.39504C4.14166 2.9285 4.69 3.24509 5.22346 3.10214C5.75693 2.9592 6.07351 2.41086 5.93057 1.8774L5.67175 0.911473Z",fill:n.color}),t.createElement("path",{d:"M1.42911 3.7399C0.895645 3.59696 0.347308 3.91354 0.204366 4.44701C0.0614245 4.98047 0.378007 5.52881 0.911473 5.67175L1.8774 5.93057C2.41086 6.07351 2.9592 5.75693 3.10214 5.22346C3.24509 4.69 2.9285 4.14166 2.39504 3.99872L1.42911 3.7399Z",fill:n.color}),t.createElement("path",{d:"M10.2426 3.17149C10.6331 2.78097 10.6331 2.1478 10.2426 1.75728C9.85204 1.36676 9.21887 1.36676 8.82835 1.75728L8.12124 2.46439C7.73072 2.85491 7.73072 3.48808 8.12124 3.8786C8.51177 4.26912 9.14493 4.26912 9.53545 3.8786L10.2426 3.17149Z",fill:n.color}),t.createElement("path",{d:"M3.17149 10.2426L3.8786 9.53546C4.26912 9.14493 4.26912 8.51177 3.8786 8.12124C3.48808 7.73072 2.85491 7.73072 2.46439 8.12124L1.75728 8.82835C1.36676 9.21887 1.36676 9.85204 1.75728 10.2426C2.1478 10.6331 2.78097 10.6331 3.17149 10.2426Z",fill:n.color}),t.createElement("path",{d:"M6.37142 5.07152C6 4.92295 5.57578 5.01002 5.29292 5.29289C5.01006 5.57575 4.92298 5.99997 5.07155 6.37138L9.07155 16.3714C9.2178 16.737 9.56502 16.9828 9.95847 16.9991C10.3519 17.0155 10.7183 16.7994 10.8945 16.4472L12.274 13.6882L15.2929 16.7071C15.6834 17.0976 16.3166 17.0976 16.7071 16.7071C17.0977 16.3166 17.0977 15.6834 16.7071 15.2929L13.6882 12.2739L16.4472 10.8944C16.7995 10.7183 17.0155 10.3519 16.9992 9.95843C16.9828 9.56498 16.737 9.21777 16.3714 9.07152L6.37142 5.07152Z",fill:n.color}))}),{style:{transform:"translate(-2px, -1px)"}}),id:"react-draw-cursor",onDrawStart:t=>{t.container.div.style.border=`1px solid ${d.main}`,t.container.div.style.backgroundColor=d.light+"4d"},onDrawing:(t,e)=>{x(t),t.coords.splice(1),function(t,e){var n,o;const i=null!==(o=null===(n=e.lastEvent)||void 0===n?void 0:n.shiftKey)&&void 0!==o&&o,r=e.customState.selectedIds||[];let c=function(t,e,n){const o=[];for(const i in t){const r=t[i];dt(r,n),y(e,r.container.bounds)&&o.push(i)}return o}(e.objectsMap,t.container.bounds,e);i&&(c=new Array(...new Set([...c,...r])));ht(e,c)}(t,e)},onDrawEnd:(t,e)=>{const{objectsMap:n,viewContainer:o}=e;o.removeChild(t.container.div),delete n[t.container.id],ut(t,e)},onResize:t=>{},setupCustomState:()=>({selectedIds:[],handlers:{},prevPoint:null}),onUnPickTool(t){const e=t.customState,n=e.selectedIds;if(0===n.length)return;ct(n.map((e=>t.objectsMap[e])),t),e.selectedIds=[]},onKeyPress(t,e){if(!("Delete"===t.key))return;const n=e.customState.selectedIds;if(n.length<1)return;const o=it(e.objectsMap,n);ct(o,e);const i=e.viewContainer;for(const t of o){i.removeChild(t.container.div),delete e.objectsMap[t.container.id];const n=j(e.drawingTools,t.toolId);n.onDeleteObject&&n.onDeleteObject(t,N(e,n.id))}}},ut=(t,e)=>{var n;const o=!!(null===(n=e.lastEvent)||void 0===n?void 0:n.shiftKey),i=t.coords[0],r=t.coords[t.coords.length-1];if(c=r,s=i,Math.sqrt(Math.pow(Math.abs(c[0]-s[0]),2)+Math.pow(Math.abs(c[1]-s[1]),2))<75){const t=function(t,e){let{top:n,right:o,bottom:i,left:r}=t;const[c,s]=e;return s>i?i=s:s<n&&(n=s),c<r?r=c:c>o&&(o=c),{top:n,right:o,bottom:i,left:r}}(D(i),r);pt(e,t,o)}var c,s},pt=(t,e,n)=>{const o=function(t,e){var n;let o=null;for(const i in t){const r=t[i];y(r.container.bounds,e)&&(null!==(n=null==o?void 0:o.style.zIndex)&&void 0!==n?n:0<r.style.zIndex)&&(o=r)}return o}(t.objectsMap,e);let{ids:i}=function(t){const e=t.customState.selectedIds||[],{objectsMap:n,prevMousePosition:o}=t,i=rt(e,n);if(ct(i,t),1===i.length){const e=j(t.drawingTools,i[0].toolId);e&&t&&e.onUnSelect&&e.onUnSelect(i[0],N(t,e.id))}return o.current=null,{ids:e.splice(0,e.length),objects:i}}(t);return n||(i=[]),null!==o&&(i=i.concat([o.container.id])),ht(t,i),i};function ht(t,e){t.customState.selectedIds=e;const n=it(t.objectsMap,e);return 1===n.length?(function(t,e,n){const o=j(t,e.toolId);o&&n&&o.onSelect&&o.onSelect(e,N(n,o.id))}(t.drawingTools,n[0],t),st(n[0],t)):n.length>1?function(t,e){for(const n of t){const t=ot(n);t&&(V(t,n.container.id,e),n.container.div.appendChild(t))}}(n,t):void 0}const ft={id:"react-draw-square-tool",icon:t.createElement((function(e){const n=O(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("rect",{width:"16",height:"16",rx:"1",fill:n.color}))}),null),onDrawStart:t=>{const e=function(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=`${t}px solid black`,e.style.borderRadius="2px",e}(t.style.lineWidth);t.container.div.appendChild(e),t.element=e},onDrawing:t=>{x(t),t.coords.splice(1)},onDrawEnd:t=>{},onResize(t,e){}};const wt={id:"react-draw-circle-tool",icon:t.createElement((function(e){const n=O(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("circle",{cx:"8",cy:"8",r:"8",fill:n.color}))}),null),onDrawStart:t=>{const e=function(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=`${t}px solid black`,e.style.borderRadius="50%",e}(t.style.lineWidth);t.container.div.appendChild(e),t.element=e},onDrawing:t=>{x(t),t.coords.splice(1)},onDrawEnd:t=>{},onResize(t,e){}};const mt={id:"react-draw-diamond-tool",icon:t.createElement((function(e){const n=O(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("rect",{x:"11",y:"-0.313721",width:"16",height:"16",rx:"1",transform:"rotate(45 11 -0.313721)",fill:n.color}))}),null),onDrawStart:t=>{const e=t.container.div,n=gt(t);e.appendChild(n)},onDrawing:t=>{x(t);const e=t.container.div,n=gt(t);e.innerHTML="",e.appendChild(n),t.element=n,t.coords.splice(1)},onDrawEnd:t=>{},onResize(t,e){b(t.element,t.container.bounds)}};function gt(t){const e=t.style.lineWidth,{bounds:n}=t.container,o=z(n.right-n.left+e,n.bottom-n.top+e),i=function(t,e){const n=A(e);return n.setAttribute("d",function(t,e){const n=t.bottom-t.top,o=t.right-t.left,i=`${e/2} ${n/2}`;return`M ${i} L ${o/2} ${e/2} L ${o-e/2} ${n/2} L ${o/2} ${n-e/2} L ${i}`}(t,e)),n}(n,t.style.lineWidth);return o.appendChild(i),o}const vt={id:"react-draw-line-tool",icon:t.createElement((function(e){const n=O(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 24 3",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("line",{y1:"1.5",x2:"24",y2:"1.5",stroke:"black",strokeWidth:"3"}))}),null),onDrawStart:t=>{const e=t.container.div,n=t.style.lineWidth,o=z(n,n),i=k(n/2);o.appendChild(i),e.append(o),t.element=o},onDrawing:(t,e)=>{x(t);const n=function(t,e){const[n,o]=t,[i,r]=e;if(i===n)return r>o?"down":"up";if(r===o)return i>n?"right":"left";if(i<n&&r<o)return"nw";if(i>n&&r<o)return"ne";if(i>n&&r>o)return"se";return"sw"}(t.coords[0],t.coords[t.coords.length-1]);t.customData.orientation=n;const o=bt(t,n),i=t.container.div;i.innerHTML="",i.appendChild(o),t.element=o,t.coords.splice(1)},onDrawEnd:t=>{},onResize(t,e){const n=bt(t,t.customData.orientation),o=t.container.div;o.removeChild(t.element),o.appendChild(n),t.element=n,t.coords.splice(1)}};function bt(t,e){const{bounds:n}=t.container,o=n.right-n.left,i=n.bottom-n.top,r=z(o,i);r.style.overflow="visible";const[c,s]=function(t,e,n){if("right"===n)return[[0,0],[t,0]];if("left"===n)return[[t,0],[0,0]];if("down"===n)return[[0,0],[0,e]];if("up"===n)return[[0,e],[0,0]];if("nw"===n)return[[t,e],[0,0]];if("ne"===n)return[[0,e],[t,0]];if("se"===n)return[[0,0],[t,e]];return[[t,0],[0,e]]}(o,i,e),l=function(t){const e=document.createElementNS("http://www.w3.org/2000/svg","line");return e.setAttribute("fill","transparent"),e.setAttribute("stroke","black"),e.style.strokeWidth=`${t}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}(t.style.lineWidth);return l.setAttribute("x1",c[0].toString()),l.setAttribute("y1",c[1].toString()),l.setAttribute("x2",s[0].toString()),l.setAttribute("y2",s[1].toString()),r.appendChild(l),r}const Mt={icon:t.createElement("span",{style:{display:"inline-block",fontWeight:"bold",fontSize:"20px"}},"A"),id:"react-draw-textarea-tool",onDrawStart:t=>{!function(t){const e=12,n=5,{div:o,bounds:i}=t.container;i.bottom=i.top+e+n,o.style.height="",o.style.minHeight=i.bottom-i.top+"px",o.style.minWidth=o.style.width,o.style.width="",o.style.border="1px solid black",o.style.padding=n+"px",o.style.borderRadius="2px";const r=document.createElement("style");r.innerHTML="\n\t.react-draw-cursor {\n\t\toutline: none;\t\t\n\t\theight: 100%;\n\t}",o.appendChild(r);const c=function(){const t=document.createElement("div");return t.style.fontSize="14px",t.setAttribute("contenteditable","true"),t.style.minWidth="1px",t.style.height="100%",t.className="react-draw-cursor",t}();function s(){const t=o.getBoundingClientRect(),{width:e,height:n}=t;i.bottom=i.top+n,i.right=i.left+e}t.customData={handler:s},c.addEventListener("keypress",s),o.appendChild(c),Et(o,i),c.setAttribute("tabindex","1"),setTimeout((function(){c.focus()}),0),t.element=c}(t)},onDrawing(t,e){},onDrawEnd(t,e){},onResize(t,e){const n=t.element;n&&xt(n)},onSelect(t,e){const n=t.element;n&&(t.customData.handler&&(n.removeEventListener("keypress",t.customData.handler),t.customData.handler=null),xt(n))},onUnSelect(t){const e=t.element;e&&(t.customData.handler&&(e.removeEventListener("keypress",t.customData.handler),t.customData.handler=null),Et(t.container.div,t.container.bounds))},onAfterUpdate(t){const e=t.element;e&&xt(e)}};function Et(t,e){const n=t.getBoundingClientRect(),{width:o,height:i}=n;e.bottom=e.top+i,e.right=e.left+o}function xt(t){if(t.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);const n=window.getSelection();if(n)return n.removeAllRanges(),n.addRange(e),!0}return console.error("cannot place caret at end"),!1}const yt={icon:t.createElement((function(e){const n=O(e),{color:o}=n,i=S(n,["color"]);return t.createElement("svg",Object.assign({},i,{viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M10.0616 0.586573L5.31159 5.33657L0.581585 10.1766C0.209084 10.5513 0 11.0582 0 11.5866C0 12.1149 0.209084 12.6218 0.581585 12.9966L4.88159 17.2966C5.06785 17.4813 5.31925 17.5855 5.58159 17.5866H17.5816V15.5866H10.5816L17.8016 8.36657C17.9875 8.18083 18.1351 7.96025 18.2357 7.71745C18.3364 7.47466 18.3882 7.2144 18.3882 6.95157C18.3882 6.68874 18.3364 6.42849 18.2357 6.18569C18.1351 5.9429 17.9875 5.72232 17.8016 5.53657L12.8916 0.586573C12.7058 0.40062 12.4853 0.253102 12.2425 0.152454C11.9997 0.0518053 11.7394 0 11.4766 0C11.2138 0 10.9535 0.0518053 10.7107 0.152454C10.4679 0.253102 10.2473 0.40062 10.0616 0.586573V0.586573ZM5.99159 15.5866L1.99159 11.5866L6.74159 6.74657L7.48159 5.99657L12.4316 10.9466L7.87159 15.5066L7.80159 15.5866H5.99159Z",fill:o}))}),null),id:"react-draw-erase-tool",cursor:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOSAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjA2MTYgMC41ODY1NzNMNS4zMTE1OSA1LjMzNjU3TDAuNTgxNTg1IDEwLjE3NjZDMC4yMDkwODQgMTAuNTUxMyAwIDExLjA1ODIgMCAxMS41ODY2QzAgMTIuMTE0OSAwLjIwOTA4NCAxMi42MjE4IDAuNTgxNTg1IDEyLjk5NjZMNC44ODE1OSAxNy4yOTY2QzUuMDY3ODUgMTcuNDgxMyA1LjMxOTI1IDE3LjU4NTUgNS41ODE1OSAxNy41ODY2SDE3LjU4MTZWMTUuNTg2NkgxMC41ODE2TDE3LjgwMTYgOC4zNjY1N0MxNy45ODc1IDguMTgwODMgMTguMTM1MSA3Ljk2MDI1IDE4LjIzNTcgNy43MTc0NUMxOC4zMzY0IDcuNDc0NjYgMTguMzg4MiA3LjIxNDQgMTguMzg4MiA2Ljk1MTU3QzE4LjM4ODIgNi42ODg3NCAxOC4zMzY0IDYuNDI4NDkgMTguMjM1NyA2LjE4NTY5QzE4LjEzNTEgNS45NDI5IDE3Ljk4NzUgNS43MjIzMiAxNy44MDE2IDUuNTM2NTdMMTIuODkxNiAwLjU4NjU3M0MxMi43MDU4IDAuNDAwNjIgMTIuNDg1MyAwLjI1MzEwMiAxMi4yNDI1IDAuMTUyNDU0QzExLjk5OTcgMC4wNTE4MDUzIDExLjczOTQgMCAxMS40NzY2IDBDMTEuMjEzOCAwIDEwLjk1MzUgMC4wNTE4MDUzIDEwLjcxMDcgMC4xNTI0NTRDMTAuNDY3OSAwLjI1MzEwMiAxMC4yNDczIDAuNDAwNjIgMTAuMDYxNiAwLjU4NjU3M1YwLjU4NjU3M1pNNS45OTE1OSAxNS41ODY2TDEuOTkxNTkgMTEuNTg2Nkw2Ljc0MTU5IDYuNzQ2NTdMNy40ODE1OSA1Ljk5NjU3TDEyLjQzMTYgMTAuOTQ2Nkw3Ljg3MTU5IDE1LjUwNjZMNy44MDE1OSAxNS41ODY2SDUuOTkxNTlaIiBmaWxsPSJibGFjayI+PC9wYXRoPgo8L3N2Zz4=') 0 16, pointer",onDrawStart(t,e){},onDrawing(t,e){const n=e.viewContainer;E(t);const o=L(t),i=z(o.width,o.height),r=function(t,e){const n=A(10);return n.setAttribute("d",function(t,e){let n="",o=t.coords[0];for(let i=0;i<t.coords.length;i++){const r=M(t.coords[i],t.container,e);n+=Dt(r,o,i),o=r,i!==t.coords.length-1&&(n+=" ")}return n}(t,e)),n.setAttribute("stroke","rgba(232, 16, 84, 0.142)"),n}(t,n);i.appendChild(r),t.container.div.innerHTML="",t.container.div.appendChild(i),t.element=i;const c=D(t.coords[t.coords.length-1]),s=Object.keys(e.objectsMap);for(const t of s){const o=e.objectsMap[t];if(y(o.container.bounds,c)){n.removeChild(o.container.div),delete e.objectsMap[t];const i=j(e.drawingTools,o.toolId);i.onDeleteObject&&i.onDeleteObject(o,N(e,i.id))}}},onDrawEnd(t,e){const{objectsMap:n,viewContainer:o}=e;o.removeChild(t.container.div),delete n[t.container.id]},onResize(t,e){}};function Dt(t,e,n){return 0===n?`M ${t[0]} ${t[1]}`:`l ${t[0]-e[0]} ${t[1]-e[1]}`}export{I as ReactDraw,wt as circleTool,mt as diamondTool,yt as eraseTool,P as freeDrawTool,at as selectTool,ft as squareTool,vt as straightLineTool,Mt as textAreaTool};
