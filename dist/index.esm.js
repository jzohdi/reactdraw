import t,{useRef as e,useState as n,useEffect as o,Children as r}from"react";import i,{css as l}from"styled-components";const c={boxShadow:"#000000 0px 1px 3px 0px",borderRadius:4,overflow:"hidden",display:"flex",flexDirection:"column"};function s({children:e,layout:n}){const o=function(t){return"default"===t?{width:500,height:500,maxWidth:"100%"}:"fit"===t?{maxWidth:"100%"}:void 0}(n);return t.createElement("div",{style:Object.assign(Object.assign({},c),o)},e)}const u={light:"#bddefb",main:"#228be6"},d={light:"#ececec"},a=i.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  &:hover {
    background-color: ${d.light};
  }
  ${t=>t.selected&&l`
      background-color: ${u.main} !important;
      > svg path {
        fill: white;
      }
    `}
`;function p({children:e,selected:n,onSelect:o}){return t.createElement(a,{selected:n,onClick:o},e)}const h=i.div`
  display: flex;
  background-color: ${u.light};
  z-index: 1;
`;function f({tools:e,onSelectTool:n,currentTool:o}){return t.createElement(h,null,e.map((e=>t.createElement(p,{key:e.id,selected:e.id===o,onSelect:()=>n(e.id)},e.icon))))}function m(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*o));return e}function v(t){let e=t.touches[0];return e||(e=t.targetTouches[0]),e||(e=t.changedTouches[0]),[e.clientX,e.clientY]}function w(t,e){if(!e)throw new Error("Container not set.");const n=e.getBoundingClientRect();return[t[0]-n.left,t[1]-n.top]}function g(){return void 0!==typeof window}function b(t,e){if(!g())throw new Error("new bounding div called on the server.");const[n,o]=t,{id:r,div:i,top:l,left:c,right:s,bottom:u}=function(t,e,n){const o=m(6),r=document.createElement("div"),i=t-n,l=e-n;return r.id=o,r.style.width=2*n+"px",r.style.height=2*n+"px",r.style.position="absolute",r.style.left=i+"px",r.style.top=l+"px",r.style.pointerEvents="none",r.style.zIndex="1",{div:r,id:o,top:l,left:i,right:i+n+n,bottom:l+n+n}}(n,o,e);return{coords:[t],element:null,container:{id:r,div:i,bounds:{top:l,left:c,right:s,bottom:u}},style:{zIndex:1,lineWidth:e}}}function y(t,e){if(!g())throw new Error("createSVG called on server");const n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("viewbox",`0 0 ${t} ${e}`),n.style.width="100%",n.style.height="100%",n}function x(t,e,n){const o=e.div.getBoundingClientRect(),r=n.getBoundingClientRect(),i=o.top-r.top,l=t[1]-i,c=o.left-r.left;return[t[0]-c,l]}function E(t,e){return t.top<=e.top&&t.bottom>=e.bottom&&t.left<=e.left&&t.right>=e.right}function M(t){const e=t.container.div,n=t.container.id;if(j(e))return null;const o=document.createElement("div");return o.setAttribute("id",`select-frame-${n}`),o.style.width="calc(100% + 12px)",o.style.height="calc(100% + 12px)",o.style.position="absolute",o.style.border=`2px dotted ${u.main}`,o.style.top="-6px",o.style.left="-6px",o.style.cursor="all-scroll",o.style.pointerEvents="all",o}function L(t){const e=M(t);e&&(!function(t,e){const n=O(!0,!1,!1,!0);n.style.cursor="nw-resize",n.id=`button-tl-${e}`;const o=O(!0,!0);o.id=`button-tr-${e}`,o.style.cursor="ne-resize";const r=O(!1,!0,!0);r.id=`button-br-${e}`,r.style.cursor="se-resize";const i=O(!1,!1,!0,!0);i.style.cursor="sw-resize",i.id=`button-bl-${e}`,t.appendChild(n),t.appendChild(o),t.appendChild(r),t.appendChild(i);const l=O();l.id=`button-rotate-${e}`,l.style.top="-45px",l.style.cursor="grab",l.style.left="calc(50% - 8px)";const c=document.createElement("div");c.style.width="0px",c.style.height="35px",c.style.borderLeft="2px dotted black",c.style.position="absolute",c.style.left="5px",l.appendChild(c),t.appendChild(l)}(e,t.container.id),t.container.div.appendChild(e))}function O(t,e,n,o){const r=document.createElement("button");return r.style.position="absolute",r.style.borderRadius="50%",r.style.width="16px",r.style.height="16px",t&&(r.style.top="-12px"),e&&(r.style.right="-12px"),n&&(r.style.bottom="-12px"),o&&(r.style.left="-12px"),r}function C(t){const{div:e,id:n}=t.container;j(e)&&e.lastElementChild&&e.removeChild(e.lastElementChild)}function j(t){var e;return null===(e=t.lastElementChild)||void 0===e?void 0:e.id.includes("select-frame")}function D(i){var{children:l,topBarTools:c}=i,u=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}(i,["children","topBarTools"]);const d=e(null),[a,p]=n(c[0]),{layout:h}=function(t,e){const n=r.count(t);if(n>1)throw new Error("ReactDraw expects either 0 or 1 children, detected more.");void 0===e&&(e="default");return{numChildren:n,layout:e}}(l,u.layout),g=e({}),y=e(null),[x,O]=n(4),j=e(`drawing-area-container-${m(6)}`),D=e([]),I=e(null),T=e(null),A=()=>{!function(t){for(const e of t)C(e)}(D.current.map((t=>g.current[t]))),T.current=null,I.current=null,D.current=[]};function z(t,e){const n=d.current;if(!n)return;if(Z(t,e))return;const o=b(e,x);y.current=o,A(),null==n||n.append(o.container.div),a.onDrawStart(o,n)}function S(t){if(Y())return;const e=d.current,n=y.current;n&&e&&(n.coords.push(t),a.onDrawing(n,e),"react-draw-cursor"===a.id&&U(n,g.current))}function $(t){const e=y.current,n=d.current;e&&n&&(T.current=null,I.current=null,y.current=null,a.onDrawEnd(e,n),k()?N(e,t):g.current[e.container.id]=e)}const N=(t,e)=>{const n=t.coords[0];if(o=e,r=n,Math.sqrt(Math.pow(Math.abs(o[0]-r[0]),2)+Math.pow(Math.abs(o[1]-r[1]),2))<75){const t=function(t,e){let{top:n,right:o,bottom:r,left:i}=t;const[l,c]=e;return c>r?r=c:c<n&&(n=c),l<i?i=l:l>o&&(o=l),{top:n,right:o,bottom:r,left:i}}(function(t){const[e,n]=t;return{top:n,right:e,bottom:n,left:e}}(n),e);B(g.current,t)}var o,r},k=()=>"react-draw-cursor"===a.id,Y=()=>null!==I.current&&null!==T.current,Z=(t,e)=>{if(!t)throw new Error("Did start select action recieved null as target");return!!t.id.includes("select-frame")&&(I.current=e,T.current="drag",!0)};function P(t){Y()&&((t=>{const e=I.current;e&&"drag"===T.current&&function(t,e,n){const[o,r]=n,[i,l]=e,c=o-i,s=r-l;for(const e of t){const{bounds:t,div:n}=e.container,{left:o,top:r,right:i,bottom:l}=t;t.left=o+c,t.top=r+s,t.right=t.left+(i-o),t.bottom=t.top+(l-r),n.style.top=t.top+"px",n.style.left=t.left+"px"}}(D.current.map((t=>g.current[t])),e,t)})(t),I.current=t)}o((()=>{const t=d.current;if(t)return t.addEventListener("mousedown",r),t.addEventListener("mouseup",l),t.addEventListener("mousemove",i),t.addEventListener("touchstart",c,{passive:!1}),t.addEventListener("touchmove",s,{passive:!1}),t.addEventListener("touchcancel",u),t.addEventListener("touchend",u),t.addEventListener("mouseleave",l),window.addEventListener("mousemove",e),window.addEventListener("mouseup",o),window.addEventListener("touchmove",n,{passive:!1}),window.addEventListener("touchend",o),()=>{t.removeEventListener("mousedown",r),t.removeEventListener("mouseup",l),t.removeEventListener("mousemove",i),t.removeEventListener("touchstart",c),t.removeEventListener("touchmove",s),t.removeEventListener("touchcancel",u),t.removeEventListener("touchend",u),t.removeEventListener("mouseleave",l),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",o),window.removeEventListener("touchmove",n),window.removeEventListener("touchend",o)};function e(e){P(w([e.clientX,e.clientY],t))}function n(e){P(w(v(e),t))}function o(){T.current=null,I.current=null}function r(e){const n=w([e.clientX,e.clientY],t);z(e.target,n)}function i(e){S(w([e.clientX,e.clientY],t))}function l(e){$(w([e.clientX,e.clientY],t))}function c(e){const n=w(v(e),t);z(e.target,n)}function s(e){S(w(v(e),t))}function u(e){$(w(v(e),t))}}),[a]);const U=(t,e)=>{let n=[];for(const o in e){const r=e[o];C(r),E(t.container.bounds,r.container.bounds)&&n.push(o)}1===n.length?L(e[n[0]]):n.length>1&&function(t){for(const e of t){const t=M(e);t&&e.container.div.appendChild(t)}}(n.map((t=>e[t]))),D.current=n},B=(t,e)=>{var n;let o=null;for(const r in t){const i=t[r];if(C(i),E(i.container.bounds,e)){(null!==(n=null==o?void 0:o.style.zIndex)&&void 0!==n?n:0<i.style.zIndex)&&(o=i)}}null!==o&&(L(o),D.current=[o.container.id])};return t.createElement(s,{layout:h},t.createElement(f,{tools:c,onSelectTool:t=>{if(a.id!==t){const e=c.find((e=>e.id===t));e&&p(e)}"react-draw-cursor"!==t&&A()},currentTool:a.id}),t.createElement("div",{id:j.current,style:{position:"relative",width:"100%",flex:1,boxSizing:"border-box"},ref:d},l),t.createElement("div",null),t.createElement("style",null,`\n\t\t#${j.current} {\n\t\t\tcursor: ${a.cursor||"defautl"};\n\t\t}\n\t  `))}var I=function(e){return function(n){const{size:o,width:r,height:i,color:l}=n,c=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}(n,["size","width","height","color"]);return t.createElement(e,Object.assign({},c,{width:r||o||20,height:i||o||20,color:l||"#111827"}))}}((function(e){return t.createElement("svg",Object.assign({},e,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M10.5858 0.585786C11.3668 -0.195262 12.6332 -0.195262 13.4142 0.585786C14.1953 1.36683 14.1953 2.63316 13.4142 3.41421L12.6213 4.20711L9.79289 1.37868L10.5858 0.585786Z",fill:e.color}),t.createElement("path",{d:"M8.37868 2.79289L0 11.1716V14H2.82842L11.2071 5.62132L8.37868 2.79289Z",fill:e.color}))}));const T={id:"free-draw-tool",icon:t.createElement(I,null),onDrawStart:t=>{const e=t.style.lineWidth,n=y(e,e),o=function(t){if(!g())throw new Error("createPath called on server");const e=document.createElementNS("http://www.w3.org/2000/svg","circle");return e.setAttribute("fill","black"),e.setAttribute("cx",`${Math.ceil(t/2)}`),e.setAttribute("cy",`${Math.ceil(t/2)}`),e.setAttribute("r",`${t}`),e}(e/2);n.appendChild(o),t.container.div.appendChild(n),t.element=n},onDrawing:(t,e)=>{!function(t){let e=!1;const[n,o]=t.coords[t.coords.length-1],r=t.container,i=r.bounds,l=t.style.lineWidth;n-l<=i.left?(i.left=n-l,r.div.style.left=n-l+"px",r.div.style.width=i.right+2*l-n+"px",e=!0):n+l>=i.right&&(i.right=n+l,r.div.style.width=n+2*l-i.left+"px",e=!0),o+l>=i.bottom?(i.bottom=o+l,r.div.style.height=o+2*l-i.top+"px",e=!0):o-l<=i.top&&(i.top=o-l,r.div.style.top=o-l+"px",r.div.style.height=i.bottom+2*l-o+"px",e=!0)}(t);const n=function(t){const e=t.container.bounds;return{width:e.right-e.left,height:e.bottom-e.top}}(t),o=y(n.width,n.height),r=function(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("fill","transparent"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","4px"),n.setAttribute("stroke-linejoin","round"),n.setAttribute("stroke-linecap","round"),n.setAttribute("d",function(t,e){let n="";for(let o=0;o<t.coords.length;o++){const r=x(t.coords[o],t.container,e);n+=0===o?`M ${r[0]} ${r[1]}`:`L ${r[0]} ${r[1]}`,o!==t.coords.length-1&&(n+="")}return n}(t,e)),n}(t,e);r.style.width="100%",r.style.height="100%",o.appendChild(r),t.container.div.innerHTML="",t.container.div.appendChild(o),t.element=o},onDrawEnd:t=>{console.log("free draw end")},onUpdate:()=>{},cursor:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjU4NTggMC41ODU3ODZDMTEuMzY2OCAtMC4xOTUyNjIgMTIuNjMzMiAtMC4xOTUyNjIgMTMuNDE0MiAwLjU4NTc4NkMxNC4xOTUzIDEuMzY2ODMgMTQuMTk1MyAyLjYzMzE2IDEzLjQxNDIgMy40MTQyMUwxMi42MjEzIDQuMjA3MTFMOS43OTI4OSAxLjM3ODY4TDEwLjU4NTggMC41ODU3ODZaIiBmaWxsPSIjMTExODI3Ii8+CjxwYXRoIGQ9Ik04LjM3ODY4IDIuNzkyODlMMCAxMS4xNzE2VjE0SDIuODI4NDJMMTEuMjA3MSA1LjYyMTMyTDguMzc4NjggMi43OTI4OVoiIGZpbGw9IiMxMTE4MjciLz4KPC9zdmc+') 0 16, pointer"};export{D as ReactDraw,T as freeDrawTool};
