import t,{useState as e,useRef as o,useEffect as n,Children as r}from"react";import i,{css as c}from"styled-components";const l={boxShadow:"#000000 0px 1px 3px 0px",borderRadius:4,overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",fontFamily:"sans-serif"};function s({children:e,layout:o}){const n=function(t){return"default"===t?{width:500,height:500,maxWidth:"100%"}:"fit"===t?{maxWidth:"100%"}:void 0}(o);return t.createElement("div",{style:Object.assign(Object.assign({},l),n)},e)}const a="react-draw-erase-tool",d="react-draw-cursor",u={light:"#bddefb",main:"#228be6"},p={light:"#ececec"},f=i.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  &:hover {
    background-color: ${p.light};
  }
  ${t=>t.selected&&c`
      background-color: ${u.main} !important;
      > svg path {
        fill: white;
      }
    `}
`;function h({children:e,selected:o,onSelect:n}){return t.createElement(f,{selected:o,onClick:n},e)}const w=i.span`
  position: relative;
  display: inline-block;
`,g=i.span`
  visibility: hidden;
  /* min-width: 120px; */
  white-space: nowrap;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 10px;
  position: absolute;
  z-index: 1000;
  ${t=>t.open&&!t.disabled?c`
        visibility: visible;
        top: ${t.top};
        left: ${t.left};
      `:c`
      visibility: hidden;
      top: ${t.top};
      left: ${t.left};
    `}
`;function b({children:r,text:i,top:c,left:l,disabled:s}){const[a,d]=e(!1),u=o(null);return n((()=>{const t=u.current;if(t)return t.addEventListener("mouseover",e),t.addEventListener("mouseleave",o),()=>{t.removeEventListener("mouseover",e),t.removeEventListener("mouseleave",o)};function e(){d(!0),("ontouchstart"in window||navigator.maxTouchPoints>0)&&setTimeout((()=>{d(!1)}),1e3)}function o(){d(!1)}}),[]),i?t.createElement(w,{ref:u},t.createElement(g,{open:a,left:l,top:c,disabled:s},i),r):t.createElement(t.Fragment,null,r)}const m=i.div`
  display: flex;
  background-color: ${u.light};
  z-index: 1000;
`;function y({tools:e,onSelectTool:o,currentTool:n}){return t.createElement(m,null,e.map(((r,i)=>{const c=r.tooltip;return t.createElement(b,Object.assign({text:c},((t,o)=>t.tooltip?o<=e.length/2?{top:"50px",left:"0"}:{top:"50px",left:`-${3*t.tooltip.length}px`}:{top:"",left:""})(r,i),{key:r.id}),t.createElement(h,{selected:r.id===n,onSelect:()=>o(r.id)},r.icon))})))}function v(t){for(var e="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=o.length,r=0;r<t;r++)e+=o.charAt(Math.floor(Math.random()*n));return e}function E(){return void 0!==typeof window}function x(t,e,o){if(!E())throw new Error("new bounding div called on the server.");const n=parseInt(e.lineWidth),[r,i]=t,{id:c,div:l,top:s,left:a,right:d,bottom:u}=function(t,e,o,n){const r=v(6),i=document.createElement("div"),c=t-o,l=e-o;return i.id=`${n}-${r}`,i.style.width=2*o+"px",i.style.height=2*o+"px",i.style.position="absolute",i.style.left=c+"px",i.style.top=l+"px",i.style.pointerEvents="none",i.style.zIndex="1",i.style.boxSizing="border-box",{div:i,id:r,top:l,left:c,right:c+o+o,bottom:l+o+o}}(r,i,n,o);return{coords:[t],element:null,toolId:o,container:{id:c,div:l,bounds:{top:s,left:a,right:d,bottom:u}},style:e,customData:new Map}}function M(t,e){const{width:o,height:n}=function(t){const e=t.getAttribute("viewbox");if(!e)throw new Error("no viewbox found on ele");const o=e.split(" ");return{width:parseFloat(o[2]),height:parseFloat(o[3])}}(t),r=(e.right-e.left)/o,i=(e.bottom-e.top)/n;t.lastElementChild.style.transform=`scale(${r}, ${i})`}function C(t,e,o){const n=e.div.getBoundingClientRect(),r=o.getBoundingClientRect(),i=n.top-r.top,c=t[1]-i,l=n.left-r.left;return[t[0]-l,c]}function j(t){let e=!1;const[o,n]=t.coords[t.coords.length-1],r=t.container,i=r.bounds,c=parseInt(t.style.lineWidth);return o-c<=i.left?(i.left=o-c,r.div.style.left=o-c+"px",r.div.style.width=i.right+2*c-o+"px",e=!0):o+c>=i.right&&(i.right=o+c,r.div.style.width=o+2*c-i.left+"px",e=!0),n+c>=i.bottom?(i.bottom=n+c,r.div.style.height=n+2*c-i.top+"px",e=!0):n-c<=i.top&&(i.top=n-c,r.div.style.top=n-c+"px",r.div.style.height=i.bottom+2*c-n+"px",e=!0),e}function I(t){if(t.coords.length<2)throw new Error("data coords must be at least length 2");const[e,o]=t.coords[0],[n,r]=t.coords[t.coords.length-1],i=parseInt(t.style.lineWidth),c=Math.min(e,n),l=Math.min(o,r),s=Math.max(e,n),a=Math.max(o,r),{bounds:d,div:u}=t.container;return d.left=c,d.right=s,d.top=l,d.bottom=a,u.style.top=l+"px",u.style.left=c+"px",u.style.width=`${s-c+i}px`,u.style.height=`${a-l+i}px`,t.coords}function L(t,e){return t.top<=e.top&&t.bottom>=e.bottom&&t.left<=e.left&&t.right>=e.right}function S(t){const[e,o]=t;return{top:o,right:e,bottom:o,left:e}}function D(t){const e=t.container.bounds;return{width:e.right-e.left,height:e.bottom-e.top}}function k(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o}function T(t){const{size:e,width:o,height:n,color:r}=t,i=k(t,["size","width","height","color"]);return Object.assign({width:o||e||20,height:n||e||20,color:r||"#111827"},i)}function O(e){const o=T(e),{color:n}=o,r=k(o,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 5C3 4.44772 3.44772 4 4 4H16C16.5523 4 17 4.44772 17 5C17 5.55228 16.5523 6 16 6H4C3.44772 6 3 5.55228 3 5Z",fill:n}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 10C3 9.44772 3.44772 9 4 9H16C16.5523 9 17 9.44772 17 10C17 10.5523 16.5523 11 16 11H4C3.44772 11 3 10.5523 3 10Z",fill:n}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 15C3 14.4477 3.44772 14 4 14H16C16.5523 14 17 14.4477 17 15C17 15.5523 16.5523 16 16 16H4C3.44772 16 3 15.5523 3 15Z",fill:n}))}const A=i.div`
  display: flex;
  background-color: ${u.light};
  z-index: 1000;
`,N=i.button`
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  ${t=>"hide"===t.mode?c`
        display: none;
      `:t.disabled?c`
        cursor: not-allowed;
        background-color: white;
        > svg path {
          fill: lightgrey;
          stroke: lightgrey;
        }
      `:c`
      &:hover {
        background-color: ${p.light};
      }
      display: inline-block;
    `}
`,z=i.button`
  position: relative;
  display: flex;
  cursor: pointer;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: transparent;
  border-radius: 2px;
  transition: background-color 150ms ease-in-out;
  @media only screen and (min-width: ${450}px) {
    width: 40px;
    height: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    width: 30px;
    height: 30px;
  }
  &:hover {
    background-color: ${p.light};
  }
  ${t=>t.open?c`
        background-color: ${u.main} !important;
        > svg path {
          fill: white;
          stroke: white;
        }
      `:c``}
`,U=i.div`
  position: absolute;
  left: 0;
  padding: 15px;
  border: 1px solid ${u.main};
  z-index: 1000;
  background-color: white;
  border-radius: 0px 5px 0px 0px;
  @media only screen and (min-width: ${450}px) {
    bottom: 40px;
  }
  @media only screen and (max-width: ${450}px) {
    bottom: 30px;
  }
`;function $({tools:o,displayMap:n,dispatch:r,hasMenu:i,children:c}){const[l,s]=e(!1);return t.createElement(t.Fragment,null,l&&t.createElement(U,null,c),t.createElement(A,null,i&&t.createElement(b,{text:"Menu",top:"-40px",left:"10px"},t.createElement(z,{onClick:()=>s(!l),open:l},t.createElement(O,{size:30}))),o.map(((e,i)=>{const c=e.id,l=n.get(c)||"hide";return t.createElement(b,Object.assign({key:e.id,text:e.tooltip},((t,e)=>t.tooltip?e<=o.length/2?{top:"-35px",left:"0"}:{top:"-35px",left:`-${3*t.tooltip.length}px`}:{top:"",left:""})(e,i),{disabled:"disabled"===l}),t.createElement(N,{disabled:"disabled"===l,mode:l,onClick:()=>r(e.handleContext)},e.icon))}))))}function W(t,e){const o=t.container.id,{div:n}=t.container,r=e.fullState[d],i=r.handlers[o];if(i)for(const t of i)t.ele.removeEventListener(t.eventName,t.fn);const c=n.querySelector('[id^="select-frame"');r.handlers[o]=[],null!==c&&n.removeChild(c);const l=r.selectedIds.indexOf(o);l>=0&&r.selectedIds.splice(l,1)}function P(t,e){for(const o in e)t.style[o]=e[o];return t}function R(t,e){const o=t.find((t=>t.id===e));if(!o)throw new Error("could not find the used tool");return o}function H(t,e){const{objectsMap:o,viewContainer:n}=e,r=Z(e.objectsMap,t);W(r,e);const{div:i,id:c}=r.container;n.removeChild(i),o.delete(c);const l=R(e.drawingTools,r.toolId);l.onDeleteObject&&l.onDeleteObject(r,e)}function Z(t,e){const o=t.get(e);if(!o)throw new Error("could not get object from map");return o}function B(t,e){if(!e)throw new Error("Container not set.");const o=e.getBoundingClientRect();return[t[0]-o.left,t[1]-o.top]}function Y(t){let e=t.touches[0];return e||(e=t.targetTouches[0]),e||(e=t.changedTouches[0]),[e.clientX,e.clientY]}function V(t,e){const o=e.querySelectorAll(t);o.length>0&&o.forEach((t=>{e.removeChild(t)}))}function K(t){return void 0!==t}function Q(t,e){const[o,n]=e,r=t.container,i=r.bounds,c=r.div;i.left+5>=i.right+o||i.bottom-5<=i.top+n||(i.top+=n,i.right+=o,c.style.top=i.top+"px",c.style.width=i.right-i.left+"px",c.style.height=i.bottom-i.top+"px")}function q(t,e){const[o,n]=e,r=t.container,i=r.bounds,c=r.div;i.left+o>=i.right-5||i.bottom-5<=i.top+n||(i.top+=n,i.left+=o,c.style.top=i.top+"px",c.style.left=i.left+"px",c.style.width=i.right-i.left+"px",c.style.height=i.bottom-i.top+"px")}function F(t,e){const[o,n]=e,r=t.container,i=r.bounds,c=r.div;i.left+5>=i.right+o||i.bottom+n<=i.top+5||(i.right+=o,i.bottom+=n,c.style.width=i.right-i.left+"px",c.style.height=i.bottom-i.top+"px")}function X(t,e){const[o,n]=e,r=t.container,i=r.bounds,c=r.div;i.left+o>=i.right-5||i.bottom+n<=i.top+5||(i.bottom+=n,i.left+=o,c.style.left=i.left+"px",c.style.width=i.right-i.left+"px",c.style.height=i.bottom-i.top+"px")}const G={top:"-45px",cursor:"grab",left:"calc(50% - 8px)"},J={width:"calc(100% + 16px)",height:"calc(100% + 16px)",position:"absolute",border:`2px dotted ${u.main}`,top:"-6px",left:"-6px",cursor:"all-scroll",pointerEvents:"all",boxSizing:"border-box"},_={width:"0px",height:"35px",borderLeft:"2px dotted black",position:"absolute",left:"5px",pointerEvents:"none"},tt={position:"absolute",borderRadius:"50%",width:"16px",height:"16px"};function et(t,e){return t.map((t=>{const o=e.get(t);if(!o)throw new Error("object not found in map");return o}))}function ot(t,e){const o=t.toolId,n=e.drawingTools.find((t=>t.id===o));n&&n.onAfterUpdate&&n.onAfterUpdate(t,e)}function nt(t,e,o){return{objectId:t.container.id,toolId:t.toolId,toolType:"top-bar-tool",action:e,data:o}}function rt(t){const e=t.element;if(!e)throw new Error;let o=e.querySelector("path");if(o||(o=e.querySelector("line")),!o)throw new Error;return o}const it=/^(#([0-9A-F]{3}){1,2}|transparent)$/i;function ct(t,e,o,n){if(!n.match(it))return;const r=rt(t),i=t.style[e];return r.style[o]=n,t.style[e]=n,nt(t,e,i)}function lt(t,e){return ct(t,"color","stroke",e)}function st(t,e){const{ele:o,action:n}=at(t,e,"background");return n?(o.style.backgroundColor=e,n):n}function at(t,e,o){const n=t.element;if(!n)throw new Error;if(!e.match(it))return{ele:n,action:void 0};const r=t.style[o];t.style[o]=e;return{ele:n,action:nt(t,o,r)}}function dt(t,e){const{ele:o,action:n}=at(t,e,"color");return n?(o.style.border=ut(t.style),n):n}function ut(t){return`${t.lineWidth}px solid ${t.color}`}function pt(t,e,o,n){if(!n.match(it))return;const r=t.style[e];return t.style[e]=n,t.container.div.style[o]=n,nt(t,e,r)}function ft(t,e){if(!e.shouldKeepHistory)return;gt({toolId:t.toolId,toolType:"top-bar-tool",objectId:t.container.id,action:"create",data:null},e)}function ht(t,e){const o=Z(e.objectsMap,t.objectId);return H(t.objectId,e),t.data=o,t.action="delete",t}function wt(t,e){const o=t.data;if(!o)throw new Error("redo delete but no data exists");return e.objectsMap.set(o.container.id,o),e.viewContainer.appendChild(o.container.div),t.data=null,t.action="create",t}function gt(t,e){e.shouldKeepHistory&&(e.undoStack.push(t),e.redoStack.splice(0))}function bt(t,e){const o=t.data;if(!o||"object"!=typeof o)throw new Error("malformed data");for(const[t,n]of o.entries())e.viewContainer.appendChild(n.container.div),e.objectsMap.set(t,n);return t.action="create",t.data=Array.from(o.keys()),t}function mt(t,e){const o=t.data;if(!o||!Array.isArray(o))throw console.error(t),new Error("malformed data");t.data=new Map;for(const n of o)t.data.set(n,Z(e.objectsMap,n)),H(n,e);return t.action="delete",t}function yt(t,e){const o=Z(e.objectsMap,t.objectId),n=o.style.opacity,r=t.data,i=o.element;if(!r||!i)throw new Error;return o.style.opacity=r,i.style.opacity=o.style.opacity,t.data=n,t}function vt(t,e){const o=Z(e.objectsMap,t.objectId),n=o.style.lineWidth,r=t.data,i=o.element;if(!r||!i)throw new Error;return o.style.lineWidth=r,i.style.border=ut(o.style),t.data=n,t}function Et(t,e){const o=Z(e.objectsMap,t.objectId),n=o.style.background,r=t.data,i=o.element;if(!r||!i)throw new Error;return o.style.background=r,i.style.backgroundColor=r,t.data=n,t}function xt(t,e){const o=Z(e.objectsMap,t.objectId),n=o.style.color,r=t.data,i=o.element;if(!r||!i)throw new Error;return o.style.color=r,i.style.border=ut(o.style),t.data=n,t}function Mt(t,e){return jt(t,e,"color","stroke")}function Ct(t,e){return jt(t,e,"background","fill")}function jt(t,e,o,n){const r=Z(e.objectsMap,t.objectId),i=r.style[o],c=t.data,l=r.element;if(!l)throw new Error;let s=l.querySelector("path");if(s||(s=l.querySelector("line")),!s)throw new Error;return r.style[o]=c,s.style[n]=c,t.data=i,t}function It(t,e){const o=Z(e.objectsMap,t.objectId),n=o.style.lineWidth,r=t.data,i=rt(o);return o.style.lineWidth=r,i.style.strokeWidth=r+"px",t.data=n,t}function Lt(t,e){const o=t.fullState[d],n=o.prevPoint;if(!n)return;const r=et(o.selectedIds,t.objectsMap);!function(t,e,o){const[n,r]=o,[i,c]=e,l=n-i,s=r-c;for(const e of t){const{bounds:t,div:o}=e.container,{left:n,top:r,right:i,bottom:c}=t;t.left=n+l,t.top=r+s,t.right=t.left+(i-n),t.bottom=t.top+(c-r),o.style.top=t.top+"px",o.style.left=t.left+"px"}}(r,n,e),o.prevPoint=e,1===r.length&&ot(r[0],t)}function St(t,e){t.fullState[d].prevPoint=e,function(t){const e=et(t.fullState[d].selectedIds,t.objectsMap),o={objectId:"",toolId:d,toolType:"top-bar-tool",action:"drag",data:e.map((t=>({objectId:t.container.id,top:t.container.bounds.top,left:t.container.bounds.left})))};gt(o,t)}(t)}function Dt(t){t.fullState[d].prevPoint=null}function kt(t,e,o){const n=function(t){t.stopPropagation();const e=B([t.clientX,t.clientY],o.viewContainer);St(o,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)},r=function(t){t.stopPropagation();const e=B([t.clientX,t.clientY],o.viewContainer);Lt(o,e)},i=function(t){t.stopPropagation(),Dt(o),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)},c=function(t){t.stopPropagation();const e=B(Y(t),o.viewContainer);St(o,e),window.addEventListener("touchmove",l),window.addEventListener("touchend",s),window.addEventListener("touchcancel",s)},l=function(t){t.stopPropagation();const e=B(Y(t),o.viewContainer);Lt(o,e)},s=function(t){t.stopPropagation(),Dt(o),window.removeEventListener("touchmove",l),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s)},a=o.fullState[d],u=a.handlers[e]||[];a.handlers[e]=u,u.push({ele:t,eventName:"mousedown",fn:n}),u.push({ele:t,eventName:"touchstart",fn:c}),t.addEventListener("mousedown",n),t.addEventListener("touchstart",c)}function Tt(t,e,o){const n=t.fullState[d],r=n.prevPoint;if(!r)return;const i=et(n.selectedIds,t.objectsMap);if(1!==i.length)throw new Error("start rotating got incorrect number of objects to handle");const c=i[0],l=(a=r,[(s=e)[0]-a[0],s[1]-a[1]]);var s,a;const u=R(t.drawingTools,c.toolId),p={viewContainer:t.viewContainer,newPoint:e,previousPoint:r};u.doResize?u.doResize(c,p):o(c,l),u.onResize(c,p),n.prevPoint=e}function Ot(t,e){t.fullState[d].prevPoint=e,function(t){const e=et(t.fullState[d].selectedIds,t.objectsMap);if(1!==e.length)throw new Error("resize push to stack expects 1 object selected");const{id:o,bounds:n}=e[0].container;gt({objectId:o,toolId:d,toolType:"top-bar-tool",action:"resize",data:{bounds:{top:n.top,left:n.left,right:n.right,bottom:n.bottom}}},t)}(t)}function At(t){t.fullState[d].prevPoint=null}function Nt(t,e,o,n){const r=function(t){t.stopPropagation();const e=B([t.clientX,t.clientY],o.viewContainer);Ot(o,e),window.addEventListener("mousemove",i),window.addEventListener("mouseup",c)},i=function(t){t.stopPropagation();const e=B([t.clientX,t.clientY],o.viewContainer);Tt(o,e,n)},c=function(t){t.stopPropagation(),At(o),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",c)},l=function(t){t.stopPropagation();const e=B(Y(t),o.viewContainer);Ot(o,e),window.addEventListener("touchmove",s),window.addEventListener("touchend",a),window.addEventListener("touchcancel",a)},s=function(t){t.stopPropagation();const e=B(Y(t),o.viewContainer);Tt(o,e,n)},a=function(t){t.stopPropagation(),At(o),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)},u=o.fullState[d],p=u.handlers[e]||[];u.handlers[e]=p,p.push({ele:t,eventName:"mousedown",fn:r}),p.push({ele:t,eventName:"touchstart",fn:l}),t.addEventListener("mousedown",r),t.addEventListener("touchstart",l)}const zt=/-{0,1}\d+\.*\d*/g;function Ut(t){const e=t.style.transform;if(!e)return 0;const o=e.match(zt);return o?parseFloat(o[0]):0}function $t(t,e){const o=t.fullState[d];if(!o.prevPoint)return;const n=et(o.selectedIds,t.objectsMap);if(1!==n.length)throw new Error("start rotating got incorrect number of objects to handle");const r=n[0];!function(t,e,o){const n=t.container.div,r=e[0]-o[0],i=e[1]-o[1],c=180*Math.atan2(i,r)/Math.PI+90;n.style.transform=`rotate(${c}deg)`}(r,e,function(t){const e=t.bottom-t.top,o=t.top+e/2,n=t.right-t.left;return[t.left+n/2,o]}(r.container.bounds)),o.prevPoint=e,ot(r,t)}function Wt(t,e){t.fullState[d].prevPoint=e,function(t){const e=et(t.fullState[d].selectedIds,t.objectsMap),o={objectId:"",toolId:d,toolType:"top-bar-tool",action:"rotate",data:e.map((t=>({objectId:t.container.id,rotate:Ut(t.container.div)})))};gt(o,t)}(t)}function Pt(t){t.fullState[d].prevPoint=null}function Rt(t,e){for(const o of t){const t=Ht(o);t&&(kt(t,o.container.id,e),o.container.div.appendChild(t))}}function Ht(t){const e=t.container.div,o=t.container.id;if(function(t){return null!==t.querySelector('[id^="select-frame"')}(e))return null;const n=document.createElement("div");return n.setAttribute("id",`select-frame-${o}`),P(n,J),n}function Zt(t,e){for(const o of t)W(o,e)}function Bt(t,e){const o=Ht(t);o&&(kt(o,t.container.id,e),function(t,e,o){const n=e.container.id,r=Yt(n,!0,!1,!1,!0);Nt(r,n,o,q);const i=Yt(n,!0,!0);Nt(i,n,o,Q);const c=Yt(n,!1,!0,!0);Nt(c,n,o,F);const l=Yt(n,!1,!1,!0,!0);Nt(l,n,o,X),t.appendChild(r),t.appendChild(i),t.appendChild(c),t.appendChild(l);const s=Yt(n);s.id=`button-rotate-${n}`,P(s,G),function(t,e,o){const n=function(t){t.stopPropagation();const e=B([t.clientX,t.clientY],o.viewContainer);Wt(o,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)},r=function(t){t.stopPropagation();const e=B([t.clientX,t.clientY],o.viewContainer);$t(o,e)},i=function(t){t.stopPropagation(),Pt(o),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)},c=function(t){t.stopPropagation();const e=B(Y(t),o.viewContainer);Wt(o,e),window.addEventListener("touchmove",l),window.addEventListener("touchend",s),window.addEventListener("touchcancel",s)},l=function(t){t.stopPropagation();const e=B(Y(t),o.viewContainer);$t(o,e)},s=function(t){t.stopPropagation(),Pt(o),window.removeEventListener("touchmove",l),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s)},a=o.fullState[d],u=a.handlers[e]||[];a.handlers[e]=u,u.push({ele:t,eventName:"mousedown",fn:n}),u.push({ele:t,eventName:"touchstart",fn:c}),t.addEventListener("mousedown",n),t.addEventListener("touchstart",c)}(s,n,o);const a=document.createElement("div");P(a,_),a.id=`line-div-${n}`,s.appendChild(a),t.appendChild(s)}(o,t,e),t.container.div.appendChild(o))}function Yt(t,e,o,n,r){const i=document.createElement("button");P(i,tt);let c="";return e?(i.style.top="-12px",c+="n"):n&&(i.style.bottom="-12px",c+="s"),o?(i.style.right="-12px",c+="e"):r&&(i.style.left="-12px",c+="w"),i.id=`corner-button-${c}-${t}`,i.style.cursor=`${c}-resize`,i}function Vt(t){const e=t.fullState[d];if(!e)throw new Error("no select state present");return[...e.selectedIds]}function Kt({getEditProps:o,styleComponents:r={},onUpdateStyle:i}){const[c,l]=e(o()),s=Object.keys(c).filter((t=>!!r[t]));n((()=>{function t(){const t=o();l(t)}return window.addEventListener("click",t),()=>{window.removeEventListener("click",t)}}),[c]);const a=(t,e)=>{l(Object.assign(Object.assign({},c),{[t]:e})),i(t,e)};return 0===s.length?t.createElement(t.Fragment,null):(s.sort(((t,e)=>{const o=r[t].order;return r[e].order-o})),t.createElement("div",{style:{display:"flex",flexDirection:"column",gap:10}},s.map((e=>{const o=r[e].component;return t.createElement(o,{key:e,onUpdate:a,styleKey:e,styleValue:c[e]})}))))}function Qt(i){var{children:c,id:l="main",topBarTools:u,hideTopBar:p,bottomBarTools:f,hideBottomBar:h,shouldKeepHistory:w=!0,shouldSelectAfterCreate:g=!0,styleComponents:b}=i,m=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o}(i,["children","id","topBarTools","hideTopBar","bottomBarTools","hideBottomBar","shouldKeepHistory","shouldSelectAfterCreate","styleComponents"]);const v=o(null),[E,M]=e(u[0]),{layout:C}=function(t,e){const o=r.count(t);if(o>1)throw new Error("ReactDraw expects either 0 or 1 children, detected more.");void 0===e&&(e="default");return{numChildren:o,layout:e}}(c,m.layout),j=o(new Map),I=o(null),L=o(`drawing-area-container-${l}`),S=o(null),D=o(null),k=o(function(t){const e={[d]:{selectedIds:[],handlers:{},prevPoint:null},[a]:{deletedObjects:new Map}};return t.reduce(((t,o)=>(void 0===t[o.id]&&(t[o.id]={}),o.setupCustomState&&(t[o.id]=Object.assign(t[o.id],o.setupCustomState(e))),t)),e)}(u)),T=o([]),O=o([]),A=o(null),N=o(Object.assign({},Xt)),[z,U]=e(new Map),W=()=>{const t=(()=>{const t=new Map;return f.reduce(((t,e)=>(t.set(e.id,e.getDisplayMode(R())),t)),t)})();if(t.size!==z.size)return U(t);const e=t.keys();for(const o of e)if(t.get(o)!==z.get(o))return U(t)};n((()=>{W()}),[]),n((()=>{if(E.id===d){const t=A.current;if(t){const e=R();Ft(e),e.fullState[d].selectedIds=[t.container.id],Bt(t,e)}}W()}),[E]);const P=t=>{if(E.id!==d)return A.current=t,M(qt(u,d));const e=R();Ft(e),Bt(t,e),W()},R=t=>{const e=t||V(),o=k.current;return{viewContainer:e,objectsMap:j.current,lastEvent:D.current,prevMousePosition:S,drawingTools:u,fullState:o,undoStack:T.current,redoStack:O.current,shouldKeepHistory:w,selectDrawingTool:X,selectObject:P,shouldSelectAfterCreate:g}};function H(t){E.onKeyPress&&(E.onKeyPress(t,R()),W())}const V=()=>{const t=v.current;if(!t)throw new Error("no view container while resizing");return t};function Q(t){const e=R(),o=x(t,Object.assign({},N.current),E.id);I.current=o,e.viewContainer.append(o.container.div),E.onDrawStart(o,e)}function q(t){const e=I.current;if(!e)return;const o=R();e.coords.push(t),E.onDrawing(e,o)}function F(t){const e=I.current;S.current=null,I.current=null,e&&(e.coords.push(t),j.current.set(e.container.id,e),E.onDrawEnd(e,R()),W())}n((()=>{const t=v.current;if(t)return t.addEventListener("mousedown",e),t.addEventListener("mouseup",n),t.addEventListener("mousemove",o),t.addEventListener("touchstart",r,{passive:!1}),t.addEventListener("touchmove",i,{passive:!1}),t.addEventListener("touchcancel",c),t.addEventListener("touchend",c),t.addEventListener("mouseleave",n),window.addEventListener("keydown",H),()=>{t.removeEventListener("mousedown",e),t.removeEventListener("mouseup",n),t.removeEventListener("mousemove",o),t.removeEventListener("touchstart",r),t.removeEventListener("touchmove",i),t.removeEventListener("touchcancel",c),t.removeEventListener("touchend",c),t.removeEventListener("mouseleave",n),window.removeEventListener("keydown",H);const l=R(t);for(const t of u)t.onUnMount&&t.onUnMount(l)};function e(e){D.current=e;Q(B([e.clientX,e.clientY],t))}function o(e){D.current=e;q(B([e.clientX,e.clientY],t))}function n(e){D.current=e;F(B([e.clientX,e.clientY],t))}function r(e){D.current=e,e.preventDefault();Q(B(Y(e),t))}function i(e){D.current=e,e.preventDefault();q(B(Y(e),t))}function c(e){D.current=e,e.preventDefault();F(B(Y(e),t))}}),[E]);const X=t=>{if(E.id!==t){const e=qt(u,t);if(e){const t=E,o=R();t.onUnPickTool&&t.onUnPickTool(o),e.onPickTool&&e.onPickTool(o),M(e),W()}}},G=(t,e)=>{const o=t.filter(K);if(0===o.length)return;gt({data:o,objectId:"",toolId:"",toolType:"batch",action:"batch"},e)},J=!!b&&!function(t){for(var e in t)return!1;return!0}(b);return t.createElement(s,{layout:C},!p&&t.createElement(y,{tools:u,onSelectTool:X,currentTool:E.id}),t.createElement("div",{id:L.current,style:{position:"relative",width:"100%",flex:1,boxSizing:"border-box"},ref:v},c),!h&&t.createElement($,{displayMap:z,tools:f,dispatch:t=>{t(R()),W()},hasMenu:J},t.createElement(Kt,{getEditProps:()=>{const t=R(),e=Vt(t);if(0===e.length){return N.current}const o=function(t,e){const o={},n=t.map((t=>Z(e.objectsMap,t))),r={};for(const t of n){const n=qt(e.drawingTools,t.toolId);if(n.getEditableStyles){const e=n.getEditableStyles();for(const n of e){const e=t.style[n];e?(o[n]=e,r[n]=(r[n]||0)+1):console.error("could not get style value for key:",n,"from object",t)}}}for(const t in r)r[t]!==n.length&&delete o[t];return o}(e,t);return o},styleComponents:b,onUpdateStyle:(t,e)=>{const o=R(),n=Vt(o);if(0===n.length)return N.current[t]=e,[];const r=n.map((t=>Z(o.objectsMap,t))),i=r.map((n=>{const r=qt(o.drawingTools,n.toolId);if(r.onUpdateStyle)return r.onUpdateStyle(n,o,t,e)}));return G(i,o),i}})),t.createElement("style",null,`\n\t\t#${L.current} {\n\t\t\tcursor: ${E.cursor||"default"};\n\t\t}\n\t  `))}function qt(t,e){const o=t.find((t=>t.id===e));if(!o)throw new Error("could not find the used tool");return o}function Ft(t){const e=t.fullState[d].selectedIds;if(e.length>0){Zt(et(e,t.objectsMap),t)}}const Xt={lineWidth:"4",zIndex:"1",color:"#000000",fontSize:"14",background:"transparent",opacity:"1"};function Gt(t){const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("fill","transparent"),e.setAttribute("stroke",t.color),e.style.strokeWidth=`${t.lineWidth}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}function Jt(t,e,o){if(!E())throw new Error("createSVG called on server");const n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("viewbox",`0 0 ${t} ${e}`),n.style.overflow="visible",n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.opacity=o,n.style.width="100%",n.style.height="100%",n}function _t(t,e){if(!E())throw new Error("createPath called on server");const o=document.createElementNS("http://www.w3.org/2000/svg","circle");return o.setAttribute("fill","black"),o.setAttribute("cx",`${Math.ceil(t/2)}`),o.setAttribute("cy",`${Math.ceil(t/2)}`),o.setAttribute("r",`${t}`),o}const te=/^[0-9]+$/g;function ee(t,e){const o=t.element;if(!o)throw new Error;if(!e.match(te))return;const n=t.style.lineWidth;t.style.lineWidth=e,o.style.border=ut(t.style);return nt(t,"lineWidth",n)}function oe(t,e){const o=e.includes("px")?e:e+"px",n=rt(t),r="lineWidth",i=t.style[r];return n.style.strokeWidth=o,t.style[r]=e,nt(t,r,i)}const ne=/^(0(\.\d+)?|1(\.0+)?)$/;function re(t,e){if(!e.match(ne))return;const o=t.element;if(!o)throw new Error;const n=t.style.opacity;return t.style.opacity=e,o.style.opacity=e,nt(t,"opacity",n)}const ie={id:"free-draw-tool",tooltip:"Free draw tool",icon:t.createElement((function(e){const o=T(e);return t.createElement("svg",Object.assign({},o,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M10.5858 0.585786C11.3668 -0.195262 12.6332 -0.195262 13.4142 0.585786C14.1953 1.36683 14.1953 2.63316 13.4142 3.41421L12.6213 4.20711L9.79289 1.37868L10.5858 0.585786Z",fill:o.color}),t.createElement("path",{d:"M8.37868 2.79289L0 11.1716V14H2.82842L11.2071 5.62132L8.37868 2.79289Z",fill:o.color}))}),null),getEditableStyles:()=>["color","lineWidth","opacity"],onDrawStart:t=>{const e=parseInt(t.style.lineWidth),o=Jt(e,e,t.style.opacity);o.style.overflow="visible";const n=_t(e/2,t.style.color);o.appendChild(n),t.container.div.appendChild(o),t.element=o},onDrawing:(t,{viewContainer:e})=>{j(t);const o=D(t),n=Jt(o.width,o.height,t.style.opacity);n.style.overflow="visible";const r=function(t,e){const o=Gt(t.style);return o.setAttribute("d",function(t,e){let o="";for(let n=0;n<t.coords.length;n++){o+=ce(C(t.coords[n],t.container,e),n),n!==t.coords.length-1&&(o+=" ")}return o}(t,e)),o}(t,e);n.appendChild(r),t.container.div.innerHTML="",t.container.div.appendChild(n),t.element=n},onDrawEnd:(t,e)=>{ft(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize:(t,e)=>{t.element&&M(t.element,t.container.bounds)},onUndo(t,e){if("create"===t.action)return ht(t,e);if("color"===t.action)return Mt(t,e);if("lineWidth"===t.action)return It(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return wt(t,e);if("color"===t.action)return Mt(t,e);if("lineWidth"===t.action)return It(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("unsupported action:",t),new Error},onUpdateStyle(t,e,o,n){if("color"===o)return lt(t,n);if("lineWidth"===o)return oe(t,n);if("opacity"===o)return re(t,n);throw console.log(o,n,t),new Error("unknown update style action")},cursor:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjU4NTggMC41ODU3ODZDMTEuMzY2OCAtMC4xOTUyNjIgMTIuNjMzMiAtMC4xOTUyNjIgMTMuNDE0MiAwLjU4NTc4NkMxNC4xOTUzIDEuMzY2ODMgMTQuMTk1MyAyLjYzMzE2IDEzLjQxNDIgMy40MTQyMUwxMi42MjEzIDQuMjA3MTFMOS43OTI4OSAxLjM3ODY4TDEwLjU4NTggMC41ODU3ODZaIiBmaWxsPSIjMTExODI3Ii8+CjxwYXRoIGQ9Ik04LjM3ODY4IDIuNzkyODlMMCAxMS4xNzE2VjE0SDIuODI4NDJMMTEuMjA3MSA1LjYyMTMyTDguMzc4NjggMi43OTI4OVoiIGZpbGw9IiMxMTE4MjciLz4KPC9zdmc+') 0 16, pointer"};function ce(t,e){return 0===e?`M ${t[0]} ${t[1]}`:`L ${t[0]} ${t[1]}`}function le(t,e){const o=t.data,n=[];for(const t of o){const o=Z(e.objectsMap,t.objectId),{bounds:r,div:i}=o.container,{left:c,top:l}=t;n.push({objectId:t.objectId,top:r.top,left:r.left}),r.top=l,r.left=c,i.style.left=c+"px",i.style.top=l+"px",ot(o,e)}return t.data=n,t}function se(t,e){const o=t.data,n=[];for(const t of o){const o=Z(e.objectsMap,t.objectId),{div:r}=o.container,i=Ut(r);n.push({objectId:t.objectId,rotate:i}),r.style.transform=`rotate(${t.rotate}deg)`,ot(o,e)}return t.data=n,t}function ae(t,e){const o=Z(e.objectsMap,t.objectId),n=t.data,r=o.container.bounds,i=Object.assign({},r);var c,l;c=o.container.div,l=n.bounds,c.style.left=l.left+"px",c.style.top=l.top+"px",c.style.width=l.right-l.left+"px",c.style.height=l.bottom-l.top+"px",o.container.bounds=n.bounds;return R(e.drawingTools,o.toolId).onResize(o,Object.assign(Object.assign({},e),{previousPoint:[r.left,r.top],newPoint:[n.bounds.left,n.bounds.top]})),t.data.bounds=i,t}const de={tooltip:"Select tool",icon:t.createElement((function(e){const o=T(e);return t.createElement("svg",Object.assign({},o,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M5.67175 0.911473C5.52881 0.378007 4.98047 0.0614245 4.44701 0.204366C3.91354 0.347308 3.59696 0.895645 3.7399 1.42911L3.99872 2.39504C4.14166 2.9285 4.69 3.24509 5.22346 3.10214C5.75693 2.9592 6.07351 2.41086 5.93057 1.8774L5.67175 0.911473Z",fill:o.color}),t.createElement("path",{d:"M1.42911 3.7399C0.895645 3.59696 0.347308 3.91354 0.204366 4.44701C0.0614245 4.98047 0.378007 5.52881 0.911473 5.67175L1.8774 5.93057C2.41086 6.07351 2.9592 5.75693 3.10214 5.22346C3.24509 4.69 2.9285 4.14166 2.39504 3.99872L1.42911 3.7399Z",fill:o.color}),t.createElement("path",{d:"M10.2426 3.17149C10.6331 2.78097 10.6331 2.1478 10.2426 1.75728C9.85204 1.36676 9.21887 1.36676 8.82835 1.75728L8.12124 2.46439C7.73072 2.85491 7.73072 3.48808 8.12124 3.8786C8.51177 4.26912 9.14493 4.26912 9.53545 3.8786L10.2426 3.17149Z",fill:o.color}),t.createElement("path",{d:"M3.17149 10.2426L3.8786 9.53546C4.26912 9.14493 4.26912 8.51177 3.8786 8.12124C3.48808 7.73072 2.85491 7.73072 2.46439 8.12124L1.75728 8.82835C1.36676 9.21887 1.36676 9.85204 1.75728 10.2426C2.1478 10.6331 2.78097 10.6331 3.17149 10.2426Z",fill:o.color}),t.createElement("path",{d:"M6.37142 5.07152C6 4.92295 5.57578 5.01002 5.29292 5.29289C5.01006 5.57575 4.92298 5.99997 5.07155 6.37138L9.07155 16.3714C9.2178 16.737 9.56502 16.9828 9.95847 16.9991C10.3519 17.0155 10.7183 16.7994 10.8945 16.4472L12.274 13.6882L15.2929 16.7071C15.6834 17.0976 16.3166 17.0976 16.7071 16.7071C17.0977 16.3166 17.0977 15.6834 16.7071 15.2929L13.6882 12.2739L16.4472 10.8944C16.7995 10.7183 17.0155 10.3519 16.9992 9.95843C16.9828 9.56498 16.737 9.21777 16.3714 9.07152L6.37142 5.07152Z",fill:o.color}))}),{style:{transform:"translate(-2px, -1px)"}}),id:d,onDrawStart:t=>{t.container.div.style.border=`1px solid ${u.main}`,t.container.div.style.backgroundColor=u.light+"4d"},onDrawing:(t,e)=>{I(t),t.coords.splice(1),function(t,e){var o,n;const r=null!==(n=null===(o=e.lastEvent)||void 0===o?void 0:o.shiftKey)&&void 0!==n&&n,i=[...e.fullState[d].selectedIds];let c=function(t,e,o){const n=[];for(const[r,i]of t.entries())W(i,o),L(e,i.container.bounds)&&n.push(r);return n}(e.objectsMap,t.container.bounds,e);r&&(c=new Array(...new Set([...c,...i])));fe(e,c)}(t,e)},onDrawEnd:(t,e)=>{const{objectsMap:o,viewContainer:n}=e;n.removeChild(t.container.div),o.delete(t.container.id),V('[id^="react-draw-cursor"',e.viewContainer),ue(t,e)},onResize:t=>{},onUnMount(t){for(const e of Object.values(t.objectsMap))W(e,t)},onUnPickTool(t){const e=t.fullState[d],o=e.selectedIds;if(0===o.length)return;Zt(et(o,t.objectsMap),t),e.selectedIds=[]},onKeyPress(t,e){if(!("Delete"===t.key))return;const o=e.fullState[d].selectedIds;if(o.length<1)return;gt(mt({toolId:d,toolType:"top-bar-tool",objectId:"",data:[...o],action:"delete"},e),e)},onUndo(t,e){const o=t.action;if("delete"===o)return bt(t,e);if("create"===o)return mt(t,e);if("drag"===o)return le(t,e);if("rotate"===o)return se(t,e);if("resize"===o)return ae(t,e);throw console.log("unsupported action",t),new Error},onRedo(t,e){const o=t.action;if("delete"===o)return bt(t,e);if("create"===o)return mt(t,e);if("drag"===o)return le(t,e);if("rotate"===o)return se(t,e);if("resize"===o)return ae(t,e);throw console.log("unsupported action",t),new Error}},ue=(t,e)=>{var o,n;const r=null!==(n=null===(o=e.lastEvent)||void 0===o?void 0:o.shiftKey)&&void 0!==n&&n,i=t.coords[0],c=t.coords[t.coords.length-1];if(l=c,s=i,Math.sqrt(Math.pow(Math.abs(l[0]-s[0]),2)+Math.pow(Math.abs(l[1]-s[1]),2))<75){const t=function(t,e){let{top:o,right:n,bottom:r,left:i}=t;const[c,l]=e;return l>r?r=l:l<o&&(o=l),c<i?i=c:c>n&&(n=c),{top:o,right:n,bottom:r,left:i}}(S(i),c);pe(e,t,r)}var l,s},pe=(t,e,o)=>{const n=function(t,e){var o;let n=null;for(const[r,i]of t.entries()){const t=parseInt(i.style.zIndex);L(i.container.bounds,e)&&(null!==(o=null==n?void 0:n.style.zIndex)&&void 0!==o?o:0<t)&&(n=i)}return n}(t.objectsMap,e);let{ids:r}=function(t){const e=[...t.fullState[d].selectedIds],{objectsMap:o,prevMousePosition:n}=t,r=et(e,o);if(Zt(r,t),1===r.length){const e=R(t.drawingTools,r[0].toolId);e&&t&&e.onUnSelect&&e.onUnSelect(r[0],t)}return n.current=null,{ids:e.splice(0,e.length),objects:r}}(t);return o||(r=[]),null!==n&&(r=r.concat([n.container.id])),fe(t,r),r};function fe(t,e){t.fullState[d].selectedIds=e;const o=et(e,t.objectsMap);return 1===o.length?(function(t,e,o){const n=R(t,e.toolId);n&&o&&n.onSelect&&n.onSelect(e,o)}(t.drawingTools,o[0],t),Bt(o[0],t)):o.length>1?Rt(o,t):void 0}const he={id:"react-draw-square-tool",tooltip:"Square Tool",icon:t.createElement((function(e){const o=T(e);return t.createElement("svg",Object.assign({},o,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("rect",{width:"16",height:"16",rx:"1",fill:o.color}))}),null),getEditableStyles:()=>["color","background","lineWidth","opacity"],onDrawStart:t=>{const e=function(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=`${t.lineWidth}px solid ${t.color}`,e.style.borderRadius="2px",e.style.boxSizing="border-box",e.style.backgroundColor=t.background,e.style.opacity=t.opacity,e}(t.style);t.container.div.appendChild(e),t.element=e},onDrawing:t=>{I(t),t.coords.splice(1)},onDrawEnd(t,e){ft(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onUndo(t,e){if("create"===t.action)return ht(t,e);if("color"===t.action)return xt(t,e);if("background"===t.action)return Et(t,e);if("lineWidth"===t.action)return vt(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return wt(t,e);if("color"===t.action)return xt(t,e);if("background"===t.action)return Et(t,e);if("lineWidth"===t.action)return vt(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("unsupported action:",t),new Error},onResize(t,e){},onUpdateStyle(t,e,o,n){if("color"===o)return dt(t,n);if("background"===o)return st(t,n);if("lineWidth"===o)return ee(t,n);if("opacity"===o)return re(t,n);throw console.log(o,n,t),new Error("unknown update style action")}};const we={id:"react-draw-circle-tool",tooltip:"Circle tool",icon:t.createElement((function(e){const o=T(e);return t.createElement("svg",Object.assign({},o,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("circle",{cx:"8",cy:"8",r:"8",fill:o.color}))}),null),getEditableStyles:()=>["color","background","lineWidth","opacity"],onDrawStart:t=>{const e=function(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=ut(t),e.style.backgroundColor=t.background,e.style.borderRadius="50%",e.style.boxSizing="border-box",e.style.opacity=t.opacity,e}(t.style);t.container.div.appendChild(e),t.element=e},onDrawing:t=>{I(t),t.coords.splice(1)},onDrawEnd(t,e){ft(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){},onUndo(t,e){if("create"===t.action)return ht(t,e);if("color"===t.action)return xt(t,e);if("background"===t.action)return Et(t,e);if("lineWidth"===t.action)return vt(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return wt(t,e);if("color"===t.action)return xt(t,e);if("background"===t.action)return Et(t,e);if("lineWidth"===t.action)return vt(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("unsupported action:",t),new Error},onUpdateStyle(t,e,o,n){if("color"===o)return dt(t,n);if("background"===o)return st(t,n);if("lineWidth"===o)return ee(t,n);if("opacity"===o)return re(t,n);throw console.log(o,n,t),new Error("unknown update style action")}};const ge={id:"react-draw-diamond-tool",tooltip:"Diamond tool",icon:t.createElement((function(e){const o=T(e);return t.createElement("svg",Object.assign({},o,{viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("rect",{x:"11",y:"-0.313721",width:"16",height:"16",rx:"1",transform:"rotate(45 11 -0.313721)",fill:o.color}))}),null),getEditableStyles:()=>["color","background","lineWidth","opacity"],onDrawStart:t=>{const e=t.container.div,o=be(t);e.appendChild(o)},onDrawing:t=>{I(t);const e=t.container.div,o=be(t);e.innerHTML="",e.appendChild(o),t.element=o,t.coords.splice(1)},onDrawEnd(t,e){ft(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){M(t.element,t.container.bounds)},onUndo(t,e){if("create"===t.action)return ht(t,e);if("color"===t.action)return Mt(t,e);if("background"===t.action)return Ct(t,e);if("lineWidth"===t.action)return It(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return wt(t,e);if("color"===t.action)return Mt(t,e);if("background"===t.action)return Ct(t,e);if("lineWidth"===t.action)return It(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("Unsupported action: ",t),new Error},onUpdateStyle(t,e,o,n){if("color"===o)return lt(t,n);if("background"===o)return function(t,e){return ct(t,"background","fill",e)}(t,n);if("lineWidth"===o)return oe(t,n);if("opacity"===o)return re(t,n);throw console.log(o,n,t),new Error("unknown update style action")}};function be(t){const e=parseInt(t.style.lineWidth),{bounds:o}=t.container,n=Jt(o.right-o.left+e,o.bottom-o.top+e,t.style.opacity),r=function(t,e){const o=Gt(e),n=parseInt(e.lineWidth);return o.setAttribute("d",function(t,e){const o=t.bottom-t.top,n=t.right-t.left,r=`${e/2} ${o/2}`;return`M ${r} L ${n/2} ${e/2} L ${n-e/2} ${o/2} L ${n/2} ${o-e/2} L ${r}`}(t,n)),o}(o,t.style);return n.appendChild(r),n}function me(t,e){const[o,n]=t,[r,i]=e;return r===o?i>n?"down":"up":i===n?r>o?"right":"left":r<o&&i<n?"nw":r>o&&i<n?"ne":r>o&&i>n?"se":"sw"}function ye(t,e,o){return"right"===o?[[0,0],[t,0]]:"left"===o?[[t,0],[0,0]]:"down"===o?[[0,0],[0,e]]:"up"===o?[[0,e],[0,0]]:"nw"===o?[[t,e],[0,0]]:"ne"===o?[[0,e],[t,0]]:"se"===o?[[0,0],[t,e]]:[[t,0],[0,e]]}const ve={id:"react-draw-line-tool",tooltip:"Straight Line Tool",icon:t.createElement((function(e){const o=T(e);return t.createElement("svg",Object.assign({},o,{viewBox:"0 0 24 3",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("line",{y1:"1.5",x2:"24",y2:"1.5",stroke:"black",strokeWidth:"3"}))}),null),getEditableStyles:()=>["color","lineWidth","opacity"],onDrawStart:t=>{const e=t.container.div,o=parseInt(t.style.lineWidth),n=Jt(o,o,t.style.opacity),r=_t(o/2,t.style.color);n.appendChild(r),e.append(n),t.element=n},onDrawing:(t,e)=>{I(t);const o=me(t.coords[0],t.coords[t.coords.length-1]);t.customData.set("orientation",o);const n=Ee(t,o),r=t.container.div;r.innerHTML="",r.appendChild(n),t.element=n,t.coords.splice(1)},onDrawEnd(t,e){ft(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){const o=t.customData.get("orientation");if(!o)throw new Error("orientation not set");const n=Ee(t,o),r=t.container.div;r.removeChild(t.element),r.appendChild(n),t.element=n,t.coords.splice(1)},onUndo(t,e){if("create"===t.action)return ht(t,e);if("color"===t.action)return Mt(t,e);if("lineWidth"===t.action)return It(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return wt(t,e);if("color"===t.action)return Mt(t,e);if("lineWidth"===t.action)return It(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("unsupported action:",t),new Error},onUpdateStyle(t,e,o,n){if("color"===o)return lt(t,n);if("lineWidth"===o)return oe(t,n);if("opacity"===o)return re(t,n);throw console.log(o,n,t),new Error("unknown update style action")}};function Ee(t,e){const{bounds:o}=t.container,n=o.right-o.left,r=o.bottom-o.top,i=Jt(n,r,t.style.opacity);i.style.overflow="visible";const[c,l]=ye(n,r,e),s=function(t){const e=document.createElementNS("http://www.w3.org/2000/svg","line");return e.setAttribute("fill","transparent"),e.setAttribute("stroke",t.color),e.style.strokeWidth=`${t.lineWidth}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}(t.style);return s.setAttribute("x1",c[0].toString()),s.setAttribute("y1",c[1].toString()),s.setAttribute("x2",l[0].toString()),s.setAttribute("y2",l[1].toString()),i.appendChild(s),i}const xe={icon:t.createElement("span",{style:{display:"inline-block",fontWeight:"bold",fontSize:"20px"}},"A"),id:"react-draw-textarea-tool",tooltip:"Textarea Tool",cursor:"text",getEditableStyles:()=>["color","background","fontSize","opacity"],onDrawStart:(t,e)=>{!function(t,e){const o=12,n=5,{div:r,bounds:i}=t.container;i.bottom=i.top+o+n,r.style.height="",r.style.minHeight=i.bottom-i.top+"px",r.style.minWidth=r.style.width,r.style.width="",r.style.border="1px solid black",r.style.backgroundColor=t.style.background,r.style.padding=n+"px",r.style.borderRadius="2px",r.style.boxSizing="border-box",r.style.color=t.style.color,r.style.fontSize=`${t.style.fontSize}px`;const c=document.createElement("style");c.innerHTML="\n\t.react-draw-cursor {\n\t\toutline: none;\t\t\n\t\theight: 100%;\n\t}",r.appendChild(c);const l=function(){const t=document.createElement("div");return t.setAttribute("contenteditable","true"),t.style.minWidth="1px",t.style.height="100%",t.className="react-draw-cursor",t}();function s(){const t=r.getBoundingClientRect(),{width:e,height:o}=t;i.bottom=i.top+o,i.right=i.left+e}l.style.opacity=t.style.opacity,t.element=l,t.customData.set("handler",s),l.addEventListener("keypress",s),r.appendChild(l),Se(r,i),l.setAttribute("tabindex","1"),function(t,e){const o=t.element,n=t.customData;function r(o){const r=(new Date).getTime(),i=n.get("lastCapture");if(i){if(r-i>5e3){const n=o.target;gt({toolId:t.toolId,action:"input",data:n.innerHTML,toolType:"top-bar-tool",objectId:t.container.id},e)}}else{gt({toolId:t.toolId,action:"input",data:"",toolType:"top-bar-tool",objectId:t.container.id},e)}n.set("lastCapture",r)}o.addEventListener("input",r),n.set("capture",r)}(t,e),setTimeout((function(){l.focus()}),0)}(t,e)},onDrawing(t,e){},onDrawEnd(t,e){ft(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){Le(t,!1),De(t.element)},onSelect(t,e){Le(t,!1),De(t.element)},onUnSelect(t){Le(t,!1),Se(t.container.div,t.container.bounds)},onAfterUpdate(t,e){Le(t,!1),De(t.element)},onUndo(t,e){if("create"===t.action)return ht(t,e);if("input"===t.action)return Me(t,e);if("color"===t.action)return Ce(t,e);if("background"===t.action)return je(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return wt(t,e);if("input"===t.action)return Me(t,e);if("color"===t.action)return Ce(t,e);if("background"===t.action)return je(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("unsupported action:",t),new Error},onDeleteObject(t,e){Le(t,!0)},onUpdateStyle(t,e,o,n){if("color"===o)return function(t,e){return pt(t,"color","color",e)}(t,n);if("background"===o)return function(t,e){return pt(t,"background","backgroundColor",e)}(t,n);if("opacity"===o)return re(t,n);throw console.log(o,n,t),new Error("unknown update style action")}};function Me(t,e){const o=Z(e.objectsMap,t.objectId).element;if(!o)throw new Error("tried to undo text but no ele found");const n=o.innerHTML,r=t.data;return o.innerHTML=r,t.data=n,t}function Ce(t,e){return Ie(t,e,"color","color")}function je(t,e){return Ie(t,e,"background","backgroundColor")}function Ie(t,e,o,n){const r=Z(e.objectsMap,t.objectId),i=r.style[o],c=t.data;return r.style[o]=c,r.container.div.style[n]=c,t.data=i,t}function Le(t,e){const o=t.element;if(!o)return;const n=t.customData.get("handler");n&&(o.removeEventListener("keypress",n),t.customData.delete("handler"));const r=t.customData.get("capture");e&&r&&(o.removeEventListener("input",r),t.customData.delete("capture"))}function Se(t,e){const o=t.getBoundingClientRect(),{width:n,height:r}=o;e.bottom=e.top+r,e.right=e.left+n}function De(t){if(t.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);const o=window.getSelection();if(o)return o.removeAllRanges(),o.addRange(e),!0}return console.error("cannot place caret at end"),!1}const ke={icon:t.createElement((function(e){const o=T(e),{color:n}=o,r=k(o,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M10.0616 0.586573L5.31159 5.33657L0.581585 10.1766C0.209084 10.5513 0 11.0582 0 11.5866C0 12.1149 0.209084 12.6218 0.581585 12.9966L4.88159 17.2966C5.06785 17.4813 5.31925 17.5855 5.58159 17.5866H17.5816V15.5866H10.5816L17.8016 8.36657C17.9875 8.18083 18.1351 7.96025 18.2357 7.71745C18.3364 7.47466 18.3882 7.2144 18.3882 6.95157C18.3882 6.68874 18.3364 6.42849 18.2357 6.18569C18.1351 5.9429 17.9875 5.72232 17.8016 5.53657L12.8916 0.586573C12.7058 0.40062 12.4853 0.253102 12.2425 0.152454C11.9997 0.0518053 11.7394 0 11.4766 0C11.2138 0 10.9535 0.0518053 10.7107 0.152454C10.4679 0.253102 10.2473 0.40062 10.0616 0.586573V0.586573ZM5.99159 15.5866L1.99159 11.5866L6.74159 6.74657L7.48159 5.99657L12.4316 10.9466L7.87159 15.5066L7.80159 15.5866H5.99159Z",fill:n}))}),null),tooltip:"Eraser tool",id:a,cursor:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOSAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjA2MTYgMC41ODY1NzNMNS4zMTE1OSA1LjMzNjU3TDAuNTgxNTg1IDEwLjE3NjZDMC4yMDkwODQgMTAuNTUxMyAwIDExLjA1ODIgMCAxMS41ODY2QzAgMTIuMTE0OSAwLjIwOTA4NCAxMi42MjE4IDAuNTgxNTg1IDEyLjk5NjZMNC44ODE1OSAxNy4yOTY2QzUuMDY3ODUgMTcuNDgxMyA1LjMxOTI1IDE3LjU4NTUgNS41ODE1OSAxNy41ODY2SDE3LjU4MTZWMTUuNTg2NkgxMC41ODE2TDE3LjgwMTYgOC4zNjY1N0MxNy45ODc1IDguMTgwODMgMTguMTM1MSA3Ljk2MDI1IDE4LjIzNTcgNy43MTc0NUMxOC4zMzY0IDcuNDc0NjYgMTguMzg4MiA3LjIxNDQgMTguMzg4MiA2Ljk1MTU3QzE4LjM4ODIgNi42ODg3NCAxOC4zMzY0IDYuNDI4NDkgMTguMjM1NyA2LjE4NTY5QzE4LjEzNTEgNS45NDI5IDE3Ljk4NzUgNS43MjIzMiAxNy44MDE2IDUuNTM2NTdMMTIuODkxNiAwLjU4NjU3M0MxMi43MDU4IDAuNDAwNjIgMTIuNDg1MyAwLjI1MzEwMiAxMi4yNDI1IDAuMTUyNDU0QzExLjk5OTcgMC4wNTE4MDUzIDExLjczOTQgMCAxMS40NzY2IDBDMTEuMjEzOCAwIDEwLjk1MzUgMC4wNTE4MDUzIDEwLjcxMDcgMC4xNTI0NTRDMTAuNDY3OSAwLjI1MzEwMiAxMC4yNDczIDAuNDAwNjIgMTAuMDYxNiAwLjU4NjU3M1YwLjU4NjU3M1pNNS45OTE1OSAxNS41ODY2TDEuOTkxNTkgMTEuNTg2Nkw2Ljc0MTU5IDYuNzQ2NTdMNy40ODE1OSA1Ljk5NjU3TDEyLjQzMTYgMTAuOTQ2Nkw3Ljg3MTU5IDE1LjUwNjZMNy44MDE1OSAxNS41ODY2SDUuOTkxNTlaIiBmaWxsPSJibGFjayI+PC9wYXRoPgo8L3N2Zz4=') 0 16, pointer",onDrawStart(t,e){},onDrawing(t,e){const o=e.viewContainer;j(t);const n=D(t),r=Jt(n.width,n.height,"1"),i=function(t,e){const o=Gt(t.style);return o.style.strokeWidth="10px",o.setAttribute("d",function(t,e){let o="",n=t.coords[0];for(let r=0;r<t.coords.length;r++){const i=C(t.coords[r],t.container,e);o+=Oe(i,n,r),n=i,r!==t.coords.length-1&&(o+=" ")}return o}(t,e)),o.setAttribute("stroke","rgba(232, 16, 84, 0.142)"),o}(t,o);r.appendChild(i),t.container.div.innerHTML="",t.container.div.appendChild(r),t.element=r;const c=S(t.coords[t.coords.length-1]),l=e.objectsMap.keys();for(const t of l){const o=e.objectsMap.get(t);o&&(L(o.container.bounds,c)&&(H(t,e),Te(e,o)))}},onDrawEnd(t,e){const{objectsMap:o,viewContainer:n}=e;n.removeChild(t.container.div),o.delete(t.container.id),V('[id^="react-draw-erase-tool"',e.viewContainer);if(e.fullState[a].deletedObjects.size>0){const o={toolId:t.toolId,toolType:"top-bar-tool",objectId:"",action:"delete",data:e.fullState[a].deletedObjects};e.fullState[a].deletedObjects=new Map,gt(o,e)}},onUndo(t,e){if("delete"===t.action)return bt(t,e);throw console.error("unrecognized action",t),new Error},onRedo(t,e){if("create"===t.action)return mt(t,e);throw console.error("unrecognized action",t),new Error},onResize(t,e){}};function Te(t,e){t.fullState[a].deletedObjects.set(e.container.id,e)}function Oe(t,e,o){return 0===o?`M ${t[0]} ${t[1]}`:`l ${t[0]-e[0]} ${t[1]-e[1]}`}const Ae={id:"react-draw-undo-tool",tooltip:"Undo",icon:t.createElement((function(e){const o=T(e),{color:n}=o,r=k(o,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M8.4345 1.3088e-05C6.17654 0.00387579 4.12643 0.851527 2.61286 2.2295L1.39599 1.07024C0.88081 0.57945 0 0.927028 0 1.62108V5.97259C0 6.40284 0.36611 6.75162 0.817742 6.75162H5.38548C6.11402 6.75162 6.47887 5.91251 5.96372 5.42172L4.54119 4.06653C5.59281 3.12847 6.95357 2.60886 8.39923 2.59698C11.5475 2.57108 14.2012 4.99825 14.174 8.09701C14.1482 11.0366 11.6466 13.5032 8.45 13.5032C7.0487 13.5032 5.7243 13.0268 4.68055 12.1543C4.51894 12.0193 4.27488 12.0275 4.12285 12.1723L2.77146 13.4597C2.60546 13.6178 2.61367 13.8757 2.78789 14.0256C4.28626 15.3149 6.27188 16.1 8.45 16.1C13.1168 16.1 16.9 12.4959 16.9 8.05007C16.9 3.6093 13.0959 -0.00793953 8.4345 1.3088e-05Z",fill:n}))}),null),getDisplayMode:t=>t.undoStack.length>0?"show":"disabled",handleContext(t){const e=t.undoStack.pop();if(e){if("top-bar-tool"===e.toolType){const o=R(t.drawingTools,e.toolId);if(o.onUndo){const n=o.onUndo(e,t);t.shouldKeepHistory&&t.redoStack.push(n)}}if("batch"===e.toolType){const o=e.data,n=[];for(const e of o){const o=R(t.drawingTools,e.toolId);o.onUndo&&n.push(o.onUndo(e,t))}e.data=n,t.shouldKeepHistory&&t.redoStack.push(e)}}}},Ne={id:"react-draw-redo-tool",tooltip:"Redo",icon:t.createElement((function(e){const o=T(e),{color:n}=o,r=k(o,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M8.28183 1.34403e-05C10.4908 0.0039801 12.4964 0.874446 13.9771 2.28951L15.1676 1.09901C15.6716 0.595046 16.5333 0.951979 16.5333 1.66471V6.13334C16.5333 6.57517 16.1752 6.93334 15.7333 6.93334H11.2647C10.552 6.93334 10.195 6.07164 10.699 5.56764L12.0907 4.17598C11.0619 3.21268 9.73063 2.67908 8.31633 2.66688C5.2364 2.64028 2.64023 5.13278 2.66687 8.31494C2.69213 11.3336 5.13947 13.8667 8.26667 13.8667C9.63757 13.8667 10.9332 13.3774 11.9543 12.4815C12.1124 12.3428 12.3512 12.3512 12.4999 12.4999L13.822 13.822C13.9844 13.9844 13.9763 14.2491 13.8059 14.4031C12.3401 15.7271 10.3975 16.5333 8.26667 16.5333C3.70113 16.5333 3.33336e-05 12.8322 2.23918e-10 8.26674C-3.33331e-05 3.70644 3.72153 -0.00815322 8.28183 1.34403e-05Z",fill:n}))}),null),getDisplayMode:t=>t.redoStack.length>0?"show":"disabled",handleContext(t){const e=t.redoStack.pop();if(e)if("top-bar-tool"===e.toolType){const o=R(t.drawingTools,e.toolId);if(o.onRedo){const n=o.onRedo(e,t);t.shouldKeepHistory&&t.undoStack.push(n)}}else if("batch"===e.toolType){const o=e.data,n=[];for(const e of o){const o=R(t.drawingTools,e.toolId);o.onRedo&&n.push(o.onRedo(e,t))}e.data=n,t.shouldKeepHistory&&t.undoStack.push(e)}}},ze={id:"react-draw-trash-tool",icon:t.createElement((function(e){const o=T(e),{color:n}=o,r=k(o,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 14 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0C5.62123 0 5.27497 0.214002 5.10557 0.552786L4.38197 2H1C0.447715 2 0 2.44772 0 3C0 3.55228 0.447716 4 1 4L1 14C1 15.1046 1.89543 16 3 16H11C12.1046 16 13 15.1046 13 14V4C13.5523 4 14 3.55228 14 3C14 2.44772 13.5523 2 13 2H9.61804L8.89443 0.552786C8.72504 0.214002 8.37877 0 8 0H6ZM4 6C4 5.44772 4.44772 5 5 5C5.55228 5 6 5.44772 6 6V12C6 12.5523 5.55228 13 5 13C4.44772 13 4 12.5523 4 12V6ZM9 5C8.44771 5 8 5.44772 8 6V12C8 12.5523 8.44771 13 9 13C9.55229 13 10 12.5523 10 12V6C10 5.44772 9.55229 5 9 5Z",fill:n}))}),null),tooltip:"Delete selected objects",getDisplayMode:t=>Vt(t).length>0?"show":"disabled",handleContext(t){const e=Vt(t);if(e.length<1)return;gt(mt({toolId:d,toolType:"top-bar-tool",objectId:"",data:[...e],action:"delete"},t),t)}},Ue={id:"react-draw-duplicate-tool",tooltip:"Duplicate objects",icon:t.createElement((function(e){const o=T(e),{color:n}=o,r=k(o,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M4 6C4 4.89543 4.89543 4 6 4H12C13.1046 4 14 4.89543 14 6V12C14 13.1046 13.1046 14 12 14H6C4.89543 14 4 13.1046 4 12V6Z",fill:n}),t.createElement("path",{d:"M2 0C0.895431 0 0 0.89543 0 2V8C0 9.10457 0.89543 10 2 10L2 2H10C10 0.895431 9.10457 0 8 0H2Z",fill:n}))}),null),getDisplayMode:t=>Vt(t).length>0?"show":"disabled",handleContext(t){const e=Vt(t);if(e.length<1)return;const o=e.map((e=>Z(t.objectsMap,e)));Zt(o,t);const n=o.map((e=>function(t,e){const{div:o,id:n,bounds:r}=t.container,i=o.cloneNode(!0),{newId:c,divId:l}=function(t){const e=v(6),o=t.split("-");return o[o.length-1]=v(6),{divId:o.join("-"),newId:e}}(o.id);i.id=l;const s={coords:t.coords.slice(0),toolId:t.toolId,element:i.lastElementChild,style:Object.assign({},t.style),customData:new Map(t.customData),container:{bounds:{top:r.top+10,left:r.left+10,bottom:r.bottom+10,right:r.right+10},div:i,id:c}};i.style.top=s.container.bounds.top+"px",i.style.left=s.container.bounds.left+"px";const a=R(e.drawingTools,t.toolId);if(a.onDuplicate)return a.onDuplicate(s,e);return s}(e,t))),r=new Map;gt(bt({toolId:d,objectId:"",toolType:"top-bar-tool",action:"delete",data:n.reduce(((t,e)=>(t.set(e.container.id,e),t)),r)},t),t),1===e.length?Bt(n[0],t):Rt(n,t);t.fullState[d].selectedIds=n.map((t=>t.container.id))}};const $e={id:"react-draw-back-tool",icon:t.createElement((function(e){const o=T(e),{color:n}=o,r=k(o,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M15 17L5 9L15 1V17Z",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),t.createElement("path",{d:"M1 16V2",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}),null),tooltip:"Move object back",getDisplayMode:t=>Vt(t).length>0?"show":"disabled",handleContext(t){const e=Vt(t);if(e.length<1)return;const o=e.map((e=>Z(t.objectsMap,e)));let n=1/0;for(const e of t.objectsMap.values()){const t=We(e);t<n&&(n=t)}o.forEach((t=>{t.container.div.style.zIndex=n.toString(),t.style.zIndex=n.toString()}))}};function We(t){const e=parseInt(t.style.zIndex);return t.container.div.style.zIndex=(e+1).toString(),t.style.zIndex=(e+1).toString(),e}const Pe={id:"react-draw-forward-tool",tooltip:"Move object forward",icon:t.createElement((function(e){const o=T(e),{color:n}=o,r=k(o,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M1 1L11 9L1 17V1Z",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),t.createElement("path",{d:"M15 2V16",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}),null),getDisplayMode:t=>Vt(t).length>0?"show":"disabled",handleContext(t){const e=Vt(t);if(e.length<1)return;const o=e.map((e=>Z(t.objectsMap,e)));let n=-1/0;for(const e of t.objectsMap.values()){const t=Re(e);t>n&&(n=t)}o.forEach((t=>{t.container.div.style.zIndex=n.toString(),t.style.zIndex=n.toString()}))}};function Re(t){const e=parseInt(t.style.zIndex);return t.container.div.style.zIndex=(e-1).toString(),t.style.zIndex=(e-1).toString(),e}function He({onUpdate:e,styleKey:n,label:r,styleValue:i}){const c=o(v(5));return t.createElement("div",null,t.createElement("div",{style:{textAlign:"left",marginBottom:5}},t.createElement("label",{style:{fontWeight:"bold"},htmlFor:c.current},r)),t.createElement("div",{style:{display:"flex"}},t.createElement("span",{style:{display:"inline-block",borderRadius:5,width:30,height:30,backgroundColor:i}}),t.createElement("div",{style:{marginLeft:10,display:"flex"}},t.createElement("span",{style:{borderRadius:"5px 0px 0px 5px",width:30,padding:5,fontWeight:"bold",fontSize:18,textAlign:"center",color:"grey",backgroundColor:"lightgray"}},"#"),t.createElement("input",{id:c.current,value:i.replace("#",""),onChange:t=>{const o=t.target.value;e(n,"transparent"===o?o:"#"+o)},style:{width:80,borderRadius:"0px 5px 5px 0px"}}))))}const Ze=e=>t.createElement(He,Object.assign({},e,{label:"color"})),Be=e=>t.createElement(He,Object.assign({},e,{label:"background"}));function Ye({onUpdate:e,styleKey:n,styleValue:r}){const i=o(v(5));return t.createElement("div",null,t.createElement("div",{style:{textAlign:"left",marginBottom:5}},t.createElement("label",{style:{fontWeight:"bold"},htmlFor:i.current},"line width")),t.createElement("div",{style:{width:"100%"}},t.createElement("input",{id:i.current,value:r,onChange:t=>{const o=t.target.value;e(n,o)},type:"number",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",step:"1"})))}function Ve({onUpdate:e,styleKey:n,styleValue:r}){const i=o(v(5));return t.createElement("div",null,t.createElement("div",{style:{textAlign:"left",marginBottom:5}},t.createElement("label",{style:{fontWeight:"bold"},htmlFor:i.current},"opacity")),t.createElement("div",{style:{width:"100%"}},t.createElement("input",{id:i.current,value:r,onChange:t=>{const o=t.target.value;e(n,o)},type:"number",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",max:"1",step:"0.1"})))}const Ke={icon:t.createElement((function(e){const o=T(e);return t.createElement("svg",Object.assign({},o,{viewBox:"0 0 16 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.2929 0.292893C10.6834 -0.0976311 11.3166 -0.0976311 11.7071 0.292893L15.7071 4.29289C16.0976 4.68342 16.0976 5.31658 15.7071 5.70711L11.7071 9.70711C11.3166 10.0976 10.6834 10.0976 10.2929 9.70711C9.90237 9.31658 9.90237 8.68342 10.2929 8.29289L12.5858 6H1C0.447716 6 -2.41411e-08 5.55228 0 5C2.41411e-08 4.44772 0.447716 4 1 4H12.5858L10.2929 1.70711C9.90237 1.31658 9.90237 0.683418 10.2929 0.292893Z",fill:o.color}))}),null),id:"react-draw-arrow-tool",getEditableStyles:()=>["color","lineWidth","opacity"],onDrawStart:t=>{const e=t.container.div,o=parseInt(t.style.lineWidth),n=Jt(o,o,t.style.opacity),r=_t(o/2,t.style.color);n.appendChild(r),e.append(n),t.element=n},onDrawing:(t,{viewContainer:e})=>{I(t);const o=me(t.coords[0],t.coords[t.coords.length-1]);t.customData.set("orientation",o);const n=Qe(t,o),r=t.container.div;r.innerHTML="",r.appendChild(n),t.element=n,t.coords.splice(1)},onDrawEnd:(t,e)=>{ft(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){const o=t.customData.get("orientation");if(!o)throw new Error("orientation not set");const n=Qe(t,o),r=t.container.div;r.removeChild(t.element),r.appendChild(n),t.element=n,t.coords.splice(1)},onUndo(t,e){if("create"===t.action)return ht(t,e);if("color"===t.action)return Mt(t,e);if("lineWidth"===t.action)return It(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("Unsupported action: ",t),new Error},onRedo(t,e){if("delete"===t.action)return wt(t,e);if("color"===t.action)return Mt(t,e);if("lineWidth"===t.action)return It(t,e);if("opacity"===t.action)return yt(t,e);throw console.error("unsupported action:",t),new Error},onUpdateStyle(t,e,o,n){if("color"===o)return lt(t,n);if("lineWidth"===o)return oe(t,n);if("opacity"===o)return re(t,n);throw console.log(o,n,t),new Error("unknown update style action")}};function Qe(t,e){const o=parseInt(t.style.lineWidth),{bounds:n}=t.container,r=n.right-n.left,i=n.bottom-n.top,[c,l]=ye(r,i,e),s=Jt(r+o,i+o,t.style.opacity);s.style.overflow="visible";const a=function(t,e,o){const[n,r]=e,[i,c]=o,l=Gt(t.style),s=[n-i,r-c],[a,d]=s,u=Math.sqrt(a*a+d*d),p=[a/u,d/u],[f,h]=p,w=f*(Math.sqrt(3)/2)-.5*h,g=1*f/2+h*(Math.sqrt(3)/2),b=f*(Math.sqrt(3)/2)+.5*h,m=.5*-f+h*(Math.sqrt(3)/2),y=20,[v,E,x,M]=[-w*y,-g*y,-b*y,-m*y];return l.setAttribute("d",`M ${n} ${r} L ${i} ${c} L ${i-v} ${c-E} L ${i} ${c} L ${i-x} ${c-M}`),l}(t,c,l);return s.appendChild(a),s}export{Be as BackgroundStyle,Ze as ColorStyle,Ye as LineWidthStyle,Ve as OpacityStyle,Qt as ReactDraw,Ke as arrowTool,$e as bringBackTool,Pe as bringForwardTool,we as circleTool,ge as diamondTool,Ue as duplicateTool,ke as eraseTool,ie as freeDrawTool,Ne as redoTool,de as selectTool,he as squareTool,ve as straightLineTool,xe as textAreaTool,ze as trashTool,Ae as undoTool};
