import t,{forwardRef as e,createContext as n,useState as o,useContext as r,useRef as i,useEffect as s,useMemo as c,Children as l}from"react";function a(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{l(o.next(t))}catch(t){i(t)}}function c(t){try{l(o.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,c)}l((o=o.apply(t,e||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;const d={boxShadow:"#000000 0px 1px 3px 0px",borderRadius:4,display:"flex",flexDirection:"column",position:"relative",fontFamily:"sans-serif"};var u=e(function({children:e,layout:n,style:o},r){const i=function(t){return"default"===t?{width:500,height:500,maxWidth:"100%"}:"fit"===t?{maxWidth:"100%"}:{width:t.width,height:t.width}}(n);let s=Object.assign(Object.assign({},d),i);return void 0!==o&&(s=Object.assign(Object.assign({},s),o)),t.createElement("div",{style:s,ref:r},e)});const p={color:null,message:null,position:"top"},f=n([p,()=>{}]);function h({children:e}){const[n,r]=o(p);return t.createElement(f.Provider,{value:[n,t=>{r(t)}]},e)}function g(){const[t,e]=r(f);return[t,e]}const y="react-draw-erase-tool",v="react-draw-cursor",b="bottomBarContainer",m="toolIconWrapper",w="clearAllButton",x="alertMessageDialog",C="bottomToolButton",E="menuButton",M="menuContainer",D="topBarBontainer",j="originalBounds",I="orientation",S=450,k={primary:{light:"#bddefb",main:"#228be6"},grey:{light:"#ececec"}};function L(t,e){const n=t.startsWith(".")?t:`.${t}`;let o="",r=`${n} {`;const i=Object.entries(e);for(const[t,e]of i)if("string"==typeof e||"number"==typeof e)r+=" "+A(t,e);else if("object"==typeof e&&t.startsWith("@media"))o+=O(t,n,e);else if("object"==typeof e&&t.startsWith("@keyframes"))o+=T(t,e);else if("object"==typeof e&&t.trim().startsWith("*"))o+=L(n+" "+t.replace(/&/g,n),e);else{if("object"!=typeof e)throw console.error("Unrecognized value:",e),new Error;o+=L(t.replace(/&/g,n),e)}return o+=`${r} }`,o}function T(t,e){return`${t} { ${Object.entries(e).map(([t,e])=>L(t,e).replace(".","")).join("")} }`}function O(t,e,n){let o=`${t} { `;return o+=L(e,n),o+" }"}const z=new Set(["opacity","zIndex","fontWeight","lineHeight","flex"]);function A(t,e){return"string"==typeof e||z.has(t)?`${N(t)}: ${e};`:`${N(t)}: ${e}px;`}function N(t){return t.replace(/([a-z])([A-Z])/g,t=>t[0]+"-"+t[1].toLowerCase())}const H=t=>`@media only screen and (min-width: ${t}px)`,$=t=>`@media only screen and (max-width: ${t}px)`,R={display:"flex",cursor:"pointer",justifyContent:"center",alignItems:"center",border:"none",backgroundColor:"transparent",borderRadius:2,transition:"background-color 150ms ease-in-out",[H(S)]:{width:40,height:40},[$(S)]:{width:30,height:30},"&:hover":{backgroundColor:k.grey.light},'&[data-selected="true"]':{backgroundColor:`${k.primary.main} !important`},'&[data-selected="true"] > svg path':{fill:"white"}};var W={key:m,styles:R};const P={width:180,fontSize:16,display:"flex",justifyContent:"flex-start",alignItems:"center",borderRadius:5,cursor:"pointer",border:"none",padding:"7px 10px",backgroundColor:k.primary.light,"&:hover":{backgroundColor:k.primary.main}};var U={key:w,styles:P};var B={key:x,styles:{position:"absolute",whiteSpace:"nowrap",textAlign:"center",borderRadius:6,padding:"5px 10px",zIndex:1001,color:"white"}};const Z={display:"flex",backgroundColor:k.primary.light,zIndex:1e3,width:"100%",overflowX:"auto","*":{scrollbarWidth:"none",scrollbarColor:`${k.primary.main} #e2ecf5`},"&::-webkit-scrollbar":{height:10},"&::-webkit-scrollbar-track":{background:"#e2ecf5"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#035195",borderRadius:10,border:"3px none #ffffff"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:" #00294d"}};var Y={key:b,styles:Z};const V={display:"flex",cursor:"pointer",justifyContent:"center",alignItems:"center",border:"none",backgroundColor:"transparent",borderRadius:2,transition:"background-color 150ms ease-in-out",[H(S)]:{width:40,height:40},[$(S)]:{width:30,height:30},'&[data-mode="hide"]':{display:"none"},'&[data-disabled="true"]':{cursor:"not-allowed",backgroundColor:"white"},'&[data-disabled="true"] > svg path':{fill:"lightgrey",stroke:"lightgrey"},'&[data-disabled="false"]:hover':{backgroundColor:k.grey.light},'&[data-disabled="false"]':{display:"inline-block"}};var K={key:C,styles:V};const F={position:"relative",display:"flex",cursor:"pointer",justifyContent:"center",alignItems:"center",border:"none",backgroundColor:"transparent",borderRadius:2,transition:"background-color 150ms ease-in-out",[H(S)]:{width:40,height:40},[$(S)]:{width:30,height:30},"&:hover":{backgroundColor:k.grey.light},'&[data-open="true"]':{backgroundColor:`${k.primary.main} !important`},'&[data-open="true"] > svg path':{fill:"white",stroke:"white"}};var X={key:E,styles:F};const Q={position:"absolute",left:0,padding:15,border:`1px solid ${k.primary.main}`,zIndex:1e3,backgroundColor:"white",borderRadius:"0px 5px 0px 0px",maxHeight:"calc(100% - 80px)",maxWidth:"100%",overflow:"auto",boxSizing:"border-box",[H(S)]:{bottom:40},[$(S)]:{bottom:30},"*":{scrollbarWidth:"none",scrollbarColor:`${k.primary.main} #e2ecf5`},"&::-webkit-scrollbar":{width:8},"&::-webkit-scrollbar-track":{background:"#e2ecf5"},"&::-webkit-scrollbar-thumb":{backgroundColor:k.primary.main,borderRadius:8,border:"3px none #ffffff"}};var q={key:M,styles:Q};const G={display:"flex",backgroundColor:k.primary.light,zIndex:1e3,width:"100%",overflowX:"auto","*":{scrollbarWidth:"none",scrollbarColor:`${k.primary.main} #e2ecf5`},"&::-webkit-scrollbar":{height:10},"&::-webkit-scrollbar-track":{background:"#e2ecf5"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#035195",borderRadius:10,border:"3px none #ffffff"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:"#00294d"}};var J={key:D,styles:G},_=Object.freeze({__proto__:null,toolIconWrapperStyles:W,clearAllButtonStyles:U,alertMessageStles:B,bottomBarContainerStyles:Y,bottomToolButtonStyles:K,menuButtonStyles:X,menuContainerStyles:q,topBarContainerStyles:J});const tt=n(()=>"");function et(t){const e=new Map;if(!t)return e;for(const n in t){const o=t[n];void 0!==o&&e.set(n,o)}return e}function nt(t,e){for(const n in e){const o=e[n];void 0!==typeof o&&("string"==typeof o||"number"==typeof o||"object"==typeof o&&void 0===t[n]?t[n]=o:"object"==typeof o&&nt(t[n],o))}}function ot(t,e,n){if(!e)return t;for(const o in e){if(void 0===o)continue;const r=e[o];void 0!==r&&(void 0===t[o]?(t[o]=r,n.set(o,o)):nt(t[o],r))}return t}function rt(t){return Object.values(_).reduce((e,n)=>{if(e[n.key])throw new Error("duplicate key while creating css styles");e[n.key]=n.styles;const o=t.get(n.key);return void 0!==o&&t.set(n.key,o+" "+n.key),t.set(n.key,n.key),e},{})}function it({children:e,styles:n,classNames:o}){const r=i(et(o)),c=i(ot(rt(r.current),n,r.current)),l=i(null);s(()=>{const t=l.current;t&&(r.current=et(o),c.current=ot(rt(r.current),n,r.current),t.innerHTML=function(t){let e="";const n=Object.entries(t);for(const[t,o]of n)e+=L(t,o);return e}(c.current))},[n]);return t.createElement(tt.Provider,{value:t=>{const e=r.current.get(t);if(void 0===e)throw new Error("Could not find key in classNames map");return e}},t.createElement("style",{id:"react-draw-styles",ref:l}),e)}function st(t){return r(tt)(t)}function ct(){const[e]=g(),n=st(x);return t.createElement("dialog",{className:n,style:{backgroundColor:e.color||"black",[e.position]:10},open:null!==e.message},e.message)}function lt({children:e,selected:n,onSelect:o}){const r=st(m);return t.createElement("button",{"data-selected":n,className:r,onClick:o},e)}function at({children:e,text:n,position:o,disabled:r}){const[i,s]=g();if(!e)return t.createElement(t.Fragment,null);if(!n)return t.createElement(t.Fragment,null,e);return t.createElement("span",{onMouseOver:()=>{r||"ontouchstart"in window||navigator.maxTouchPoints>0||s(Object.assign(Object.assign({},i),{message:n,position:o}))},onMouseLeave:()=>{null!==i.message&&s(Object.assign(Object.assign({},i),{message:null}))},"aria-label":`label mouse listener ${n}`},e)}function dt(t){return void 0!==t.onDrawStart}function ut(t){return void 0!==t.getDisplayMode}function pt({tools:e,onSelectDrawingTool:n,onClickActionTool:o,currentTool:r}){const i=st(D);return t.createElement("div",{className:i},e.filter(t=>!!t.icon).map((e,i)=>{const s=e.tooltip;return t.createElement(at,{text:s,position:"top",key:e.id},t.createElement(lt,{selected:e.id===r,onSelect:()=>dt(e)?n(e):ut(e)?o(e.handleContext):void 0},e.icon))}))}function ft(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<t;o++)e+=n.charAt(Math.floor(62*Math.random()));return e}function ht(){return void 0!==typeof window}function gt(t,e,n){var o;if(!ht())throw new Error("new bounding div called on the server.");const r=parseInt(e.lineWidth),i=parseInt(null!==(o=e.zIndex)&&void 0!==o?o:"0"),[s,c]=t,{id:l,div:a}=yt(s,c,r,n,i);return{coords:[t],element:null,toolId:n,containerDiv:a,id:l,style:Object.assign({},e),customData:new Map}}function yt(t,e,n,o,r){const i=ft(6),s=document.createElement("div"),c=t-n,l=e-n;return s.id=`${o}-${i}`,s.style.width=2*n+"px",s.style.height=2*n+"px",s.style.position="absolute",s.style.left=c+"px",s.style.top=l+"px",s.style.pointerEvents="none",s.style.zIndex=r.toString(),s.style.boxSizing="border-box",{div:s,id:i,top:l,left:c,right:c+n+n,bottom:l+n+n}}function vt(t,e){const{width:n,height:o}=function(t){const e=t.getAttribute("viewbox");if(!e)throw new Error("no viewbox found on ele");const n=e.split(" ");return{width:parseFloat(n[2]),height:parseFloat(n[3])}}(t),r=(e.right-e.left)/n,i=(e.bottom-e.top)/o;t.lastElementChild.style.transform=`scale(${r}, ${i})`}function bt(t,e,n){const o=e.getBoundingClientRect(),r=n.getBoundingClientRect(),i=o.top-r.top,s=t[1]-i,c=o.left-r.left;return[t[0]-c,s]}function mt(t){let e=!1;const[n,o]=t.coords[t.coords.length-1],r=t.containerDiv,i=Mt(t),s=parseInt(t.style.lineWidth);if(n-s<=i.left){const t=n-s,o=i.left-t;r.style.left=t+"px",r.style.width=i.width+o+"px",e=!0}else n+s>=i.right&&(r.style.width=n+2*s-i.left+"px",e=!0);if(o+s>=i.bottom)r.style.height=o+2*s-i.top+"px",e=!0;else if(o-s<=i.top){const t=o-s,n=i.top-t;r.style.top=t+"px",r.style.height=i.height+n+"px",e=!0}return e}function wt(t){if(t.coords.length<2)throw new Error("data coords must be at least length 2");const[e,n]=t.coords[0],[o,r]=t.coords[t.coords.length-1];parseInt(t.style.lineWidth);const i=Math.min(e,o),s=Math.min(n,r),c=Math.max(e,o),l=Math.max(n,r),a=t.containerDiv;return a.style.top=s+"px",a.style.left=i+"px",a.style.width=`${Math.max(c-i,1)}px`,a.style.height=`${Math.max(l-s,1)}px`,t.coords}function xt(t,e){return t.top<=e.top&&t.bottom>=e.bottom&&t.left<=e.left&&t.right>=e.right}function Ct(t,e){const[n,o]=e,{width:r,height:i}=t;return r/2>=n&&-r/2<=n&&i/2>=o&&-i/2<=o}function Et(t,e){return Math.sqrt(Math.pow(Math.abs(t[0]-e[0]),2)+Math.pow(Math.abs(t[1]-e[1]),2))}function Mt(t){const e=t.containerDiv,n=e.getBoundingClientRect(),o=jt(e.style.left),r=jt(e.style.top),i=jt(e.style.height),s=jt(e.style.width),c=0===i?n.height:i,l=0===s?n.width:s;return{left:o,top:r,height:c,width:l,right:o+l,bottom:r+c}}const Dt=/-?\d+\.*\d*/;function jt(t){const e=t.match(Dt);return e?parseFloat(e[0]):0}function It(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}function St(t){const{size:e,width:n,height:o,color:r}=t,i=It(t,["size","width","height","color"]);return Object.assign({width:n||e||20,height:o||e||20,color:r||"#111827"},i)}function kt(e){const n=St(e),{color:o}=n,r=It(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 5C3 4.44772 3.44772 4 4 4H16C16.5523 4 17 4.44772 17 5C17 5.55228 16.5523 6 16 6H4C3.44772 6 3 5.55228 3 5Z",fill:o}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 10C3 9.44772 3.44772 9 4 9H16C16.5523 9 17 9.44772 17 10C17 10.5523 16.5523 11 16 11H4C3.44772 11 3 10.5523 3 10Z",fill:o}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 15C3 14.4477 3.44772 14 4 14H16C16.5523 14 17 14.4477 17 15C17 15.5523 16.5523 16 16 16H4C3.44772 16 3 15.5523 3 15Z",fill:o}))}function Lt(e){const n=St(e),{color:o}=n,r=It(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 18 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M16 5L15.1327 17.1425C15.0579 18.1891 14.187 19 13.1378 19H4.86224C3.81296 19 2.94208 18.1891 2.86732 17.1425L2 5M7 9V15M11 9V15M12 5V2C12 1.44772 11.5523 1 11 1H7C6.44772 1 6 1.44772 6 2V5M1 5H17",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}function Tt(e){const n=St(e),{color:o}=n,r=It(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M19.312 11.75C20.4373 11.75 21.312 10.8936 21.312 9.79167C21.312 8.68978 20.4373 7.83333 19.312 7.83333C18.1867 7.83333 17.312 8.68978 17.312 9.79167C17.312 10.8936 18.1867 11.75 19.312 11.75ZM15.312 6.54867C16.4373 6.54867 17.312 5.69222 17.312 4.59033C17.312 3.48844 16.4373 2.632 15.312 2.632C14.1867 2.632 13.312 3.48844 13.312 4.59033C13.312 5.69222 14.1867 6.54867 15.312 6.54867ZM8.688 6.54867C9.81333 6.54867 10.688 5.69222 10.688 4.59033C10.688 3.48844 9.81333 2.632 8.688 2.632C7.56267 2.632 6.688 3.48844 6.688 4.59033C6.688 5.69222 7.56267 6.54867 8.688 6.54867ZM4.688 11.75C5.81333 11.75 6.688 10.8936 6.688 9.79167C6.688 8.68978 5.81333 7.83333 4.688 7.83333C3.56267 7.83333 2.688 8.68978 2.688 9.79167C2.688 10.8936 3.56267 11.75 4.688 11.75ZM12 0C18.6253 0 24 4.71175 24 10.4653C24 14.0765 21 16.9526 17.312 16.9526H15C13.8747 16.9526 13 17.8091 13 18.911C13 19.4006 13.188 19.8288 13.5 20.1956C13.812 20.5625 14 21.0521 14 21.5417C14 22.6436 13.1253 23.5 12 23.5C5.37467 23.5 0 18.2373 0 11.75C0 5.26269 5.37467 0 12 0Z",fill:o}))}function Ot({getEditProps:e,styleComponents:n={},onUpdateStyle:r}){const[i,c]=o(e()),l=Object.keys(i).filter(t=>!!n[t]);s(()=>{function t(){const t=e();c(t)}return window.addEventListener("click",t),()=>{window.removeEventListener("click",t)}},[i]);const a=(t,e)=>{c(Object.assign(Object.assign({},i),{[t]:e})),r(t,e)};return 0===l.length?t.createElement(t.Fragment,null):(l.sort((t,e)=>{const o=n[t].order;return n[e].order-o}),t.createElement("div",{style:{display:"flex",flexDirection:"column",gap:10}},l.map(e=>{const o=n[e].component;return t.createElement(o,{key:e,onUpdate:a,styleKey:e,styleValue:i[e]})})))}function zt({tools:e,displayMap:n,onSelectDrawingTool:r,onClickActionTool:i,stylesMenu:s,children:c}){const l=st(b),a=st(C),d=st(E),u=st(M),[p,f]=o(null),h=t=>f(t===p?null:t),g=!!s.styleComponents&&!function(t){for(var e in t)return!1;return!0}(s.styleComponents),y=!!c&&t.Children.count(c)>0;return t.createElement(t.Fragment,null,"styles"===p&&t.createElement("div",{className:u},t.createElement(Ot,Object.assign({},s))),"menu"===p&&t.createElement("div",{className:u},c),t.createElement("div",{className:l},y&&t.createElement(at,{text:"Menu",position:"bottom"},t.createElement("button",{className:d,onClick:()=>h("menu"),"data-open":"menu"===p},t.createElement(kt,{size:20}))),g&&t.createElement(at,{text:"Styles",position:"bottom"},t.createElement("button",{className:d,onClick:()=>h("styles"),"data-open":"styles"===p},t.createElement(Tt,{size:20}))),e.map((e,o)=>{const s=e.id,c=n.get(s)||"hide",l="disabled"===c;return t.createElement(at,{key:e.id,text:e.tooltip,position:"bottom",disabled:l},t.createElement("button",{className:a,"aria-disabled":l,"data-disabled":l,"data-mode":c,disabled:l,onClick:()=>dt(e)?r(e):ut(e)?i(e.handleContext):void 0},e.icon))})))}function At(t,e){const n=t.id,o=t.containerDiv,r=e.fullState[v],i=r.handlers[n];if(i)for(const t of i)t.ele.removeEventListener(t.eventName,t.fn);const s=o.querySelector('[id^="select-frame"');r.handlers[n]=[],null!==s&&o.removeChild(s);const c=r.selectedIds.indexOf(n);c>=0&&r.selectedIds.splice(c,1)}function Nt(t,e){e.shouldKeepHistory&&(e.undoStack.push(t),e.redoStack.splice(0))}function Ht(t,e,n){return{objectId:t.id,toolId:t.toolId,toolType:"top-bar-tool",action:e,data:n}}function $t(t){const e=t.containerDiv;return e.style.backgroundColor=t.style.background,e.style.borderRadius="2px",e.style.boxSizing="border-box",e.style.color=t.style.color,e.style.opacity=t.style.opacity,e.style.fontSize=`${t.style.fontSize}px`,t}function Rt(t){const e=t.element;if(!e)throw new Error;let n=e.querySelector("path");if(n||(n=e.querySelector("line")),!n)throw new Error;return n}const Wt=/\d+\.*\d*/g;function Pt(t){return void 0===t.style.zIndex?0:parseInt(t.style.zIndex)}function Ut(t,e){for(const n in e)t.style[n]=e[n];return t}function Bt(t,e){const n=t.find(t=>t.id===e);if(!n)throw new Error("could not find the used tool");return n}function Zt(t,e){const{objectsMap:n,viewContainer:o}=e,r=Yt(e.objectsMap,t);At(r,e);const{containerDiv:i,id:s}=r;o.removeChild(i),n.delete(s);const c=Bt(e.drawingTools,r.toolId);c.onDeleteObject&&c.onDeleteObject(r,e)}function Yt(t,e){const n=t.get(e);if(!n)throw new Error("could not get object from map");return n}function Vt(t,e){if(!e)throw new Error("Container not set.");const n=e.getBoundingClientRect();return[t[0]-n.left,t[1]-n.top]}function Kt(t){let e=t.touches[0];return e||(e=t.targetTouches[0]),e||(e=t.changedTouches[0]),[e.clientX,e.clientY]}function Ft(t){const{width:e,height:n,top:o,left:r}=t;return[r+e/2,o+n/2]}function Xt(t){const e=t.viewContainer.getBoundingClientRect();return[e.width/2,e.height/2]}function Qt(t,e){const n=e.querySelectorAll(t);n.length>0&&n.forEach(t=>{e.removeChild(t)})}function qt(t){return void 0!==t}function Gt(t,e){var n;const o={action:"batch",toolType:"batch",toolId:"",objectId:"",data:[]},r=new Set;for(const i of t){const t=Yt(e.objectsMap,i),s=t.toolId,c=Bt(e.drawingTools,s);if(e.shouldKeepHistory&&(null===(n=null==c?void 0:c.undoHandlers)||void 0===n?void 0:n.delete)){const e={action:"delete",toolType:"top-bar-tool",toolId:s,objectId:i,data:t};o.data.push(e)}else r.add(s);Zt(i,e)}if(e.shouldKeepHistory){if(Nt(o,e),r.size>0)for(let t=e.undoStack.length-1;t>=0;t--)r.has(e.undoStack[t].toolId)&&(e.undoStack.splice(t,1),t++)}else e.undoStack.splice(0)}function Jt(t,e,n){const o=Object.assign({},t.globalStyles),r=ee(t)+1;o.zIndex=r.toString();return gt(e,o,n)}function _t(t,e){const{containerDiv:n,id:o}=e;t.viewContainer.appendChild(n);!function(t,e){t.style.zIndex=e.toString(),t.containerDiv.style.zIndex=e.toString()}(e,ee(t)+1),t.objectsMap.set(o,e)}function te(t,e,n,o){const r=t.viewContainer.getBoundingClientRect(),i=e.containerDiv;if(!n||!o){const{width:t,height:e}=i.getBoundingClientRect();n=n||t,o=o||e}const s=r.height/2-o/2,c=r.width/2-n/2;i.style.top=s+"px",i.style.left=c+"px",i.style.height=o+"px",i.style.width=n+"px"}function ee(t){if(0===t.objectsMap.size)return 0;const e=Array.from(t.objectsMap.values());return e.sort((t,e)=>Pt(e.containerDiv)-Pt(t.containerDiv)),Pt(e[0].containerDiv)}const ne=/-{0,1}\d+\.*\d*/g;function oe(t){const e=t.style.transform;if(!e)return 0;const n=e.match(ne);return n?parseFloat(n[0]):0}function re(t,e){const n=Ft(Mt(t)),o=oe(t.containerDiv);if(0===o)return[e.newPoint[0]-e.previousPoint[0],e.newPoint[1]-e.previousPoint[1]];const[r,i]=se(e.previousPoint,n),[s,c]=se(e.newPoint,n),l=le(r,i,-o);return se(le(s,c,-o),l)}function ie(t,e,n){const[o,r]=e,[i,s]=n,c=Mt(t),l=t.containerDiv,a=oe(l),[d,u]=Ft(c),[p,f]=le(o,r,a),h=c.height+s,g=c.width+i;if(g<10||h<10)return!1;const y=u-(f+h/2),v=p-g/2+d;return l.style.top=y+"px",l.style.left=v+"px",l.style.width=g+"px",l.style.height=h+"px",!0}function se(t,e){const[n,o]=e,[r,i]=t;return[r-n,o-i]}const ce=5;function le(t,e,n){const o=n*(Math.PI/180),r=t*Math.cos(o)+e*Math.sin(o),i=-t*Math.sin(o)+e*Math.cos(o);return[ae(r,ce),ae(i,ce)]}function ae(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}function de([t,e],n,{direction:o,targetAspectRatio:r}){const i=function(t){return e=>{const n=t[0],o=Math.abs(e.dX),r=Math.abs(e.dY),i=o/r;switch(n){case"E":case"W":if(0===e.dY)return e.dX;if(i>e.currAR)return e.dX;return r*e.currAR*e.dirFlag*e.reverseFlag;default:return e.dX}}}(o),s=function(t){return e=>{const n=Math.abs(e.dX),o=n/Math.abs(e.dY);switch(t[0]){case"N":case"S":if(0===e.dX)return e.dY;if(o<e.currAR)return e.dY;return n/e.currAR*e.dirFlag*e.reverseFlag;default:return e.dY}}}(o),c=function(t){if("S"===t[1]||"W"===t[1])return-1;return 1}(o),l=function(t,e,n){switch(t[0]){case"N":return e<0?1:-1;case"S":return e<0?-1:1;case"E":return n<0?1:-1;case"W":return n<0?-1:1}throw new Error("should not get here"+JSON.stringify({direction:t,dX:e,dY:n}))}(o,t,e),a={dX:t,dY:e,currAR:r,dirFlag:l,reverseFlag:c};console.log(r);return[i(a),s(a)]}function ue(t){const{width:e,height:n}=Mt(t);return e/n}function pe(t,e,n){return{targetAspectRatio:ue(t),direction:n}}function fe(t,e,n){const o=re(t,e);if(void 0!==n){const[e,r]=de(o,0,n);return ie(t,[0,-r/2],[0,-r])}return ie(t,[0,-o[1]/2],[0,-o[1]])}function he(t,e,n){let o=re(t,e);if(void 0!==n){const[e,r]=de(o,0,n);return ie(t,[e/2,0],[-e,0])}return ie(t,[o[0]/2,0],[-o[0],0])}function ge(t,e){const[n,o]=re(t,e);if(!e.shouldPreserveAspectRatio)return ie(t,[n/2,-o/2],[-n,o]);const r=pe(t,0,"WS"),[i,s]=de([n,o],0,r),c=pe(t,0,"SW"),[l,a]=de([n,o],0,c);return ie(t,[i/2,-a/2],[-i,a])}function ye(t,e,n){let o=re(t,e);if(void 0!==n){const[e,r]=de(o,0,n);return ie(t,[0,-r/2],[0,r])}return ie(t,[0,-o[1]/2],[0,o[1]])}function ve(t,e){const[n,o]=re(t,e);if(!e.shouldPreserveAspectRatio)return ie(t,[n/2,-o/2],[n,o]);const r=pe(t,0,"ES"),[i,s]=de([n,o],0,r),c=pe(t,0,"SE"),[l,a]=de([n,o],0,c);return ie(t,[i/2,-a/2],[i,a])}function be(t,e){const[n,o]=re(t,e);if(!e.shouldPreserveAspectRatio)return ie(t,[n/2,-o/2],[-n,-o]);const r=pe(t,0,"WN"),[i,s]=de([n,o],0,r),c=pe(t,0,"NW"),[l,a]=de([n,o],0,c);return ie(t,[i/2,-a/2],[-i,-a])}function me(t,e){const[n,o]=re(t,e);if(!e.shouldPreserveAspectRatio)return ie(t,[n/2,-o/2],[n,-o]);const r=pe(t,0,"EN"),[i,s]=de([n,o],0,r),c=pe(t,0,"NE"),[l,a]=de([n,o],0,c);return ie(t,[i/2,-a/2],[i,-a])}function we(t,e,n){let o=re(t,e);if(void 0!==n){const[e,r]=de(o,0,n);return ie(t,[e/2,0],[e,0])}return ie(t,[o[0]/2,0],[o[0],0])}const xe="button-rotate",Ce={top:"-45px",cursor:"grab",left:"calc(50% - 8px)"},Ee={width:"calc(100% + 16px)",height:"calc(100% + 16px)",position:"absolute",border:`2px dotted ${k.primary.main}`,top:"-6px",left:"-6px",cursor:"all-scroll",pointerEvents:"all",boxSizing:"border-box"},Me={width:"0px",height:"35px",borderLeft:"2px dotted black",position:"absolute",left:"5px",pointerEvents:"none"},De={position:"absolute",borderRadius:"50%",width:"16px",height:"16px"};function je(t,e){return t.map(t=>{const n=e.get(t);if(!n)throw new Error("object not found in map");return n})}function Ie(t,e){const n=t.toolId,o=e.drawingTools.find(t=>t.id===n);o&&o.onAfterUpdate&&o.onAfterUpdate(t,e)}function Se(t,e){const n=t.fullState[v],o=n.prevPoint;if(!o)return void console.error("handleDrag prev point not set");const r=je(n.selectedIds,t.objectsMap);!function(t,e,n){const[o,r]=n,[i,s]=e,c=o-i,l=r-s;for(const e of t){const t=e.containerDiv,n=Mt(e),{left:o,top:r}=n;t.style.top=r+l+"px",t.style.left=o+c+"px"}}(r,o,e),n.prevPoint=e,1===r.length&&Ie(r[0],t)}function ke(t,e){t.fullState[v].prevPoint=e,function(t){const e=t.fullState[v],n=je(e.selectedIds,t.objectsMap),o={objectId:"",toolId:v,toolType:"top-bar-tool",action:"drag",data:n.map(t=>{const e=Mt(t);return{objectId:t.id,top:e.top,left:e.left}})};Nt(o,t)}(t)}function Le(t){t.fullState[v].prevPoint=null}function Te(t,e,n){const o=function(t){t.stopPropagation();const e=Vt([t.clientX,t.clientY],n.viewContainer);ke(n,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)},r=function(t){t.stopPropagation();const e=Vt([t.clientX,t.clientY],n.viewContainer);Se(n,e)},i=function(t){t.stopPropagation(),Le(n),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)},s=function(t){t.stopPropagation();const e=Vt(Kt(t),n.viewContainer);ke(n,e),window.addEventListener("touchmove",c,{passive:!0}),window.addEventListener("touchend",l,{passive:!0}),window.addEventListener("touchcancel",l,{passive:!0})},c=function(t){t.stopPropagation();const e=Vt(Kt(t),n.viewContainer);Se(n,e)},l=function(t){t.stopPropagation(),Le(n),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",l),window.removeEventListener("touchcancel",l)},a=n.fullState[v],d=a.handlers[e]||[];a.handlers[e]=d,d.push({ele:t,eventName:"mousedown",fn:o}),d.push({ele:t,eventName:"touchstart",fn:s}),t.addEventListener("mousedown",o),t.addEventListener("touchstart",s,{passive:!0})}function Oe(t,e,n){const o=t.fullState[v],r=o.prevPoint;if(!r)return;const i=je(o.selectedIds,t.objectsMap);if(1!==i.length)return void console.error("start rotating got incorrect number of objects to handle");const s=i[0],c=Bt(t.drawingTools,s.toolId),l={viewContainer:t.viewContainer,newPoint:e,previousPoint:r,shouldPreserveAspectRatio:t.shouldCornerResizePreserveRatio};c.doResize?c.doResize(s,l):n(s,l),c.onResize(s,l),o.prevPoint=e}function ze(t,e){t.fullState[v].prevPoint=e,function(t){const e=t.fullState[v],n=je(e.selectedIds,t.objectsMap);if(1!==n.length)throw new Error("resize push to stack expects 1 object selected");const o=n[0],r=Mt(o);Nt({objectId:o.id,toolId:v,toolType:"top-bar-tool",action:"resize",data:{bounds:{top:r.top,left:r.left,right:r.right,bottom:r.bottom}}},t)}(t)}function Ae(t){t.fullState[v].prevPoint=null}function Ne(t,e,n,o){const r=function(t){t.stopPropagation();const e=Vt([t.clientX,t.clientY],n.viewContainer);ze(n,e),window.addEventListener("mousemove",i),window.addEventListener("mouseup",s)},i=function(t){t.stopPropagation();const e=Vt([t.clientX,t.clientY],n.viewContainer);Oe(n,e,o)},s=function(t){t.stopPropagation(),Ae(n),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",s)},c=function(t){t.stopPropagation();const e=Vt(Kt(t),n.viewContainer);ze(n,e),window.addEventListener("touchmove",l,{passive:!0}),window.addEventListener("touchend",a,{passive:!0}),window.addEventListener("touchcancel",a,{passive:!0})},l=function(t){t.stopPropagation();const e=Vt(Kt(t),n.viewContainer);Oe(n,e,o)},a=function(t){t.stopPropagation(),Ae(n),window.removeEventListener("touchmove",l),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)},d=n.fullState[v],u=d.handlers[e]||[];d.handlers[e]=u,u.push({ele:t,eventName:"mousedown",fn:r}),u.push({ele:t,eventName:"touchstart",fn:c}),t.addEventListener("mousedown",r),t.addEventListener("touchstart",c,{passive:!0})}function He(t,e){const n=t.fullState[v];if(!n.prevPoint)return;const o=je(n.selectedIds,t.objectsMap);if(1!==o.length)return void console.error("start rotating got incorrect number of objects to handle");const r=o[0];!function(t,e,n){const o=t.containerDiv,r=e[0]-n[0],i=e[1]-n[1],s=180*Math.atan2(i,r)/Math.PI+90;o.style.transform=`rotate(${ae(s,5)}deg)`}(r,e,Ft(Mt(r))),n.prevPoint=e,Ie(r,t)}function $e(t,e){t.fullState[v].prevPoint=e,function(t){const e=t.fullState[v],n=je(e.selectedIds,t.objectsMap),o={objectId:"",toolId:v,toolType:"top-bar-tool",action:"rotate",data:n.map(t=>({objectId:t.id,rotate:oe(t.containerDiv)}))};Nt(o,t)}(t)}function Re(t){t.fullState[v].prevPoint=null}function We(t,e){for(const n of t){const t=Pe(n);t&&(Te(t,n.id,e),n.containerDiv.appendChild(t))}}function Pe(t){const e=t.containerDiv,n=t.id;if(function(t){return null!==t.querySelector('[id^="select-frame"')}(e))return null;const o=document.createElement("div");return o.setAttribute("id",`select-frame-${n}`),Ut(o,Ee),o}function Ue(t,e,n){const o=Bt(t,e.toolId);o&&n&&o.onSelect&&o.onSelect(e,n)}function Be(t,e){for(const n of t)At(n,e)}function Ze(t,e){const n=Pe(t);n&&(Te(n,t.id,e),function(t,e,n){const o=e.id,r=Ve(o,2,0,0,2);Ne(r,o,n,be);const i=Ve(o,2,1);Ne(i,o,n,fe);const s=Ve(o,2,2);Ne(s,o,n,me);const c=Ve(o,0,2,1);Ne(c,o,n,we);const l=Ve(o,0,2,2);Ne(l,o,n,ve);const a=Ve(o,0,1,2);Ne(a,o,n,ye);const d=Ve(o,0,0,2,2);Ne(d,o,n,ge);const u=Ve(o,0,0,1,2);Ne(u,o,n,he),t.appendChild(r),t.appendChild(i),t.appendChild(s),t.appendChild(c),t.appendChild(l),t.appendChild(a),t.appendChild(d),t.appendChild(u);const p=Ve(o);p.id=`${xe}-${o}`,Ut(p,Ce),function(t,e,n){const o=function(t){t.stopPropagation();const e=Vt([t.clientX,t.clientY],n.viewContainer);$e(n,e),window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)},r=function(t){t.stopPropagation();const e=Vt([t.clientX,t.clientY],n.viewContainer);He(n,e)},i=function(t){t.stopPropagation(),Re(n),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)},s=function(t){t.stopPropagation();const e=Vt(Kt(t),n.viewContainer);$e(n,e),window.addEventListener("touchmove",c,{passive:!0}),window.addEventListener("touchend",l,{passive:!0}),window.addEventListener("touchcancel",l,{passive:!0})},c=function(t){t.stopPropagation();const e=Vt(Kt(t),n.viewContainer);He(n,e)},l=function(t){t.stopPropagation(),Re(n),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",l),window.removeEventListener("touchcancel",l)},a=n.fullState[v],d=a.handlers[e]||[];a.handlers[e]=d,d.push({ele:t,eventName:"mousedown",fn:o}),d.push({ele:t,eventName:"touchstart",fn:s}),t.addEventListener("mousedown",o),t.addEventListener("touchstart",s,{passive:!0})}(p,o,n);const f=document.createElement("div");Ut(f,Me),f.id=`line-div-${o}`,p.appendChild(f),t.appendChild(p)}(n,t,e),t.containerDiv.appendChild(n))}const Ye=-12;function Ve(t,e=0,n=0,o=0,r=0){const i=document.createElement("button");Ut(i,De);let s="";return 2===e&&(i.style.top=`${Ye}px`,s+="n"),2===o?(i.style.bottom=`${Ye}px`,s+="s"):1===o&&(i.style.bottom="calc(50% - 8px)"),2===n?(i.style.right=`${Ye}px`,s+="e"):1===n&&(i.style.right="calc(50% - 8px)"),2===r&&(i.style.left=`${Ye}px`,s+="w"),i.id=`corner-button-${s}-${t}`,i.style.cursor=`${s}-resize`,i}function Ke(t){const e=t.fullState[v];if(!e)throw new Error("no select state present");return[...e.selectedIds]}function Fe(t,e,n){const o=t.filter(t=>"top"===n?!t.postition||t.postition.view===n:!!t.postition&&t.postition.view===n),r=e.filter(t=>"bottom"===n?!t.postition||t.postition.view===n:!!t.postition&&t.postition.view===n);return[...o].concat(r).sort((t,e)=>{var n,o,r,i;return(null===(n=t.postition)||void 0===n?void 0:n.order)||(null===(o=e.postition)||void 0===o?void 0:o.order)?(null===(r=t.postition)||void 0===r?void 0:r.order)?(null===(i=e.postition)||void 0===i?void 0:i.order)?t.postition.order-e.postition.order:-1:1:0})}function Xe({children:e,id:n="main",drawingTools:r,hideTopBar:l,actionTools:a=[],hideBottomBar:d,shouldKeepHistory:u=!0,shouldSelectAfterCreate:p=!0,isResponsive:f=!1,shouldCornerResizePreserveRatio:h=!1,styleComponents:g,menuComponents:b=[],onLoad:m,contextGetter:w}){const x=i(null),[C,E]=o(r[0]),M=i(new Map),D=i(null),j=i(`drawing-area-container-${n}`),I=i(null),S=i(null),k=i(function(t){const e={[v]:{selectedIds:[],handlers:{},prevPoint:null},[y]:{deletedObjects:new Map}};return t.reduce((t,n)=>(void 0===t[n.id]&&(t[n.id]={}),n.setupCustomState&&(t[n.id]=Object.assign(t[n.id],n.setupCustomState(e))),t),e)}(r)),L=i([]),T=i([]),O=i(null),z=i(function(){const t=Object.assign({},Ge);return t}()),[A,N]=o(new Map),H=c(()=>Fe(r,a,"top"),[r,a]),$=c(()=>Fe(r,a,"bottom"),[r,a]),R=()=>{const t=(()=>{const t=new Map;return a.reduce((t,e)=>(t.set(e.id,e.getDisplayMode(P())),t),t)})();if(t.size!==A.size)return N(t);const e=t.keys();for(const n of e)if(t.get(n)!==A.get(n))return N(t)};s(()=>{R(),m&&m(P())},[]),s(()=>{if(C.id===v){const t=O.current;if(t){const e=P();qe(e),e.fullState[v].selectedIds=[t.id],Ze(t,e),O.current=null}}R()},[C]);const W=t=>{if(C.id!==v)return O.current=t,E(Qe(r,v));const e=P();qe(e),e.fullState[v].selectedIds=[t.id],Ze(t,e),R()},P=t=>{const e=t||B(),n=k.current;return{viewContainer:e,objectsMap:M.current,lastEvent:S.current,prevMousePosition:I,drawingTools:r,fullState:n,undoStack:L.current,redoStack:T.current,shouldKeepHistory:u,shouldCornerResizePreserveRatio:h,selectDrawingTool:F,selectObject:W,shouldSelectAfterCreate:p,globalStyles:z.current}};function U(t){C.onKeyPress&&(C.onKeyPress(t,P()),R())}const B=()=>{const t=x.current;if(!t)throw new Error("no view container while resizing");return t};function Z(t){const e=P(),n=Object.assign({},z.current),o=ee(e)+1;n.zIndex=o.toString();const r=gt(t,n,C.id);D.current=r,e.viewContainer.append(r.containerDiv),C.onDrawStart(r,e)}function Y(t){const e=D.current;if(!e)return;const n=P();e.coords.push(t),C.onDrawing(e,n)}function V(t){const e=D.current;I.current=null,D.current=null,e&&(e.coords.push(t),M.current.set(e.id,e),C.onDrawEnd(e,P()),R())}s(()=>{const t=x.current;if(t)return t.addEventListener("mousedown",e),t.addEventListener("mouseup",o),t.addEventListener("mousemove",n),t.addEventListener("touchstart",i,{passive:!1}),t.addEventListener("touchmove",s,{passive:!1}),t.addEventListener("touchcancel",c,{passive:!0}),t.addEventListener("touchend",c,{passive:!0}),t.addEventListener("mouseleave",o),window.addEventListener("keydown",U),()=>{t.removeEventListener("mousedown",e),t.removeEventListener("mouseup",o),t.removeEventListener("mousemove",n),t.removeEventListener("touchstart",i),t.removeEventListener("touchmove",s),t.removeEventListener("touchcancel",c),t.removeEventListener("touchend",c),t.removeEventListener("mouseleave",o),window.removeEventListener("keydown",U);const l=P(t);for(const t of r)t.onUnMount&&t.onUnMount(l)};function e(e){S.current=e;Z(Vt([e.clientX,e.clientY],t))}function n(e){S.current=e;Y(Vt([e.clientX,e.clientY],t))}function o(e){S.current=e;V(Vt([e.clientX,e.clientY],t))}function i(e){S.current=e,e.preventDefault();Z(Vt(Kt(e),t))}function s(e){S.current=e,e.preventDefault();Y(Vt(Kt(e),t))}function c(e){S.current=e,e.preventDefault();V(Vt(Kt(e),t))}},[C]);const K=i({width:0,height:0});s(()=>{const{viewContainer:t}=P();if(!t)return;K.current.width=t.offsetWidth,K.current.height=t.offsetHeight;let e=null;return f&&(e=new ResizeObserver(function(){const t=P(),{viewContainer:e}=t,n=e.offsetWidth,o=e.offsetHeight,r=o/K.current.height,i=n/K.current.width;t.objectsMap.forEach(e=>{e.containerDiv.style.height=e.containerDiv.offsetHeight*r+"px",e.containerDiv.style.width=e.containerDiv.offsetWidth*i+"px";const n=jt(e.containerDiv.style.left),o=jt(e.containerDiv.style.top),s=n*i,c=o*r;e.containerDiv.style.left=s+"px",e.containerDiv.style.top=c+"px",Qe(t.drawingTools,e.toolId).onResize(e,Object.assign(Object.assign({},t),{shouldPreserveAspectRatio:h,previousPoint:[n,o],newPoint:[s,c]}))}),K.current={width:n,height:o}}),e.observe(t)),()=>{null==e||e.disconnect()}},[]);const F=t=>{const e=t.id;if(C.id!==e){const t=Qe(r,e);if(t){const e=C,n=P();e.onUnPickTool&&e.onUnPickTool(n),t.onPickTool&&t.onPickTool(n),E(t),R()}}},X=t=>{t(P()),R()},Q=(t,e)=>{const n=t.filter(qt);if(0===n.length)return;Nt({data:n,objectId:"",toolId:"",toolType:"batch",action:"batch"},e)};return s(()=>{w&&w(P)},[]),t.createElement(t.Fragment,null,!l&&t.createElement(pt,{tools:H,onClickActionTool:X,onSelectDrawingTool:F,currentTool:C.id}),t.createElement("div",{id:j.current,style:{position:"relative",width:"100%",flex:1,overflow:"hidden",boxSizing:"border-box"},ref:x},t.createElement(ct,null),e),!d&&t.createElement(zt,{displayMap:A,tools:$,onSelectDrawingTool:F,onClickActionTool:X,stylesMenu:{getEditProps:()=>{const t=P(),e=Ke(t);if(0===e.length){return z.current}const n=function(t,e){const n={},o=t.map(t=>Yt(e.objectsMap,t)),r={};for(const t of o){const o=Qe(e.drawingTools,t.toolId);if(o.styleHandlers){const e=Object.keys(o.styleHandlers);for(const o of e){const e=t.style[o];e?(n[o]=e,r[o]=(r[o]||0)+1):console.error("could not get style value for key:",o,"from object",t)}}}for(const t in r)r[t]!==o.length&&delete n[t];return n}(e,t);return n},styleComponents:g,onUpdateStyle:(t,e)=>{const n=P(),o=Ke(n);if(0===o.length)return z.current[t]=e,[];const r=o.map(t=>Yt(n.objectsMap,t)),i=r.map(o=>{const r=Qe(n.drawingTools,o.toolId).styleHandlers;if(r&&r[t])return r[t](o,e,n)});return Q(i,n),i}}},b.map((e,n)=>t.createElement(e,{key:n,getContext:P}))),t.createElement("style",null,`\n\t\t#${j.current} {\n\t\t\tcursor: ${C.cursor||"default"};\n\t\t}\n\t  `))}function Qe(t,e){const n=t.find(t=>t.id===e);if(!n)throw new Error("could not find the used tool");return n}function qe(t){const e=t.fullState[v].selectedIds;if(e.length>0){Be(je(e,t.objectsMap),t)}}const Ge={lineWidth:"4",zIndex:"1",color:"#000000",fontSize:"14",background:"transparent",opacity:"1"};var Je=e(function(e,n){var{children:o,styles:r,style:i,classNames:s}=e,c=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n}(e,["children","styles","style","classNames"]);const{layout:a}=function(t,e){const n=l.count(t);if(n>1)throw new Error("ReactDraw expects either 0 or 1 children, detected more.");void 0===e&&(e="default");return{numChildren:n,layout:e}}(o,c.layout);return t.createElement(it,{styles:r,classNames:s},t.createElement(h,null,t.createElement(u,{layout:a,ref:n,style:i},t.createElement(Xe,Object.assign({},c),o))))});function _e(t){const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("fill","transparent"),e.setAttribute("stroke",t.color),e.style.strokeWidth=`${t.lineWidth}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}function tn(t,e,n){if(!ht())throw new Error("createSVG called on server");const o=document.createElementNS("http://www.w3.org/2000/svg","svg");return o.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),o.setAttribute("viewbox",`0 0 ${t} ${e}`),o.style.overflow="visible",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.opacity=n,o.style.width="100%",o.style.height="100%",o}function en(t,e){if(!ht())throw new Error("createPath called on server");const n=document.createElementNS("http://www.w3.org/2000/svg","circle");return n.setAttribute("fill","black"),n.setAttribute("cx",`${Math.ceil(t/2)}`),n.setAttribute("cy",`${Math.ceil(t/2)}`),n.setAttribute("r",`${t}`),n}const nn=/^(#([0-9A-F]{3}){1,2}|transparent)$/i;function on(t,e,n,o){if(!o.match(nn))return;const r=Rt(t),i=t.style[e];return r.style[n]=o,t.style[e]=o,Ht(t,e,i)}function rn(t,e){return on(t,"color","stroke",e)}function sn(t,e){const{ele:n,action:o}=cn(t,e,"background");return o?(n.style.backgroundColor=e,o):o}function cn(t,e,n){const o=t.element;if(!o)throw new Error;if(!e.match(nn))return{ele:o,action:void 0};const r=t.style[n];t.style[n]=e;return{ele:o,action:Ht(t,n,r)}}function ln(t,e){const{ele:n,action:o}=cn(t,e,"color");return o?(n.style.border=an(t.style),o):o}function an(t){return`${t.lineWidth}px solid ${t.color}`}function dn(t,e,n,o){if(!o.match(nn))return;const r=t.style[e];return t.style[e]=o,t.containerDiv.style[n]=o,Ht(t,e,r)}function un(t,e){if(!e.shouldKeepHistory)return;Nt({toolId:t.toolId,toolType:"top-bar-tool",objectId:t.id,action:"create",data:null},e)}function pn(t,e){const n=Yt(e.objectsMap,t.objectId);return Zt(t.objectId,e),t.data=n,t.action="delete",t}function fn(t,e){const n=t.data;if(!n)throw new Error("redo delete but no data exists");return e.objectsMap.set(n.id,n),e.viewContainer.appendChild(n.containerDiv),t.data=null,t.action="create",t}function hn(t,e){const n=t.data;if(!n||"object"!=typeof n)throw new Error("malformed data");for(const[t,o]of n.entries())e.viewContainer.appendChild(o.containerDiv),e.objectsMap.set(t,o);return t.action="create",t.data=Array.from(n.keys()),t}function gn(t,e){const n=t.data;if(!n||!Array.isArray(n))throw console.error(t),new Error("malformed data");t.data=new Map;for(const o of n)t.data.set(o,Yt(e.objectsMap,o)),Zt(o,e);return t.action="delete",t}function yn(t,e){const n=Yt(e.objectsMap,t.objectId),o=n.style.opacity,r=t.data,i=n.element;if(!r||!i)throw new Error;return n.style.opacity=r,i.style.opacity=n.style.opacity,t.data=o,t}function vn(t,e){const n=Yt(e.objectsMap,t.objectId),o=n.style.lineWidth,r=t.data,i=n.element;if(!r||!i)throw new Error;return n.style.lineWidth=r,i.style.border=an(n.style),t.data=o,t}function bn(t,e){const n=Yt(e.objectsMap,t.objectId),o=n.style.background,r=t.data,i=n.element;if(!r||!i)throw new Error;return n.style.background=r,i.style.backgroundColor=r,t.data=o,t}function mn(t,e){const n=Yt(e.objectsMap,t.objectId),o=n.style.color,r=t.data,i=n.element;if(!r||!i)throw new Error;return n.style.color=r,i.style.border=an(n.style),t.data=o,t}function wn(t,e){return Cn(t,e,"color","stroke")}function xn(t,e){return Cn(t,e,"background","fill")}function Cn(t,e,n,o){const r=Yt(e.objectsMap,t.objectId),i=r.style[n],s=t.data,c=r.element;if(!c)throw new Error;let l=c.querySelector("path");if(l||(l=c.querySelector("line")),!l)throw new Error;return r.style[n]=s,l.style[o]=s,t.data=i,t}function En(t,e){const n=Yt(e.objectsMap,t.objectId),o=n.style.lineWidth,r=t.data,i=Rt(n);return n.style.lineWidth=r,i.style.strokeWidth=r+"px",t.data=o,t}const Mn=/^[0-9]+$/g;function Dn(t,e){const n=t.element;if(!n)throw new Error;if(!e.match(Mn))return;const o=t.style.lineWidth;t.style.lineWidth=e,n.style.border=an(t.style);return Ht(t,"lineWidth",o)}function jn(t,e){const n=e.includes("px")?e:e+"px",o=Rt(t),r="lineWidth",i=t.style[r];return o.style.strokeWidth=n,t.style[r]=e,Ht(t,r,i)}const In=/^(0(\.\d+)?|1(\.0+)?)$/;function Sn(t,e){if(!e.match(In))return;const n=t.element;if(!n)throw new Error;const o=t.style.opacity;return t.style.opacity=e,n.style.opacity=e,Ht(t,"opacity",o)}const kn={id:"free-draw-tool",tooltip:"Free draw tool",icon:t.createElement(function(e){const n=St(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M10.5858 0.585786C11.3668 -0.195262 12.6332 -0.195262 13.4142 0.585786C14.1953 1.36683 14.1953 2.63316 13.4142 3.41421L12.6213 4.20711L9.79289 1.37868L10.5858 0.585786Z",fill:n.color}),t.createElement("path",{d:"M8.37868 2.79289L0 11.1716V14H2.82842L11.2071 5.62132L8.37868 2.79289Z",fill:n.color}))},null),onDrawStart:t=>{const e=parseInt(t.style.lineWidth),n=tn(e,e,t.style.opacity);n.style.overflow="visible";const o=en(e/2,t.style.color);n.appendChild(o),t.containerDiv.appendChild(n),t.element=n},onDrawing:(t,e)=>{!function(t){const e=t.length;if(e<3)return;const n=t[e-3],o=t[e-1];Et(n,o)<10&&t.splice(e-2,1);Et(n,o)<20&&(t[e-2]=function(t,e){const[n,o]=t,[r,i]=e;return[Math.min(n,r)+Math.abs(n-r)/2,Math.min(o,i)+Math.abs(o-i)/2]}(n,o))}(t.coords),mt(t);const n=Mt(t),o=tn(n.width,n.height,t.style.opacity);o.style.overflow="visible";const r=Ln(t,e.viewContainer);o.appendChild(r),t.containerDiv.innerHTML="",t.containerDiv.appendChild(o),t.element=o},onDrawEnd:(t,e)=>{un(t,e),function(t){t.customData.set(j,Mt(t))}(t),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize:(t,e)=>{t.element&&vt(t.element,Mt(t))},undoHandlers:{create:pn,delete:fn,color:wn,lineWidth:En,opacity:yn},redoHandlers:{create:pn,delete:fn,color:wn,lineWidth:En,opacity:yn},styleHandlers:{color:(t,e,n)=>rn(t,e),lineWidth:(t,e,n)=>jn(t,e),opacity:(t,e,n)=>Sn(t,e)},cursor:"url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjU4NTggMC41ODU3ODZDMTEuMzY2OCAtMC4xOTUyNjIgMTIuNjMzMiAtMC4xOTUyNjIgMTMuNDE0MiAwLjU4NTc4NkMxNC4xOTUzIDEuMzY2ODMgMTQuMTk1MyAyLjYzMzE2IDEzLjQxNDIgMy40MTQyMUwxMi42MjEzIDQuMjA3MTFMOS43OTI4OSAxLjM3ODY4TDEwLjU4NTggMC41ODU3ODZaIiBmaWxsPSIjMTExODI3Ii8+CjxwYXRoIGQ9Ik04LjM3ODY4IDIuNzkyODlMMCAxMS4xNzE2VjE0SDIuODI4NDJMMTEuMjA3MSA1LjYyMTMyTDguMzc4NjggMi43OTI4OVoiIGZpbGw9IiMxMTE4MjciLz4KPC9zdmc+) 0 16, pointer"};function Ln(t,e){const n=_e(t.style);return n.setAttribute("d",function(t,e){let n="";for(let o=0;o<t.coords.length;o++){n+=Tn(bt(t.coords[o],t.containerDiv,e),o),o!==t.coords.length-1&&(n+=" ")}return n}(t,e)),n}function Tn(t,e){return 0===e?`M ${t[0]} ${t[1]}`:`L ${t[0]} ${t[1]}`}function On(t,e){const n=t.data,o=[];for(const t of n){const n=Yt(e.objectsMap,t.objectId),r=n.containerDiv,i=Mt(n),{left:s,top:c}=t;o.push({objectId:t.objectId,top:i.top,left:i.left}),r.style.left=s+"px",r.style.top=c+"px",Ie(n,e)}return t.data=o,t}function zn(t,e){const n=t.data,o=[];for(const t of n){const n=Yt(e.objectsMap,t.objectId),r=n.containerDiv,i=oe(r);o.push({objectId:t.objectId,rotate:i}),r.style.transform=`rotate(${t.rotate}deg)`,Ie(n,e)}return t.data=o,t}function An(t,e){const n=Yt(e.objectsMap,t.objectId),o=t.data,r=Mt(n),i=Object.assign({},r);Nn(n.containerDiv,o.bounds);return Bt(e.drawingTools,n.toolId).onResize(n,Object.assign(Object.assign({},e),{previousPoint:[r.left,r.top],newPoint:[o.bounds.left,o.bounds.top],shouldPreserveAspectRatio:e.shouldCornerResizePreserveRatio})),t.data.bounds=i,t}function Nn(t,e){t.style.left=e.left+"px",t.style.top=e.top+"px",t.style.width=e.right-e.left+"px",t.style.height=e.bottom-e.top+"px"}function Hn(t,e){var n,o;const r=null!==(o=null===(n=t.localState)||void 0===n?void 0:n.subs)&&void 0!==o?o:[];Ke(e).length>0?r.forEach(t=>t("selected")):r.forEach(t=>t("none-selected"))}const $n={tooltip:"Select tool",icon:t.createElement(function(e){const n=St(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M5.67175 0.911473C5.52881 0.378007 4.98047 0.0614245 4.44701 0.204366C3.91354 0.347308 3.59696 0.895645 3.7399 1.42911L3.99872 2.39504C4.14166 2.9285 4.69 3.24509 5.22346 3.10214C5.75693 2.9592 6.07351 2.41086 5.93057 1.8774L5.67175 0.911473Z",fill:n.color}),t.createElement("path",{d:"M1.42911 3.7399C0.895645 3.59696 0.347308 3.91354 0.204366 4.44701C0.0614245 4.98047 0.378007 5.52881 0.911473 5.67175L1.8774 5.93057C2.41086 6.07351 2.9592 5.75693 3.10214 5.22346C3.24509 4.69 2.9285 4.14166 2.39504 3.99872L1.42911 3.7399Z",fill:n.color}),t.createElement("path",{d:"M10.2426 3.17149C10.6331 2.78097 10.6331 2.1478 10.2426 1.75728C9.85204 1.36676 9.21887 1.36676 8.82835 1.75728L8.12124 2.46439C7.73072 2.85491 7.73072 3.48808 8.12124 3.8786C8.51177 4.26912 9.14493 4.26912 9.53545 3.8786L10.2426 3.17149Z",fill:n.color}),t.createElement("path",{d:"M3.17149 10.2426L3.8786 9.53546C4.26912 9.14493 4.26912 8.51177 3.8786 8.12124C3.48808 7.73072 2.85491 7.73072 2.46439 8.12124L1.75728 8.82835C1.36676 9.21887 1.36676 9.85204 1.75728 10.2426C2.1478 10.6331 2.78097 10.6331 3.17149 10.2426Z",fill:n.color}),t.createElement("path",{d:"M6.37142 5.07152C6 4.92295 5.57578 5.01002 5.29292 5.29289C5.01006 5.57575 4.92298 5.99997 5.07155 6.37138L9.07155 16.3714C9.2178 16.737 9.56502 16.9828 9.95847 16.9991C10.3519 17.0155 10.7183 16.7994 10.8945 16.4472L12.274 13.6882L15.2929 16.7071C15.6834 17.0976 16.3166 17.0976 16.7071 16.7071C17.0977 16.3166 17.0977 15.6834 16.7071 15.2929L13.6882 12.2739L16.4472 10.8944C16.7995 10.7183 17.0155 10.3519 16.9992 9.95843C16.9828 9.56498 16.737 9.21777 16.3714 9.07152L6.37142 5.07152Z",fill:n.color}))},{style:{transform:"translate(-2px, -1px)"}}),id:v,onDrawStart:t=>{t.containerDiv.style.border=`1px solid ${k.primary.main}`,t.containerDiv.style.backgroundColor=k.primary.light+"4d"},onDrawing(t,e){wt(t),t.coords.splice(1),function(t,e){var n,o;const r=null!==(o=null===(n=e.lastEvent)||void 0===n?void 0:n.shiftKey)&&void 0!==o&&o,i=e.fullState[v].selectedIds,s=[...i];let c=function(t,e,n){const o=[];for(const[r,i]of t.entries())At(i,n),xt(e,Mt(i))&&o.push(r);return o}(e.objectsMap,Mt(t),e);r&&(c=new Array(...new Set([...c,...s])));Un(e,c)}(t,e),Hn($n,e)},onDrawEnd(t,e){const{objectsMap:n,viewContainer:o}=e;o.removeChild(t.containerDiv),n.delete(t.id),Qt('[id^="react-draw-cursor"',e.viewContainer),Wn(t,e),Hn($n,e)},onResize:t=>{},onUnMount(t){var e;for(const e of Object.values(t.objectsMap))At(e,t);(null===(e=$n.localState)||void 0===e?void 0:e.subs)&&($n.localState.subs=[])},onUnPickTool(t){const e=t.fullState[v],n=e.selectedIds;if(0===n.length)return;Be(je(n,t.objectsMap),t),e.selectedIds=[],Hn($n,t)},onKeyPress(t,e){"Delete"===t.key&&(Rn(e),Hn($n,e))},undoHandlers:{delete:hn,create:gn,drag:On,rotate:zn,resize:An},redoHandlers:{delete:hn,create:gn,drag:On,rotate:zn,resize:An},subscribe(t){var e;$n.localState||($n.localState={}),(null===(e=$n.localState)||void 0===e?void 0:e.subs)||($n.localState.subs=[]),$n.localState.subs.push(t)}};function Rn(t){const e=t.fullState[v].selectedIds;if(e.length<1)return;const n={toolId:"",toolType:"top-bar-tool",objectId:"",data:[],action:"delete"};n.toolId=v,n.data=[...e];const o=gn(n,t);t.shouldKeepHistory&&Nt(o,t)}const Wn=(t,e)=>{var n,o;const r=null!==(o=null===(n=e.lastEvent)||void 0===n?void 0:n.shiftKey)&&void 0!==o&&o,i=t.coords[0],s=t.coords[t.coords.length-1];Et(s,i)<75&&function(t,e,n,o){const r=function(t,e,n){let o=null;for(const[r,i]of t.entries()){const t=parseInt(i.style.zIndex);if(Pn({bounds:Mt(i),rotation:oe(i.containerDiv)},e,n)){if(null===o){o=i;continue}t>parseInt(o.style.zIndex)&&(o=i)}}return o}(t.objectsMap,e,n);let{ids:i}=function(t){const e=[...t.fullState[v].selectedIds],{objectsMap:n,prevMousePosition:o}=t,r=je(e,n);if(Be(r,t),1===r.length){const e=Bt(t.drawingTools,r[0].toolId);e&&t&&e.onUnSelect&&e.onUnSelect(r[0],t)}return o.current=null,{ids:e.splice(0,e.length),objects:r}}(t);o||(i=[]);null!==r&&(i=i.concat([r.id]));Un(t,i)}(e,i,s,r)};function Pn({bounds:t,rotation:e},...n){for(const o of n){const n=Ft(t),[r,i]=se(o,n);if(Ct(t,le(r,i,-e)))return!0}return!1}function Un(t,e){t.fullState[v].selectedIds=e;const n=je(e,t.objectsMap);return 1===n.length?(Ue(t.drawingTools,n[0],t),Ze(n[0],t)):n.length>1?We(n,t):void 0}const Bn={id:"react-draw-square-tool",tooltip:"Square Tool",icon:t.createElement(function(e){const n=St(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("rect",{width:"16",height:"16",rx:"1",fill:n.color}))},null),onDrawStart:t=>{const e=Zn(t.style);t.containerDiv.appendChild(e),t.element=e},onDrawing:t=>{wt(t),t.coords.splice(1)},onDrawEnd(t,e){un(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},undoHandlers:{create:pn,delete:fn,color:mn,background:bn,lineWidth:vn,opacity:yn},redoHandlers:{create:pn,delete:fn,color:mn,background:bn,lineWidth:vn,opacity:yn},onResize(t,e){},styleHandlers:{color:ln,background:sn,lineWidth:Dn,opacity:Sn}};function Zn(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=`${t.lineWidth}px solid ${t.color}`,e.style.borderRadius="2px",e.style.boxSizing="border-box",e.style.backgroundColor=t.background,e.style.opacity=t.opacity,e}const Yn={id:"react-draw-circle-tool",tooltip:"Circle tool",icon:t.createElement(function(e){const n=St(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("circle",{cx:"8",cy:"8",r:"8",fill:n.color}))},null),onDrawStart:t=>{const e=Vn(t.style);t.containerDiv.appendChild(e),t.element=e},onDrawing:t=>{wt(t),t.coords.splice(1)},onDrawEnd(t,e){un(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){},undoHandlers:{create:pn,delete:fn,color:mn,background:bn,lineWidth:vn,opacity:yn},redoHandlers:{delete:fn,create:pn,color:mn,background:bn,lineWidth:vn,opacity:yn},styleHandlers:{color:(t,e,n)=>ln(t,e),background:(t,e,n)=>sn(t,e),lineWidth:(t,e,n)=>Dn(t,e),opacity:(t,e,n)=>Sn(t,e)}};function Vn(t){const e=document.createElement("div");return e.style.width="100%",e.style.height="100%",e.style.border=an(t),e.style.backgroundColor=t.background,e.style.borderRadius="50%",e.style.boxSizing="border-box",e.style.opacity=t.opacity,e}const Kn={id:"react-draw-diamond-tool",tooltip:"Diamond tool",icon:t.createElement(function(e){const n=St(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("rect",{x:"11",y:"-0.313721",width:"16",height:"16",rx:"1",transform:"rotate(45 11 -0.313721)",fill:n.color}))},null),onDrawStart:t=>{const e=t.containerDiv,n=Fn(t);e.appendChild(n)},onDrawing:t=>{wt(t);const e=t.containerDiv,n=Fn(t);e.innerHTML="",e.appendChild(n),t.element=n,t.coords.splice(1)},onDrawEnd(t,e){un(t,e),t.customData.set(j,Mt(t)),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){vt(t.element,Mt(t))},undoHandlers:{create:pn,delete:fn,color:wn,background:xn,lineWidth:En,opacity:yn},redoHandlers:{create:pn,delete:fn,color:wn,background:xn,lineWidth:En,opacity:yn},styleHandlers:{color:rn,background:function(t,e){return on(t,"background","fill",e)},lineWidth:jn,opacity:Sn}};function Fn(t){const e=parseInt(t.style.lineWidth),n=Mt(t),{width:o,height:r}=n,i=tn(o+e,r+e,t.style.opacity),s=function(t,e){const n=_e(e);n.setAttribute("fill",e.background);const o=parseInt(e.lineWidth);return n.setAttribute("d",function(t,e){const n=t.bottom-t.top,o=t.right-t.left,r=`${e/2} ${n/2}`,i=`L ${o/2} ${e/2}`,s=`L ${o-e/2} ${n/2}`,c=`L ${o/2} ${n-e/2}`;return`M ${r} ${i} ${s} ${c} L ${r}`}(t,o)),n}(n,t.style);return i.appendChild(s),i}function Xn(t,e){const[n,o]=t,[r,i]=e;return r===n?i>o?"down":"up":i===o?r>n?"right":"left":r<n&&i<o?"nw":r>n&&i<o?"ne":r>n&&i>o?"se":"sw"}function Qn(t,e,n){return"right"===n?[[0,e/2],[t,e/2]]:"left"===n?[[t,e/2],[0,e/2]]:"down"===n?[[t/2,0],[t/2,e]]:"up"===n?[[t/2,e],[t/2,0]]:"nw"===n?[[t,e],[0,0]]:"ne"===n?[[0,e],[t,0]]:"se"===n?[[0,0],[t,e]]:[[t,0],[0,e]]}const qn={id:"react-draw-line-tool",tooltip:"Straight Line Tool",icon:t.createElement(function(e){const n=St(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 24 3",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("line",{y1:"1.5",x2:"24",y2:"1.5",stroke:"black",strokeWidth:"3"}))},null),onDrawStart:t=>{const e=t.containerDiv,n=parseInt(t.style.lineWidth),o=tn(n,n,t.style.opacity),r=en(n/2,t.style.color);o.appendChild(r),e.append(o),t.element=o},onDrawing:(t,e)=>{wt(t);const n=Xn(t.coords[0],t.coords[t.coords.length-1]);t.customData.set(I,n);const o=Gn(t,n),r=t.containerDiv;r.innerHTML="",r.appendChild(o),t.element=o,t.coords.splice(1)},onDrawEnd(t,e){un(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){const n=t.customData.get(I);if(!n)throw new Error("orientation not set");const o=Gn(t,n),r=t.containerDiv;r.removeChild(t.element),r.appendChild(o),t.element=o,t.coords.splice(1)},undoHandlers:{create:pn,delete:fn,color:wn,lineWidth:En,opacity:yn},redoHandlers:{create:pn,delete:fn,color:wn,lineWidth:En,opacity:yn},styleHandlers:{color:rn,lineWidth:jn,opacity:Sn}};function Gn(t,e){const n=Mt(t),o=n.right-n.left,r=n.bottom-n.top,i=tn(o,r,t.style.opacity);i.style.overflow="visible";const[s,c]=Qn(o,r,e),l=function(t){const e=document.createElementNS("http://www.w3.org/2000/svg","line");return e.setAttribute("fill","transparent"),e.setAttribute("stroke",t.color),e.style.strokeWidth=`${t.lineWidth}px`,e.setAttribute("stroke-linejoin","round"),e.setAttribute("stroke-linecap","round"),e}(t.style);return l.setAttribute("x1",s[0].toString()),l.setAttribute("y1",s[1].toString()),l.setAttribute("x2",c[0].toString()),l.setAttribute("y2",c[1].toString()),i.appendChild(l),i}const Jn={icon:t.createElement("span",{style:{display:"inline-block",fontWeight:"bold",fontSize:"20px"}},"A"),id:"react-draw-textarea-tool",tooltip:"Textarea Tool",cursor:"text",onDrawStart:(t,e)=>{co(t,e)},onDrawing(t,e){},onDrawEnd(t,e){un(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){ro(t,!1),so(t.element)},onSelect(t,e){ro(t,!1),so(t.element)},onUnSelect(t){ro(t,!1),io(t.containerDiv,Mt(t))},onAfterUpdate(t,e){ro(t,!1),so(t.element)},undoHandlers:{create:pn,delete:fn,input:to,color:eo,background:no,opacity:yn,fontSize:_n},redoHandlers:{create:pn,delete:fn,input:to,color:eo,background:no,opacity:yn,fontSize:_n},onDeleteObject(t,e){ro(t,!0)},styleHandlers:{color:function(t,e){return dn(t,"color","color",e)},background:function(t,e){return dn(t,"background","backgroundColor",e)},opacity:Sn,fontSize:function(t,e){const n=t.style.fontSize;return t.style.fontSize=e,t.containerDiv.style.fontSize=e+"px",io(t.containerDiv,Mt(t)),Ht(t,"fontSize",n)}}};function _n(t,e){const n=Yt(e.objectsMap,t.objectId),o=n.style.fontSize,r=t.data;return n.style.fontSize=r,n.containerDiv.style.fontSize=r+"px",t.data=o,t}function to(t,e){const n=Yt(e.objectsMap,t.objectId).element;if(!n)throw new Error("tried to undo text but no ele found");const o=n.innerHTML,r=t.data;return n.innerHTML=r,t.data=o,t}function eo(t,e){return oo(t,e,"color","color")}function no(t,e){return oo(t,e,"background","backgroundColor")}function oo(t,e,n,o){const r=Yt(e.objectsMap,t.objectId),i=r.style[n],s=t.data;return r.style[n]=s,r.containerDiv.style[o]=s,t.data=i,t}function ro(t,e){const n=t.element;if(!n)return;const o=t.customData.get("handler");o&&(n.removeEventListener("keypress",o),t.customData.delete("handler"));const r=t.customData.get("capture");e&&r&&(n.removeEventListener("input",r),t.customData.delete("capture"))}function io(t,e){const n=t.getBoundingClientRect(),{width:o,height:r}=n;e.bottom=e.top+r,e.right=e.left+o}function so(t){if(t.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);const n=window.getSelection();if(n)return n.removeAllRanges(),n.addRange(e),!0}return console.error("cannot place caret at end"),!1}function co(t,e){const n=t.containerDiv,o=Mt(t);$t(t),function(t){const e=parseInt(t.style.fontSize),n=t.containerDiv,o=Mt(t),r=o.top+e+5;n.style.height="",n.style.minHeight=r-o.top+"px",n.style.minWidth=n.style.width,n.style.width="",n.style.border="1px solid black"}(t),function(t){const e=t.containerDiv;e.style.padding="5px",e.style.borderRadius="2px",e.style.boxSizing="border-box";const n=document.createElement("style");n.innerHTML="\n\t.react-draw-cursor {\n\t\toutline: none;\t\t\n\t\theight: 100%;\n\t}",e.appendChild(n)}(t);const r=function(){const t=document.createElement("div");return t.setAttribute("contenteditable","true"),t.style.minWidth="1px",t.style.height="100%",t.className="react-draw-cursor",t}();return r.style.opacity=t.style.opacity,t.element=r,n.appendChild(r),io(n,o),r.setAttribute("tabindex","1"),lo(t,e),setTimeout(function(){r.focus()},0),r}function lo(t,e){const n=t.element,o=t.customData;function r(n){const r=(new Date).getTime(),i=o.get("lastCapture");if(i){if(r-i>5e3){const o=n.target;Nt({toolId:t.toolId,action:"input",data:o.innerHTML,toolType:"top-bar-tool",objectId:t.id},e)}}else{Nt({toolId:t.toolId,action:"input",data:"",toolType:"top-bar-tool",objectId:t.id},e)}o.set("lastCapture",r)}n.addEventListener("input",r),o.set("capture",r)}const ao={icon:t.createElement(function(e){const n=St(e);return t.createElement("svg",Object.assign({},n,{viewBox:"0 0 16 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.2929 0.292893C10.6834 -0.0976311 11.3166 -0.0976311 11.7071 0.292893L15.7071 4.29289C16.0976 4.68342 16.0976 5.31658 15.7071 5.70711L11.7071 9.70711C11.3166 10.0976 10.6834 10.0976 10.2929 9.70711C9.90237 9.31658 9.90237 8.68342 10.2929 8.29289L12.5858 6H1C0.447716 6 -2.41411e-08 5.55228 0 5C2.41411e-08 4.44772 0.447716 4 1 4H12.5858L10.2929 1.70711C9.90237 1.31658 9.90237 0.683418 10.2929 0.292893Z",fill:n.color}))},null),id:"react-draw-arrow-tool",tooltip:"Arrow Tool",onDrawStart:t=>{const e=t.containerDiv,n=parseInt(t.style.lineWidth),o=tn(n,n,t.style.opacity),r=en(n/2,t.style.color);o.appendChild(r),e.append(o),t.element=o},onDrawing:(t,{viewContainer:e})=>{wt(t);const n=Xn(t.coords[0],t.coords[t.coords.length-1]);t.customData.set(I,n);const o=uo(t,n),r=t.containerDiv;r.innerHTML="",r.appendChild(o),t.element=o,t.coords.splice(1)},onDrawEnd:(t,e)=>{e.shouldKeepHistory&&un(t,e),e.shouldSelectAfterCreate&&e.selectObject(t)},onResize(t,e){const n=t.customData.get(I);if(!n)throw new Error("orientation not set");const o=uo(t,n),r=t.containerDiv;r.removeChild(t.element),r.appendChild(o),t.element=o,t.coords.splice(1)},undoHandlers:{create:pn,delete:fn,color:wn,lineWidth:En,opacity:yn},redoHandlers:{create:pn,delete:fn,color:wn,lineWidth:En,opacity:yn},styleHandlers:{color:(t,e,n)=>rn(t,e),lineWidth:(t,e,n)=>jn(t,e),opacity:(t,e,n)=>Sn(t,e)}};function uo(t,e){const n=parseInt(t.style.lineWidth),{width:o,height:r}=Mt(t),[i,s]=Qn(o,r,e),c=tn(o+n,r+n,t.style.opacity);c.style.overflow="visible";const l=function(t,e,n){const[o,r]=e,[i,s]=n,c=_e(t.style),l=[o-i,r-s],[a,d]=l,u=Math.sqrt(a*a+d*d),p=[a/u,d/u],[f,h]=p,g=f*(Math.sqrt(3)/2)-.5*h,y=1*f/2+h*(Math.sqrt(3)/2),v=f*(Math.sqrt(3)/2)+.5*h,b=.5*-f+h*(Math.sqrt(3)/2),m=20,[w,x,C,E]=[-g*m,-y*m,-v*m,-b*m];return c.setAttribute("d",`M ${o} ${r} L ${i} ${s} L ${i-w} ${s-x} L ${i} ${s} L ${i-C} ${s-E}`),c}(t,i,s);return c.appendChild(l),c}const po={icon:t.createElement(function(e){const n=St(e),{color:o}=n,r=It(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M10.0616 0.586573L5.31159 5.33657L0.581585 10.1766C0.209084 10.5513 0 11.0582 0 11.5866C0 12.1149 0.209084 12.6218 0.581585 12.9966L4.88159 17.2966C5.06785 17.4813 5.31925 17.5855 5.58159 17.5866H17.5816V15.5866H10.5816L17.8016 8.36657C17.9875 8.18083 18.1351 7.96025 18.2357 7.71745C18.3364 7.47466 18.3882 7.2144 18.3882 6.95157C18.3882 6.68874 18.3364 6.42849 18.2357 6.18569C18.1351 5.9429 17.9875 5.72232 17.8016 5.53657L12.8916 0.586573C12.7058 0.40062 12.4853 0.253102 12.2425 0.152454C11.9997 0.0518053 11.7394 0 11.4766 0C11.2138 0 10.9535 0.0518053 10.7107 0.152454C10.4679 0.253102 10.2473 0.40062 10.0616 0.586573V0.586573ZM5.99159 15.5866L1.99159 11.5866L6.74159 6.74657L7.48159 5.99657L12.4316 10.9466L7.87159 15.5066L7.80159 15.5866H5.99159Z",fill:o}))},null),tooltip:"Eraser tool",id:y,cursor:"url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOSAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjA2MTYgMC41ODY1NzNMNS4zMTE1OSA1LjMzNjU3TDAuNTgxNTg1IDEwLjE3NjZDMC4yMDkwODQgMTAuNTUxMyAwIDExLjA1ODIgMCAxMS41ODY2QzAgMTIuMTE0OSAwLjIwOTA4NCAxMi42MjE4IDAuNTgxNTg1IDEyLjk5NjZMNC44ODE1OSAxNy4yOTY2QzUuMDY3ODUgMTcuNDgxMyA1LjMxOTI1IDE3LjU4NTUgNS41ODE1OSAxNy41ODY2SDE3LjU4MTZWMTUuNTg2NkgxMC41ODE2TDE3LjgwMTYgOC4zNjY1N0MxNy45ODc1IDguMTgwODMgMTguMTM1MSA3Ljk2MDI1IDE4LjIzNTcgNy43MTc0NUMxOC4zMzY0IDcuNDc0NjYgMTguMzg4MiA3LjIxNDQgMTguMzg4MiA2Ljk1MTU3QzE4LjM4ODIgNi42ODg3NCAxOC4zMzY0IDYuNDI4NDkgMTguMjM1NyA2LjE4NTY5QzE4LjEzNTEgNS45NDI5IDE3Ljk4NzUgNS43MjIzMiAxNy44MDE2IDUuNTM2NTdMMTIuODkxNiAwLjU4NjU3M0MxMi43MDU4IDAuNDAwNjIgMTIuNDg1MyAwLjI1MzEwMiAxMi4yNDI1IDAuMTUyNDU0QzExLjk5OTcgMC4wNTE4MDUzIDExLjczOTQgMCAxMS40NzY2IDBDMTEuMjEzOCAwIDEwLjk1MzUgMC4wNTE4MDUzIDEwLjcxMDcgMC4xNTI0NTRDMTAuNDY3OSAwLjI1MzEwMiAxMC4yNDczIDAuNDAwNjIgMTAuMDYxNiAwLjU4NjU3M1YwLjU4NjU3M1pNNS45OTE1OSAxNS41ODY2TDEuOTkxNTkgMTEuNTg2Nkw2Ljc0MTU5IDYuNzQ2NTdMNy40ODE1OSA1Ljk5NjU3TDEyLjQzMTYgMTAuOTQ2Nkw3Ljg3MTU5IDE1LjUwNjZMNy44MDE1OSAxNS41ODY2SDUuOTkxNTlaIiBmaWxsPSJibGFjayI+PC9wYXRoPgo8L3N2Zz4=) 0 16, pointer",onDrawStart(t,e){},onDrawing(t,e){const n=e.viewContainer;mt(t);const o=Mt(t),r=tn(o.width,o.height,"1"),i=function(t,e){const n=_e(t.style);return n.style.strokeWidth="10px",n.setAttribute("d",function(t,e){let n="",o=t.coords[0];for(let r=0;r<t.coords.length;r++){const i=bt(t.coords[r],t.containerDiv,e);n+=ho(i,o,r),o=i,r!==t.coords.length-1&&(n+=" ")}return n}(t,e)),n.setAttribute("stroke","rgba(232, 16, 84, 0.142)"),n}(t,n);r.appendChild(i);const s=t.containerDiv;s.innerHTML="",s.appendChild(r),t.element=r;const c=function(t){const[e,n]=t;return{top:n,right:e,bottom:n,left:e}}(t.coords[t.coords.length-1]),l=e.objectsMap.keys();for(const t of l){const n=e.objectsMap.get(t);if(!n)continue;xt(Mt(n),c)&&(Zt(t,e),fo(e,n))}},onDrawEnd(t,e){const{objectsMap:n,viewContainer:o}=e;o.removeChild(t.containerDiv),n.delete(t.id),Qt('[id^="react-draw-erase-tool"',e.viewContainer);if(e.fullState[y].deletedObjects.size>0&&e.shouldKeepHistory){const n={toolId:t.toolId,toolType:"top-bar-tool",objectId:"",action:"delete",data:e.fullState[y].deletedObjects};e.fullState[y].deletedObjects=new Map,Nt(n,e)}},undoHandlers:{delete:hn},redoHandlers:{create:gn},onResize(t,e){}};function fo(t,e){t.fullState[y].deletedObjects.set(e.id,e)}function ho(t,e,n){return 0===n?`M ${t[0]} ${t[1]}`:`l ${t[0]-e[0]} ${t[1]-e[1]}`}const go={id:"react-draw-undo-tool",tooltip:"Undo",icon:t.createElement(function(e){const n=St(e),{color:o}=n,r=It(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M8.4345 1.3088e-05C6.17654 0.00387579 4.12643 0.851527 2.61286 2.2295L1.39599 1.07024C0.88081 0.57945 0 0.927028 0 1.62108V5.97259C0 6.40284 0.36611 6.75162 0.817742 6.75162H5.38548C6.11402 6.75162 6.47887 5.91251 5.96372 5.42172L4.54119 4.06653C5.59281 3.12847 6.95357 2.60886 8.39923 2.59698C11.5475 2.57108 14.2012 4.99825 14.174 8.09701C14.1482 11.0366 11.6466 13.5032 8.45 13.5032C7.0487 13.5032 5.7243 13.0268 4.68055 12.1543C4.51894 12.0193 4.27488 12.0275 4.12285 12.1723L2.77146 13.4597C2.60546 13.6178 2.61367 13.8757 2.78789 14.0256C4.28626 15.3149 6.27188 16.1 8.45 16.1C13.1168 16.1 16.9 12.4959 16.9 8.05007C16.9 3.6093 13.0959 -0.00793953 8.4345 1.3088e-05Z",fill:o}))},null),getDisplayMode:t=>t.undoStack.length>0?"show":"disabled",handleContext(t){const e=t.undoStack.pop();if(e)return"top-bar-tool"===e.toolType?function(t,e){const n=e.toolId,o=Bt(t.drawingTools,n),r=o.undoHandlers,i=e.action;if(!r)return void console.error("tool:",o,"does not implement undo functionality");const s=r[i];s||console.error("tool:",o,"does not implement undo action:",i);const c=s(e,t);t.shouldKeepHistory&&t.redoStack.push(c)}(t,e):"batch"===e.toolType?function(t,e){const n=e.data,o=[];for(const e of n){const n=e.toolId,r=Bt(t.drawingTools,n),i=r.undoHandlers,s=e.action;if(!i)return void console.error("tool:",r,"does not implement undo functionality");const c=i[s];if(!c)return void console.error("tool:",r,"does not implement action:",s);o.push(c(e,t))}e.data=o,t.shouldKeepHistory&&t.redoStack.push(e)}(t,e):void 0}};const yo={id:"react-draw-redo-tool",tooltip:"Redo",icon:t.createElement(function(e){const n=St(e),{color:o}=n,r=It(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M8.28183 1.34403e-05C10.4908 0.0039801 12.4964 0.874446 13.9771 2.28951L15.1676 1.09901C15.6716 0.595046 16.5333 0.951979 16.5333 1.66471V6.13334C16.5333 6.57517 16.1752 6.93334 15.7333 6.93334H11.2647C10.552 6.93334 10.195 6.07164 10.699 5.56764L12.0907 4.17598C11.0619 3.21268 9.73063 2.67908 8.31633 2.66688C5.2364 2.64028 2.64023 5.13278 2.66687 8.31494C2.69213 11.3336 5.13947 13.8667 8.26667 13.8667C9.63757 13.8667 10.9332 13.3774 11.9543 12.4815C12.1124 12.3428 12.3512 12.3512 12.4999 12.4999L13.822 13.822C13.9844 13.9844 13.9763 14.2491 13.8059 14.4031C12.3401 15.7271 10.3975 16.5333 8.26667 16.5333C3.70113 16.5333 3.33336e-05 12.8322 2.23918e-10 8.26674C-3.33331e-05 3.70644 3.72153 -0.00815322 8.28183 1.34403e-05Z",fill:o}))},null),getDisplayMode:t=>t.redoStack.length>0?"show":"disabled",handleContext(t){const e=t.redoStack.pop();if(e)return"top-bar-tool"===e.toolType?function(t,e){const n=e.toolId,o=Bt(t.drawingTools,n),r=o.redoHandlers,i=e.action;if(!r)return void console.error("tool:",o,"does not implement undo functionality");const s=r[i];s||console.error("tool:",o,"does not implement undo action:",i);const c=s(e,t);t.shouldKeepHistory&&t.undoStack.push(c)}(t,e):"batch"===e.toolType?function(t,e){const n=e.data,o=[];for(const e of n){const n=e.toolId,r=Bt(t.drawingTools,n),i=r.redoHandlers,s=e.action;if(!i)return void console.error("tool:",r,"does not implement undo functionality");const c=i[s];if(!c)return void console.error("tool:",r,"does not implement action:",s);o.push(c(e,t))}e.data=o,t.shouldKeepHistory&&t.undoStack.push(e)}(t,e):void 0}};const vo={id:"react-draw-trash-tool",icon:t.createElement(function(e){const n=St(e),{color:o}=n,r=It(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 14 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0C5.62123 0 5.27497 0.214002 5.10557 0.552786L4.38197 2H1C0.447715 2 0 2.44772 0 3C0 3.55228 0.447716 4 1 4L1 14C1 15.1046 1.89543 16 3 16H11C12.1046 16 13 15.1046 13 14V4C13.5523 4 14 3.55228 14 3C14 2.44772 13.5523 2 13 2H9.61804L8.89443 0.552786C8.72504 0.214002 8.37877 0 8 0H6ZM4 6C4 5.44772 4.44772 5 5 5C5.55228 5 6 5.44772 6 6V12C6 12.5523 5.55228 13 5 13C4.44772 13 4 12.5523 4 12V6ZM9 5C8.44771 5 8 5.44772 8 6V12C8 12.5523 8.44771 13 9 13C9.55229 13 10 12.5523 10 12V6C10 5.44772 9.55229 5 9 5Z",fill:o}))},null),tooltip:"Delete selected objects",getDisplayMode:t=>Ke(t).length>0?"show":"disabled",handleContext(t){const e=Ke(t);e.length<1||Gt(e,t)}},bo={id:"react-draw-duplicate-tool",tooltip:"Duplicate objects",icon:t.createElement(function(e){const n=St(e),{color:o}=n,r=It(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M4 6C4 4.89543 4.89543 4 6 4H12C13.1046 4 14 4.89543 14 6V12C14 13.1046 13.1046 14 12 14H6C4.89543 14 4 13.1046 4 12V6Z",fill:o}),t.createElement("path",{d:"M2 0C0.895431 0 0 0.89543 0 2V8C0 9.10457 0.89543 10 2 10L2 2H10C10 0.895431 9.10457 0 8 0H2Z",fill:o}))},null),getDisplayMode:t=>Ke(t).length>0?"show":"disabled",handleContext(t){mo(t)}};function mo(t){const e=Ke(t);if(e.length<1)return null;const n=e.map(e=>Yt(t.objectsMap,e));Be(n,t);const o=n.map(e=>function(t,e){const n=t.containerDiv,o=n.cloneNode(!0),{newId:r,divId:i}=function(t){const e=ft(6),n=t.split("-");return n[n.length-1]=ft(6),{divId:n.join("-"),newId:e}}(n.id);o.id=i;const s=ee(e),c=s+1,l={coords:t.coords.slice(0),toolId:t.toolId,element:o.lastElementChild,style:Object.assign(Object.assign({},t.style),{zIndex:c.toString()}),customData:new Map(t.customData),containerDiv:o,id:r},a=Mt(t);o.style.top=a.top+5+"px",o.style.left=a.left+10+"px",o.style.zIndex=c.toString();const d=Bt(e.drawingTools,t.toolId);if(d.onDuplicate)return d.onDuplicate(l,e);return l}(e,t)),r=o.map(e=>{const{toolId:n,id:o}=e;t.objectsMap.set(o,e),t.viewContainer.appendChild(e.containerDiv);return{action:"create",toolType:"top-bar-tool",toolId:n,objectId:o,data:e}});if(t.shouldKeepHistory){Nt({toolId:"",objectId:"",toolType:"batch",action:"batch",data:r},t)}1===e.length?Ze(o[0],t):We(o,t);return t.fullState[v].selectedIds=o.map(t=>t.id),o}const wo={id:"react-draw-back-tool",icon:t.createElement(function(e){const n=St(e),{color:o}=n,r=It(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M15 17L5 9L15 1V17Z",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),t.createElement("path",{d:"M1 16V2",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))},null),tooltip:"Move object back",getDisplayMode:t=>Ke(t).length>0?"show":"disabled",handleContext(t){xo(t)}};function xo(t){var e,n;const o=Ke(t);if(o.length<1)return;let r=[],i=new Set;o.forEach(e=>{r.push(Yt(t.objectsMap,e)),i.add(e)});for(const t of r)t.style.zIndex="0",t.containerDiv.style.zIndex="0";let s=1/0;for(const n of t.objectsMap.values()){if(i.has(n.id))continue;const t=parseInt(null!==(e=n.containerDiv.style.zIndex)&&void 0!==e?e:"0");t<s&&(s=t)}let c=1;s<0&&(c=1-s);for(const e of t.objectsMap.values()){if(i.has(e.id))continue;const t=parseInt(null!==(n=e.containerDiv.style.zIndex)&&void 0!==n?n:"0")+c;e.style.zIndex=t.toString(),e.containerDiv.style.zIndex=t.toString()}}const Co={id:"react-draw-forward-tool",tooltip:"Move object forward",icon:t.createElement(function(e){const n=St(e),{color:o}=n,r=It(n,["color"]);return t.createElement("svg",Object.assign({},r,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),t.createElement("path",{d:"M1 1L11 9L1 17V1Z",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),t.createElement("path",{d:"M15 2V16",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))},null),getDisplayMode:t=>Ke(t).length>0?"show":"disabled",handleContext(t){Eo(t)}};function Eo(t){const e=Ke(t);if(e.length<1)return;const n=e.map(e=>Yt(t.objectsMap,e));n.sort((t,e)=>Mo(t)-Mo(e));const o=[];for(const n of t.objectsMap.values())e.includes(n.id)||o.push(n);let r=o.length+1;for(const t of n)t.style.zIndex=r.toString(),t.containerDiv.style.zIndex=r.toString(),r+=1;o.sort((t,e)=>{const n=Mo(t);return Mo(e)-n});let i=o.length;o.forEach(t=>{t.style.zIndex=i.toString(),t.containerDiv.style.zIndex=i.toString(),i-=1})}const Mo=t=>t.containerDiv.style.zIndex?parseInt(t.containerDiv.style.zIndex):t.style.zIndex?parseInt(t.style.zIndex):0;function Do({onUpdate:e,styleKey:n,label:o,styleValue:r}){const s=i(ft(5));return t.createElement("div",null,t.createElement("div",{style:{textAlign:"left",marginBottom:5}},t.createElement("label",{style:{fontWeight:"bold"},htmlFor:s.current},o)),t.createElement("div",{style:{display:"flex"}},t.createElement("span",{style:{display:"inline-block",borderRadius:5,width:30,height:30,backgroundColor:r}}),t.createElement("div",{style:{marginLeft:10,display:"flex"}},t.createElement("span",{style:{borderRadius:"5px 0px 0px 5px",width:30,padding:5,fontWeight:"bold",fontSize:18,textAlign:"center",color:"grey",backgroundColor:"lightgray"}},"#"),t.createElement("input",{id:s.current,value:r.replace("#",""),onChange:t=>{const o=t.target.value;e(n,"transparent"===o?o:"#"+o)},style:{width:80,borderRadius:"0px 5px 5px 0px"}}))))}const jo=e=>t.createElement(Do,Object.assign({},e,{label:"color"})),Io=e=>t.createElement(Do,Object.assign({},e,{label:"background"}));function So({onUpdate:e,styleKey:n,styleValue:o}){const r=i(ft(5));return t.createElement("div",null,t.createElement("div",{style:{textAlign:"left",marginBottom:5}},t.createElement("label",{style:{fontWeight:"bold"},htmlFor:r.current},"line width")),t.createElement("div",{style:{width:"100%"}},t.createElement("input",{id:r.current,value:o,onChange:t=>{const o=t.target.value;e(n,o)},type:"number",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",step:"1"})))}function ko({onUpdate:e,styleKey:n,styleValue:o}){const r=i(ft(5));return t.createElement("div",null,t.createElement("div",{style:{textAlign:"left",marginBottom:5}},t.createElement("label",{style:{fontWeight:"bold"},htmlFor:r.current},"opacity (",o,")")),t.createElement("div",{style:{width:"100%"}},t.createElement("input",{id:r.current,value:o,onChange:t=>{const o=t.target.value;e(n,o)},type:"range",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",max:"1",step:"0.1"})))}function Lo({onUpdate:e,styleKey:n,styleValue:o}){const r=i(ft(5));return t.createElement("div",null,t.createElement("div",{style:{textAlign:"left",marginBottom:5}},t.createElement("label",{style:{fontWeight:"bold"},htmlFor:r.current},"font size")),t.createElement("div",{style:{width:"100%"}},t.createElement("input",{id:r.current,value:o,onChange:t=>{const o=t.target.value;e(n,o)},type:"number",style:{boxSizing:"border-box",width:168,height:30,borderRadius:5,paddingLeft:10,fontSize:19,lineHeight:"1.6"},min:"0",step:"1"})))}const To=({getContext:e})=>{const n=st(w),o=t.useRef(ft(6));return t.createElement("button",{className:n,id:o.current,onClick:()=>{const t=e();if(0===t.objectsMap.size)return;const n=t.objectsMap.keys();Gt(Array.from(n),t)}},t.createElement("div",{style:{padding:"0px 5px",height:20}},t.createElement(Lt,{width:15,height:20})),t.createElement("label",{htmlFor:o.current,style:{padding:"0px 10px",pointerEvents:"none"}},"Clear All"))};function Oo(t,e){const n=[];for(const o of e.objectsMap.values()){const e=t[o.toolId];if(void 0===e)return Vo(o,t);n.push(e(o))}return JSON.stringify(n)}const zo=t=>{const{containerState:e,customData:n}=$o(t);return Object.assign(Object.assign({},t),{containerDiv:e,customData:n})},Ao=t=>{const e=Ho(t),n=Po(t);return Object.assign(Object.assign({},t),{containerDiv:e,customData:n})},No=t=>{const{containerState:e,customData:n}=$o(t);return Object.assign(Object.assign({},t),{containerDiv:e,customData:n})};function Ho(t){return{rotation:oe(t.containerDiv),bbox:Mt(t),scale:null,other:{}}}function $o(t){var e;const n=Ho(t);n.scale=function(t){const e=Rt(t).style.transform.match(Wt);return e?{x:e[0],y:e[1]}:{x:"1",y:"1"}}(t),n.other.viewbox=null===(e=t.element)||void 0===e?void 0:e.getAttribute("viewbox");return{containerState:n,customData:Po(t)}}function Ro(t){return{containerState:Ho(t),customData:Po(t)}}const Wo=t=>{const{containerState:e,customData:n}=$o(t);return Object.assign(Object.assign({},t),{containerDiv:e,customData:n})},Po=t=>{const e={};for(const n of t.customData.keys())e[n]=t.customData.get(n);return e},Uo=t=>{const{containerState:e,customData:n}=Ro(t);return Object.assign(Object.assign({},t),{containerDiv:e,customData:n})},Bo=t=>{const{containerState:e,customData:n}=$o(t);return Object.assign(Object.assign({},t),{containerDiv:e,customData:n})},Zo=t=>{const{containerState:e,customData:n}=Ro(t);e.other.text=t.containerDiv.innerText;return Object.assign(Object.assign({},t),{containerDiv:e,customData:n})};function Yo(t,e,n,o=!0){const r=JSON.parse(t),i=[];for(const t of r){const r=e[t.toolId];if(void 0===r)return Vo(t,e);const s=r(t,n,o);i.push(s)}return i}function Vo(t,e){throw new Error("toolid not function in serializers. id: "+t.toolId+" .options: "+Object.keys(e)+" . object: "+JSON.stringify(t))}function Ko(t){var e;const n=t,o=n.containerDiv,r=n.customData,i=n.coords[0],s=parseInt(n.style.lineWidth),c=parseInt(null!==(e=n.style.zIndex)&&void 0!==e?e:"0"),{id:l,div:a}=yt(i[0],i[1],s,n.toolId,c);return{drawingData:{toolId:n.toolId,id:l,style:n.style,customData:nr(r),containerDiv:a,element:null,coords:n.coords},div:a,containerState:o}}function Fo(t,e){t.containerDiv.innerHTML="",t.containerDiv.appendChild(e),t.element=e}function Xo(t,e){t.style.transform=`rotate(${e.rotation}deg)`}const Qo=(t,e,n=!0)=>{var o,r;const{drawingData:i,div:s,containerState:c}=Ko(t),l=i.customData.get(j),a=c.bbox;Nn(s,l),n&&_t(e,i);const d=tn(l.width,l.height,i.style.opacity);d.setAttribute("viewbox",c.other.viewbox),d.style.overflow="visible";const u=Ln(i,e.viewContainer);return u.style.transform=`scale(${null===(o=c.scale)||void 0===o?void 0:o.x}, ${null===(r=c.scale)||void 0===r?void 0:r.y})`,d.appendChild(u),Fo(i,d),Xo(d,c),Nn(s,a),i},qo=(t,e,n)=>{const{drawingData:o,containerState:r,div:i}=Ko(t);return Fo(o,Zn(t.style)),Xo(i,r),Nn(i,r.bbox),n&&_t(e,o),o},Go=(t,e,n)=>{const{drawingData:o,containerState:r,div:i}=Ko(t);Nn(i,r.bbox);return Fo(o,Vn(o.style)),Xo(i,r),n&&_t(e,o),o},Jo=(t,e,n)=>{var o,r;const{drawingData:i,div:s,containerState:c}=Ko(t),l=i.customData.get(j),a=c.bbox;Nn(s,l),n&&_t(e,i);const d=Fn(i);d.setAttribute("viewbox",c.other.viewbox),d.style.overflow="visible";const u=d.getElementsByTagName("path")[0];return u&&(u.style.transform=`scale(${null===(o=c.scale)||void 0===o?void 0:o.x}, ${null===(r=c.scale)||void 0===r?void 0:r.y})`),Fo(i,d),Xo(d,c),Nn(s,a),i},_o=(t,e,n)=>{const{drawingData:o,div:r,containerState:i}=Ko(t),s=o.customData.get(I);Nn(r,i.bbox),n&&_t(e,o);const c=Gn(o,s);return c.setAttribute("viewbox",i.other.viewbox),c.style.overflow="visible",Fo(o,c),Xo(c,i),o},tr=(t,e,n)=>{const{drawingData:o,containerState:r,div:i}=Ko(t);return co(o,e),i.innerHTML=r.other.text,Nn(i,r.bbox),Xo(i,r),n&&_t(e,o),o},er=(t,e,n)=>{const{drawingData:o,div:r,containerState:i}=Ko(t),s=o.customData.get(I);Nn(r,i.bbox),n&&_t(e,o);const c=uo(o,s);return c.setAttribute("viewbox",i.other.viewbox),c.style.overflow="visible",Fo(o,c),Xo(c,i),o};function nr(t){const e=new Map;for(const n in t){const o=t[n];e.set(n,o)}return e}function or(t,e){const{toolId:n,text:o,viewLocation:r,editable:i,useTextToolDefaults:s}=e,c=Jt(t,null!=r?r:Xt(t),n);if(s){const e=co(c,t);return e.innerHTML=o,_t(t,c),so(e),c}const l=document.createElement("div");l.style.width="fit-content",l.innerText=o;const a=c.containerDiv;a.appendChild(l),c.element=l,_t(t,c);const d=l.getBoundingClientRect();return a.style.width=d.width+"px",a.style.height=d.height+"px",a.style.display="flex",a.style.justifyContent="center",a.style.alignItems="center",$t(c),i?(l.setAttribute("tabindex","1"),l.contentEditable="true",n===Jn.id&&lo(c,t),c):(l.contentEditable="false",c)}function rr(t,e){Zt(e,t)}function ir(t){lr(t),Rn(t)}function sr(t,e){const n=Jt(t,e.pointA,e.toolId),o=Vn(t.globalStyles);return n.containerDiv.appendChild(o),n.element=o,n.coords.push(e.pointB),wt(n),_t(t,n),t.selectObject(n),n}function cr(t,e){return a(this,void 0,void 0,function*(){const n=Jt(t,e.pointA,e.toolId);_t(t,n),n.coords.push(e.pointB),wt(n);const o=e.url;return new Promise((r,i)=>{var s;const c=e=>{n.element=e,n.containerDiv.innerHTML="",n.containerDiv.appendChild(e),t.shouldSelectAfterCreate&&t.selectObject(n),r(n)};if(o){if(e.showLoading){const t=null!==(s=e.loadingElement)&&void 0!==s?s:function(){const t=document.createElement("style");t.innerHTML=".skeleton-loader {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\tborder-radius: 10px;\n\t\t\t\t\tbackground: linear-gradient(\n\t\t\t\t\t\t\tto right,\n\t\t\t\t\t\t\trgba(255, 255, 255, 0),\n\t\t\t\t\t\t\trgba(255, 255, 255, 0.5) 50%,\n\t\t\t\t\t\t\trgba(255, 255, 255, 0) 80%\n\t\t\t\t\t\t),\n\t\t\t\t\t\tlightgray;\n\t\t\t\t\tbackground-repeat: repeat-y;\n\t\t\t\t\tbackground-size: 50px 500px;\n\t\t\t\t\tbackground-position: 0 0;\n\t\t\t\t\tanimation: shine 1s infinite;\n\t\t\t\t}\n\t\t\t\t@keyframes shine {\n\t\t\t\t\tto {\n\t\t\t\t\t\tbackground-position: 100% 0, /* move highlight to right */ 0 0;\n\t\t\t\t\t}\n\t\t\t\t}";const e=document.createElement("div");e.appendChild(t),e.style.width="100%",e.style.height="100%";const n=document.createElement("span");return n.className="skeleton-loader",e.appendChild(n),e}();n.containerDiv.appendChild(t)}const t=new Image;return t.style.width="100%",t.style.height="100%",t.crossOrigin="anonymous",t.onload=function(){c(t)},t.onerror=()=>{i(null)},t.src=o,n}const l=e.image;if(!l)throw new Error("createImage must be given either url (string) or image (HTMLImageElement) options. Neither provided.");c(l)})})}function lr(t){const e=je(Ke(t),t.objectsMap);e.length>0&&Be(e,t);const n=Array.from(t.objectsMap.keys());t.fullState[v].selectedIds=n;const o=Array.from(t.objectsMap.values());return 1===o.length?(Ue(t.drawingTools,o[0],t),Ze(o[0],t)):o.length>1?We(o,t):void 0}function ar(t){return je(Ke(t),t.objectsMap)}export{Io as BackgroundStyle,k as COLORS,To as ClearAllButton,jo as ColorStyle,Lo as FontSizeStyle,So as LineWidthStyle,ko as OpacityStyle,Je as ReactDraw,_t as addObject,ao as arrowTool,wo as bringBackTool,Co as bringForwardTool,xo as bringSelectedBack,te as centerObject,Yn as circleTool,sr as createCircle,cr as createImage,Jt as createNewObject,or as createText,ir as deleteAll,rr as deleteObject,Rn as deletedSelected,Ko as deserializationSetup,er as deserializeArrow,Go as deserializeCircle,Yo as deserializeData,Jo as deserializeDiamond,Qo as deserializeFreeDraw,_o as deserializeLine,qo as deserializeSquare,tr as deserializeTextArea,Kn as diamondTool,mo as duplicateSelectedObjects,bo as duplicateTool,po as eraseTool,kn as freeDrawTool,ar as getSelectedObjects,Xt as getViewCenterPoint,ut as isActionTool,dt as isDrawingTool,uo as makeArrowSvg,Vn as makeCircleDiv,Fn as makeDiamondSvg,Gn as makeLineInOrientation,yt as makeNewDiv,Zn as makeSquareDiv,Eo as moveSelectedForward,Ue as notifyTool,yo as redoTool,lr as selectAll,Ze as selectElement,We as selectManyElements,$n as selectTool,zo as serializeArrow,Ao as serializeCircle,No as serializeDiamond,Wo as serializeFreeDraw,Bo as serializeLine,Oo as serializeObjects,Uo as serializeSquare,Zo as serializeText,wt as setContainerRect,co as setupTextAreaDiv,Bn as squareTool,qn as straightLineTool,Jn as textAreaTool,vo as trashTool,go as undoTool,Be as unselectAll,At as unselectElement,st as useStyles};
