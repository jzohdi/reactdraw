import{u as H,a as B,b as R,d as S,r as v,e as w,T as F,h as f,i as N,j as _,k as y,l as A,p as D,m as k,n as O,o as U,S as W,q as P,t as q,v as V,w as X,x as m,y as G,z as x,A as g,g as J}from"./ClearAllButton-DK1678Z8.js";import{e as Q}from"./iframe-ThtCju29.js";const Y={icon:Q.createElement("span",{style:{display:"inline-block",fontWeight:"bold",fontSize:"20px"}},"A"),id:F,tooltip:"Textarea Tool",cursor:"text",onDrawStart:(e,t)=>{M(e,t)},onDrawing(e,t){},onDrawEnd(e,t){N(e,t),t.shouldSelectAfterCreate&&t.selectObject(e)},onResize(e,t){u(e,!1),p(e.element)},onSelect(e,t){u(e,!1),p(e.element)},onUnSelect(e){u(e,!1),b(e.containerDiv,f(e))},onAfterUpdate(e,t){u(e,!1),p(e.element)},undoHandlers:{create:w,delete:v,input:j,color:I,background:E,opacity:S,fontSize:C},redoHandlers:{create:w,delete:v,input:j,color:I,background:E,opacity:S,fontSize:C},onDeleteObject(e,t){u(e,!0)},styleHandlers:{color:R,background:B,opacity:H,fontSize:Z}};function Z(e,t){const n=e.style.fontSize;return e.style.fontSize=t,e.containerDiv.style.fontSize=t+"px",b(e.containerDiv,f(e)),_(e,"fontSize",n)}function C(e,t){const n=y(t.objectsMap,e.objectId),o=n.style.fontSize,r=e.data;return n.style.fontSize=r,n.containerDiv.style.fontSize=r+"px",e.data=o,e}function j(e,t){const o=y(t.objectsMap,e.objectId).element;if(!o)throw new Error("tried to undo text but no ele found");const r=o.innerHTML,i=e.data;return o.innerHTML=i,e.data=r,e}function I(e,t){return z(e,t,"color","color")}function E(e,t){return z(e,t,"background","backgroundColor")}function z(e,t,n,o){const r=y(t.objectsMap,e.objectId),i=r.style[n],c=e.data;return r.style[n]=c,r.containerDiv.style[o]=c,e.data=i,e}function u(e,t){const n=e.element;if(!n)return;const o=e.customData.get("handler");o&&(n.removeEventListener("keypress",o),e.customData.delete("handler"));const r=e.customData.get("capture");t&&r&&(n.removeEventListener("input",r),e.customData.delete("capture"))}function b(e,t){const n=e.getBoundingClientRect(),{width:o,height:r}=n;t.bottom=t.top+r,t.right=t.left+o}function p(e){if(e.focus(),typeof window.getSelection<"u"&&typeof document.createRange<"u"){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);const n=window.getSelection();if(n)return n.removeAllRanges(),n.addRange(t),!0}return console.error("cannot place caret at end"),!1}function $(e){const n=e.containerDiv;n.style.padding="5px",n.style.borderRadius="2px",n.style.boxSizing="border-box";const o=document.createElement("style");return o.innerHTML=`
	.react-draw-cursor {
		outline: none;		
		height: 100%;
	}`,n.appendChild(o),e}function K(e){const t=parseInt(e.style.fontSize),n=5,o=e.containerDiv,r=f(e),i=r.top+t+n;return o.style.height="",o.style.minHeight=i-r.top+"px",o.style.minWidth=o.style.width,o.style.width="",o.style.border="1px solid black",e}function M(e,t){const n=e.containerDiv,o=f(e);A(e),K(e),$(e);const r=ee();return r.style.opacity=e.style.opacity,e.element=r,n.appendChild(r),b(n,o),r.setAttribute("tabindex","1"),L(e,t),setTimeout(function(){r.focus()},0),r}function L(e,t){const n=e.element,o=e.customData;function r(i){const c=new Date().getTime(),a=o.get("lastCapture");if(a){if(c-a>1e3*5){const s=i.target,l={toolId:e.toolId,action:"input",data:s.innerHTML,toolType:"top-bar-tool",objectId:e.id};D(l,t)}}else{const s={toolId:e.toolId,action:"input",data:"",toolType:"top-bar-tool",objectId:e.id};D(s,t)}o.set("lastCapture",c)}n.addEventListener("input",r),o.set("capture",r)}function ee(){const e=document.createElement("div");return e.setAttribute("contenteditable","true"),e.style.minWidth="1px",e.style.height="100%",e.className="react-draw-cursor",e}function se(e,t){const{toolId:n,text:o,viewLocation:r,editable:i,useTextToolDefaults:c}=t,a=r??J(e),s=m(e,a,n);if(c){const T=M(s,e);return T.innerHTML=o,g(e,s),p(T),s}const l=document.createElement("div");l.style.width="fit-content",l.innerText=o;const d=s.containerDiv;d.appendChild(l),s.element=l,g(e,s);const h=l.getBoundingClientRect();return d.style.width=h.width+"px",d.style.height=h.height+"px",d.style.display="flex",d.style.justifyContent="center",d.style.alignItems="center",A(s),i?(l.setAttribute("tabindex","1"),l.contentEditable="true",n===Y.id&&L(s,e),s):(l.contentEditable="false",s)}function ie(e,t,n){const o=ne(e);for(const r of o){const i=X(e.drawingTools,r.toolId);i.styleHandlers&&i.styleHandlers[t]&&i.styleHandlers[t](r,n,e)}}function le(e,t){const n=m(e,t.pointA,t.toolId),o=G(e.globalStyles);return n.containerDiv.appendChild(o),n.element=o,n.coords.push(t.pointB),x(n),g(e,n),e.selectObject(n),n}function te(){const e=document.createElement("style");e.innerHTML=`.skeleton-loader {
					width: 100%;
					height: 100%;
					display: block;
					border-radius: 10px;
					background: linear-gradient(
							to right,
							rgba(255, 255, 255, 0),
							rgba(255, 255, 255, 0.5) 50%,
							rgba(255, 255, 255, 0) 80%
						),
						lightgray;
					background-repeat: repeat-y;
					background-size: 50px 500px;
					background-position: 0 0;
					animation: shine 1s infinite;
				}
				@keyframes shine {
					to {
						background-position: 100% 0, /* move highlight to right */ 0 0;
					}
				}`;const t=document.createElement("div");t.appendChild(e),t.style.width="100%",t.style.height="100%";const n=document.createElement("span");return n.className="skeleton-loader",t.appendChild(n),t}async function ce(e,t){const n=m(e,t.pointA,t.toolId);g(e,n),n.coords.push(t.pointB),x(n);const o=t.url;return new Promise((r,i)=>{const c=s=>{n.element=s,n.containerDiv.innerHTML="",n.containerDiv.appendChild(s),e.shouldSelectAfterCreate&&e.selectObject(n),r(n)};if(o){if(t.showLoading){const l=t.loadingElement??te();n.containerDiv.appendChild(l)}const s=new Image;return s.style.width="100%",s.style.height="100%",s.crossOrigin="anonymous",s.onload=function(){c(s)},s.onerror=()=>{i(null)},s.src=o,n}const a=t.image;if(!a)throw new Error("createImage must be given either url (string) or image (HTMLImageElement) options. Neither provided.");c(a)})}function ae(e){const t=k(e),n=O(t,e.objectsMap);n.length>0&&U(n,e);const o=Array.from(e.objectsMap.keys());e.fullState[W].selectedIds=o;const r=Array.from(e.objectsMap.values());if(r.length===1)return P(e.drawingTools,r[0],e),q(r[0],e);if(r.length>1)return V(r,e)}function ne(e){const t=k(e);return O(t,e.objectsMap)}export{ae as a,le as b,ce as c,se as d,ne as g,M as s,Y as t,ie as u};
