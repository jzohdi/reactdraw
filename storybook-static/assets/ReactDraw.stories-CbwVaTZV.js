import{e as a,r as X}from"./iframe-ThtCju29.js";import{B as g,C as S,u as Y,D as Ve,E as qe,F as Qe,d as C,G as he,H as fe,I as we,r as y,e as v,J as Ge,i as V,z as q,K as ne,L as Je,M as re,N as A,O as Ce,P as j,Q as Xe,U as et,h,V as se,W as T,X as ie,Y as tt,Z as k,_ as Te,$ as ot,a0 as nt,a1 as rt,a2 as st,a3 as N,a4 as it,p as Ie,a5 as at,a6 as lt,a7 as ct,a8 as dt,a9 as ut,w as P,m as D,aa as pt,k as ae,o as gt,t as mt,v as ht,S as ft,ab as wt,ac as ye,ad as Ct,ae as yt,af as f,A as I,y as vt,ag as Dt,ah as St,R as Me,ai as xe,aj as Ee,ak as Le,al as Ae,am as je,an as ke,s as K,f as Q,c as U,ao as ve,ap as bt,aq as Tt,g as De}from"./ClearAllButton-DK1678Z8.js";import{s as It,t as Z,a as Mt,u as xt,g as Et,b as Lt,c as At,d as Se}from"./publicUtils-CtIMU_v1.js";function jt(e){const t=g(e);return a.createElement("svg",Object.assign({},t,{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),a.createElement("rect",{width:"16",height:"16",rx:"1",fill:t.color}))}function kt(e){const t=g(e);return a.createElement("svg",Object.assign({},t,{viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),a.createElement("rect",{x:"11",y:"-0.313721",width:"16",height:"16",rx:"1",transform:"rotate(45 11 -0.313721)",fill:t.color}))}function Ot(e){const t=g(e);return a.createElement("svg",Object.assign({},t,{viewBox:"0 0 24 3",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),a.createElement("line",{y1:"1.5",x2:"24",y2:"1.5",stroke:"black",strokeWidth:"3"}))}function zt(e){const t=g(e);return a.createElement("svg",Object.assign({},t,{viewBox:"0 0 16 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.2929 0.292893C10.6834 -0.0976311 11.3166 -0.0976311 11.7071 0.292893L15.7071 4.29289C16.0976 4.68342 16.0976 5.31658 15.7071 5.70711L11.7071 9.70711C11.3166 10.0976 10.6834 10.0976 10.2929 9.70711C9.90237 9.31658 9.90237 8.68342 10.2929 8.29289L12.5858 6H1C0.447716 6 -2.41411e-08 5.55228 0 5C2.41411e-08 4.44772 0.447716 4 1 4H12.5858L10.2929 1.70711C9.90237 1.31658 9.90237 0.683418 10.2929 0.292893Z",fill:t.color}))}function Nt(e){const t=g(e),{color:o}=t,n=S(t,["color"]);return a.createElement("svg",Object.assign({},n,{viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),a.createElement("path",{d:"M10.0616 0.586573L5.31159 5.33657L0.581585 10.1766C0.209084 10.5513 0 11.0582 0 11.5866C0 12.1149 0.209084 12.6218 0.581585 12.9966L4.88159 17.2966C5.06785 17.4813 5.31925 17.5855 5.58159 17.5866H17.5816V15.5866H10.5816L17.8016 8.36657C17.9875 8.18083 18.1351 7.96025 18.2357 7.71745C18.3364 7.47466 18.3882 7.2144 18.3882 6.95157C18.3882 6.68874 18.3364 6.42849 18.2357 6.18569C18.1351 5.9429 17.9875 5.72232 17.8016 5.53657L12.8916 0.586573C12.7058 0.40062 12.4853 0.253102 12.2425 0.152454C11.9997 0.0518053 11.7394 0 11.4766 0C11.2138 0 10.9535 0.0518053 10.7107 0.152454C10.4679 0.253102 10.2473 0.40062 10.0616 0.586573V0.586573ZM5.99159 15.5866L1.99159 11.5866L6.74159 6.74657L7.48159 5.99657L12.4316 10.9466L7.87159 15.5066L7.80159 15.5866H5.99159Z",fill:o}))}function Bt(e){const t=g(e),{color:o}=t,n=S(t,["color"]);return a.createElement("svg",Object.assign({},n,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),a.createElement("path",{d:"M8.4345 1.3088e-05C6.17654 0.00387579 4.12643 0.851527 2.61286 2.2295L1.39599 1.07024C0.88081 0.57945 0 0.927028 0 1.62108V5.97259C0 6.40284 0.36611 6.75162 0.817742 6.75162H5.38548C6.11402 6.75162 6.47887 5.91251 5.96372 5.42172L4.54119 4.06653C5.59281 3.12847 6.95357 2.60886 8.39923 2.59698C11.5475 2.57108 14.2012 4.99825 14.174 8.09701C14.1482 11.0366 11.6466 13.5032 8.45 13.5032C7.0487 13.5032 5.7243 13.0268 4.68055 12.1543C4.51894 12.0193 4.27488 12.0275 4.12285 12.1723L2.77146 13.4597C2.60546 13.6178 2.61367 13.8757 2.78789 14.0256C4.28626 15.3149 6.27188 16.1 8.45 16.1C13.1168 16.1 16.9 12.4959 16.9 8.05007C16.9 3.6093 13.0959 -0.00793953 8.4345 1.3088e-05Z",fill:o}))}function Ht(e){const t=g(e),{color:o}=t,n=S(t,["color"]);return a.createElement("svg",Object.assign({},n,{viewBox:"0 0 17 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),a.createElement("path",{d:"M8.28183 1.34403e-05C10.4908 0.0039801 12.4964 0.874446 13.9771 2.28951L15.1676 1.09901C15.6716 0.595046 16.5333 0.951979 16.5333 1.66471V6.13334C16.5333 6.57517 16.1752 6.93334 15.7333 6.93334H11.2647C10.552 6.93334 10.195 6.07164 10.699 5.56764L12.0907 4.17598C11.0619 3.21268 9.73063 2.67908 8.31633 2.66688C5.2364 2.64028 2.64023 5.13278 2.66687 8.31494C2.69213 11.3336 5.13947 13.8667 8.26667 13.8667C9.63757 13.8667 10.9332 13.3774 11.9543 12.4815C12.1124 12.3428 12.3512 12.3512 12.4999 12.4999L13.822 13.822C13.9844 13.9844 13.9763 14.2491 13.8059 14.4031C12.3401 15.7271 10.3975 16.5333 8.26667 16.5333C3.70113 16.5333 3.33336e-05 12.8322 2.23918e-10 8.26674C-3.33331e-05 3.70644 3.72153 -0.00815322 8.28183 1.34403e-05Z",fill:o}))}function $t(e){const t=g(e),{color:o}=t,n=S(t,["color"]);return a.createElement("svg",Object.assign({},n,{viewBox:"0 0 14 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 0C5.62123 0 5.27497 0.214002 5.10557 0.552786L4.38197 2H1C0.447715 2 0 2.44772 0 3C0 3.55228 0.447716 4 1 4L1 14C1 15.1046 1.89543 16 3 16H11C12.1046 16 13 15.1046 13 14V4C13.5523 4 14 3.55228 14 3C14 2.44772 13.5523 2 13 2H9.61804L8.89443 0.552786C8.72504 0.214002 8.37877 0 8 0H6ZM4 6C4 5.44772 4.44772 5 5 5C5.55228 5 6 5.44772 6 6V12C6 12.5523 5.55228 13 5 13C4.44772 13 4 12.5523 4 12V6ZM9 5C8.44771 5 8 5.44772 8 6V12C8 12.5523 8.44771 13 9 13C9.55229 13 10 12.5523 10 12V6C10 5.44772 9.55229 5 9 5Z",fill:o}))}function Wt(e){const t=g(e),{color:o}=t,n=S(t,["color"]);return a.createElement("svg",Object.assign({},n,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),a.createElement("path",{d:"M15 17L5 9L15 1V17Z",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{d:"M1 16V2",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}function Rt(e){const t=g(e),{color:o}=t,n=S(t,["color"]);return a.createElement("svg",Object.assign({},n,{viewBox:"0 0 16 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),a.createElement("path",{d:"M1 1L11 9L1 17V1Z",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{d:"M15 2V16",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}function Pt(e){const t=g(e),{color:o}=t,n=S(t,["color"]);return a.createElement("svg",Object.assign({},n,{viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),a.createElement("path",{d:"M4 6C4 4.89543 4.89543 4 6 4H12C13.1046 4 14 4.89543 14 6V12C14 13.1046 13.1046 14 12 14H6C4.89543 14 4 13.1046 4 12V6Z",fill:o}),a.createElement("path",{d:"M2 0C0.895431 0 0 0.89543 0 2V8C0 9.10457 0.89543 10 2 10L2 2H10C10 0.895431 9.10457 0 8 0H2Z",fill:o}))}function Ut(e){const t=g(e),{color:o}=t,n=S(t,["color"]);return a.createElement("svg",Object.assign({},n,{viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"}),a.createElement("path",{d:"M1 13L1 14C1 15.6569 2.34315 17 4 17L14 17C15.6569 17 17 15.6569 17 14L17 13M13 9L9 13M9 13L5 9M9 13L9 1",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}))}const le={id:Ge,tooltip:"Square Tool",icon:a.createElement(jt,null),onDrawStart:e=>{const t=Oe(e.style);e.containerDiv.appendChild(t),e.element=t},onDrawing:e=>{q(e),e.coords.splice(1)},onDrawEnd(e,t){V(e,t),t.shouldSelectAfterCreate&&t.selectObject(e)},undoHandlers:{create:v,delete:y,color:we,background:fe,lineWidth:he,opacity:C},redoHandlers:{create:v,delete:y,color:we,background:fe,lineWidth:he,opacity:C},onResize(e,t){},styleHandlers:{color:Qe,background:qe,lineWidth:Ve,opacity:Y}};function Oe(e){const t=document.createElement("div");return t.style.width="100%",t.style.height="100%",t.style.border=`${e.lineWidth}px solid ${e.color}`,t.style.borderRadius="2px",t.style.boxSizing="border-box",t.style.backgroundColor=e.background,t.style.opacity=e.opacity,t}const ce={id:Xe,tooltip:"Diamond tool",icon:a.createElement(kt,null),onDrawStart:e=>{const t=e.containerDiv,o=ee(e);t.appendChild(o)},onDrawing:e=>{q(e);const t=e.containerDiv,o=ee(e);t.innerHTML="",t.appendChild(o),e.element=o,e.coords.splice(1)},onDrawEnd(e,t){V(e,t),e.customData.set(se,h(e)),t.shouldSelectAfterCreate&&t.selectObject(e)},onResize(e,t){et(e.element,h(e))},undoHandlers:{create:v,delete:y,color:j,background:Ce,lineWidth:A,opacity:C},redoHandlers:{create:v,delete:y,color:j,background:Ce,lineWidth:A,opacity:C},styleHandlers:{color:re,background:Je,lineWidth:ne,opacity:Y}};function ee(e){const t=parseInt(e.style.lineWidth),o=h(e),{width:n,height:s}=o,r=T(n+t,s+t,e.style.opacity),i=Zt(o,e.style);return r.appendChild(i),r}function Zt(e,t){const o=ie(t);o.setAttribute("fill",t.background);const n=parseInt(t.lineWidth);return o.setAttribute("d",_t(e,n)),o}function _t(e,t){const o=e.bottom-e.top,n=e.right-e.left,s=`${t/2} ${o/2}`,r=`L ${n/2} ${t/2}`,i=`L ${n-t/2} ${o/2}`,c=`L ${n/2} ${o-t/2}`;return`M ${s} ${r} ${i} ${c} L ${s}`}function ze(e,t){const[o,n]=e,[s,r]=t;return s===o?r>n?"down":"up":r===n?s>o?"right":"left":s<o&&r<n?"nw":s>o&&r<n?"ne":s>o&&r>n?"se":"sw"}function Ne(e,t,o){return o==="right"?[[0,t/2],[e,t/2]]:o==="left"?[[e,t/2],[0,t/2]]:o==="down"?[[e/2,0],[e/2,t]]:o==="up"?[[e/2,t],[e/2,0]]:o==="nw"?[[e,t],[0,0]]:o==="ne"?[[0,t],[e,0]]:o==="se"?[[0,0],[e,t]]:[[e,0],[0,t]]}const de={id:tt,tooltip:"Straight Line Tool",icon:a.createElement(Ot,null),onDrawStart:e=>{const t=e.containerDiv,o=parseInt(e.style.lineWidth),n=T(o,o,e.style.opacity),s=Te(o/2,e.style.color);n.appendChild(s),t.append(n),e.element=n},onDrawing:(e,t)=>{q(e);const o=e.coords[0],n=e.coords[e.coords.length-1],s=ze(o,n);e.customData.set(k,s);const r=te(e,s),i=e.containerDiv;i.innerHTML="",i.appendChild(r),e.element=r,e.coords.splice(1)},onDrawEnd(e,t){V(e,t),t.shouldSelectAfterCreate&&t.selectObject(e)},onResize(e,t){const o=e.customData.get(k);if(!o)throw new Error("orientation not set");const n=te(e,o),s=e.containerDiv;s.removeChild(e.element),s.appendChild(n),e.element=n,e.coords.splice(1)},undoHandlers:{create:v,delete:y,color:j,lineWidth:A,opacity:C},redoHandlers:{create:v,delete:y,color:j,lineWidth:A,opacity:C},styleHandlers:{color:re,lineWidth:ne,opacity:Y}};function te(e,t){const o=h(e),n=o.right-o.left,s=o.bottom-o.top,r=T(n,s,e.style.opacity);r.style.overflow="visible";const[i,c]=Ne(n,s,t),l=ot(e.style);return l.setAttribute("x1",i[0].toString()),l.setAttribute("y1",i[1].toString()),l.setAttribute("x2",c[0].toString()),l.setAttribute("y2",c[1].toString()),r.appendChild(l),r}const ue={icon:a.createElement(zt,null),id:nt,tooltip:"Arrow Tool",onDrawStart:e=>{const t=e.containerDiv,o=parseInt(e.style.lineWidth),n=T(o,o,e.style.opacity),s=Te(o/2,e.style.color);n.appendChild(s),t.append(n),e.element=n},onDrawing:(e,{viewContainer:t})=>{q(e);const o=e.coords[0],n=e.coords[e.coords.length-1],s=ze(o,n);e.customData.set(k,s);const r=oe(e,s),i=e.containerDiv;i.innerHTML="",i.appendChild(r),e.element=r,e.coords.splice(1)},onDrawEnd:(e,t)=>{t.shouldKeepHistory&&V(e,t),t.shouldSelectAfterCreate&&t.selectObject(e)},onResize(e,t){const o=e.customData.get(k);if(!o)throw new Error("orientation not set");const n=oe(e,o),s=e.containerDiv;s.removeChild(e.element),s.appendChild(n),e.element=n,e.coords.splice(1)},undoHandlers:{create:v,delete:y,color:j,lineWidth:A,opacity:C},redoHandlers:{create:v,delete:y,color:j,lineWidth:A,opacity:C},styleHandlers:{color:(e,t,o)=>re(e,t),lineWidth:(e,t,o)=>ne(e,t),opacity:(e,t,o)=>Y(e,t)}};function oe(e,t){const o=parseInt(e.style.lineWidth),{width:n,height:s}=h(e),[r,i]=Ne(n,s,t),c=T(n+o,s+o,e.style.opacity);c.style.overflow="visible";const l=Ft(e,r,i);return c.appendChild(l),c}function Ft(e,t,o){const[n,s]=t,[r,i]=o,c=ie(e.style),l=[n-r,s-i],[d,m]=l,w=Math.sqrt(d*d+m*m),z=[d/w,m/w],[E,L]=z,J=E*(Math.sqrt(3)/2)-L*(1/2),u=E*1/2+L*(Math.sqrt(3)/2),p=E*(Math.sqrt(3)/2)+L*(1/2),b=-E*(1/2)+L*(Math.sqrt(3)/2),_=20,[_e,Fe,Ke,Ye]=[-J*_,-u*_,-p*_,-b*_];return c.setAttribute("d",`M ${n} ${s} L ${r} ${i} L ${r-_e} ${i-Fe} L ${r} ${i} L ${r-Ke} ${i-Ye}`),c}const Kt="PHN2ZyB3aWR0aD0iMTkiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOSAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEwLjA2MTYgMC41ODY1NzNMNS4zMTE1OSA1LjMzNjU3TDAuNTgxNTg1IDEwLjE3NjZDMC4yMDkwODQgMTAuNTUxMyAwIDExLjA1ODIgMCAxMS41ODY2QzAgMTIuMTE0OSAwLjIwOTA4NCAxMi42MjE4IDAuNTgxNTg1IDEyLjk5NjZMNC44ODE1OSAxNy4yOTY2QzUuMDY3ODUgMTcuNDgxMyA1LjMxOTI1IDE3LjU4NTUgNS41ODE1OSAxNy41ODY2SDE3LjU4MTZWMTUuNTg2NkgxMC41ODE2TDE3LjgwMTYgOC4zNjY1N0MxNy45ODc1IDguMTgwODMgMTguMTM1MSA3Ljk2MDI1IDE4LjIzNTcgNy43MTc0NUMxOC4zMzY0IDcuNDc0NjYgMTguMzg4MiA3LjIxNDQgMTguMzg4MiA2Ljk1MTU3QzE4LjM4ODIgNi42ODg3NCAxOC4zMzY0IDYuNDI4NDkgMTguMjM1NyA2LjE4NTY5QzE4LjEzNTEgNS45NDI5IDE3Ljk4NzUgNS43MjIzMiAxNy44MDE2IDUuNTM2NTdMMTIuODkxNiAwLjU4NjU3M0MxMi43MDU4IDAuNDAwNjIgMTIuNDg1MyAwLjI1MzEwMiAxMi4yNDI1IDAuMTUyNDU0QzExLjk5OTcgMC4wNTE4MDUzIDExLjczOTQgMCAxMS40NzY2IDBDMTEuMjEzOCAwIDEwLjk1MzUgMC4wNTE4MDUzIDEwLjcxMDcgMC4xNTI0NTRDMTAuNDY3OSAwLjI1MzEwMiAxMC4yNDczIDAuNDAwNjIgMTAuMDYxNiAwLjU4NjU3M1YwLjU4NjU3M1pNNS45OTE1OSAxNS41ODY2TDEuOTkxNTkgMTEuNTg2Nkw2Ljc0MTU5IDYuNzQ2NTdMNy40ODE1OSA1Ljk5NjU3TDEyLjQzMTYgMTAuOTQ2Nkw3Ljg3MTU5IDE1LjUwNjZMNy44MDE1OSAxNS41ODY2SDUuOTkxNTlaIiBmaWxsPSJibGFjayI+PC9wYXRoPgo8L3N2Zz4=",Yt={icon:a.createElement(Nt,null),tooltip:"Eraser tool",id:N,cursor:`url(data:image/svg+xml;base64,${Kt}) 0 16, pointer`,onDrawStart(e,t){},onDrawing(e,t){const o=t.viewContainer;at(e);const n=h(e),s=T(n.width,n.height,"1"),r=qt(e,o);s.appendChild(r);const i=e.containerDiv;i.innerHTML="",i.appendChild(s),e.element=s;const c=e.coords[e.coords.length-1],l=lt(c),d=t.objectsMap.keys();for(const m of d){const w=t.objectsMap.get(m);if(!w)continue;const z=h(w);ct(z,l)&&(dt(m,t),Vt(t,w))}},onDrawEnd(e,t){const{objectsMap:o,viewContainer:n}=t;if(n.removeChild(e.containerDiv),o.delete(e.id),it('[id^="react-draw-erase-tool"',t.viewContainer),t.fullState[N].deletedObjects.size>0&&t.shouldKeepHistory){const r={toolId:e.toolId,toolType:"top-bar-tool",objectId:"",action:"delete",data:t.fullState[N].deletedObjects};t.fullState[N].deletedObjects=new Map,Ie(r,t)}},undoHandlers:{delete:st},redoHandlers:{create:rt},onResize(e,t){}};function Vt(e,t){e.fullState[N].deletedObjects.set(t.id,t)}function qt(e,t){const o=ie(e.style);return o.style.strokeWidth="10px",o.setAttribute("d",Qt(e,t)),o.setAttribute("stroke","rgba(232, 16, 84, 0.142)"),o}function Qt(e,t){let o="",n=e.coords[0];for(let s=0;s<e.coords.length;s++){const r=e.coords[s],i=ut(r,e.containerDiv,t);o+=Gt(i,n,s),n=i,s!==e.coords.length-1&&(o+=" ")}return o}function Gt(e,t,o){return o===0?`M ${e[0]} ${e[1]}`:`l ${e[0]-t[0]} ${e[1]-t[1]}`}const Jt={id:"react-draw-undo-tool",tooltip:"Undo",icon:a.createElement(Bt,null),getDisplayMode(e){return e.undoStack.length>0?"show":"disabled"},handleContext(e){const t=e.undoStack.pop();if(t){if(t.toolType==="top-bar-tool")return Xt(e,t);if(t.toolType==="batch")return eo(e,t)}}};function Xt(e,t){const o=t.toolId,n=P(e.drawingTools,o),s=n.undoHandlers,r=t.action;if(!s){console.error("tool:",n,"does not implement undo functionality");return}const i=s[r];i||console.error("tool:",n,"does not implement undo action:",r);const c=i(t,e);e.shouldKeepHistory&&e.redoStack.push(c)}function eo(e,t){const o=t.data,n=[];for(const s of o){const r=s.toolId,i=P(e.drawingTools,r),c=i.undoHandlers,l=s.action;if(!c){console.error("tool:",i,"does not implement undo functionality");return}const d=c[l];if(!d){console.error("tool:",i,"does not implement action:",l);return}n.push(d(s,e))}t.data=n,e.shouldKeepHistory&&e.redoStack.push(t)}const to={id:"react-draw-redo-tool",tooltip:"Redo",icon:a.createElement(Ht,null),getDisplayMode(e){return e.redoStack.length>0?"show":"disabled"},handleContext(e){const t=e.redoStack.pop();if(t){if(t.toolType==="top-bar-tool")return oo(e,t);if(t.toolType==="batch")return no(e,t)}}};function oo(e,t){const o=t.toolId,n=P(e.drawingTools,o),s=n.redoHandlers,r=t.action;if(!s){console.error("tool:",n,"does not implement undo functionality");return}const i=s[r];i||console.error("tool:",n,"does not implement undo action:",r);const c=i(t,e);e.shouldKeepHistory&&e.undoStack.push(c)}function no(e,t){const o=t.data,n=[];for(const s of o){const r=s.toolId,i=P(e.drawingTools,r),c=i.redoHandlers,l=s.action;if(!c){console.error("tool:",i,"does not implement undo functionality");return}const d=c[l];if(!d){console.error("tool:",i,"does not implement action:",l);return}n.push(d(s,e))}t.data=n,e.shouldKeepHistory&&e.undoStack.push(t)}const ro={id:"react-draw-trash-tool",icon:a.createElement($t,null),tooltip:"Delete selected objects",getDisplayMode(e){return D(e).length>0?"show":"disabled"},handleContext(e){const t=D(e);t.length<1||pt(t,e)}},so={id:"react-draw-duplicate-tool",tooltip:"Duplicate objects",icon:a.createElement(Pt,null),getDisplayMode(e){return D(e).length>0?"show":"disabled"},handleContext(e){Be(e)}};function Be(e){const t=D(e);if(t.length<1)return null;const o=t.map(i=>ae(e.objectsMap,i));gt(o,e);const n=o.map(i=>io(i,e)),s=n.map(i=>{const{toolId:c,id:l}=i;return e.objectsMap.set(l,i),e.viewContainer.appendChild(i.containerDiv),{action:"create",toolType:"top-bar-tool",toolId:c,objectId:l,data:i}});e.shouldKeepHistory&&Ie({toolId:"",objectId:"",toolType:"batch",action:"batch",data:s},e),t.length===1?mt(n[0],e):ht(n,e);const r=e.fullState[ft];return r.selectedIds=n.map(i=>i.id),n}function io(e,t){const o=e.containerDiv,n=o.cloneNode(!0),{newId:s,divId:r}=ao(o.id);n.id=r;const c=wt(t)+1,l={coords:e.coords.slice(0),toolId:e.toolId,element:n.lastElementChild,style:{...e.style,zIndex:c.toString()},customData:new Map(e.customData),containerDiv:n,id:s},d=h(e);n.style.top=d.top+5+"px",n.style.left=d.left+10+"px",n.style.zIndex=c.toString();const m=P(t.drawingTools,e.toolId);return m.onDuplicate?m.onDuplicate(l,t):l}function ao(e){const t=ye(6),o=e.split("-");return o[o.length-1]=ye(6),{divId:o.join("-"),newId:t}}const lo={id:"react-draw-back-tool",icon:a.createElement(Wt,null),tooltip:"Move object back",getDisplayMode(e){return D(e).length>0?"show":"disabled"},handleContext(e){He(e)}};function He(e){const t=D(e);if(t.length<1)return;let o=[],n=new Set;t.forEach(i=>{o.push(ae(e.objectsMap,i)),n.add(i)});for(const i of o)i.style.zIndex="0",i.containerDiv.style.zIndex="0";let s=1/0;for(const i of e.objectsMap.values()){if(n.has(i.id))continue;const c=parseInt(i.containerDiv.style.zIndex??"0");c<s&&(s=c)}let r=1;s<0&&(r=1-s);for(const i of e.objectsMap.values()){if(n.has(i.id))continue;const l=parseInt(i.containerDiv.style.zIndex??"0")+r;i.style.zIndex=l.toString(),i.containerDiv.style.zIndex=l.toString()}}const co={id:"react-draw-forward-tool",tooltip:"Move object forward",icon:a.createElement(Rt,null),getDisplayMode(e){return D(e).length>0?"show":"disabled"},handleContext(e){$e(e)}};function $e(e){const t=D(e);if(t.length<1)return;const o=t.map(i=>ae(e.objectsMap,i));o.sort((i,c)=>F(i)-F(c));const n=[];for(const i of e.objectsMap.values())t.includes(i.id)||n.push(i);let s=n.length+1;for(const i of o)i.style.zIndex=s.toString(),i.containerDiv.style.zIndex=s.toString(),s+=1;n.sort((i,c)=>{const l=F(i);return F(c)-l});let r=n.length;n.forEach(i=>{i.style.zIndex=r.toString(),i.containerDiv.style.zIndex=r.toString(),r-=1})}const F=e=>e.containerDiv.style.zIndex?parseInt(e.containerDiv.style.zIndex):e.style.zIndex?parseInt(e.style.zIndex):0;function uo(e,t){const o=[];for(const n of t.objectsMap.values()){const s=n.toolId,r=e[s];if(r===void 0)return Re(n,e);o.push(r(n))}return JSON.stringify(o)}const po=e=>{const{containerState:t,customData:o}=G(e);return{...e,containerDiv:t,customData:o}},go=e=>{const t=pe(e),o=ge(e);return{...e,containerDiv:t,customData:o}},mo=e=>{const{containerState:t,customData:o}=G(e);return{...e,containerDiv:t,customData:o}};function pe(e){return{rotation:yt(e.containerDiv),bbox:h(e),scale:null,other:{}}}function G(e){const t=pe(e);t.scale=Ct(e),t.other.viewbox=e.element?.getAttribute("viewbox");const o=ge(e);return{containerState:t,customData:o}}function We(e){const t=pe(e),o=ge(e);return{containerState:t,customData:o}}const ho=e=>{const{containerState:t,customData:o}=G(e);return{...e,containerDiv:t,customData:o}},ge=e=>{const t={};for(const o of e.customData.keys())t[o]=e.customData.get(o);return t},fo=e=>{const{containerState:t,customData:o}=We(e);return{...e,containerDiv:t,customData:o}},wo=e=>{const{containerState:t,customData:o}=G(e);return{...e,containerDiv:t,customData:o}},Co=e=>{const{containerState:t,customData:o}=We(e);return t.other.text=e.containerDiv.innerText,{...e,containerDiv:t,customData:o}};function yo(e,t,o,n=!0){const s=JSON.parse(e),r=[];for(const i of s){const c=t[i.toolId];if(c===void 0)return Re(i,t);const l=c(i,o,n);r.push(l)}return r}function Re(e,t){throw new Error("toolid not function in serializers. id: "+e.toolId+" .options: "+Object.keys(t)+" . object: "+JSON.stringify(e))}function M(e){const t=e,o=t.containerDiv,n=t.customData,s=t.coords[0],r=parseInt(t.style.lineWidth),i=parseInt(t.style.zIndex??"0"),{id:c,div:l}=St(s[0],s[1],r,t.toolId,i);return{drawingData:{toolId:t.toolId,id:c,style:t.style,customData:xo(n),containerDiv:l,element:null,coords:t.coords},div:l,containerState:o}}function O(e,t){e.containerDiv.innerHTML="",e.containerDiv.appendChild(t),e.element=t}function x(e,t){e.style.transform=`rotate(${t.rotation}deg)`}const vo=(e,t,o=!0)=>{const{drawingData:n,div:s,containerState:r}=M(e),i=n.customData.get(se),c=r.bbox;f(s,i),o&&I(t,n);const l=T(i.width,i.height,n.style.opacity);l.setAttribute("viewbox",r.other.viewbox),l.style.overflow="visible";const d=Dt(n,t.viewContainer);return d.style.transform=`scale(${r.scale?.x}, ${r.scale?.y})`,l.appendChild(d),O(n,l),x(l,r),f(s,c),n},Do=(e,t,o)=>{const{drawingData:n,containerState:s,div:r}=M(e),i=Oe(e.style);return O(n,i),x(r,s),f(r,s.bbox),o&&I(t,n),n},So=(e,t,o)=>{const{drawingData:n,containerState:s,div:r}=M(e);f(r,s.bbox);const i=vt(n.style);return O(n,i),x(r,s),o&&I(t,n),n},bo=(e,t,o)=>{const{drawingData:n,div:s,containerState:r}=M(e),i=n.customData.get(se),c=r.bbox;f(s,i),o&&I(t,n);const l=ee(n);l.setAttribute("viewbox",r.other.viewbox),l.style.overflow="visible";const d=l.getElementsByTagName("path")[0];return d&&(d.style.transform=`scale(${r.scale?.x}, ${r.scale?.y})`),O(n,l),x(l,r),f(s,c),n},To=(e,t,o)=>{const{drawingData:n,div:s,containerState:r}=M(e),i=n.customData.get(k),c=r.bbox;f(s,c),o&&I(t,n);const l=te(n,i);return l.setAttribute("viewbox",r.other.viewbox),l.style.overflow="visible",O(n,l),x(l,r),n},Io=(e,t,o)=>{const{drawingData:n,containerState:s,div:r}=M(e);return It(n,t),r.innerHTML=s.other.text,f(r,s.bbox),x(r,s),o&&I(t,n),n},Mo=(e,t,o)=>{const{drawingData:n,div:s,containerState:r}=M(e),i=n.customData.get(k),c=r.bbox;f(s,c),o&&I(t,n);const l=oe(n,i);return l.setAttribute("viewbox",r.other.viewbox),l.style.overflow="visible",O(n,l),x(l,r),n};function xo(e){const t=new Map;for(const o in e){const n=e[o];t.set(o,n)}return t}const Eo={title:"ReactDraw",component:Me,argTypes:{layout:{control:"select",options:["default","fit"]},hideTopBar:{control:"boolean"},hideBottomBar:{control:"boolean"},shouldKeepHistory:{control:"boolean"},shouldSelectAfterCreate:{control:"boolean"},isResponsive:{control:"boolean"},shouldCornerResizePreserveRatio:{control:"boolean"},id:{control:"text"}}},me=[K,Q,le,U,ce,de,Z,ue,Yt],Pe=[Jt,to,ro,so,lo,co],B={args:{drawingTools:me,actionTools:Pe,shouldSelectAfterCreate:!0,isResponsive:!1,shouldCornerResizePreserveRatio:!1,styleComponents:{color:{order:3,component:ke},background:{order:4,component:je},lineWidth:{order:1,component:Ae},opacity:{order:0,component:Le},fontSize:{order:2,component:Ee}},menuComponents:[xe]}},H={args:{drawingTools:[Q],hideTopBar:!0,hideBottomBar:!0,shouldSelectAfterCreate:!1,shouldKeepHistory:!1}},Lo={[Q.id]:ho,[le.id]:fo,[U.id]:go,[ce.id]:mo,[de.id]:wo,[Z.id]:Co,[ue.id]:po},Ao={[Q.id]:vo,[le.id]:Do,[U.id]:So,[ce.id]:bo,[de.id]:To,[Z.id]:Io,[ue.id]:Mo},be="save-canvas-button",jo=({getContext:e})=>{const t=bt("saveCanvasComponent"),o=X.useRef(null),n=()=>{const s=e(),r=uo(Lo,s);window&&window.localStorage.setItem("react-draw-saved-data",r)};return a.createElement("button",{className:t,id:be,onClick:n,ref:o},a.createElement("div",{style:{padding:"0px 5px",height:15}},a.createElement(Ut,{height:15,width:20})),a.createElement("label",{htmlFor:be,style:{padding:"0px 10px",pointerEvents:"none"}},"Save Canvas"))},$={args:{drawingTools:me,shouldSelectAfterCreate:!0,menuComponents:[jo,xe],shouldKeepHistory:!1,onLoad(e){const t=localStorage.getItem("react-draw-saved-data");t&&yo(t,Ao,e)},styleComponents:{color:{order:3,component:ke},background:{order:4,component:je},lineWidth:{order:1,component:Ae},opacity:{order:0,component:Le},fontSize:{order:2,component:Ee}},styles:{saveCanvasComponent:{width:180,fontSize:16,display:"flex",justifyContent:"flex-start",alignItems:"center",borderRadius:5,cursor:"pointer",padding:"7px 10px",backgroundColor:"white",marginBottom:10,boxSizing:"border-box",border:`1px solid ${ve.primary.main}`,"&:hover":{backgroundColor:ve.primary.light}}}}},Ue=Object.assign({},U);delete Ue.icon;const ko="my-image-tool-id",Ze={id:ko,onDrawEnd(){},onDrawing(){},onDrawStart(){},onResize(){}};function Oo(e){const t=X.useRef(),[o,n]=X.useState(0),s=u=>{t.current=u},r=()=>{const u=t.current;if(!u)throw new Error("Ctx getter not set");return u()},i=u=>{const p=Et(r());n(p.length)},c=()=>{const u=r(),p=De(u);Lt(u,{pointA:p,pointB:[p[0]+100,p[1]+100],toolId:U.id})},l=()=>{const u=r(),p=De(u),b=document.createElement("p");b.innerHTML=" loading...",At(u,{pointA:p,pointB:[p[0]+100,p[1]+100],toolId:Ze.id,url:"https://picsum.photos/200",showLoading:!0,loadingElement:b})},d=u=>{const p=r(),b=Z.id;if(!u){Se(p,{text:"hello, world",toolId:b,editable:!1});return}Se(p,{text:"hello, world",toolId:b,useTextToolDefaults:!0})},m=()=>Mt(r()),w=()=>Be(r()),z=()=>He(r()),E=()=>$e(r()),L=()=>Tt(r()),J=(u,p)=>xt(r(),u,p);return K.subscribe&&K.subscribe(i),a.createElement("div",null,a.createElement("div",{style:{display:"flex",gap:10}},a.createElement("div",{style:{paddingTop:10,display:"flex",flexDirection:"column"}},a.createElement("div",null,"Num Selected Items: ",o),a.createElement("button",{onClick:c},"Add Circle"),a.createElement("button",{onClick:l},"Add Picture"),a.createElement("button",{onClick:m},"Select All"),a.createElement("button",{onClick:w},"Duplicate Selected"),a.createElement("button",{onClick:z},"Move Selected Back"),a.createElement("button",{onClick:E},"Move Selected Forward"),a.createElement("button",{onClick:L},"Delete Selected"),a.createElement("button",{onClick:()=>d(!0)},"Add some editable text"),a.createElement("button",{onClick:()=>d(!1)},"Add some not editable text"),o>0&&a.createElement("div",null,a.createElement("label",null,"Stroke color"),a.createElement("input",{type:"color",onChange:u=>J("color",u.target.value)}))),a.createElement(Me,{...e,contextGetter:s})))}const W={render:e=>a.createElement(Oo,{...e}),args:{drawingTools:[K,Ue,Ze,Z],shouldKeepHistory:!1,shouldSelectAfterCreate:!0,hideTopBar:!0}},R={args:{drawingTools:me,actionTools:Pe,shouldKeepHistory:!0,shouldSelectAfterCreate:!0,styles:{toolIconWrapper:{"&:hover":{backgroundColor:"red"}},bottomToolButton:{'&[data-disabled="false"]:hover':{backgroundColor:"black"},'&[data-disabled="false"]:hover > svg path':{fill:"white",stroke:"white"}}}}};B.parameters={...B.parameters,docs:{...B.parameters?.docs,source:{originalSource:`{
  args: {
    drawingTools,
    actionTools,
    shouldSelectAfterCreate: true,
    isResponsive: false,
    shouldCornerResizePreserveRatio: false,
    styleComponents: {
      color: {
        order: 3,
        component: ColorStyle
      },
      background: {
        order: 4,
        component: BackgroundStyle
      },
      lineWidth: {
        order: 1,
        component: LineWidthStyle
      },
      opacity: {
        order: 0,
        component: OpacityStyle
      },
      fontSize: {
        order: 2,
        component: FontSizeStyle
      }
    },
    menuComponents: [ClearAllButton]
  }
}`,...B.parameters?.docs?.source}}};H.parameters={...H.parameters,docs:{...H.parameters?.docs,source:{originalSource:`{
  args: {
    drawingTools: [freeDrawTool],
    hideTopBar: true,
    hideBottomBar: true,
    shouldSelectAfterCreate: false,
    shouldKeepHistory: false
  }
}`,...H.parameters?.docs?.source}}};$.parameters={...$.parameters,docs:{...$.parameters?.docs,source:{originalSource:`{
  args: {
    drawingTools,
    shouldSelectAfterCreate: true,
    menuComponents: [SaveCanvas, ClearAllButton],
    shouldKeepHistory: false,
    onLoad(ctx) {
      const savedData = localStorage.getItem("react-draw-saved-data");
      if (savedData) deserializeData(savedData, deserializers, ctx);
    },
    styleComponents: {
      color: {
        order: 3,
        component: ColorStyle
      },
      background: {
        order: 4,
        component: BackgroundStyle
      },
      lineWidth: {
        order: 1,
        component: LineWidthStyle
      },
      opacity: {
        order: 0,
        component: OpacityStyle
      },
      fontSize: {
        order: 2,
        component: FontSizeStyle
      }
    },
    styles: {
      saveCanvasComponent: {
        width: 180,
        fontSize: 16,
        display: "flex",
        justifyContent: "flex-start",
        alignItems: "center",
        borderRadius: 5,
        cursor: "pointer",
        padding: "7px 10px",
        backgroundColor: "white",
        marginBottom: 10,
        boxSizing: "border-box",
        border: \`1px solid \${COLORS.primary.main}\`,
        "&:hover": {
          backgroundColor: COLORS.primary.light
        }
      }
    }
  }
}`,...$.parameters?.docs?.source}}};W.parameters={...W.parameters,docs:{...W.parameters?.docs,source:{originalSource:`{
  render: args => <ExternalControlsWrapper {...args} />,
  args: {
    drawingTools: [selectTool, circleToolCopy, imageTool, textAreaTool],
    shouldKeepHistory: false,
    shouldSelectAfterCreate: true,
    hideTopBar: true
  }
}`,...W.parameters?.docs?.source}}};R.parameters={...R.parameters,docs:{...R.parameters?.docs,source:{originalSource:`{
  args: {
    drawingTools,
    actionTools,
    shouldKeepHistory: true,
    shouldSelectAfterCreate: true,
    styles: {
      toolIconWrapper: {
        "&:hover": {
          backgroundColor: "red"
        }
      },
      bottomToolButton: {
        '&[data-disabled="false"]:hover': {
          backgroundColor: "black"
        },
        '&[data-disabled="false"]:hover > svg path': {
          fill: "white",
          stroke: "white"
        }
      }
    }
  }
}`,...R.parameters?.docs?.source}}};const zo=["Playground","FreeDrawOnly","SaveAndLoadJson","ExternalControls","CustomizeStyles"],$o=Object.freeze(Object.defineProperty({__proto__:null,CustomizeStyles:R,ExternalControls:W,FreeDrawOnly:H,Playground:B,SaveAndLoadJson:$,__namedExportsOrder:zo,default:Eo},Symbol.toStringTag,{value:"Module"}));export{$o as R};
